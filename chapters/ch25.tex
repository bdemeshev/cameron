
\chapter{Оценка эффектов воздействия}

\section{Введение}

Оценка воздействия (treatment evaluation) рассматривает вопросы измерения эффекта вмешательств того или иного рода на интересующие нас показатели, при этом как вмешательство, так и результирующий показатель могут определяться достаточно широко и применяться в различных контекстах. Сам подход и часть терминологии пришли из медицинских наук, где под вмешательством часто понимается использование того или иного типа лечения. Проведя лечение, можно измерять его эффект в сравнении, к примеру, с отсутствием лечения или другим его видом. В экономических приложениях воздействия и вмешательства как правило имеют сходный смысл. 

К примерам воздействия в экономическом контексте можно отнести участие в программах профессионального обучения, членство в профсоюзе, получение трансфертного платежа в рамках социальной программы, изменения в правилах получения социальных пособий или осуществления финансовых трансакций, изменение экономических стимулов и так далее; эти вопросы разобраны в работах Моффитта (1992), Фридлэндера, Гринберга, и
Роббинса (1997), и Хекмана, Лалонда, и Смита (1999). Если осуществляемое воздействие может быть разной интенсивности или типа, используется термин  \bfseries <<множественные воздействия>>. \mdseries По сравнению со случаем единичного воздействия эта ситуация не создает дополнительных затруднений, но позволяет более гибко определять базу для сравнения. 

Результат в данном случае заключается в изменении экономических показателей индивида при изменении его экономического статуса или внешних условий. Чаще всего результирующая переменная $y$ является непрерывной, и переменная воздействия $D$ --- бинарной, равной 1, если воздействие было и 0 в противном случае. Пример вмешательства из экономики труда --- это профессиональное обучение, которое может влиять на зарплату работников, прошедших обучение. В общем, однако, и результат, и воздействие, могут быть как непрерывными, так и дискретными. Детали анализа могут изменяться, но общая идея будет применима ко всем ситуациям. Для простоты, мы сосредоточимся на случае непрерывной результирующей переменной и бинарного воздействия. В дальнейшем мы расширим анализ на другие полезные на практике случаи. 

Очевидно, что оценка воздействия очень полезна для построения государственной политики, потому что успешные воздействия могут получать более широкое распространение, а в существующие программы могут вноситься улучшения. Хекман и Смит (1998) рассмотрели связь между несколькими наиболее часто используемыми измерителями эффекта воздействия и традиционным анализом выгод и издержек. 

Стандартная проблема анализа воздействия заключается в предпосылке о наличии причинной связи между воздействием и результатом. В каноническом примере одиночного воздействия мы наблюдаем $(y_i, x_i, D_i), \; i = 1, \dots, N$ и изучаем влияние гипотетического изменения $D$ на $y$ при фиксированном $x$. Такая ситуация рассматривается в модели с потенциальным результатом, уже рассмотренной в Главе 2, где интересующая нас результирующая переменная сравнивается на объектах, подвергшихся и не подвергшихся воздействию. Следовательно, это похоже на ситуацию с пропущенными данными, где можно изучать причинно-следственные связи и выдвигать гипотезы. Нас интересует, как результат среднего индивида, не подвергшегося воздействию, поменялся бы если бы он подвергся воздействию. То есть, нас интересует величина $\Delta y / \Delta D$ --- эффект этого воздействия. Здесь причинность в терминах ceteris paribus --- при прочих равных. 

Чем отличается эта глава от предыдущих, где мы тоже рассматривали идентификацию и оценку моделей? Здесь меняется объект нашего внимания, из-за чего возникают отличия. Главное отличие проистекает из того, что мы ориентируемся на целое семейство мер эффективности воздействия. Эти меры являются функциям от параметров и данных, и они позволяют проверять связанные с проводимой политикой гипотезы. Важный и интересный результат заключается в том, что не все меры могут быть построены при наличии данных и оценок. Выбор оценки и типа используемых данных налагает ограничения на гипотезы, которые можно проверить, и, следовательно, на эффекты, которые можно состоятельно оценить. 

Помимо в этого, в литературе также делается упор на преимуществах оценки с использованием минимума функциональных форм и ограничений (к примеру, полупараметрических оценок). Причиной тому является желание получить значимые для политики результаты, по возможности не зависящие от сильных предположений. Допустимость использования полупараметрических методов оценки воздействия в линейных моделях показать проще, чем в случае использования нелинейных моделей с ограничениями на зависимые переменные. 

В разделе 25.2 рассмотрены предположения, связанные с оцениванием. Раздел 25.3 рассматривает меры эффектов воздействия, которые обычно используются при идентификации и оценке. В разделе 25.4 рассматриваются оценки при помощи сопоставления (matching) и мер склонности (propensity score). Оценка воздействия методом разность разностей (differences-in-differences), использующаяся при изучении событий с использованием квази-экспериментальных данных, рассмотрена в разделе 25.5. Продолжая работать с квази-экспериментальными данными, мы рассмотрим разрывные регрессии (regression discontinuity) в разделе 25.6 и оценки методом инструментальных переменных в разделе 25.7. Рассматриваются преимущественно линейные модели. В разделе 25.8 приводятся примеры применения предложенных методов на практике. 

\section{Структура и предположения}

Методы оценивания эффектов воздействия опираются на предположения, позволяющие идентифицировать причинные эффекты, так же, как и, к примеру, линейная модель одновременных уравнений опирается на предположения того же рода (см. Главу 2). В этом разделе мы рассмотрим предположения, позволяющие оценки сопоставления и мер склонности, предложенные в разделе 25.4. 

Для начала рассмотрим структуру для получения причинных параметров при оценке воздействия. 

\subsection{Условия исследования эффектов воздействия}

В плане условий, начнем со случайного назначения объектов, на которые будет оказано воздействие, в рамках социального эксперимента, описанного в разделе 3.3. Пусть есть целевая совокупность для воздействия и $N$ обозначает количество случайно отобранных индивидов, на которых будет оказано воздействие. Тогда $N_C = N - N_T$ --- число индивидов, не подвергнутых воздействию, которые служат контрольной группой. 

Случайное назначение предполагает, что процесс назначения игнорирует возможное влияние воздействия на результат. К примеру, никто не попадает в выборку только потому, что потенциальная выгода от его включения будет большой и никто не игнорируется потому, что выгода от его включения невелика. Обозначим $(y_i, x_i, D_i; \; i = 1, \dots, N)$ вектор наблюдений со скалярной результирующей переменной $y$, вектором наблюдаемых переменных $x$ и бинарным индикатором воздействия $D$. Для простоты, предположим, что все, кому назначено воздействие, получают его, а все кому не назначено --- не получают. Результирующая переменная индивида, подвергшегося воздействию, обозначается $y_1$, не подвергшегося --- $y_0$. После проведения эксперимента и сбора данных, мы оцениваем эффект этого воздействия. Самый естественный способ измерения эффекта воздействия --- это построить показатель, который будет сравнивать средние результаты в подвергшихся и не подвергшихся воздействию группах. 

С одним важным отличием, та же самая схема может применяться и к данным, полученных в ходе наблюдения. Отличие заключается в том, что теперь нет механизма случайного назначения, возможно, потому что индивиды сами решают, подвергаться им воздействию или нет, возможно по другим причинам. 

Надо заметить, что большая часть работ в области оцени воздействия имеют характер частичного равновесия, то есть, они предполагают отсутствие эффектов общего равновесия. Под этим мы подразумеваем, что эффекты воздействия невелики и не влияют на переменные, которые мы считаем экзогенными. Это предположение не выполняется, если мы рассматриваем программу, затрагивающую целый сектор, являющийся важной частью национальной экономики. К примеру, введение всеобщего медицинского страхования может повлиять на весь сектор, связанный с оказанием медицинских услуг, что может затруднить применение методов, рассматриваемых в этой главе. 

Есть несколько проблем, которые могут возникнуть при оценке эффектов воздействия. Есть также небольшие различия в интерпретациях, возникающие из-за различий в предположениях, используемых для получения оценок. Следовательно, мы начнем с рассмотрения этих предположений. 

\subsection{Предположение об условной независимости}

Необходимо ввести ряд предположений, чтобы сравнения результатов в двух группах имели какой-то смысл. Для начала мы перечислим и объясним их, а затем используем в обсуждении идентифицируемости отдельных эффектов воздействия. 

Важным предположением является \bfseries предположение об условной независимости \mdseries, согласно которому, результаты и воздействие независимы при заданных $x$, то есть

\begin{equation}
\label{eq25.1}
y_0, y_1 \perp D | x. 
\end{equation}
Это означает, что участие в программе не зависит от результата после учета изменчивости результата, обусловленной различиями в $x$. Правильно примененное случайное назначение обеспечивает выполнение этого требования. При полностью случайном назначении мы можем сделать даже более сильное предположение:

\begin{equation}
\label{eq25.2}
y_0, y_1 \perp D, 
\end{equation}
потому что назначение будет случайным на всем пространстве $(y, x)$. Более часто применяемое предположение~(\ref{eq25.1}) может быть использовано для идентификации параметров воздействия, потому что, согласно ему, воздействие и результат независимы, если мы учли влияние регрессоров $x$, некоторые из которых могут быть связаны с $D$. 

Предположение об условной независимости достаточно широко и предполагает следующее 


\begin{align}
\label{eq25.3}
& F(y_j | x, D = 1) = F(y_j | x, D = 0) = F(y_j | x), \; j = 0,1 ,  \\
& F(u_j | x, D = 1) = F(u_j | x, D = 0) = F(u_j | x), \; j = 0,1, \nonumber
\end{align}
где $u$ --- ошибка в модели регрессии. Это означает, что решение об участии не влияет на \bfseries распределение возможных результатов \mdseries. 

Чтобы оценить последствия этого предположения, предположим, что $\E[y|x, D]$ линейно, то есть, уравнение результат-участие:

\begin{equation}
\label{eq25.4}
y = x' \beta + \alpha D + u, 
\end{equation}
где $\E[u|D] = \E [y - x' \beta - \alpha D | D] = 0$. Следовательно, $D$ может трактоваться как экзогенная переменная, и тогда в модели не будет смещения из-за одновременности или самоотбора. При стандартных предположениях на $x$, возможно получить состоятельные оценки параметров регрессии. 

Можно рассмотреть предположение, которое будет слабее, чем~(\ref{eq25.1}):

\begin{equation}
\label{eq25.5}
y_0 \perp D | x,
\end{equation}
которое предполагает условную независимость участия и $y_0$. Это предположение используется для установления идентифицируемости среднего по совокупности \bfseries эффекта воздействия на подвергшуюся воздействию группу (treatment effect on the treated, ATET) \mdseries, как будет показано ниже. 

В литературе встречаются другие названия для предположения~(\ref{eq25.5}). Имбенс (2005) ссылается на него как на \bfseries предположение о несмешиваемости (unconfoundedness assumption) \mdseries, Рубин называет его \bfseries предположением об игнорируемости (ignorability assumption) \mdseries (Рубин, 1978, Вулдридж, 2001). Его введение приводит к тому, что при включении $x$ в регрессию в модели нет смещения из-за пропущенных переменных, и, следовательно, нет смешивания. Это предположение эквивалентно тому, что назначение воздействия игнорирует результаты, следовательно, на него можно ссылаться и как на предположение об игнорируемости. 

Это предположение необходимо, если переменная воздействия рассматривается как экзогенная, что очень важно для простоты оценивания. Иначе нужно использовать модели с самоотбором выборки или методы работы с инструментальными переменными для учета эндогенных переменных воздействия, эти методы разобраны в разделе 25.4. 

\subsection{Предположение о пересечении}

Второе предположение, называемое \bfseries предположением о пересечении \mdseries или \bfseries о сопоставлении \mdseries (overlap, matching), необходимо для идентификации некоторых мер воздействия. Согласно этому предположению

\begin{equation}
\label{eq25.6}
0 < \Pr [D = 1| x] < 1, 
\end{equation}
Это предположение гарантирует, что для каждого значения $x$ мы наблюдаем как подвергшиеся воздействию случаи, так и не подвергшиеся. В этом смысле у нас есть пересечение подвергшихся и не подвергшихся воздействию выборок. Каждому подвергшемуся воздействию индивиду сопоставляется неподвергшийся с таким же $x$. Если это предположение не выполнено, мы можем иметь индивидов с одинаковым вектором $x$, целиком подвергнутых воздействию, и других, с другим $x$, --- целиком не подвергнутых. Это требование не обязательно для идентификации параметра воздействия только для подвергнутой воздействию группы. В этом случае для идентификации эффекта воздействия для случайно отобранного индивида, нам требуется аналогичный ему индивид, не подвергавшийся воздействию. Тогда достаточно условия $\Pr [D = 1|x] < 1$. 

\subsection{Предположение об условном среднем}

Третье предположение --- это \bfseries предположение о независимости условного среднего: \mdseries

\begin{equation}
\label{eq25.7}
\E[y_0 | D = 1, x] = \E [y_0 | D = 0, x] = \E [y_0|x], 
\end{equation}
согласно которому $y_0$ не влияет на участие. 

\subsection{Меры склонности}

Когда индивиды, подвергающиеся воздействию, выбираются не случайно, а в зависимости от вектора наблюдаемых характеристик $x$, как это бывает при использовании данных наблюдения или когда воздействие назначается индивидам в зависимости от их наблюдаемых характеристик (таких как возраст, пол или социоэкономический статус), очень полезным оказывается использование \bfseries мер склонности. \mdseries Эта мера условной вероятности участия в программе при заданном $x$ обозначается $p(x)$, где

\begin{equation}
\label{eq25.8}
p(x) = \Pr [D = 1| X = x].
\end{equation}
Мера склонности может быть рассчитана по данным $(D_i, x_i)$ при помощи параметрических или полупараметрических методов, рассмотренных в Главе 14 (к примеру, при помощи логит-регрессии). 

Очень важную роль в оценке воздействия играет предположение, называемое \bfseries балансирующим условием, \mdseries согласно которому

\begin{equation}
\label{eq25.9}
D \perp x | p (x).
\end{equation}
Иначе говоря, для индивидов с одинаковой мерой склонности назначение на воздействие случайно и не зависит от вектора $x$. Выполнение балансирующего условия  можно тестировать. 

\begin{table}[h!]
\caption{\label{tab: } Эффекты воздействия --- обозначения}
\begin{center}
\begin{tabular}{ll}
\hline
\hline
Обозначение & Определение \\
\hline
$y_1$ & Результат группы, подвергнутой воздействию (экспериментальной) \\
$y_0$ & Результат группы, не подвергнутой воздействию (контрольной) \\
$p(x)$ & Мера склонности \\
$N_T$ & Число подвергнутых воздействию индивидов в выборке \\
\hline
\hline
\end{tabular}
\end{center}
\end{table}

Есть очень полезный результат, касающийся условной независимости $p(x)$, полученный в работе Розенбаума и Рубина (1983):

\begin{equation}
\label{eq25.10}
y_0, y_1 \perp D | x \Rightarrow y_0, y_1 \perp D | p(x).
\end{equation}
То есть, выполнение предположения об условной независимости при заданном $x$ приводит к условной независимости при заданном $p(x)$, то есть, независимости $y_0, y_1$ и $D$ при заданном $p(x)$. 

Чтобы получить этот результат, заметим, что 

\begin{align}
\Pr[D=1 | y_0, y_1, p(x)] & =  \E[D | y_0, y_1, p(x)] \nonumber \\
& =  \E[ \E[D | y_0, y_1, p(x), x] | y_0, y_1, p(x)] \nonumber \\
& =  \E[ \E[D | y_0, y_1, x] | y_0, y_1, p(x)] \nonumber \\
& =  \E[ \E[D | x] | y_0, y_1, p(x)] \nonumber \\
& =  \E[ p(x) | y_0, y_1, p(x)] \nonumber \\
& = p(x). \nonumber
\end{align}
Здесь вторая и третья строки следуют из закона повторных ожиданий. Четвертая строка использует условную независимость. Интуиция за этим результатом заключается в том, что $p(x)$ --- функция от $x$ и, в определенном смысле, содержит меньше информации, чем $x$. Поэтому условная независимость при заданном $p(x)$ следует из независимости при заданных $x$. Из-за условия на $x$ мы избавляемся от корреляции между $x$ и $D$, так же как беря условие на меру склонности, мы устраняем корреляцию между $x$ и $D$. Поэтому регрессия, сходная с~(\ref{eq25.4}) имеет вид:
\begin{align}
\label{eq25.12}
y & = x' \beta + \alpha p(x) + u \\
& = x' \beta + \alpha \hat p(x) + ( u + \alpha (p(x) - \hat p(x))).
\end{align}
Во второй строке неизвестная $p(x)$ заменяется на выборочную оценку, что приводит к добавлению выборочной ошибки к регрессионной ошибке. Достоинства и недостатки этого подхода будут рассмотрены ниже. В таблице 25.1 приводятся основные обозначения. 

\section{Эффекты воздействия и смещение самоотбора}

Мы начинаем с представления двух широко используемых способов измерения эффектов воздействия --- способа, усредняющего по всем индивидам и способа, усредняющего только по подвергшимся воздействию. После этого мы обсудим роль самоотбора при изучении воздействия. Методы, представленные в разделах 25.4 --- 25.6 предполагают, что эффекты самоотбора прямо зависят только от измеряемых наблюдаемых характеристик индивида, таких как возраст. Если помимо этого зависят от ненаблюдаемых показателей, необходимо использовать методы из Главы 16. Данный раздел включает обсуждение вопросов, связанных с самоотбором. 

\subsection{Два основных параметра: ATE и ATET}

Определим $\Delta$ как разницу в результате в экспериментальной и контрольной группах:

\begin{equation}
\label{eq25.13}
\Delta = y_1 - y_0,
\end{equation}
где, при желании, можно добавить зависимость от $x$. Подчеркнем, что $\Delta$ не наблюдается явно, потому что ни один индивид на наблюдается в двух состояниях одновременно. Полученные по генеральной совокупности \bfseries средний эффект воздействия (average treatment effect, ATE)  \mdseries и \bfseries средний эффект воздействия подвергнутой воздействию группы (average treatment effect on the treated, ATET) \mdseries определяются:

\begin{equation}
\label{eq25.14}
ATE = \E[\Delta],
\end{equation}
\begin{equation}
\label{eq25.15}
ATET = \E [\Delta | D = 1],
\end{equation}
с выборочными аналогами:
\begin{equation}
\label{eq25.16}
\widehat{ATE} = \frac{1}{N} \sum_{i=1}^N [\Delta_i],
\end{equation}
\begin{equation}
\label{eq25.17}
\widehat{ATET} = \frac{1}{N_T} \sum_{i=1}^{N_T} [\Delta_i | D_i = 1],
\end{equation}
где $N_T = \sum_{i=1}^N D_i$. В каждом из этих двух случаев, вычисления очевидны, если есть возможность получить $\Delta_i$. Процедура затрудняется тем, что в формулах присутствует ненаблюдаемый компонент, который необходимо оценить, что требует введения дополнительных предположений. 

ATE релевантна, когда воздействие может быть применено к любому индивиду и гипотетически можно исследовать выигрыш от воздействия для любого случайно выбранного члена генеральной совокупности. ATET используется, когда мы хотим оценить средний выигрыш именно для тех, кого подвергли воздействию. Подробнее см. в работе Хекмана и Вытлацила (2002). 

Чтобы понять проблему оценки воздействия, рассмотрим средний выигрыш от участия при заданных характеристиках $x$. Тогда

\begin{align}
\label{eq25.18}
ATE & =  \E[ \Delta | X=x ]  \\
& =  \E[ y_1 - y_0 | X = x ] \nonumber \\
& =  \E[ y_1 | X=x ] - \E[ y_0 | X=x ] \nonumber \\
& =  \E[ y_1 | x, D = 1] - \E[ y_0 | x , D = 0 ], \nonumber
\end{align}
где последнее равенство использует предположение об условной независимости~(\ref{eq25.1}). 

Имея выборку для участников, можно оценить $\E [y_1 | D = 1, x]$. Однако, $\E[y_0 | x, D = 0]$ не наблюдается, потому что это мера для участников, которую они имели бы если бы они не участвовали, а наблюдать одновременно одних и тех индивидов как участников и неучастников невозможно. Для использования ATE мы должны найти оценку для второго члена. 

По определению~(\ref{eq25.18})

\begin{align}
\label{eq25.20}
ATE & =  \E[ y_1 | x, D = 1] - \E[ y_0 | x , D = 0 ]  \\
& =  \mu_1(x) - \mu_0(x) + \E[ u_1 | x, D = 1] - \E[ u_0 | x , D = 0 ]  \nonumber \\
& =  \mu_1(x) - \mu_0(x) + \E[ u_1 | x] - \E[ u_0 | x ] \nonumber \\
& =  \mu_1(x) - \mu_0(x),
\end{align}
где первый член в правой части уравнения на первой строчке может быть оценен при помощи данных об участниках программы, а второй член не наблюдается. Следующие три строчки получаются применением условной независимости и предположения об условном среднем при использовании спецификации $y_1 = \mu_1(x) + u_1$ для подвергающихся воздействию и $y_0 = \mu_0 (x) + u_0$ для не подвергающихся. Второй член из последней строки требует только независимости средних, а не полной условной независимости. 

\subsection{Отбор и смещение самоотбора}

Проблема описанного выше метода заключается в том, что $\E [y_0 | x, D = 1]$ не наблюдается. Решение этой проблемы частично зависит от типа доступных данных. В социальных экспериментах в качестве прокси для сравнения используются подходящие участники, не вошедшие в экспериментальную группу. Если данные получаются в процессе наблюдения, группа для сравнения получается из того же источника, что и экспериментальная группа, или из других баз данных, в итоге всё сводится к получению функции от $\E[y_0 | x, D = 0]$, которая может быть оценена при помощи данных о не-участниках. Простота вычисления для данных, полученных в ходе хорошо построенных и проведенных социальных экспериментов, противопоставляется другим проблемам, таким как \bfseries смещение выборки \mdseries и \bfseries смещение от замещения \mdseries (рассмотрено в Главе 3). 

Предположим, что для подвергающихся воздействию участников результат принимает вид:

\begin{align}
\label{eq25.22}
y_1 & =  \E[ y_1 | x]  + u_1  \\
& =  \mu_1(x) + u_1
\end{align}
а для не-участников:

\begin{align}
\label{eq25.24}
y_0 & =  \E[ y_0 | x]  + u_0  \\
& =  \mu_0(x) + u_0
\end{align}
Заметим, что эта спецификация устроена как регрессия с переключением (аналогично модели Роя, рассмотренной в разделе 16.7) в том смысле, что здесь участники и не-участники имеют разные функции условного среднего, $\mu_1(x)$ и $\mu_0(x)$, которые записываются в более общих терминах, чем требуется для чисто линейных моделей. Мы предполагаем, что $\E [u_1 | X] = \E[u_0 | X] = 0$, однако $\E [u_1 | x, D]$ и $\E [u_0 | x, D]$ не обязательно равны нулю. 

Более распространенная, но более узкая, спецификация имеет вид

\begin{equation}
\label{eq25.25}
\mu_1 (x) = \mu_0 (x) + \alpha D, 
\end{equation}
в которой для группы, подвергающейся воздействию, вводится дополнительная константа $\alpha$, но коэффициенты наклона не зависят от воздействия. 

\begin{table}[!h]
\caption{\label{tab:} Измерение эффектов воздействия: ATE и ATET}
\begin{center}
\begin{tabular}{lll}
\hline
\hline
Мера & Эффект воздействия & Частный случай (25.25) \\
\hline
ATE при заданном x & $\E [\Delta | x] = \mu_1(x) - \mu_0(x) $ & $\E[\Delta | x] = \alpha$ \\
ATET с x и эффектом отбора & $\E [\Delta | x, D = 1] $ & $\E[\Delta | x, D = 1]$ \\
& $ = \mu_1(x) - \mu_0(x)$ & $ = \alpha + \E [u_1 - u_0 | x, D = 1]$ \\
& $ + \E[u_1 - u_0 | x, D = 1]$ & \\

Дополнительный выигрыш & $\E [u_1 - u_0 | x, D = 1] $ & $\E [u_1 - u_0 | x, D = 1]$ \\
индивида с $x$ & & \\
Среднее смещение самоотбора & $\E [u_0 | x, D = 1]$ & $\E [u_0 | x, D = 1]$ \\
&  $ - \E [u_0 | x, D = 0]$ & $ - \E [u_0 | x, D = 0]$ \\
\hline
\hline
\end{tabular}
\end{center}
\end{table}

Наблюдаемый результат $y$ записывается как

\begin{equation}
\label{eq25.26}
y = D y_1 + (1-D) y_0. 
\end{equation}

Комбинируя эти уравнения, получаем

\begin{align}
\label{eq25.27}
y & = D (\mu_1 (x) + u_1) + (1-D)(\mu_0(x) + u_0) \nonumber \\
& =  \mu_0 (x) + D(\mu_1 (x) - \mu_0 (x) + u_1 - u_0) + u_0. 
\end{align}
Из-за того, что $D = 1$ или $0$, второй член в регрессии <<переключается>>. Второй член в~(\ref{eq25.27}) измеряет выгоду от участия; первая составляющая $\mu_1(x) - \mu_0(x)$ измеряет средний выигрыш для участника с характеристиками $x$ и вторая составляющая $(u_1 - u_0)$ --- это выигрыш, индивидуальный для каждого участника. Вторая компонента может наблюдаться участником, но не наблюдаться исследователем. 

Выражения для ATE и ATET приводятся в таблице 25.2, в общем случае и для спецификации~(\ref{eq25.25}). 

Среднее смещение самоотбора --- это разница между участниками программы и не-участниками в базовом состоянии. Эта разница не может быть приписана воздействию. Специальный случай --- это $\E [u_1 - u_0 | x, D = 1] = 0$, который возникает, если нет ненаблюдаемых компонент в выигрыше от участия или лучшая индивидуальная оценка $u_1 - u_0$ равна нулю. 

Смещение самоотбора возникает, когда переменная воздействия коррелирована с ошибкой в уравнении для результата. Эта корреляция может быть вызвана наличием пропущенных переменных, которые влияют на $D$ и $y$. Тогда компонента регрессионной ошибке, соответствующая пропущенной переменной, будет коррелирована  с $D$ --- случай \bfseries отбора по наблюдаемым показателям. \mdseries Другой источник смещения --- это ненаблюдаемые факторы, влияющие на $D$ и $y$. Это случай \bfseries отбора по ненаблюдаемым показателям. \mdseries Предположение об условной независимости устраняет проблемы, связанные с пропущенными переменными. 

\subsection{Отбор по наблюдаемым показателям}

При использовании данных, полученных в ходе наблюдения, проблема отбора по наблюдаемым показателям решается при помощи регрессионных методов и методов сопоставления. В следующих разделах данной главы эти методы разбираются в деталях. Прежде, чем перейти к ним, отметим, что в качестве примера здесь можно привести двухчастную модель из раздела 16.4. В этом же разделе мы рассмотрим другой очевидный метод. 

 \bfseries Оценка управляющей функции \mdseries нужна для того, чтобы учесть возможную корреляцию наблюдаемых переменных $z$, определяющих $D$, с результатами. Рассмотрим конкретный случай с уравнением для результата:

\begin{equation}
\label{eq25.28}
y_i = x'_i \beta + \alpha D_i + u_i
\end{equation}
с такой ошибкой, что 

$$
\E [u_i | x_i, D_i] = \E [u_i | x_i, D_i, z_i]. 
$$
В случае отбора по наблюдаемым показателям возможно, что $\E[u_i|z_i] \ne 0$. Тогда

\begin{equation}
\label{eq25.29}
\E [y_i | x_i, D_i, z_i] = x'_i \beta + \alpha D_i + \E [u_i | x_i, z_i],
\end{equation}
что мотивирует использование оценок управляющей функции, основанной на МНК/ОМНК оценивании уравнения. Основная идея заключается в том, что нужно добавить в уравнение для результата все наблюдаемые переменные, которые могут быть коррелированы с $u_i$ и оценить полученное уравнение. В этом случае

\begin{equation}
\label{eq25.30}
y_i = C'_i \delta + \alpha D_i + \{ u_i - \E[u_i | D_i, C_i] \},
\end{equation}
где $C_i$ включается в себя все переменные, входящие в $x$ или в $z$. Наличие $z$ в регрессии устраняет возможную корреляцию между $u$ и $z$. Заметим, что при отборе по ненаблюдаемым показателям, вызванном наличием общих ненаблюдаемых факторов, влияющих на $D$ и $u$, мы по-прежнему сталкиваемся с возможностью возникновения проблем с идентификацией. 

Эта оценка была использована в работе Хекмана и Хотца (1989), там же предложены альтернативные варианты простых оценок метода управляющих функций. 

\subsection{Отбор по ненаблюдаемым показателям}

Теперь рассмотрим частный линейный случай, где решение об участии в программе воздействия эндогенно. Это пример из известного класса моделей с <<эндогенной дамми-переменной>>. С эмпирической точки зрения модель очень важна при работе с данными, полученными в ходе наблюдений, потому что в таком случае есть несколько причин отказаться от ограничивающих предположений $y_0, y_1 \perp D | x$ или $\E[u|x, D] = 0$. Нарушение предположения об условной независимости приводит к тому, что простая регрессия методом наименьших квадратов не может идентифицировать ATE, в силу чего возникает необходимость использовать другую стратегию идентификации. 

Основные элементы в стратегии идентификации, которые мы будем обсуждать, похожи на случай моделей с самоотбором. Подход требует достаточно сильных предположений и полностью параметрический. В рассмотренном специальном случае, спецификация аналогична модели Роя. Берутся линейные условные средние в уравнениях для результирующей переменной. В модели также присутствует уравнение для решения об участия для переменной $D_i$. Тогда:

\begin{align}
\label{eq25.31}
& y_{1i} = x'_i \beta_1 + u_{1i}, \\
& y_{0i} = x'_i \beta_0 + u_{0i}, \nonumber \\
& D^*_i = z'_i \gamma + \e_i, \nonumber
\end{align}
где $D_i^*$ --- латентная переменная, такая, что

\begin{equation}
\label{eq25.32}
D_i=\begin{cases}
1, \text{ если }D_i^*>0,\\
0, \text{ если }D_i^* \le 0,
\end{cases}
\end{equation}
предполагается, что $\E [u_1 | x, z] = \E[u_0 | x, z ] = 0$. 

Часть переменных из $z$ могут присутствовать и в $x$, но предполагается, что по меньшей мере один компонент $z$, обозначенный $z_1$, уникален. То есть, существует по меньшей мере одна независимая переменная, определяющая $D$. Поэтому можно рассматривать $z_1$ как инструментальную переменную, коррелированную с эндогенной переменной $D$, и связанную с результирующими переменными $y_0$ и $y_1$ только через $D$. 

Далее, предполагается, что $(u_{1i}, u_{0i}, \e_i)$ имеют совместное нормальное распределение с нулевым средним и ковариационной матрицей $\Sigma$:

\begin{equation}
\label{eq25.33}
\Sigma = \begin{bmatrix}
\sigma_{11} & \sigma_{10} & \sigma_{1 \e} \\
\sigma_{10} & \sigma_{00} & \sigma_{0 \e} \\
\sigma_{1 \e} & \sigma_{0 \e} & 1 \\
\end{bmatrix}.
\end{equation}
Ненулевые ковариации $\sigma_{1 \e}$ и $\sigma_{0 \e}$ отражают эндогенность переменной воздействия. Параметр $\sigma_{10}$ отражает ковариацию между результатами. Из-за того, что мы не можем наблюдать одного индивида в обоих состояний, этот параметр не может быть оценен и обычно считается равным нулю. Дисперсия $\e$ принимается за 1 для удобства оценивания. 

При использовании такой полностью параметрической спецификации, модель может быть оценена методом максимального правдоподобия или двухшаговой полупараметрической процедурой. Эти вопросы были рассмотрены в Главе 16. Оставляя в стороне нюансы оценивания, мы сосредоточимся на измерении эффекта воздействия. 

Выгода от участия, ATET, задается следующим образом:

\begin{equation}
\label{eq25.34}
y_{1i} - \E [y_{0i} | D_i = 1] = y_{1i} - x'_i \beta_0 + \sigma_{0 \e} \frac{\phi(z'_i \gamma)}{1 - \Phi (z'_i \gamma)}.
\end{equation}
Это можно переписать в форме:

\begin{equation}
\label{eq25.35}
\E [y_{1i} | D_i = 1] - \E [y_{0i} | D_i = 1] = x'_i (\beta_1 - \beta_0) + (\sigma_{0 \e} - \sigma_{1 \e}) \frac{\phi(z'_i \gamma)}{\Phi (z'_i \gamma)},
\end{equation}
где $(\alpha_{0 \e} - \alpha_{1 \e}) \phi(z'_i \gamma)/\Phi (z'_i \gamma)$ --- эффект отбора, см. раздел 16.7.1. 

В частном случае, где $x'_i \beta_0 = x'_i \beta_1$ и дамми на воздействие входит в уравнение для $y_1$ линейно  с коэффициентом $\alpha$, средний эффект программы равен

\begin{equation}
\label{eq25.36}
\E [y_{i} | D_i = 1] - \E [y_{i} | D_i = 0] = \alpha + \text{ эффект отбора}.
\end{equation}

Для некоторых выборок такая стратегия оценки может быть неустойчивой. К примеру, экспериментальная и контрольная группы могут быть слишком разными, предположение о многомерной нормальности может не выполняться, или инструментальная переменная $z_1$ может быть слабой или коррелированной с ошибкой модели для результата. 

Эти соображения приводят к необходимости использовать альтернативные процедуры оценивания, представленные в этой главе. Они, как правило, предполагают отбор только по наблюдаемым переменным, хотя в разделе 25.7 представлены методы с инструментальными переменными, применимые и при отборе по ненаблюдаемым показателям. 

\section{Оценки при помощи сопоставления и мер склонности}

Когда данные получены в процессе наблюдения, возможности влиять на выбор участников, как при проведении эксперимента, нет. Поэтому нет возможности рассчитать аналог ATE как среднюю разницу между результатами в двух группах, нет базы для сравнения. Её можно заменить на данные, полученные, возможно, из другого источника, но где есть индивиды со сходными наблюдаемыми характеристиками, $x$, не подвергавшиеся воздействию, и сопоставить с имеющимися индивидами, подвергавшимися изучаемому воздействию. 

Средний результат для контрольной группы можно использовать как средний результат для экспериментальной группы в гипотетической ситуации, где она бы не подвергаются воздействию. Этот подход разрешает проблему с оцениванием путем ввода дополнительного предположения: что отбор не зависит от результата для не-участников при условии на $x$. Чтобы применять его на практике, необходимо определить критерии сопоставления. 

\subsection{Предположения для оценки эффектов воздействия}

Оценка эффектов воздействия при помощи сопоставления может использоваться, когда отбор осуществляется только на основе наблюдаемых показателей. Помимо этого, предполагается выполнение \bfseries условия пересечения \mdseries ~(\ref{eq25.6}), согласно которому для каждого заданного $x$ есть положительная вероятность не-участия. Это гарантирует, что для каждого участника с характеристиками $x$ мы можем найти не-участника с такими же характеристиками. Грубо говоря, контрольная и экспериментальная группы имеют сравнимые наблюдаемые характеристики. Для получения хороших сопоставлений требуется выполнение условия пересечения. Помимо этого, ключевую роль играет то, что ненаблюдаемые характеристики не влияют на назначение воздействия и результат. 

При оценке регрессии происходит импутация пропущенных потенциальных результатов. Если $D_i = 1$, $y_{0,i}$ определяются при помощи оценки условной регрессии $\hat \mu_0 (x_i)$. Оценки сопоставления определяет пропущенные значения по методу <<ближайших соседей>>, которые определяются при помощи подходящей метрики на основе наблюдаемых характеристик. Это дает определенные основания для проведения аналогий между оценкой сопоставления и непараметрическими методами, основанными на ближайших соседях. Оценка сопоставления как правило оценивает разницу средних, а дисперсия оценки вычисляется одним из способов вычисления дисперсии разности. 

Сопоставление является очень привлекательным методом, если: $(1)$ нам доступен большой набор переменных $x$, $(2)$ есть много потенциальных регрессоров и $(3)$ предметом изучения является ATET. Для оцениванивания также требуется предположение об отсутствии эффектов общего равновесия, или \bfseries предположения о стабильности величины воздействия (stable unit treatment value assumption, SUTVA), \mdseries согласно которому воздействие не имеет непрямых эффектов на наблюдения из контрольной группы. Оценка сопоставления, однако, не требует предположения, что эффект воздействия входит в условное среднее линейно. Первый шаг заключается в поиске ближайших соответствий для каждого наблюдения, и он же позволяет понять, доступно ли для сравнения достаточно контрольных наблюдений. В отличие от регрессионного подхода, здесь меньше опасности экстраполировать  за пределами диапазона значений данных. 

Предположим, что всем наблюдениям из экспериментальной группы нашлись сопоставления в терминах всех наблюдаемых объясняющих переменных. Тогда, в определенном смысле, мы учитываем все различия между экспериментальной и контрольной группами. Зная результаты $y_{1i}$ и $y_{0i}$ для экспериментальной и контрольной групп соответственно, можно получить средний эффект воздействия:

\begin{align}
\label{eq25.37}
\E & [y_{1i} | D_i = 1] - \E [y_{0i} | D_i = 0]  \\
& = \E [y_{1i} - y_{0i} | D_i = 1] + \{  \E [y_{0i} | D_i = 1] -  \E [y_{0i} | D_i = 0] \}. \nonumber
\end{align}
Первый член во второй строчке --- это ATET, а второй --- это <<смещение>>, он будет нулевым, если назначение в экспериментальную и контрольную группы было случайным. В таком случае всё, что требуется для получения оценки ATET --- это оценить среднюю разность результатов. 

В более реалистичном случае мы будем использовать наблюдаемые объясняющие переменные $x_i$. Предполагается, что сюда входят переменные, которые влияют на отбор в экспериментальную группу. Если контрольная и экспериментальная группы сопоставляются по каждому сочетанию объясняющих переменных, можно легко вычислить различия в результатах для каждого наблюдения из экспериментальной группы и каждого $x_i$. Средняя разность результатов по всем подвергнутым воздействию индивидам и по всем $x_i$ будет средним эффектом воздействия. Формально, в этом случае (см. Ангрист и Крюгер, 2000, с. 1316) эффект воздействия примет вид

\begin{align}
\label{eq25.38}
\E [y_{1i} - y_{0i} | D_i = 1] &= \E[ \{ \E[y_{1i} | x_i, D_i = 1] - \E[y_{0i} | x_i, D_i = 0] \} | D_i = 1 ]  \\
& = \E [\Delta_x | D_i = 1], \nonumber
\end{align}
где $\Delta_x = \E [y_{1i} | x_i, D_i = 1] - \E[y_{0i} | x_i, D_i = 0] $. 

Если переменные $x$ --- дискретные, оценка сопоставления определяется как взвешенная сумма

\begin{equation}
\label{eq25.39}
\E [y_{1i} - y_{0i} | D_i = 1] = \sum_x \Delta_x \Pr [x_i = x | D_i = 1],
\end{equation}
где $\Pr [x_i = x | D_i = 1]$ --- вероятность $x_i$ при $D_i = 1$. Ангрист и Крюгер (2000) рассматривают некоторые аспекты этой оценки. 

\subsection{Точное сопоставление}

Процедура заключается в сопоставлении индивидов из экспериментальной и контрольной выборок на основании их наблюдаемых характеристик $x$. 

\bfseries Точно сопоставление \mdseries применимо, когда вектор объясняющих переменных дискретный и выборка содержит много наблюдений для каждого отдельного значения $x$. 

Если вектор объясняющих переменных имеет большую размерность или если среди переменных есть непрерывные, точно сопоставление двух групп невозможно. Тогда применяются методы \bfseries неточного сопоставления. \mdseries Неточное сопоставления преобразует $x$ в показатель с меньшей размерностью, непрерывный или дискретный, обычно используется скаляр $f(x)$. 

\subsection{Меры склонности}

Использование мер склонности (Розенбаум и Рубин, 1983) --- популярный метод неточного сопоставления. Вместо сопоставления регрессоров он сопоставляет меры склонности. Точные сопоставления по-прежнему невозможны, поэтому для сравнения используются те объекты, которые оказались достаточно близко к исследуемому. 

\bfseries Мера склонности \mdseries --- условная вероятность получить воздействие при заданном $x$, обозначаемая $p(x)$, была предложена Розенбаум и Рубин (1983). Как отмечено в разделе 25.2.5, если данные позволяют осуществлять сопоставление на основе $x$, они позволяют также и сопоставлять на основе мер склонности. 

Меры склонности как правило оцениваются при помощи параметрических моделей, таких как логит или пробит, но, в принципе, могут быть оценены и непараметрически. 

\subsection*{Сопоставление про помощи мер склонности}

При использовании мер склонности мы учитываем влияние регрессоров, учитывая влияние определенной функции от них --- условной вероятности получить воздействие, $\Pr [ D_i = 1 | x_i ]$ . То есть, сопоставление проводится по мере склонности. Она может быть легко рассчитана с помощью, к примеру, логит-регрессии. Более того, можно учитывать влияние лагированных переменных, добавляя их в вектор объясняющих переменных. Если смещение самоотбора можно устранить учетом $x_i$, его можно устранить и учетом меры склонности. Зачастую проще брать условия на меры склонности, чем на многомерный вектор $x$. Дехеджа и Ваба (1998) приводят эмпирическую иллюстрацию, основанную на данных, использованных в работе Лалонда (1986).

\subsection*{Особенности реализации}

Использование мер склонности требует хороших моделей для оценки самих мер. Цель при этом --- получить состоятельную оценку вероятности участия, а не получить оценки параметров в функции для меры склонности. Более точные оценки меры склонности, скорее всего, будут получены при помощи гибких параметрических или непараметрических моделей. 

При сопоставлении на основе $p(x_i)$ важны три вопроса: $(1)$ сопоставлять с возвращением или без возвращения; $(2)$ сколько наблюдений использовать для сопоставления и $(3)$ какой метод сопоставления выбрать. 

Сопоставление без возвращения означает, что любое наблюдение в контрольной группе сопоставляется не более чем одному наблюдению из экспериментальной группы, с которым они наиболее близки, тогда как при сопоставлении с возвращением могут быть множественные сопоставления. При сопоставлении без возвращения, слишком маленький размер контрольной выборки может привести к тому, что сопоставления будут не очень близкими в терминах $p(x)$, что повышает смещение оценки. 

Вопрос выбора количества наблюдений в контрольной выборке для сопоставления --- это выбор между смещением и дисперсией. При использовании одного, самого близкого, сопоставления уменьшается смещение, но при увеличении числа сопоставляемых наблюдений уменьшается дисперсия, тогда как смещение растет, потому что дополнительные наблюдения хуже описывают изучаемые объекты. Частичным решением этой проблемы может быть использование определенного радиуса вокруг $p(x)$ для наблюдения из экспериментальной выборки, внутри которого наблюдения сопоставляются (а за его пределами --- нет). Другими словами, мы используем только лучшие совпадения. Это называется \bfseries <<циркульное (caliper) сопоставление>>. \mdseries

Хекман и др. (1997, 1998) изучали качество оценок сопоставления на экспериментальных данных  полученных при реализации Закона о партнерстве по подготовке кадров (Job Training Partnership Act, JTPA) в сочетании с контрольными группами, взятыми из трех источников. Качество данных играет ключевую роль в устойчивости оценок эффектов воздействия с помощью методов сопоставления. Наилучшие результаты достигаются тогда, когда данные для контрольной и экспериментальной групп устроены сопоставимо, когда обе группы находятся на одном рынке труда и когда мера склонности может быть оценена при помощи большого набора регрессоров. 

Вопрос чувствительности результатов к выбору метода не имеет простого решения. Результат может меняться для разных выборок, в зависимости от уровня пересечения между контрольной и экспериментальной выборками. Если две группы похожи в том смысле, что присутствует значительное пересечение их мер склонности, и если контрольная группа велика, сопоставления найти проще и можно использовать сопоставление с без возвращения. Если же контрольная группа невелика и отличается от экспериментальной, хорошие по качеству совпадения быстро закончатся и возможности использовать всю экспериментальную выборку не будет. Эта проблема особенно вероятна,  если используется сопоставление без возвращения. 

Дехеджа и Ваба (2002) применяют методы используя данные полученные в ходе Национальной программы поддержки занятости (National Supported Work Program) --- это хороший и поучительный пример. Мы исследуем и иллюстрируем вопросы применения описанных методов в разделе 25.8 на данных Дехеджа и Ваба. 

\subsection{Измерение эффектов воздействия}

Обозначим группу для сравнения для подвергнутого воздействию наблюдения $i$ с характеристиками $x_i$ как множество $A_j (x) = \{ j | x_j \in c(x_i) \}$, где $c(x_i)$ --- окрестность точки $x_i$. Обозначим $N_C$ --- количество наблюдений в группе для сравнения и $w(i, j)$ --- вес $j$-ого наблюдения в сопоставлении для $i$-ого наблюдения, $\sum_j w(i, j) = 1$. Тогда \bfseries  общая формула \mdseries для оценки сопоставления ATET:

\begin{equation}
\label{eq25.40}
\Delta^M = \frac{1}{N_T} \sum_{i \in \{ D=1 \}} [y_{1,i} - \sum_j w(i,j) y_{0,j}],
\end{equation}
где $0 < w(i,j) \le 1$ и $\{ D =1 \}$ --- множество индивидов из экспериментальной группы, а $j$ --- элемент из множества сопоставленных наблюдений. Разные оценки сопоставления получаются изменением весов $w(i,j)$. 

\subsection*{Методы сопоставления}

Простое сопоставление сравнивает наблюдения с одинаковыми дискретными $x$

\begin{equation}
\label{eq25.41}
\Delta^M = \sum_k w_k [ \overline{y}_{1,k} - \overline{y}_{0,k} ],
\end{equation}
где $\overline{y}_{1}$ --- средний результат для экспериментальной группы, $\overline{y}_{0}$ --- средний результат для контрольной группы и $w_k$ --- вес $k$-ого наблюдения (то есть, доля наблюдений в точке $k$). 

Частный случай (Дехеджа и Ваба, 2002):

\begin{equation}
\label{eq25.42}
\frac{1}{N_T} \sum_i \left( y_i - \frac{1}{N_{C,i}} \sum_{j \in \{ D = 0\}} y_j \right) ,
\end{equation}
где $N_T$ --- размер экспериментальной группы ($D = 1$) и $N_{C,i}$ --- размер сравнительной группы, соответствующей $i$-ому наблюдению. 

Метод \bfseries сопоставления по ближайшим соседям \mdseries  для каждого $i$ из экспериментальной группы выбирает набор $A_i (x) = \{ j | \min_j \| x_i - x_j \| \}$, где $\| \; \|$  обозначает Евклидово расстояние между векторами. Если $w(i,j) = 1$ в~(\ref{eq25.40}) при $j \in A_i (x)$ и 0 иначе, то полученная спецификация использует только одно наблюдение для построения сравнительной группы. 

Другая оценка получается при помощи \bfseries ядерного сопоставления \mdseries, где

$$
w(i,j) = \frac{K (x_j - x_i)}{\sum_{j=1}^{N_{C,i}} K (x_j - x_i)},
$$
где $K$ --- ядерная функция, рассмотренная в разделе 9.3. 

Преимущество этих методов заключается в том, что они не требуют предположений о функциональной форме уравнений для результирующей переменной при оценке ATET и могут оценивать её для отдельных значений $x$. Недостаток их заключается в том, что при большой размерности $x$ число сопоставлений может оказаться очень низким. В таких случаях есть основания использовать сопоставления, основанные на скалярной метрике. \bfseries Сопоставление при помощи мер склонности, \mdseries рассмотренное выше, является примером таких методов. 

Сопоставление по ближайшим соседям и ядерное сопоставление могут быть также определены в терминах мер склонности. К примеру, для сопоставления по ближайшим соседям можно определить множество для сопоставления как $A_i (p(x)) = \{ p_j | \min_j \| p_i - p_j\| \}$. 

\bfseries Стратифицированное \mdseries или \bfseries интервальное сопоставление \mdseries основано на разделении диапазона значений меры склонности на интервалы, так что внутри каждого интервала наблюдения из контрольной и экспериментальной групп имеют, в среднем, одинаковую меру склонности. Можно использовать те же блоки, которые были идентифицированы алгоритмом при оценке мер склонности. Затем мы вычисляем разность между средними результатами для двух групп. ATET в этом случае --- взвешенное среднее этих разностей, при этом веса определяются распределением наблюдений из экспериментальной группы по блокам. Один из недостатков этого метода заключается в том, что он не учитывает наблюдения из тех блоков, где нет наблюдений из контрольной либо из экспериментальной группы. 

Обозначим как $b$ блоки, определенные на интервалах значений меры склонности. Тогда эффект воздействия внутри $b$-ого блока определяется как

$$
ATET_b^S = (N_b^T)^{-1} \sum_{i \in I(b)} Y_{1i} - (N_b^C)^{-1} \sum_{j \in I(b)} Y_{0j},
$$
где $I(b)$ --- множество наблюдений из блока $b$, $N_b^T$ --- количество наблюдений из экспериментальной группы в блоке $b$, $N_b^C$ --- количество наблюдений из контрольной группы в блоке $b$. Тогда эффект воздействия на основе стратификации определяется как

\begin{equation}
\label{eq25.43}
ATET^S = \sum_{b=1}^B ATET_b^S \times \left[ \sum_{i \in I(b)} D_i / \sum D_i \right], 
\end{equation}
где член в квадратных скобках --- это вес каждого блока, определяемый как соответствующая ему доля наблюдений из экспериментальной группы, и $B$ --- общее число блоков. 

При \bfseries радиальном сопоставлении \mdseries множество $A_i (p(x)) = \{ p_j \bigl| \; \|p_i - p_j \| < r \}$ получается на основе мер склонности. Это означает, что все наблюдения из контрольной выборки с мерами склонности внутри радиуса $r$ сопоставляются $i$-ому наблюдению из экспериментальной группы. 

Можно выразить ATE и ATET в терминах $p(x)$, предполагая условие пересечения $0 < p(x) < 1$. Тогда

\begin{equation}
\label{eq25.44}
ATE = \E \left[  \frac{(D - p(x)) y}{p(x)(1 - p(x))}  \right],
\end{equation}
\begin{equation}
\label{eq25.45}
ATET = \E \left[  \frac{(D - p(x)) y}{\Pr[D = 1](1 - p(x))}  \right];
\end{equation}

последний результат получен Дехеджа (1997).

Из этих результатов получаются следующие выводы:
\begin{align}
\label{eq25.46}
y & = (1-D)y_0 + Dy_1  \nonumber \\
& = y_0 + D(y_1 - y_0), \nonumber \\
(D - p(x))y & = (D - p(x))(y_0 + D(y_1 - y_0))  \nonumber \\
& = Dy_1 - p(x) y_0 - D p(x) y_1 + D p(x) y_0 \nonumber \\
& = Dy_1 - p(x) (1-D) y_0 - D p(x) y_1.
\end{align}

Далее, беря математические ожидания и заметив, что $\E[D|x] = p(x)$ получаем

\begin{align}
\label{eq25.47}
\E[(D - p(x)) y | x] & = p(x) \E[y_1] - p(x)(1 - p(x)) \E[y_0] - p^2(x) \E[y_1]  \\
& = p(x)\E[y_1 - p(x)y_1] - p(x)(1-p(x))\E[y_0] \nonumber \\
& = p(x)(1-p(x)) \E[y_1 - y_0],  \nonumber 
\end{align}
откуда следует, что 

$$
ATE = \E[y_1 - y_0] = \E \left[ \frac{(D - p(x)) y}{ p(x) (1 - p(x))} \right].
$$

Чтобы получить результат Дехеджа:

\begin{align}
\label{eq25.48}
\E \left[ \frac{(D - p(x)) y}{1 - p(x)} \right] & = \E[p(x) \E [\mu_1(x) - \mu_0 (x)]]  \\
& = \E[D (y_1 - y_0)] \nonumber \\
& = \E[D (y_1 - y_0) | D = 1] \; \Pr [D = 1],  \nonumber
\end{align}
где первая строка следует из~(\ref{eq25.47}), вторая получается при применении предположения об условной независимости, а последняя выражает совместное математическое ожидание как произведение частного и условного ожиданий, что приводит к

$$
ATET = \frac{\E [D (y_1 - y_0)]}{\Pr [D = 1]}.
$$

Используя~(\ref{eq25.44}) и~(\ref{eq25.45}), можно получить состоятельные оценки на основе выборки размера $N$:

\begin{equation}
\label{eq25.49}
\widehat{ATE} = \frac1N \sum_{i=1}^N \left[  \frac{(D_i - \hat p(x_i)) y_i}{\hat p(x_i)(1 - \hat p(x_i))}  \right],
\end{equation}
\begin{equation}
\label{eq25.50}
\widehat{ATET} = \left(  \frac1N \sum_{i=1}^N D_i  \right)^{-1}  \sum_{i=1}^N \left[ \frac1N \frac{(D_i - \hat p(x_i)) y_i}{(1 - \hat p(x_i))}  \right],
\end{equation}
где $N^{-1} \sum_{i=1}^N D_i$ --- состоятельная оценка $\Pr[D=1]$, 

\subsection{Дисперсия ATET на основе $x$ и $p(x)$}

При предположениях идентифицируемости из раздела 25.2, $\widehat \Delta_x$ и $\widehat \Delta_{p(x)}$ определяются как 

\begin{align}
\widehat \Delta_x & =\frac1{N_T} \sum [y_{1i} - \widehat \E [y_0 | D = 0, x = x_i]] \nonumber \\
& = \frac1{N_T} \sum_{i \in \{ D = 1 \}} [y_{1i} - \sum_{j \in A_i(x)} w_{ij} y_{0,j}]  \nonumber 
\end{align}
и 
\begin{align}
\widehat \Delta_{p(x)} & =\frac1{N_T} \sum [y_{1i} - \widehat \E [y_0 | D = 0, p(x) = p(x_i)]] \nonumber \\
& = \frac1{N_T} \sum_{i \in \{ D = 1 \}} [y_{1i} - \sum_{j \in A_i(p(x))} w_{ij} y_{0,j}],  \nonumber 
\end{align}
где $i$ --- индекс экспериментальной группы, $w_{ij} - 1/N_{c,i}$ и $N_{c,i}$ --- число наблюдений в сравнительной группе для $i$-ого наблюдения. Обе --- состоятельные оценки ATET, $\E [y_1 - y_0 | D = 1 , x]$, первая основана на $x$, вторая --- на $p(x)$. Вопрос, встающий на практике, --- что лучше с точки зрения эффективности, учет различий в мере склонности или в $x$. Хан (1998), Хекман и др. (1998) и другие показали, что нельзя точно сравнить эти две оценки в терминах асимптотической дисперсии, даже если мы предположим, что $p(x_i)$ известны, что на практике невозможно при использовании данных, полученных в ходе наблюдения. 

Запишем асимптотические дисперсии для двух случаев следующим образом:
\begin{align}
\V[\widehat \Delta_x] & = \E [\V[y_1 | D = 1, x] | D = 1] + \V [\E[y_1 - y_0 | D = 1, x] | D = 1], \nonumber \\
\V[\widehat \Delta_{p(x)}] & = \E [\V[y_1 | D = 1, p(x)] | D = 1] + \V [\E[y_1 - y_0 | D = 1, p(x)] | D = 1], \nonumber 
\end{align}
где мы используем декомпозицию дисперсии, приведенную в разделе A.8. В общем случае $x$ --- лучший предиктор, чем $p(x)$, поэтому
\begin{align}
\E[\V[y_1 | D = 1, x] | D = 1] & \le \E [\V[y_1 | D = 1, p(x)] | D = 1] , \nonumber \\
\V [\E[y_1 - y_0 | D = 1, x] | D = 1] & \ge  \V [\E[y_1 - y_0 | D = 1, p(x)] | D = 1], \nonumber 
\end{align}
потому что при фиксированном $x$ происходит меньшая потеря информации, что при фиксировании $p(x)$, который является функцией от $x$. Поэтому второе сравнение говорит в пользу использования мер склонности, тогда как первое --- в пользу $x$. 

Полезные с практической точки зрения разъяснения и  компьютерные программы для вычисления ATET приведены Бекером и Ичино (2002).

\section{Оценка методом разность разностей}

В главах 2 и 3 обсуждались концепции \bfseries естественного эксперимента \mdseries и \bfseries квазиэксперимента, \mdseries в которых переменная воздействия претерпевает изменение, которое может рассматриваться как экзогенная изменчивость переменной воздействия. Экспериментальная группа может сравниваться с не подвергнутой воздействию контрольной группой. 

В некоторых случаях исследователь располагает данными об экспериментальной и контрольной группах как до, так и после эксперимента. Тогда для $i$-ого наблюдения из экспериментальной группы изменение в результате оценивается как $[y_{ia} - y_{ib} | D_{ia} = 1]$ и для контрольной группы $[y_{ia} - y_{ib} | D_{ia} = 0]$. Тогда оценка {\it{разности разностей}} равна $[y_{ia} - y_{ib} | D_{ia} = 1] - [y_{ia} - y_{ib} | D_{ia} = 0]$, где нижние индексы $a$ и $b$ обозначают состояния после (англ. after) и до (англ. before) эксперимента. Она формирует базу для оценки эффекта воздействия. Этот метод был представлен в разделах 3.4.2 и 22.6. 

Рассмотрим модель с фиксированным эффектом $\phi_i$ и сдвигом $\delta_t$, где результаты до и после воздействия задаются, соответственно:

\begin{equation}
\label{eq25.51}
y_{it,0}= \phi_i + \delta_t + \e_{it}, 
\end{equation}
\begin{equation}
\label{eq25.52}
y_{it,1}= y_{it,0} + \alpha, 
\end{equation}
так, что 
\begin{align}
\label{eq25.53}
y_{it} & = (1 - D_{it}) y_{it,0} + D_{it} y_{it, 1} \\
&  =  \phi_i + \delta_t + \alpha D_{it} + \e_{it}. \nonumber 
\end{align}

В этих уравнениях $t = a, b$; ~(\ref{eq25.51}) --- для группы, не подвергшейся воздейстию и~(\ref{eq25.52}) для группы, подвергшейся воздействию. При использовании формулировок <<до>> и <<после>>, мы получаем эффект воздействия:

\begin{align}
\label{eq25.54}
\alpha & = \E [y_{ia} - y_{ib} | D_{ia} = 1] - \E [y_{ia} - y_{ib} | D_{ia} = 0] \\
&  =  \{ \E [y_{ia} | D_{ia} = 1] - \E [y_{ia}| D_{ia} = 0] \} \nonumber  \\
& \quad -  \{ \E[y_{ib} | D_{ia} = 1] - \E [y_{ib}| D_{ia} = 0] \}, \nonumber 
\end{align}
где после взятия разностей исключаются фиксированный эффект $\alpha$ и сдвиг $\delta_t$. 

Есть альтернативы взятию разностей. Одна из них --- это явно учитывать различие в результатах до воздействия для двух групп при помощи регрессии. 

К примеру, заменяя $\phi_i$ в~(\ref{eq25.51}) на $x_i' \beta + \gamma y_{ib}$, получаем
\begin{align}
\label{eq25.55}
& y_{ia,0} = x_i' \beta + \gamma y_{ib} + \delta_a + \e_{ia} \\
& y_{ia,1} = x_i' \beta + \gamma y_{ib} + \delta_a + \alpha D_{ia} \e_{ia}. \nonumber 
\end{align}
Оценки $\alpha$ получаются регрессированием результатов после воздействия на результаты до воздействия, $x_i$ и $D_{ia}$. Интерпретация $\alpha$ как параметра причинности основана на предположении, что после учета $x$ и $y_b$ разница в результате после воздействия для двух групп полностью обусловлена эффектом воздействия. Фиксированный эффект задается в линейной форме, тогда как стратегия сопоставления может основываться на более слабых предположениях. 

Наши предыдущие результаты могли быть основаны на квазиэкспериментальных данных. К примеру, можно сравнивать людей в одном штате с одним законом с людьми в другом штате с другими законами, тогда приходится учитывать влияние штата. Новый элемент --- это добавление данных перед экспериментом. При предположении, что в обоих штатах одинаковый параметр сдвига, можно использовать оценки разности разностей для устранения эффектов штата, которые иначе приходилось бы учитывать. 

\section{Разрывный дизайн}

Идентификация эффекта воздействия иногда может быть облегчена естественным экспериментом или при использовании данных, полученных в квазиэкспериментальных условиях. Разрывный дизайн (Regression discontinuity design) --- пример квазиэкспериментального дизайна, где вероятность получения воздействия --- разрывная функция от одной или более переменных. Такое устройство данных возникает в условиях, когда воздействие запускается по административному или организационному правилу. К примеру, Ангрист и Лейви (1999) изучают эффект размера класса на успеваемость студентов, используя данные, полученные во время действия правила Маймонида, согласно которому класс должен быть разделен при достижении определенного порогового размера. Ван дер Клаув (2003) оценивает эффект финансовой помощи на решение студентов об обучении в колледже, используя информацию об административном правиле, согласно которому финансовая помощь увязывается с результатами студента --- оценкой SAT и средним баллом. Этим эконометрическим приложениям предшествовала работа Тислтуэйт и Кемпбелла (1960), исследовавшая влияние студенческих стипендий на карьерные устремления, использовавшая тот факт, что поощрения назначались только, если результаты студента превосходили определенный порог; см. также Трочим (1984). Обсуждение здесь следует  работе Ван дер Клаува (2003).

\subsection{Разрывный механизм назначения воздействия}

При разрывном дизайне, у нас есть дополнительная информация о правиле отбора. Известно, что назначение воздействия зависит, по меньшей мере частично, от величины наблюдаемой непрерывной переменной по сравнению с пороговым значением так, что соответствующая вероятность получить воздействие, мера склонности --- разрывная функция от этой переменной с разрывом в пороговой точке. Рисунок 25.1 иллюстрирует выборку, сгенерированную разрывным механизмом. 

\vspace{3cm}
Рисунок 25.1

Regression Discontinuity Example --- Пример разрывной регрессии

Selection variable S --- Переменная отбора S

Actual data --- Фактические данные

Outcome y --- Зависимая переменная y

No treat (low) --- Нет воздействия (низкие значения)

Treat (high) --- Есть воздействие (высокие значения)


При простейшем виде разрывного дизайна, называемом \bfseries четкий разрывный дизайн, \mdseries индивиды назначаются в экспериментальную и контрольную группы только на основании наблюдаемой непрерывной переменной $S$, называемой переменной отбора или переменной назначения. Те, кто находится ниже порогового значения $\overline{S}$ не получают воздействие и входят в контрольную группу, те же, кто находится выше порога, получают воздействие ($D = 1$). То есть, назначение  воздействия осуществляется на основе известного правила: $D_i = \boldsymbol{1} [S_i \ge \overline{S}]$. На графике 25.2 четкий разрывный дизайн показан сплошной линией (см. Ван дер Клаув, 2003).

При четком разрывном дизайне

\begin{equation}
\label{eq25.56}
\E[u | D, S] = \E [u | S],
\end{equation}
где $u$ --- ошибка в уравнении для результата. Из-за того, что $S$ --- единственная переменная, систематически влияющая на $D$, $S$ будет учитывать любую корреляцию между $D$ и $u$. 

При $D_i = D(S_i) = \boldsymbol{1} [S_i \ge \overline{S}]$, из-за зависимости между $D_i$ и $u_i$ МНК оценка $\alpha$ будет несостоятельной. Как было замечено выше, один из подходов к оценке эффектов воздействия в этом случае заключается в спецификации и включении условного среднего $\E[u|D,S]$ как <<регрессора>> в уравнение для результата. Тогда

\begin{equation}
\label{eq25.57}
y_i = \beta + \alpha D_i + k (S_i) + \e_i ,
\end{equation}
где $\e_i = y_i - \E [y_i | D_i, S_i ] $. Если $k (S)$ правильно специфицирована регрессия дает состоятельные оценки $\alpha$. 

Если $k(S)$ линейна, $\alpha$ будет оцениваться как расстояние между двумя параллельными  регрессионными прямыми в пороговой точке, в данном случае --- как разность постоянных членов. Это несмещенная оценка общего эффекта воздействия для линейной  функции $k(S)$. 

В более общем случае для изменяющихся эффектов воздействия, когда коэффициент при $D$ есть $\E[\alpha_i | \overline{S}]$, или локальных ATE (local ATE, LATE), рассмотренных в разделе 25.7.1, функция $k(S)$ соответствует величине $\E[u|S] + (\E[\alpha_i | S] - \E[\alpha_i | \overline{S} ]) \boldsymbol{1} [S_i \ge \overline{S}]$, где $\boldsymbol{1} [S_i \ge \overline{S}] = 1$, если условие в скобках выполнено. Неправильная спецификация $k(S)$ приводит к несостоятельности, поэтому имеет смысл попробовать полупараметрическую спецификацию, к примеру, $k(S) = \sum_{j=1}^J \eta_j S^j$, где $J$ может быть определена подходящим методом. 

Переменная $S$ может быть связана с результатом $y$, что автоматически приведет к связи $(y, D)$, даже если нет никакой причинной связи между этими двумя показателями. В противоположность этому случаю, при случайном назначении такой связи удается избежать. 

Тогда как случайное назначение делает экспериментальную и контрольную группы схожими по всем показателям, кроме получения воздействия, четкий разрывный дизайн делает их разными, по крайней мере с точки зрения переменной $S$. Это нарушает предположение о \bfseries <<строгой игнорируемости>> \mdseries Розенбаума и Рубина (1983), которое также требует предположения о пересечении, $0 < \Pr [D = 1 | S] < 1$, тогда как в моделях с четким разрывным дизайном $\Pr [D = 1|S] \in [0,1]$. 

\subsection{Идентификация и оценка при четком разрывном дизайне}

Интуитивно понятно, что набор индивидов из маленькой окрестности пороговой точки будет похож на случайный эксперимент в пороговой точке, потому что у них практически одинаковые значения $S$. Индивиды, находящиеся чуть ниже порога, будут очень похожи на тех, кто расположился чуть выше. Сравнение средних значений $y$ для этих двух групп даст оценку среднего эффекта воздействия. 

Увеличение интервала вокруг порога приведет к смещению оценки эффекта воздействия, особенно если сама переменная назначения связана с результирующей переменной при фиксированном статусе воздействия. Если можно сделать предположение о функциональной форме этой связи, можно <<использовать больше наблюдений и экстраполировать вниз и вверх от пороговой точки и получить результат, который показал бы рандомизированный эксперимент. Эта двойная экстраполяция, в сочетании с использованием <<рандомизированного эксперимента>> вокруг пороговой точки --- основная идея разрывного анализа>> (Ван дер Клаув, 2003, стр. 1258).

Заметим, что при таком разрывном дизайне

\begin{equation}
\label{eq25.58}
\lim_{S \downarrow \overline{S}} \E[y|S] - \lim_{S \uparrow \overline{S}} \E[y|S] = \alpha + \lim_{S \downarrow \overline{S}} \E[u|S] - \lim_{S \uparrow \overline{S}} \E[u|S].
\end{equation}

Более формальный способ предположить, что в отсутствии воздействия, индивиды в малой окрестности $\overline{S}$ будут иметь схожие средние результаты, выглядит следующим образом:

\bfseries Предположение A1. \mdseries Условное среднее $\E [u|S]$ непрерывно в точке $\overline{S}$. 

\bfseries Предположение A2. \mdseries Средний эффект воздействия $\E [\alpha_i|S]$ непрерывен справа в точке $\overline{S}$:

\begin{equation}
\label{eq25.59}
y_i = \beta + \alpha D_i + k(S_i) + \e_i ,
\end{equation}
где $\e_i = y_i - \E [y_i | D_i , S_i ]$. 

Тогда получается результат из~(\ref{eq25.58}). 

\subsection{Нечеткий разрывный дизайн}

Здесь назначение воздействия зависит от переменной отбора стохастически. Известно, что мера склонности $\Pr[D = 1|S]$ имеет разрыв в точке $\overline{S}$. Возможным последствием неточного назначения рядом с пороговой точкой является нечеткий разрывный дизайн, когда значения $S$ вокруг порога попадают как в экспериментальную, так и в контрольную группы. В качестве альтернативы, назначение может быть основано на дополнительных переменных, наблюдаемых организатором, назначающим воздействие, но ненаблюдаемых исследователем. Тогда, в отличие от четкого разрывного дизайна, отбор при \bfseries нечетком разрывном дизайне (fuzzy RD design) \mdseries зависит как от наблюдаемых, так и от ненаблюдаемых переменных. На графике 25.2 нечеткий разрывный дизайн показан пунктирной линией. 

Мы по-прежнему можем использовать разрыв в правиле отбора для идентификации эффекта воздействия при предположении A1. Если $\E [u|S]$ непрерывно в $\overline{S}$, то $\lim_{S \downarrow \overline{S}} \E[y|S] - \lim_{S \uparrow \overline{S}} \E[y|S] = \alpha [\lim_{S \downarrow \overline{S}} \E[D|S] - \lim_{S \uparrow \overline{S}} \E[D|S] ]$. Следовательно, эффект воздействия $\alpha$ может быть оценен как

\begin{equation}
\label{eq25.60}
\frac{\lim_{S \downarrow \overline{S}} \E[y|S] - \lim_{S \uparrow \overline{S}} \E[y|S]}{\lim_{S \downarrow \overline{S}} \E[D|S] - \lim_{S \uparrow \overline{S}} \E[D|S]},
\end{equation}
где знаменатель $\lim_{S \downarrow \overline{S}} \E[D|S] - \lim_{S \uparrow \overline{S}} \E[D|S] \ne 0$ из-за разрыва $\E[D|S]$ в точке $\overline{S}$. 

В случае \bfseries гетерогенных эффектов воздействия \mdseries нам требуются дополнительные предположения

\bfseries Предположение A2*. \mdseries Средний эффект воздействия $\E [\alpha_i | S]$ непрерывен в точке $\overline{S}$.

\bfseries Предположение A3. \mdseries $D_i$ не зависит от $\alpha_i$ при фиксированном $S$ в окрестности $\overline{S}$:

\begin{equation}
\label{eq25.61}
y_i = \beta + \alpha \E[D_i|S_i] + k (S_i) + \epsilon_i,
\end{equation}
где $\e_i = y_i - \E [y_i | D_i , S_i ] $ и $k(S_i)$ --- спецификация $\E [u_i | S_i ]$. 

\subsection{Двухшаговая оценка}

Если $\Cov [D,u] \ne 0$, МНК оценка $\alpha$ будет смещенной. Однако, можно получить состоятельную оценку. Рассмотрим

\begin{equation}
\label{eq25.62}
y_i = \beta + \alpha \E[D_i|S_i] + k (S_i) + \e_i,
\end{equation}
где $\e_i = y_i - \E [y_i | D_i , S_i ] $ и $k(S_i)$ --- спецификация $\E [u_i | S_i ]$. 

Шаг 1: Специфицируем функциональную форму мер склонности для нечеткого разрывного дизайна как

\begin{equation}
\label{eq25.63}
\E [D_i | S_i] = f (S_i) + \gamma \boldsymbol{1} [S_i \ge \overline{S}],
\end{equation}
где $f (S_i)$ --- некая непрерывная функция от $S$, которая непрерывна в точке $\overline{S}$. Специфицируя функциональную форму $f$ (или оценивая $f$ полу- или непараметрически) можно оценить $\gamma$, величину разрыва мер функции меры склонности в точке $\overline{S}$. 

Шаг 2: Оцениваем уравнение результата с управляющей функцией и $D_i$ замененным на полученную на первом шаге оценку $\E [D_i | S_i ] = \Pr [D_i = 1 | S_i]$. Эта оценка будет разрывной по $S$, тогда как управляющая функция для $k(S)$ будет непрерывной по $S$ в $\overline{S}$. При правильной спецификации $f(S_i)$ и $k(S_i)$ двухшаговая процедура будет состоятельной. 

\vspace{3cm}
Рисунок 25.2

Sharp and Fuzzy RD Designs -- Четкий и нечеткий разрывный дизайн

Sharp Design -- четкий дизайн

Fuzzy design -- нечеткий дизайн

Propensity score $\Pr[D=1|S]$ -- мера склонности $\Pr[D = 1|S]$

Selection variable S --- Переменная отбора S

Рисунок 25.2. Дизайн разрывной регрессии. Четкий дизайн (сплошная линия) и нечеткий дизайн (пунктирная линия) назначения воздействия 


\section{Метод инструментальных переменных}

В последние годы методы инструментальных переменных набирают популярность как альтернативы ММП и другим строго параметрическим методам (Ангрист, Имбенс, и Рубин, 1996). Они выглядят очень привлекательно в моделях с \bfseries отбором по ненаблюдаемым переменным \mdseries (см. раздел 25.3.4). Во многих случаях такая модель состоит из линейного уравнения для непрерывной результирующей переменной, для которой специфицированы условное среднее и структура дисперсии, без дополнительных предположений о форме распределения. В самом частом случае рассматривается непрерывная результирующая переменная, вектор регрессоров $x$ и одна эндогенная дамми-переменная воздействия ($D$), которая отвечает за решение об участии в программе воздействия. Это уравнение называется уравнением участия или уравнением отбора. В более общем случае, можно рассматривать ограниченный или дискретный результат и множество переменных воздействия. 

Обсуждение ниже перекликается с обсуждением моделей отбора и инструментальных переменных в других частях книги. Подход инструментальных переменных дает нам возможность рассматривать другой, <<локальный>>, вариант параметра ATE. 

\subsection{Локальный ATE (LATE)}

Рассмотрим простую линейную модель. Результирующая переменная --- линейная функция от наблюдаемых переменных $x$ и индикатора участия $D$:

\begin{equation}
\label{eq25.64}
y_i = x'_i \beta + \alpha D_i + u_i,
\end{equation}
и решение об участии зависит от единственной переменной $z$, которая является инструментом:

\begin{equation}
\label{eq25.65}
D_i^* = \gamma_0 + \gamma_1 z_i + v_i,
\end{equation}
где $D_i^*$  --- латентная переменная для наблюдаемой переменной $D_i$, задаваемой как

\begin{equation}
\label{eq25.66}
D_i=\begin{cases}
0, \text{ если }D_i^* \le 0, \\
1, \text{ если }D_i^*>0,
\end{cases}
\end{equation}

Вводится два предположения:

\begin{enumerate}
\item Существует переменная $z$, которая присутствует в уравнении для $D$, но не присутствует в уравнении для $y$, Она может быть непрерывной или дискретной, в частном случае ---  бинарной. Исключение регрессоров $x$ из уравнения участия --- это упрощение. Одновременное присутствие $z$ в уравнении участия и его исключение из уравнения для результирующей переменной называется \bfseries исключающим ограничением (exclusion restriction). \mdseries Эта струкрура модели знакома по Главе 16 о моделях с самоотбором. 
\item $\Cov [z,v] = \Cov [u,z] = \Cov [x,u] = 0$ и 
$$
\Cov [D, z] \ne 0.
$$
Вместе с первым предположением, это предположение означает, что $y$ зависит от $z$ только через $D$, и $D$ зависит от $z$ нетривиальным образом. Поэтому мы используем обозначение $D(z)$, чтобы подчеркнуть зависимость $D$ от $z$.
\end{enumerate}

При этих предположениях IV оценивание~(\ref{eq25.64}) даёт состоятельные оценки $(\beta, \alpha)$. Пусть $z' = z + \delta, \; \delta \ne 0$. Отметив также, что $\E [D | x, D(z)] = \Pr [D(z) = 1]$ и взяв ожидания, получим:

\begin{align}
\E [y | x, D(z) ] & = x' \beta + \alpha \Pr[D(z) = 1],  \nonumber \\
\E [y | x, D(z') ] & = x' \beta + \alpha \Pr[D(z') = 1], \nonumber 
\end{align}
где, после вычитания, мы имеем

$$
\E [y | x, z' ] - \E [y | x, z ] = \alpha [ \Pr[D(z') = 1] -  \Pr[D(z) = 1] ].
$$

Решая это уравнение относительно $\alpha$ получаем выражение для \bfseries локального среднего эффекта воздействия (local average treatment effect LATE), \mdseries рассмотренного Имбенсом и Ангристом (1994):

\begin{align}
\label{eq25.67}
\alpha_{LATE} & = \frac{\E [y | x, z' ] - \E [y | x, z ]}{\Pr[D(z') = 1] -  \Pr[D(z) = 1]'} \\
& = \frac{ \int_{R(x)} \left[ \E [y | x, z' ] - \E [y | x, z ] \right] dF(x|x \in R(x))}{ \int_{R(x)} \left[ \Pr[D(z') = 1] -  \Pr[D(z) = 1] \right] dF(x|x \in R(x))' } \nonumber \\
& = \frac{\E [y | z' ] - \E [y | z ]}{\Pr[D(z') = 1] -  \Pr[D(z) = 1]} , \nonumber
\end{align}
где во второй строке стоит усреднение по $x$, чей носитель обозначен как $R(x)$. Это выражение определено при $\Pr[D(z') = 1] -  \Pr[D(z) = 1] \ne 0$. Выборочный аналог этого выражения --- это отношение средней разности между экспериментальной и контрольной группами к изменению доли подвергнутых воздействию индивидов в силу изменения $z$. Это оценка, полученная с помощью метода инструментальных переменных. Используя асимптотическую нормальность оценок метода инструментальных переменных, мы можем получить доверительные интервалы для параметра LATE. 

Приставка <<локальный>> в LATE появляется из-за того, что он измеряет эффект воздействия на тех индивидах, которые приняли решение об участии в программе в силу изменений $z$. LATE зависит от конкретных значений $z$, использованных для оценки воздействия и от выбора инструментов. Группа <<переходящих>>  может быть нерепрезентативной для всей совокупности подвергнутых воздействию индивидов, не говоря уже об общей генеральной совокупности. Помимо этого, LATE может быть не информативным с точки зрения последствий крупных изменений политики и программ в силу того, что они могут влиять на инструменты, отличные от тех, которые мы наблюдаем. 

Для бинарных инструментов LATE и оценки метода инструментальных переменных эквивалентны, как показано в работе Ангриста и др. (1996, стр. 447). Если же в уравнении участия есть более одного инструмента, как при наличии переидентифицирующих ограничений, оценка LATE для каждого инструмента в общем случае будет отличаться. Однако, можно построить взвешенное среднее. 

Дальнейший анализ применим, когда эффект воздействия не изменяется в зависимости от индивида. Если же эффекты воздействия \bfseries гетерогенны \mdseries, возможны сложности с оценкой влияния $z$: наблюдаемая изменчивость вызвана разницей в $z$ или в $\alpha$? При гетерогенности идиосинкратический компонент эффекта воздействия

$$
u_{i,1} = u_{i,0} + D_i (\alpha_i (x_i) - \alpha (x_i)),
$$
является функцией от $\alpha_i (x_i) - \alpha (x_i)$, см.~(\ref{eq25.27}). Тогда предыдущих предположений недостаточно для вычисления ATE и ATET. Решением этой проблемы может выступать добавление \bfseries предположения о монотонности \mdseries в качестве дополнительного условия идентификации. Согласно ему, инструмент влияет на уровень участия монотонно, так что если в среднем участие более вероятно при $Z = w$, чем при $Z = z$, то любой, кто участвовал бы при $Z = z$ обязательно должен участвовать при $Z = w$. 

\subsection{Связь с другими мерами}

Оценка метода инструментальных переменных $\alpha$ совпадает с полученной при помощи двухшагового МНК, где первым шагом оценивается вероятность получения воздействия, $\E[D = 1 | x, z]$, а затем строится регрессия $y$ на $x$ и оцененную вероятностью, в предположении, конечно же, что эффект воздействия аддитивен. Рассмотрим частный случай оценки метода инструментальных переменных , где $x$ --- скаляр, равный единице, а $z$ ---- скалярная дамми-переменная, которая обозначает право на участие в программе воздействия: $z=1$ означает наличие права, $z=0$ --- отсутствие. 

Мы можем разделить генеральную совокупность на четыре категории: \bfseries конформисты (compliers, C) \mdseries, \bfseries всегда участвующие (always-takers, A)\mdseries, \bfseries никогда не участвующие (never-takers, N) \mdseries и \bfseries нарушители (defiers, D)\mdseries. Конформисты участвуют только когда имеют на это право, всегда участвующие --- всегда, вне зависимости от наличия права, никогда не участвующие --- никогда, вне зависимости от прав, а нарушители не получают воздействие, когда имеют на это право и получают, когда не имеют. Предположим, что нарушителей нет, и будем рассматривать оставшиеся три категории. 

\bfseriesОценка Вальда \mdseries эффекта воздействия определяется как:

\begin{equation}
\label{eq25.68}
TE_{WALD} = \frac{\E[y_i | z_i = 1] - \E[y_i | z_i = 0] }{\E[D_i | z_i = 1] - \E[D_i | z_i = 0]},
\end{equation}
где числитель, выраженный как взвешенное среднее эффектов воздействия по трем категориям с весами, равными вероятностям попасть в каждую категорию, равен:

\begin{align}
\Pr & [C]\{ \E[y_i | z_i = 1, C] - \E[y_i | z_i = 0, C] \}  \nonumber \\
& + \Pr[A]\{ \E[y_i | z_i = 1, A] - \E[y_i | z_i = 0, A] \} \nonumber \\
& + \Pr[N]\{ \E[y_i | z_i = 1, N] - \E[y_i | z_i = 0, N] \} \nonumber \\
& = \Pr[C]\{ \E[y_i | z_i = 1, C] - \E[y_i | z_i = 0, C] \}. \nonumber 
\end{align}
Результат в последней строчке получается из-за того, что члены, соответствующие всегда участвующим и никогда не участвующим равны нулю. Знаменатель в~(\ref{eq25.68}) равен вероятности конформизма, $\Pr[C]$. Следовательно

\begin{equation}
\label{eq25.69}
TE_{WALD} =\ E[y_{1,i} | z_i = 1, C] - \E[y_{0,i} | z_i = 0, C].
\end{equation}
Если мы сравним $TE_{WALD}$ с LATE, то обнаружим, что LATE --- это мера эффекта воздействия для подгруппы тех, кто на границе решения участвовать --- не участвовать, которых мы называем конформистами. 

В эмпирических экономических приложениях очень популярна концепция предельного влияния изменения непрерывной переменной, рассчитываемая как частная производная. Для дискретных переменных существует дискретный аналог. \bfseries Предельный эффект воздействия (marginal treatment effect (MTE)) \mdseries при фиксированном $x$ определяется как

\begin{equation}
\label{eq25.70}
MTE = \left. \frac{\partial \E[y|x,z]}{\partial \Pr [D = 1|x, Z]} \right|_{Z=z} .
\end{equation}

Хекман и Вытлацил (2002) показали, что ATE, ATET и LATE являются средними MTE, взятыми по разным подмножествам $Z$. ATE --- ожидаемая величина MTE по всему множеству возможных значений $z$, включая те, в которых уровень участия нулевой или равен единице. ATET исключает те $z$, где нет участия. LATE --- это средний MTE по тем $z$, где уровни участия различаются. 

\subsection{Оценка модели с гетерогенными эффектами воздействия с помощью инструментальных переменных}

Теперь рассмотрим модель, допускающую отбор по ненаблюдаемым показателям и гетерогенные эффекты воздействия. Используется контекст линейной модели с эндогенной переменной воздействия со случайным коэффициентом, см. работу Бьорклунда и Моффитта (1987). Модель, которая обосновывается тем, что эффекты воздействия могут быть непостоянными по наблюдениям из экспериментальной группы, была рассмотрена Вулдриджом (1997) и Хекманом и Вытлацилом (1998).

Мы записываем модель как систему одновременных уравнений, где результирующая переменная $y_1$ зависит от переменной воздействия $y_2$. Для простоты рассматривается непрерывная переменная воздействия $y_2$. Обозначая инструмент $z$ и экзогенную переменную $x_i$ получаем модель:

\begin{align}
\label{eq25.71}
y_{1,i} & = (\alpha + v_i) y_{2i} + x'_i \beta_1 + \e_i  \\
& = \alpha y_{2i} + x'_i \beta_1 + \e_i + v_i y_{2i} \nonumber \\
& = v_i \overline{y}_2 \alpha y_{2i} + x'_i \beta_1 + w_i, \nonumber \\
\label{eq25.72}
y_{2i} & = \gamma z_i + x'_i \beta_2 + \eta_i ,
\end{align}
где $w_i = \e_i + v_i (y_{2i} - \overline{y}_2 )$. Предельная реакция $y_1$ на изменение $y_2$ равна $(\alpha + v_i)$ и изменяется в зависимости от индивида, таким образом в модели допускаются \bfseries гетерогенные эффекты воздействия. \mdseries

Предположим, что $\E[\e_i | x_i , y_{2i}] = \E[v_i | x_i , y_{2i}] = 0$. Тогда $ \E[\e_i + v_i y_{2i}| x_i , y_{2i}] = 0$ и $\V[\e_i + v_i y_{2i}| x_i , y_{2i}]$ зависит от $x_i$ и следовательно гетероскедастична. Тогда МНК оценка $(\alpha, \beta_1)$ состоятельна, но не эффективна. Это следует из предполагаемой экзогенности $y_2$. 

Теперь рассмотрим случай, где переменная воздействия эндогенна. Делаются следующие предположения:

\begin{equation}
\label{eq25.73}
\E[\e_i | x_i , z_i ] = \E [\eta_i | x_i , z_i] = \E [v_i | x_i , z_i ] = 0,
\end{equation}
\begin{equation}
\label{eq25.74}
\E[\e_i^2 | x_i , z_i ] = \sigma_{\e}^2 ; \E [v_i^2 | x_i , z_i] = \sigma_v^2 ; \E [\eta_i^2 | x_i , z_i ] = \sigma_{\eta}^2.
\end{equation}
Эндогенность возникает из-за возможности корреляции между $v$ и $\eta$. В частности, предположим, что $\E[v_i | \eta_i] = \rho \eta_i$. Это условие выполняется, если $(v,\eta)$ имеют совместное нормально распределение. При таких предположениях $z$ --- валидный инструмент и $x$ --- экзогенный. Исключение $z$ из уравнения для $y_1$ --- идентифицирующее ограничение. Поэтому естественной выглядит оценка инструментальными переменными с инструментами $(z,x)$ уравнения~(\ref{eq25.71}). Заметим, однако, что для получения состоятельной оценки требуется $\E[w_i | x_i, z_i] = 0$. Первая компонента $w_i$, $\e_i$, не коррелирована с $z_i$ по предположению; вторая компонента $w_i$ --- это $v_i(y_{2i} - \overline{y}_2)$, которая, как может показаться, должна быть коррелирована с $z_i$, от которого зависит $y_{2i}$. Если это так, оценка метода инструментальных переменных будет несостоятельна. Однако, можно показать, что оценка метода инструментальных переменных будет состоятельной при введенных выше предположениях. Ключевой шаг здесь --- это показать, что $\E[v_i y_{2i} | z_i] = \E[v_i y_{2i}]$, как было продемонстрировано Вулдриджом (1997) с помощью правила повторных ожиданий; действительно,

\begin{align}
\label{eq25.75}
\E[vy_2|z] & = \E[\E[vy_2|z,\eta] | z]  \\
& = \E[y_2 \E[v|z,\eta] | z] = \E[\rho \eta y_2 | z] \nonumber \\
& = \rho E[\eta^2 | z] = \rho \sigma_{\eta}^2 = \E[v y_2]. \nonumber
\end{align}

Несмотря на то что оценка метода инструментальных переменных состоятельна при введенных предположениях, она не эффективна из-за гетероскедастичности ошибок. Поэтому необходимо использовать устойчивые к гетероскедастичности стандартные ошибки. Наконец, мы не рассмотрели вопросы чувствительности оцененных эффектов воздействия к выбору инструментов при гетерогенных эффектах воздействия. 

\subsection{Эндогенное воздействие в нелинейных моделях}

Рассмотрим теперь как анализ, проведенный в разделах 25.3 и 25.7, поменялся бы если бы результатом программы профессионального переобучения была занятость, а не доход, или продолжительность пребывания на одном рабочем месте. Либо предположим, что после обучения значительная часть участников остается без работы и имеет нулевые доходы; тогда выборка --- это смесь индивидов с нулевыми и ненулевыми доходами и, следовательно, не является нормальной. Как нужно расширить представленные методы, чтобы работать с нелинейностью и ненормальностью?

Спецификация и оценка нелинейных, ненормальных моделей воздействия и результата с самоотбором --- частая проблема в микроэконометрике. Как и в линейных моделях, основное внимание в таких моделях уделяется влиянию эндогенной переменной воздействия на экономический результат. Спецификация модели включает уравнение для результата со структурно-причинной интерпретацией и другие уравнения, которые моделируют процесс генерации переменных воздействия. Есть два широких подхода к этой проблеме: параметрический, который опирается на основанные на правдоподобии методы, включая Байесовские, и полупараметрический, основанный на ОММ или линеаризованных методах инструментальных переменных. 

Типичная ситуация иллюстрируется следующими несколькими примерами. В экономике труда, Бингли и Уолкер (2001) исследовали влияние продолжительности безработицы мужей на решения их жен об участии на рынке труда. Здесь переменная воздействия принимает неотрицательные значения и может быть цензурированной или усеченной. Питт и Розенцвейг (1990) исследовали влияние эндогенного состояния здоровья младенцев на деятельность их матерей в течение дня; здесь переменная воздействия дискретна и результат непрерывен. Карраско (2001) исследует влияние рождения детей на уровень участия женщин в рабочей силе. В моделях воздействия-результата, связанных с фертильностью, Йенсен (1999) исследует влияние использования контрацептивов, дискретной переменной, на время между рождениями детей, ограниченную зависимую переменную. Олсен и Фаркаш (1989) исследуют влияние рождения детей на риск исключения из школы. В экономике здоровья, Кенкел и Терца (2001) изучают влияние рекомендаций врача, дискретная переменная, на потребление алкоголя (непрерывная и неотрицательная). Говрисанкаран и Таун (1999) рассматривают влияние выбора госпиталя на риск смерти в госпитале. В экономике здоровья часто изучается влияние выбора медицинской страховки  на использование медицинских услуг, иногда измеряемое как расходы, а иногда --- как число отдельных потребленных услуг --- посещений врача или госпитализаций (Деб и Триведи 1997). Терца (1998) и ван Офем (2000) моделируют влияние наличия у домохозяйства автомобиля на количество путешествий. Можно привести и множество других примеров. 

У этих моделей есть множество статистических свойств. Во-первых, как воздействие, так и результат нелинейны и ненормальны: мультиномиальны, счетны, дискретны или цензурированы. Во-вторых, в каждой модели воздействие эндогенно. Наконец, у исследователей часто есть хорошие априорные причины выбрать те или иные частные распределения для воздействий и результатов. Однако, переход от частных распределений к совместной модели воздействия и результата --- важный шаг, на котором могут возникнуть проблемы, когда используются ненормальные многомерные распределения. Бывает, что у частных распределений нет (или есть, но очень ограниченные) удобных многомерных аналогов (к примеру, счетных моделей и моделей длительности). В других случаях, воздействие и результат берутся из разных семейств распределений (к примеру, мультиномиальное воздействие и уровень риска в качестве результата), так что  многомерные распределения в явном виде часто просто не существуют. Из-за специализированной природы приложений в этой области, эта тема здесь дальше не рассматривается. 

\section{Пример: влияние профессиональной подготовки на доходы}

В ходе проводившегося в 1970-ые проекта по Национальной поддержке работы (National Supported Work, NSW), измерялось влияние профессиональной подготовки на доходы при помощи рандомизированного эксперимента, который назначал некоторым индивидам профессиональную подготовку (экспериментальная группа), а других оставлял без подготовки (контрольная группа). Эффект подготовки затем измерялся прямым сравнением выборочных средних доходов после подготовки для экспериментальной и контрольной групп. 

Как обсуждалось в Главе 3, рандомизированные эксперименты достаточно редки в общественных науках. Более часто используется выборка, полученная в ходе наблюдения, часть индивидов из которой получают воздействие, а часть --- нет. Сравнение подвергнутых воздействию с неподвергнутыми должно учитывать различия в наблюдаемых характеристиках и, возможно, в ненаблюдаемых характеристиках. 

Чтобы определить адекватность стандартных микроэконометрических методов для данных, полученных в ходе наблюдения, Лалонд (1986) сравнил результаты экспериментальной группы из NSW с результатами контрольных групп, полученных из двух национальных опросов. Полученные результаты значительно отличались от полученных при помощи экспериментальной и контрольной выборки из NSW. Он пришел к выводу, что полученные в ходе наблюдения данные недостаточно надежны. 

Дехеджа и Ваба (1999, 2002) провели повторный анализ части данных Лалонда при помощи альтернативных методов сопоставления и получили результаты, близкие к полученным по экспериментальным данным. В этом разделе мы используем данные Дехеджа и Ваба (1999), чтобы продемонстрировать  методы, представленных в разделах 25.2 --- 25.5, которые учитывают только отбор по наблюдаемым показателям. 

\subsection{Данные Дехеджа и Ваба}

В экспериментальную выборку вошли 185 мужчин, прошедших профессиональную подготовку в 1976 --- 1977 годах. Контрольная группа состоит из 2490 мужчин-глав домохозяйств в возрасте до 55, не находящихся на пенсии, извлеченных из Панельного исследования динамики доходов (Panel Study of Income Dynamics, PSID). Дехеджа и Ваба (1999) называют эти две выборки подвыборкой RE74 (из экспериментальной группы NSW) и выборкой PSID-1 (не прошедших подготовку). Переменная-индикатор воздействия $D$ определяется как $D = 1$, если индивид прошел подготовку (тогда наблюдение попадает в экспериментальную выборку) и $D = 0$, если индивид не прошел подготовку (тогда наблюдение в контрольной выборке). 

Описательные статистики основных переменных приведены в таблице 25.3. Экспериментальная группа заметно отличается от контрольной, с большей пропорцией темнокожих (84\%), с образованием как правило ниже университетского (71\%) , а доля безработных в предшествовавший воздействию 1975 год равна 71\%. Оценки эффекта воздействия должны учитывать эти различия. 

\subsection{Управляющие функции}

Разные оценки влияние подготовки на доходы даны в таблице 25.4. 

Интересующая нас результирующая переменная --- это доходы после подготовки, RE78. Одна из возможных мер эффекта воздействия --- это средняя разница в RE78 между прошедшими подготовку из NSW и не прошедшими из PSID, полученная оценка: $\$ 6 349 - \$ 21 554 = - \$ 15 205$. Такая оценка называется оценкой \bfseries сравнения экспериментальной и контрольной групп, \mdseries потому что она дублирует анализ в условиях эксперимента. Она также может быть рассчитана как коэффициент при переменной воздействия $D$ в МНК регрессии RE78 на константу и $D$ по объединенной (экспериментальной и контрольной) выборке. 

\begin{table}
\caption{\label{tab: } Влияние подготовки: Выборочные средние в выборках}
\begin{minipage}{17.5cm}
\begin{center}
\begin{tabular}{llcc}
\hline
\hline
Переменная \footnote{Взяты те же данные, что и в таблице 1 в работе Дехеджа и Ваба (1999). Экспериментальная группа --- это подвыборока RE74 из NSW. Контрольная группа --- это выборка из PSID-1 с мужчинами --- главами домохозяйств до 55 лет, не находящимися на пенсии. Воздействие происходило в 1976 --- 1977 годах.} & Определение & Эксперимент. &  Контрол. \\
 & & выборка & выборка\\
\hline
AGE & Возраст в годах & 25.82 & 34.85 \\
EDUC & Образование в годах & 10.35 & 12.12 \\
NODEGREE & 1, если EDUC < 12 & 0.71 & 0.31 \\
BLACK & 1, если темнокожий & 0.84 & 0.25 \\
HISP & 1, если латиноамериканец & 0.06 & 0.03 \\
MARR & 1, если женат & 0.19 & 0.87 \\
U74 & 1, если безработный в 1974 & 0.60 & 0.10 \\
U75 & 1, если безработный в 1975 & 0.71 & 0.09 \\
RE74 & Реальный доход в 1974 (в 1982\$) & 2096 & 19429 \\
RE75 & Реальный доход в 1975 (в 1982\$) & 1532 & 19063 \\
RE78 & Реальный доход в 1978 (в 1982\$) & 6349 & 21554 \\
D & 1, если участвовал в программе подготовки & 1.00 & 0.00 \\
Sample size &  & 185 & 2490 \\
\hline
\hline
\end{tabular}
\end{center}
\end{minipage}
\end{table}

Такая оценка воздействия неверна, потому что отражает в основном различия в типах индивидов в двух выборках --- индивиды из контрольной группы не очень подходят для сравнения. Можно учесть разницу, включив характеристики до воздействия в качестве регрессоров и оценивая МНК

\begin{equation}
\label{eq25.76}
RE78_i = x'_i \beta + \alpha D_i+ u_i, \qquad i = 1, \dots, 2675. 
\end{equation}
Это приводит к значительно меньшем оценкам эффекта воздействия $\widehat{\alpha} = \$ 218$ если в качестве регрессоров, как и в Дехеджа и Ваба, использовать постоянный член, AGE, AGESQ, EDUC, NODEGREE, BLACK, HISP, RE74 и RE75. Этот подход в разделе 25.3.3 называется \bfseries оценкой управляющей функции. \mdseries 

\subsection{Разность разностей}

Второй подход --- это \bfseries сравнение до-после, \mdseries которое базируется на разнице доходов после воздействия RE78 и доходов до воздействия RE75. Используя средние доходы экспериментальной группы получаем оценку $\$ 6 349 - \$ 1 532 = \$ 4 817$. 

Это оценка также может быть неточной из-за того, что она отражает все изменения за рассматриваемый период времени, такие как изменения в экономике, а не только подготовку. \bfseries Оценка разности разностей, \mdseries  рассмотренная в разделе 25.5, дополнительно вычисляет похожую величину для контрольной группы, $\$ 21 554 - \$ 19 063 = \$ 2 491$, и использует эту меру изменений дохода за период, произошедших не в силу воздействия, так что изменение только в силу воздействия равно $\$ 4 817 - \$ 2 491 = \$ 2 326$. 

\begin{table}[h]
\caption{\label{} Влияние подготовки: Разные оценки эффекта воздействия}
\begin{minipage}{17.5cm}
\begin{center}
\begin{tabular}{p{7cm}lcc}
\hline
\hline
Метод & Определение & Оценка &  Ст. ошибка\footnote{Стандартные ошибки превых четырех оценок рассчитаны при помощи устойчивый к гетероскедастичности процедур из соответствующей МНК регрессии.} \\
\hline
Сравнение экспериментальной и контрольной групп & $\overline{RE78}_{D=1} - \overline{RE78}_{D=0} $ & -15 205 & 656 \\
Оценка управляющей функции & $\widehat{\alpha}$ из МНК регрессии~(\ref{eq25.76}) & 218 & 768\\
Сравнение до-после & $\overline{RE78}_{D=1} - \overline{RE75}_{D=1} $ & 4817 & 625 \\
Разность разностей & $\widehat{\alpha}$ из МНК регрессии~(\ref{eq25.77}) & 2326 & 749 \\
Мера склонности & см. Раздел 25.8.4 & 995 & --- \\
\hline
\hline
\end{tabular}
\end{center}
\end{minipage}
\end{table}

Можно показать, что оценка разностей в разностях эквивалентна оценке $\alpha$ из МНК регрессии

\begin{equation}
\label{eq25.77}
RE_{it} = \phi + \delta D78_{it} + \gamma \alpha D_i + \alpha D78_{it} \times D_i + u_{i}, \qquad i = 1, \dots, 2675, t = 75, \; 78.
\end{equation}

Здесь $RE_{i, 75}$ обозначает доходы в период до воздействия и $RE_{i,78}$ --- доходы в период после воздействия, так что при оценке регрессии используется 5350 наблюдений. Переменная-индикатор $D78_{it}$ равна 1 для периода после воздействия, индикатор $D_i$ равен 1, если индивид находится в экспериментальной группе, показатель $ D78_{it} \times D_i $ равен 1 для индивидов из экспериментальной выборки в период после воздействия. 

В более общем случае, константу $\phi$ в~(\ref{eq25.77}) можно заменить на $x'_{it} \beta$. Это ничего не меняет в этом примере, где регрессоры не изменяются во времени, так что $x_{it} = x_i$. Этот метод может быть применен к пространственным данным (см. Раздел 22.6.2), потому что он не требует, чтобы индивиды из двух групп наблюдались в оба периода времени (1975 и 1978). 

\subsection{Простая оценка меры склонности}

Третий подход сравнивает результат $RE78$ для индивида из экспериментальной выборки с искусственным прогнозом $RE78$ для того же индивида в случае, если бы он не получал воздействие. Первая оценка сравнения экспериментальной и контрольной групп \$15205 --- это крайне упрощенный случай данного подхода, который использует в качестве прогноза $RE78$ среднее значение показателя для контрольной группы (\$21554). Можно получить более точные оценки при помощи регрессионных моделей. К примеру, модель~(\ref{eq25.76}) специфицирует $\E[RE78|x]$ равным $x'\beta + \alpha$ для подвергнутых воздействию и $x' \beta$ для не подвергнутых. Это налагает ограничения как на влияние регрессоров $x$, так и на эффект воздействия, которые, при заданном $x$, предполагаются постоянными по индивидам. 

В литературе, посвященной эффектам воздействия, выделяются подходы, которые не опираются на такие сильные предположения. Самый очевидный подход --- это сравнение индивидов из экспериментальной и контрольной групп с одинаковыми значениями $x$, но на практике такое \bfseries сопоставление по регрессорам \mdseries невозможно, если релевантными считаются несколько регрессоров, принимающих большой диапазон значений. 

\vspace{3cm}

TREATMENT EVALUATION --- Оценка воздействия

Post-treatment Earnings against Propensity Score --- Доходы после воздействий в зависимости от меры склонности

Real Earnings 1978 --- Фактические доходы 1978

Comparison sample --- Контрольная выборка

Treated sample --- Экспериментальная выборка

Propensity Score --- Мера склонности

Original data --- Исходные данные

Nonparametric regression --- Непараметрическая регрессия



Рисунок 25.3: Влияние обучения: график доходов после воздействия от меры склонности для двух выборок. Включены только наблюдения с близкой мерой склонности. Наблюдения с доходами больше \$20000 не изображены на графике, однако включены в непараметрическую регрессию. 

Вместо этого, при предположениях из разделов 25.3 и 25.4, может оказаться достаточным \bfseries сопоставления по мере склонности, \mdseries определяемой как условная вероятность получения воздействия $\Pr [D = 1 | x]$. В этом примере, при оценке логит-модели мы используем только данные для 1975 года:

\begin{equation}
\label{eq25.78}
\Pr [D_i = 1 | x_i] = \Lambda (x'_i \beta), \qquad i = 1, \dots, 2675,
\end{equation}

Где, из раздела 14.2, $\Lambda (z) = e^z / (1+e^z)$, и в качестве регрессоров, как и в работе  Дехеджа и Ваба (1999), взяты AGE, AGESQ, EDUC, EDUCSQ, NODEGREE, BLACK, HISP, MARR, RE74, RE75, RE74SQ, RE75SQ и $U74*BLACK$. 

Рисунок 25.3 показывает доходы  после воздействия RE78 в зависимости от меры склонности, отдельно для экспериментальной и контрольной групп. Рассматривая только меру склонности (ось $x$), становится ясно, что большая часть наблюдений в контрольной выборке имеет очень низкую меру склонности, как и ожидалось, учитывая то, что (как видно из таблицы 25.3) в экспериментальной выборке завышена доля черных, безработных и людей с низким уровнем образования. 

Обращаясь к доходу после воздействия RE78 (ось $y$), видно, что эффект воздействия оценивается как разность между данным индивидом из экспериментальной группы ($D = 1$) и индивидом из контрольной группы ($D = 0$) с такой же спрогнозированной мерой склонности. Каждый график в 25.3 показывает также оцененную непараметрическую регрессию RE78 на меру склонности. Эффект воздействия меньше одной тысячи долларов на большей части диапазона значений меры склонности, однако он положительный и заметно больше по величине для меры склонности около 0.8. 

Есть много способов реализации подхода, основанного на сравнении индивидов с похожими мерами склонности с последующим усреднением по всем индивидам из экспериментальной выборки. Одна из возможных стратегий заключается в сопоставлении подвергнутых воздействию индивидов с индивидами из контрольной группы с самой близкой мерой склонности. 
В Разделе 25.4.4 этот подход назывался сопоставлением по ближайшим соседям. Более простая стратегия заключается в стратификации данных по мере склонности, $p(x)$, с использованием среднего по страте значения RE78 контрольной группы в качестве оценки результата без воздействия. 
К примеру, если наблюдение из экспериментальной группы имеет меру склонности $p(x) = 0.35$, то гипотетической мерой склонности для случая не-участия может быть средняя $p(x)$ для наблюдений из контрольной группы с $0.3 < p(x) < 0.4$. Общий эффект тогда $\sum_s w_s (\overline{RE78}_{s,D=1} - \overline{RE78}_{s,D=0})$, где $\overline{RE78}_{s,D=1}$ и $\overline{RE78}_{s,D=1}$ --- средние по страте $s$ значения RE78 для, соответственно, экспериментальных и контрольных наблюдений, а веса $w_s$ равны доле экспериментальных наблюдений в каждой страте. 
Простая схема стратификации может использовать, к примеру, 10 страт одинакового размера с $0.0 < p(x) \leq 0.1$, $0.1 < p(x) \leq 0.2$ и так далее. Такой подход называется сопоставлением со стратификацией, он был рассмотрен в разделе 25.4.4. Эта процедура может использоваться в случаях, когда меры склонности для двух выборок накладываются друг на друга, см. раздел 25.4.3. Здесь мера склонности изменяется от 0.0005 до 0.9420 для экспериментальной группы и от 0.0000 до 0.9371 для контрольной группы, поэтому  исключается 1423 наблюдения из контрольной группы и 8 из экспериментальной. Получившаяся оценка эффекта \$995 приведена в таблице 25.4. 

\subsection{Сопоставление при помощи мер склонности}

Как упоминалось в разделе 25.4, другие стратегии сопоставления включают в себя радиальное и ядерное сопоставление, которые также достаточно несложно реализовать. Оставшаяся часть данной главы рассматривает эти и другие подходы, с упором на методы, использующие меры склонности. 

\subsection*{Оцененные меры склонности}

Оцененные меры склонности получаются при использовании двух разных спецификаций логит-модели, из работ Дехеджа и Ваба (1999) и Дехеджа и Ваба (2002) соответственно. Спецификации для мер склонности приведены внизу таблицы 25.6. Единственное отличие от работы Дехеджа и Ваба (1999, 2002) заключается в том, что константа включена в логит-модели. Оценки коэффициентов, не приведенные в целях экономии места, имеют ожидаемые знаки. 

\subsection*{Алгоритмы сопоставления и балансировка}

Важный на практике вопрос заключается в выборе алгоритма сопоставления, основанного на мерах склонности, который соответствовал бы условию балансировки~(\ref{eq25.9}). Дехеджа и Ваба (2002, стр. 161) приводят алгоритм, который начинается с простой логит-модели для оценки $p(x)$. Алгоритм работает следующим образом. Данные сортируются по $\widehat p(x)$. Наблюдения стратифицируются так, что внутри страты величины $\widehat p(x)$ для экспериментальной и контрольной групп близки. К примеру, в начале может использоваться грубая сетка с границами одинаковой длины. Внутри каждой страты необходимо протестировать равенство средних в двух группах для каждой объясняющей переменной. Если нет статистически значимых различий, регрессоры можно считать сбалансированными между экспериментальной и контрольной группами и алгоритм можно остановить. Если для какой-то страты нет баланса, для \bfseries несбалансированной страты \mdseries нужно использовать более тонкую сетку. Если наблюдается много несбалансированных страт, изначальная логит-модель переоценивается с другой спецификацией, которая включает произведения показателей и члены более высоких порядков. 

\begin{table}[h]
\caption{Влияние подготовки: Распределение мер склонности для экспериментальной и контрольной групп по спецификации Дехеджа и Ваба (1999)}
\begin{center}
\begin{minipage}{12cm}
\begin{tabular}{cccc}
\hline
\hline
Минимум $\widehat p(x)$ \footnote{Для второй строки, к примеру, мера склонности лежит между 0.10 и 0.20 для 10 экспериментальных и 56 контрольных индивидов} & Экспериментальная & Контрольная &  Общая \\
\hline
0.000364 & 9 & 960 & 969 \\
0.10 & 10 & 56 & 66 \\
0.20 & 14 & 33 & 47 \\
0.40 & 24 & 22 & 46 \\
0.60 & 33 & 7 & 40 \\
0.80 & 95 & 8 & 103 \\
Всего & 185 & 1086 & 1271 \\
\hline
\hline
\end{tabular}
\end{minipage}
\end{center}
\end{table}
Используя программное обеспечение из работы Бекер и Ичино (2002), мы применили алгоритм Дехеджа и Ваба (2002) для расчета мер склонности. Во всех случаях, расчет мер склонности был ограничен областью пересечения мер склонности тестированием \bfseries условия балансировки \mdseries по тем наблюдениям, для которых меры склонности лежат на пересечении носителей мер склонности для контрольной и экспериментальной выборок. Это ограничение серьезно уменьшает размер выборки. Размер контрольной группы упал с 2490 наблюдений до 1086 при использовании спецификации из работы Дехеджа и Ваба (2002). 

В таблице 25.5 показано число наблюдений в каждой из выборок по интервалам для меры склонности после балансировки. Эти результаты отличаются от полученных Дехеджа и Ваба (2002), потому что они исключают контрольные наблюдения из NSW-PSID не на основании пересечения областей значения. Вместо этого они исключают те наблюдения, для которых оцененная мера склонности меньше, чем минимальная из мер склонности для экспериментальных наблюдений. Таблицы показывают, что доля экспериментальных наблюдений очень низка для первых интервалов по сравнению с последующими. 

Похожее упражнение для спецификации из работы Дехеджа и Ваба (1999) даёт схожие результаты. В контрольной группе 1146 наблюдений. Границы для интервалов $\widehat p(x)$: 0.0006526, 0.05, 0.10, 0.20, 0.40, 0.60 и 0.80. 

\subsection*{Оценка ATET методами сопоставления}

Результаты для разных методов сопоставления представлены в таблице 25.6. Оценка ATET методом ближайших соседей для спецификации Дехеджа и Ваба (2002) равна \$2385, для спецификации Дехеджа и Ваба (1999) приблизительно \$560. Стратификация и ядерное сопоставление также дают смешанные результаты, оценки ATET изменяются от \$1452 до \$2156. 

Для сравнения, оценки ATET из работы Дехеджа и Ваба (2002) приведены в таблице 25.7. Отметим также, что базовая оценка эффекта воздействия равна \$1794. Она получена регрессией RE78 на $D$ для версии выборки NSW из работы Дехеджа и Ваба (2002), в которую входят и участники и не-участники. Оценки ATET из этой таблице заметно отличаются от полученных в работе Дехеджа и Ваба (2002), равно как и от базовых, экспериментальных оценок. Для спецификации Дехеджа и Ваба (2002), оценка ближайшего соседа очень близка к базовой и даже лучше результатов Дехеджа и Ваба (2002) из-за уменьшения смещения. 

\begin{table}[h]
\caption{Влияние подготовки: оценки ATET}
\begin{center}
\begin{minipage}{17cm} 
\begin{tabular}{lccccc}
\hline
\hline
Процедура сопоставления & Кол-во в  & Кол-во в & ATET & Ст. ошибка & \% от \$1794 \footnote{$ATET/1794 \cdot 100$.} \\
& эксперимент. & контрол. & &\\
\hline
\multicolumn{6}{l}{Спецификация Дехеджа и Ваба (2002) \footnote{Логит-модель: $\Pr[treat = 1]$ = h(CONSTANT, CONSTANT, AGE, $AGE^2$, EDU, $EDU^2$, MARRIED, NODEGREE, BLACK, HISPANIC, RE74, $RE74^2$, RE75, U74, U75, U74*HISPANIC).}}\\
Ближайших соседей & 185 & 53 & 2385 & 1209 \footnote{Бутстрапированные стандартные ошибки, 200 репликаций.} & 133 \\
Радиус, $r = 0.001$ & 54 & 517 & $-7815$ & 1118 \footnote{Аналитические стандартные ошибки.} & $-436$ \\
Радиус, $r = 0.0001$ & 24 & 92 & $-9333$ & 2282 \textcolor{red}{$^d$} & $-520$ \\
Радиус, $r = 0.00001$ & 15 & 19 & $-2200$ & 2986 \textcolor{red}{$^d$} & $-123$ \\
Стратификация & 185 & 1086 & 1452 & 1041 \textcolor{red}{$^c$} & 81 \\
Ядерная & 185 & 1058 & 1309 & 975 \textcolor{red}{$^c$} & 73 \\
\multicolumn{6}{l}{Спецификация Дехеджа и Ваба (2002) \footnote{Логит-модель: $\Pr[treat = 1]$ = h(CONSTANT, AGE, $AGE^2$, EDU, $EDU^2$, MARRIED, NODEGREE, BLACK,
HISPANIC, RE74, $RE74^2$, RE75, $RE75^2$, $RE74*RE75$, $U74*BLACK$).}}\\
Ближайших соседей & 185 & 57 & 560 & 1098 \textcolor{red}{$^c$} & 31 \\
Радиус, $r = 0.001$ & 57 & 583 & $-9358$ & 997 \textcolor{red}{$^d$} & $-522$ \\
Радиус, $r = 0.0001$ & 27 & 76 & $-7847$ & 2066 \textcolor{red}{$^d$} & $-437$ \\
Радиус, $r = 0.00001$ & 16 & 13 & 223 & 4551 \textcolor{red}{$^d$} & 12 \\
Стратификация & 185 & 1146 & 2156 & 814 \textcolor{red}{$^c$} & 120 \\
Ядерная & 185 & 1146 & 1518 & 890 \textcolor{red}{$^c$} & 85 \\
\hline
\hline
\end{tabular}
\end{minipage}
\end{center}
\end{table}

Для стратифицированных и ядерных оценок смещение больше. Для оценки радиальным сопоставлением, это смещение сильнее, потому что дает отрицательные оценки эффекта воздействия вместо положительных, которые Дехеджа и Ваба (2002) получили при циркульном сопоставлении. Разница между нашим радиальным сопоставлением и циркульным сопоставлением Дехеджа и Ваба (2002) заключается в том, что при циркульном сопоставлении объект, не имеющий аналогов внутри заданного радиуса, сопоставляется с ближайшим соседом за пределами радиуса.  В нашем же случае, в сходной ситуации такой объект просто игнорируется. Полученные различия демонстрируют чувствительность оценок сопоставления к предположениям. 

Робастность оценок ATET при разных спецификациях может быть оценена в терминах соотношения ATET и базовой оценки, приведенного в последней колонке таблицы 25.6. За исключением сопоставления со стратификацией, это отношение очень сильно меняется в зависимости от спецификации. К примеру, оценка ближайших соседей составляет 133\% базовой оценки в спецификации Дехеджа и Ваба (2002), но только 31\% в спецификации Дехеджа и Ваба (1999). Аналогично, оценки ATET чувствительны к использованной мере склонности, кроме случая ядерной оценки. 

\begin{table}[h]
\caption{Влияние подготовки: оценки ATET Дехеджа и Ваба (2002)}
\begin{center}
\begin{tabular}{lcc}
\hline
\hline
Процедура сопоставления & ATET &  Ст. ошибка \\
\hline
Ближайший сосед & 1890 & 1202 \\
Радиус, $r = 0.001$ & 1824 & 1187 \\
Радиус, $r = 0.0001$ & 1973 & 1191 \\
Радиус, $r = 0.00005$ & 1928 & 1196 \\
Радиус, $r = 0.00001$ & 1893 & 1198 \\
\hline
\hline
\end{tabular}
\end{center}
\end{table}

Качество работы методов сопоставления зависит от выбора модели меры склонности для экспериментальной и контрольной групп (Дехеджа и Ваба, 2002). Однако, очевидно, что есть связь между методами и моделями меры склонности. 

\section{Библиографические заметки}

Ранние экономические приложения методов сопоставления и разности разностей встречаются в работах Ашенфелтера (1978) и Ашенфелтера и Карда (1985). Оценка воздействия --- очень популярная и быстро развивающая область в современной эконометрике. 
\begin{enumerate}
\item[25.2] Ангрист и др. (1996) приводят полезные сравнения концепций и терминологии в медицинской и эконометрической литературе.  
\item[25.3] Хекман и Robb (1985) рассматривают оценку эффекта программ для разных видов данных в присутствии самоотбора. См. также работу Бьорклунда и Моффитта (1987). Хекман и Хотц (1989) также говорят, что необходимо проверить результаты несколькими тестами на спецификацию чтобы проверить их робастность и оценить влияние смещения самоотбора. К примеру, они предлагают использовать множественные сравнительные группы для оценки чувствительности результатов, полученных на основе одной контрольной группы. Большая часть их ранних работ использует параметрический подход. В более новых также применяются непараметрические методы. 
\item[25.4] Хекман, Ишимура и Тодд (1997) и Хекман и др. (1998) изучают и применяют оценки сопоставления. Важный результат, касающийся условий на меру склонности, дан в работе Розенбаума и Рубина (1983, теорема 2). Эффективное оценивание ATE при помощи оцененных мер склонности проанализировано в работе Хирано, Имбенса и Риддера (2003). Дехеджа и Ваба (2002) применяют методы сопоставления мер склонности для варианта данных Лалонда (1986). Экспериментальные данные сопоставляются с наблюдениями из CPS и PSID. Смит и Тодд (2004) повторно анализируют данные Дехеджа and Ваба при помощи разных вариантов оценок на основе мер склонности. Они подчеркивают смещения, связанные с альтернативными оценками мер склонности и отмечают важность использования высококачественных данных для минимизации смещения. Бекер и Ичино (2002) приводят обзор нескольких оценок на основе сопоставления мер склонности. Они также предоставляют набор программ для STATA с иллюстрациями, который можно использовать для оценки ATET. В выпуске Квартального Экономического Журнала (Quarterly Journal of Economics) за февраль 2004 есть подборка по эконометрике сопоставления. 
\item[25.6] Хан, Тодд, and Ван дер Клаув (2001) анализируют идентификацию эффектов воздействия для модели разрывной регрессии при слабых предположениях.  
\item[25.7] Имбенс и Ангрист (1994) анализируют свойства оценок LATE. Ангрист и др. (1996) обсуждают использование методов инструментальных переменных и делают сравнение с оценкой LATE. За статьей следует оживленная дискуссия, в которой приводятся разные мнения об оценках метода инструментальных переменных и связи с другой литературой, см. также Хекман (1997). Ангрист (2001) обсуждает некоторые простые стратегии для работы с эндогенными дамми в нелинейных моделях с ненормальными результатами. За этой статьей следует обсуждение и комментарии, которые анализируют достоинства и недостатки линеаризованного метода инструментальных переменных. Нет соглашения по поводу того, какой из подходов выглядит наиболее многообещающе. Хекман, Тобиас, и Вытлацил (2003) рассматривают оценки эффектов воздействия в рамках моделей с латентными переменными. Велла и Вербик (1999) сравнивают метод инструментальных переменных с использованием управляющих функций, включающих коррекцию на смещение самоотбора. 
\end{enumerate}

\section*{Упражнения}

\begin{enumerate}
\item[25-1] (Адаптировано из работы Хекман, 1996) Рассмотрите модель воздействие-результат $y = x' \beta +\alpha d + \e$, где $d$ --- бинарный индикатор, равный 1, если воздействие было назначено (случайно), и 0 в противном случае.
\begin{enumerate}
\item Является ли рандомизированное воздействие достаточным условием для оценки $\alpha$? 
\item Является ли рандомизированное воздействие достаточным условием для оценки $\alpha$ и $\beta$? 
\end{enumerate}

\item[25-2] В предыдущей задаче рандомизация относится к воздействию. Теперь рассмотрим рандомизированное право на получение воздействия. Пусть $e = 1$ обозначает, что индивид имеет право (значение присваивается случайно) и $e = 0$ --- что не имеет. Покажите, что в этом случае при $\Pr [d = 1 | x] \ne 0$, эффект воздействия задается $\E [y | e = 1, x] - \E [y | e = 0, x]/\Pr[d = 1|x]$.

\item[25-3] Рассмотрим модель с нелинейным результатом воздействия $\E [y|x,d] = \exp (x'\beta + \alpha d)$, где $d$ --- это бинарный индикатор воздействия. Предположим, что нам доступны состоятельные оценки $(\beta, \alpha)$ и оценка ковариационной матрицы $\widehat \V [\widehat{\beta}, \widehat{\alpha}]$. Пусть оценка асимптотически нормальна. Наметьте бутстраповский или Монте-Карло алгоритм для оценки ATE и его асимптотической дисперсии, если даны $(x_i , d_i), \; i = 1, \dots, N$. 

\item[25-4] Рассмотрим модель с нелинейным результатом воздействия $\E [\ln y|x,d] = x'\beta + \alpha d$, где $d$ --- это бинарный индикатор воздействия. Предположим, что нам доступны состоятельные оценки $(\beta, \alpha)$ и оценка ковариационной матрицы $\widehat \V [\widehat{\beta}, \widehat{\alpha}]$. Пусть нас интересует оценка ATE в терминах $y$, а не $\ln y$. Предложите процедуру оценивания и проанализируйте её состоятельность. 

\item[25-5] В этой главе в эмпирической иллюстрации использовалась контрольная группа из PSID и экспериментальная из NSW. Дехеджа и Ваба (2002) использовали две контрольные группы. Вторая была основана на CPS. В этом упражнении нужно повторить некоторые вычисления, представленные здесь, при помощи контрольной группы из CPS, а не из PSID. 
\begin{enumerate}
\item Сделайте таблицу, аналогичную 25.3. Сравните группу из NSW с группой из CPS по возрасту, расовой принадлежности, образованию и доходам до воздействия.  
\item Различия между экспериментальной и контрольной группами могут рассматриваться при помощи оцененной меры склонности, как это было сделано в разделе 25.8. Используя подход из раздела 25.8.4, оцените меру склонности для общей выборки NSW-CPS, включая объясняющие переменные в модель линейно и в более высоких порядках, как в Дехеджа и Ваба (2002). Игнорируя те контрольные наблюдения, для которых мера склонности меньше минимума по экспериментальной группе, сравните меры склонности в двух выборках при помощи гистограмм. Прокомментируйте качество сопоставления для разных интервалов значений меры склонности. 
\item Используя методы сопоставления, описанные и реализованные в разделах 25.8.4 и 25.8.5 (особенно метод ближайших соседей, стратификацию или интервальное сопоставление, ядерное сопоставление и радиальное сопоставление), постройте таблицу, аналогичную таблице 25.6. Прокомментируйте полученные оценки ATET и сравните их с полученными по контрольной выборке из PSID. 
\end{enumerate}

\end{enumerate}



