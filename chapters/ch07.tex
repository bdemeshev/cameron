
\chapter{Тесты на проверку гипотез}
\section{Введение}

В этой главе мы рассмотрим тесты на проверку гипотез, в том числе нелинейных по параметрам, используя оценки для нелинейных моделей.

Распределение тестовой статистики может быть получено, используя ту же самую статистическую теорию, что и для получения оценки, так как тестовые статистики, как и оценки, --- это статистики, выбор которых зависит от результатов наблюдений. При подходящей линеаризации оценок и гипотез результаты похожи на результаты тестирования линейных ограничений в линейной регрессионной модели. Однако результаты основываются на асимптотической теории, а также $t$-статистика и $F$-статистика для линейной модели при предположении о нормальности заменяются на статистики, которые распределены асимптотически нормально ($z$-тесты) или распределены по хи-квадрат.

Существуют две основные проблемы, связанные с проверкой гипотез. Во-первых, тесты могут быть неверного размера, так, проверяя гипотезу на номинальном уровне значимости, например, 5\%, истинная вероятность отвергнуть нулевую гипотезу может быть гораздо больше или меньше, чем 5\%. Такая проблема пратически всегда возникает в выборках среднего размера, так как базовая асимптотическая теория является лишь апроксимацией. Одним из решений этой проблемы является метод бутстреп, который вводится в этой главе, но он настолько важен, что будет рассмотрен отдельно в главе 11. Во-вторых, мощность тестов может быть низкой, то есть вероятность отвергнуть нулевую гипотезу, когда она должна быть отвергнута, будет маленькой. Многие часто не учитывают этот потенциальный недостаток. В этой книге размеру и мощности уделяется большее внимание, чем в других книгах.

Тест Вальда, наиболее широко применяемая тестовая процедура, будет определён в разделе 7.2. В разделе 7.3 дополнительно описаны тест отношения правдоподобия и тест множителей Лагранжа, которые применяются при оценивании с помощью метода максимального правдоподобия. Различные тесты проиллюстрированы в разделе 7.4. Раздел 7.5 представляет методы оценивания, отличные от метода максимального правдоподобия, включая формы тестов с поправками. В разделах 7.6, 7.7 и 7.8 описаны мощность теста, метод Монте-Карло и метод бутстреп.

Методы для определения спецификации и выбора модели рассмотрены отдельно в главе 8.

\section{Тест Вальда}

Тест Вальда, предложенный Вальдом в 1943 году, --- это выдающийся тест в микроэконометрике. Он требует оценивания неограниченной модели, то есть модели без наложенных на неё ограничений, которые указаны в нулевой гипотезе. Тест Вальда широко применяется, так как современное программное обеспечение обычно позволяет оценить неограниченную модель, даже если она является более сложной, чем ограниченная модель. Более того, современное программное обеспечение позволяет найти оценку ковариационной матрицы с поправкой, которая даёт возможность применять тест Вальда при довольно слабых предпосылках о распределении. Статистика теста на значимость регрессоров, которая рассчитывается различными статистическими пакетами, --- это и есть статистика Вальда. 

В этом разделе детально рассматривается тест Вальда для проверки нелинейных гипотез, с теорией и примерами. Также в нём представлен дельта-метод, который используется для построения доверительных интервалов и областей нелинейных функций параметров. Минусом теста Вальда является его инвариантность к алгебраически эквивалентной параметризации нулевой гипотезы. Он будет подробно освещён в конце раздела.

\subsection{Линейные гипотезы в линейных моделях}

Сначала мы вспомним результаты стандартной линейной модели, так как тест Вальда --- это обобщение обычного теста на линейные ограничения в линейной регрессионной модели.

Нулевая и альтернативная гипотезы для двустороннего теста на линейные ограничения на параметры регрессии в линейной регрессионной модели $y = X'\beta + u$ выглядят так:

\begin{equation}
H_0: R\beta_0 - r = 0,
H_a: R\beta_0 - r \not= 0,
\end{equation}
где есть $h$ ограничений, $R$ --- это матрица констант полного ранга $h$ и размера $h \times K$, $\beta$ --- это вектор параметров размера $K \times 1$, $r$ --- это вектор констант размера $h \times 1$, и $h \leq K$.

Например, совместный тест на то, что $\beta_1 = 1$, $\beta_2 - \beta_3 = 2$ при $K = 4$, может быть сформулирован как нулевая и альтернативная гипотезы, представленные выше при условии, что
\[
R = \begin{bmatrix} 1 & 0 & 0 & 0 \\ 0 & 1 & -1 & 0 \end{bmatrix}, r = \begin{bmatrix} 1 \\ 2 \end{bmatrix}.
\]

Тест Вальда на то, что $R\beta_0 - r = 0$, --- это тест на близость к нулю выборочного аналога $R\hat{\beta} - r$, где $\hat{\beta}$ --- это вектор параметров оценённой с помощью МНК неограниченной модели. При сильном предположении о том, что $u \sim N[0,\sigma_0^2I]$ и оценка $\hat{\beta} \sim N[\beta_0, \sigma_0^2(X'X)^{-1}]$, получается, что при нулевой гипотезе
\[
R\hat{\beta} - r \sim N[0,\sigma_0^2R(X'X)^{-1}R'],
\]
где $R\beta_0 - r = 0$ привело к тому, что математическое ожидание стало равно нулю. Получение квадратичной формы приводит к тестовой статистике
\[
W_1 = (R\hat{\beta} - r)'[\sigma_0^2R(X'X)^{-1}R'](R\hat{\beta} - r),
\]
которая при нулевой гипотезе распределена по $\chi^2(h)$. Однако на практике тестовая статистика $W_1$ не может быть рассчитана, так как $\sigma_0^2$ неизвестна.

В больших выборках замена $\sigma_0^2$ на $s^2$ не влияет на предельное распределение $W_1$, так как это эквивалентно домножению слева $W_1$ на $\sigma_0^2/s^2$ и $\plim(\sigma_0^2/s^2) = 1$ (см. теорему преобразования А.12). Таким образом,
\begin{equation}
W_2 = (R\hat{\beta} - r)'[s^2R(X'X)^{-1}R'](R\hat{\beta} - r)
\end{equation}
сходится к распределению $\chi^2(h)$ при нулевой гипотезе.

Тестовая статистика $W_2$ распределена по хи-квадрат только асимптотически. В этом линейном примере с нормальным распределением ошибок для малой выборки может быть получен альтернативный результат. Стандартный результат, который выводится во многих вводных книгах
\[
W_3 = W_2/h,
\] 
распределён по $F(h,N - K)$ при нулевой гипотезе, если $s^2 = (N - K)^{-1}\sum_i \hat{u}_i^2$, где $\hat{u}_i$ --- это остатки в модели, оценённой с помощью МНК. Это $F$-статистика, которая часто записывается в виде суммы квадратов остатков.

Точные результаты такие, как для $W_3$, невозможно получить в нелинейных моделях, и даже в линейных моделях они требуют очень сильных предпосылок. Вместо этого применяется нелинейный аналог $W_2$ с асимптотическими результатами.

\subsection{Нелинейные гипотезы}

Мы рассмотрим гипотезы об $h$ ограничениях, возможно, нелинейных по параметрам, на векторе параметров $\theta$ размера $q \times 1$, где $h \leq q$. Для линейной регрессии $\theta = \beta$ и $q = K$.

Нулевая и альтернативная гипотезы для двустороннего теста выглядят так:
\begin{equation}
H_0: h(\theta_0) = 0,
H_a: h(\theta_0) \not= 0,
\end{equation}
где $h(\cdot)$ --- векторная функция $\theta$ размера $h \times 1$. Обратите внимание, что в этой главе $h(\theta)$ используется для обозначения ограничений, которые указаны в нулевой гипотезе. Важно это не путать с $h(w, \theta)$, которое использовалось в предыдущей главе для обозначения моментных условий, применяемых для метода моментов и для обобщённого метода моментов.

Обычные линейные примеры включают тест на значимость одного коэффициента $h(\theta) = \theta_j = 0$ и тест на подгруппу коэффициентов $h(\theta) = \theta_2 = 0$. Нелинейным примером одного ограничения может быть $h(\theta) = \theta_1/\theta_2 - 1 = 0$. Эти примеры рассматриваются в дальнейших главах.

Предполагается, что $h(\theta)$ --- это матрица размера $h \times q$
\begin{equation}
R(\theta) = \frac{\partial{h(\theta)}}{\partial{\theta'}},
\end{equation}
которая имеет полный ранг в оцениваемой точке $\theta = \theta_0$. Это предположение равнозначно линейной независимости ограничений в линейной модели, в которой $R(\theta) = R$ не зависит от $\theta$ и имеет полный ранг $h$. Также предполагается, что параметры не находятся на границе области параметров при нулевой гипотезе. Это исключает проверку гипотезы $H_0: \theta_1 = 0$, если для модели необходимо условие $\theta_1 \geq 0$.

\subsection{Статистика теста Вальда}

Логика, которая лежит в основе теста Вальда, довольно проста. Тест на проверку гипотезы $h(\theta_0) = 0$ заключается в том, чтобы получить оценку $\hat{\theta}$ без наложения ограничений и проверить $h(\hat{\theta}) \simeq  0$ или нет. Если $h(\hat{\theta}) \stackrel{a}{\sim} N[0, \V[h(\hat{\theta}]]$ при нулевой гипотезе, тогда тестовая статистика будет такой:
\[
W = h(\hat{\theta})'[\V[h(\hat{\theta})]]^{-1}h(\hat{\theta}) \stackrel{a}{\sim} \chi^2(h).
\]

Единственное затруднение, которое может возникнуть --- это нахождение $\V[h(\hat{\theta})]$, которое зависит от ограничений $h(\cdot)$ и оценки $\hat{\theta}$.

С помощью разложения в ряд Тейлора до первого члена (см. раздел 7.4.2) при нулевой гипотезе $h(\hat{\theta})$ имеет то же самое предельное распределение, что и $R(\theta_0)(\hat{\theta} - \theta_0)$, где $R(\theta)$ было определено в (7.4). Тогда $h(\theta)$ распределён асимптотически нормально при нулевой гипотезе с математическим ожиданием, равным нулю, и ковариационной матрицей $R(\theta_0)\V[\hat{\theta}]R(\theta_0)'$. Состоятельная оценка имеет вид $\hat{R}N^{-1}\hat{C}\hat{R}'$, где $\hat{R} = R(\hat{\theta})$. Предполагается, что для оценки $\hat{\theta}$ верно следующее:
\begin{equation}
\sqrt{N}(\hat{\theta} - \theta) \stackrel{d}{\rightarrow} N[0, C_0],
\end{equation}
и $\hat{C}$ --- любая состоятельная оценка $C_0$.

\begin{center}
Стандартные версии теста Вальда
\end{center}

Из предыдущих обсуждений следует, что статистика теста Вальда выглядит следующим образом:
\begin{equation}
W = N\hat{h}'[\hat{R}\hat{C}\hat{R}']^{-1}\hat{h},
\end{equation}
где $\hat{h} = h(\hat{\theta})$ и $\hat{R} = \partial{h(\theta)}/\partial{\theta'}|_{\hat{\theta}}$. Это эквивалентно выражению $W = \hat{h}'[\hat{R}\hat{\V}[\hat{\theta}]\hat{R}']^{-1}\hat{h}$, где $\hat{\V}[\hat{\theta}] = N^{-1}\hat{C}$ --- это оценка асимптотической ковариационной матрицы $\hat{\theta}$.

Тестовая статистика $W$ асимптотически распределена по $\chi^2(h)$ при нулевой гипотезе. Таким образом, нулевая гипотеза отвергается в пользу альтернативной гипотезы на уровне значимости $\alpha$, если $W > \chi_{\alpha}^2(h)$, во всех остальных случаях она не отвергается. Аналогично нулевая гипотеза отвергается на уровне значимости $\alpha$, если $p$-значение, равное $\Pr[\chi^2(h) > W]$, меньше $\alpha$.

Статистику Вальда можно использовать и для $F$-статистики. Асимптотическая $F$-статистика Вальда
\begin{equation}
F = W/h
\end{equation}
имеет асимпотическое распределение $F(h, N - q)$. Это даёт то же самое $p$-значение, что и для первоначальной статистики Вальда $W$, так как $N \rightarrow \infty$. Однако для конечных выборок $p$-значения будут отличаться. Для нелинейных моделей чаще всего смотрят на $W$, хотя $F$ тоже применяется в надежде, что она даст лучшую апроксимацию для малых выборок.

Для теста только на одно ограничение, квадратный корень из хи-квадрат теста Вальда --- это стандартная тестовая статистика. Этот результат полезен, так как он позволяет проверять односторонние гипотезы. В частности, для скаляра $h(\theta)$ $z$-тестовая статистика Вальда выглядит так:
\begin{equation}
W_z = \frac {\hat{h}}{\sqrt{\hat{r}N^{-1}\hat{C}\hat{r}'}}
\end{equation}
где $\hat{h} = h(\hat{\theta})$ и $\hat{r} = \partial{h(\theta)}/\partial{\theta'}|_{\hat{\theta}}$ --- это вектор размера $1 \times k$. Результат (7.6) подразумевает, что $W_z$ имеет асимптотическое нормальное распределение при нулевой гипотезе. Соответственно, $W_z$ имеет асимптотическое $t$-распределение с $(N-q)$ степенями свободы, так как $t$-распределение сходится к нормальному при $N \rightarrow \infty$.

\begin{center}
Обсуждение
\end{center}

Статистика Вальда (7.6) для нелинейного случая имеет тот же самый вид, что и статистика $W_2$ для линейной модели (7.2). Оцениваемое отклонение от нулевой гипотезы равно $h(\hat{\theta})$, а не $(R\hat{\beta} - r)$. Матрица $R$ заменена оценённой матрицей $\hat{R}$, а предположение о том, что матрица $R$ имеет полный ранг, заменяется предположением о том, что матрица $R_0$ имеет полный ранг. Наконец, оценка ковариационной матрицы равна $N^{-1}\hat{C}$, а не $s^2(X'X)^{-1}$.

Существует множество возможных состоятельных оценок $C_0$ (см. раздел 5.5.2), которые приводят на практике к расчёту  различных значений $W$, $F$ или $Wz$, которые асимптотически эквивалентны. В частности, $C_0$ часто имеет форму сэндвича $A_0^{-1}B_0A_0^{-1}$, оценка с поправкой которого равна $\hat{A}^{-1}\hat{B}\hat{A}^{-1}$. Преимущество теста Вальда состоит в том, что к нему легко применить поправку для обеспечения достоверных статистических заключений при относительно слабых предположениях о распределении таких, как наличие потенциальной гетероскедастичности ошибок.

Вероятность отвергнуть нулевую гипотезу тем выше, чем больше значения $W$ или $F$, или для двустронних тестов $Wz$. Чем дальше значение $h(\hat{\theta})$ от 0 в нулевой гипотезе, тем более эффективна оценка $\hat{\theta}$ (так как $\hat{C}$ принимает маленькие значения) и тем больше размер выборки, так как в этом случае $N^{-1}$ мало. Последний результат является следствием проверки гипотезы на неизменном уровне значимости $\alpha$ при увеличении размера выборки. В принципе можно было бы уменьшить $\alpha$ при увеличении размера выборки. Такие штрафы для полностью параметрических моделей представлены в разделе 8.5.1.


\subsection{Вывод статистики Вальда}

Разложив в ряд Тейлора до первого члена в точке $\theta_0$, получаем
\[
h(\hat{\theta}) = h(\theta_0) + \frac{\partial{h}}{\partial{\theta'}}|_{\theta^{+}} (\hat{\theta} - \theta_0)
\]
для некоторой $\theta^{+}$, которая лежит между $\hat{\theta}$ и $\theta_0$. Отсюда следует, что
\[
\sqrt{N}(h(\hat{\theta}) - h(\theta_0)) = R(\theta^{+})\sqrt{N}(\hat{\theta} - \theta_0),
\]
где $R(\theta)$ представляет собой то, как оно было определено в (7.4), откуда получается, что
\begin{equation}
\sqrt{N}(h(\hat{\theta}) - h(\theta_0)) \stackrel{d}{\rightarrow} N[0, R_0C_0R_0'],
\end{equation}
с помощью теоремы о нормальности предела произведения (Теорема A.17), так как $R(\theta^{+}) \stackrel{p}{\rightarrow} R_0 = R(\theta_0)$ и применяя предельное распределение для $\sqrt{N}(\hat{\theta} - \theta_0)$, которое дано в (7.5).

При нулевой гипотезе (7.9) можно упростить, так как $h(\theta_0) = 0$, отсюда при нулевой гипотезе
\begin{equation}
\sqrt{N}h(\hat{\theta}) \stackrel{d}{\rightarrow} N[0, R_0C_0R_0'].
\end{equation}

Теоретически можно было бы использовать это многомерное нормальное распределение для определения области, в которой гипотеза отвергается, но гораздо проще его привести к хи-квадрат распределению. Напомним, что $z \sim N[0,\Omega]$, где матрица $\Omega$ имеет полный ранг. Тогда $z'\Omega^{-1}z \sim \chi^2(dim(\Omega))$. В таком случае из (7.10) следует, что при нулевой гипотезе
\[
Nh(\hat{\theta})'[R_0C_0R_0']^{-1}h(\hat{\theta}) \stackrel{d}{\rightarrow} \chi^2(h),
\]
где для этого выражения существует обратная матрица в силу предположения, что матрицы $R_0$ и $C_0$ имеют полный ранг. Статистика Вальда, определённая в (7.6), получается при замене $R_0$ и $C_0$ состоятельными оценками.

\subsection{Примеры теста Вальда}

Наиболее распространённые тесты --- тесты на одно или несколько исключающих ограничений. Мы также приводим пример теста для проверки нелинейной гипотезы.

\begin{center}
Тесты на исключающие ограничения
\end{center}

Рассмотрим случай, когда последние $h$ компонент $\theta$ равны нулю. Тогда $h(\theta) = \theta_2 = 0$, где мы разобьём $\theta = (\theta_1', \theta_2')'$. Отсюда следует, что
\[
R(\theta) = \frac{\partial{h(\theta)}}{\partial{\theta'}} = \begin{bmatrix} \frac{\partial{\theta_2}}{\partial{\theta_1'}} & \frac{\partial{\theta_2}}{\partial{\theta_2'}} \end{bmatrix} = \begin{bmatrix} 0 & I_h \end{bmatrix},
\]
где $0$ --- это матрица из нулей размера $(q - h) \times q$ и $h$ --- это единичная матрица размера $h \times h$. Тогда
\[
R(\theta)C(\theta)R(\theta)' = \begin{bmatrix} 0 & I_h \end{bmatrix} \begin{bmatrix} C_{11} & C_{12} \\ C_{21} & C_{22}\end{bmatrix} \begin{bmatrix} 0 \\ I_h \end{bmatrix} = C_{22}.
\]

Таким образом, статистика Вальда для теста на исключающие ограничения выглядит следующим образом:
\begin{equation}
W = \hat{\theta_2}'[N^{-1}\hat{C}_{22}]^{-1}\hat{\theta_2},
\end{equation}
где $N^{-1}\hat{C}_{22} = \hat{\V}[\hat{\theta}_2]$. При нулевой гипотезе $W$ имеет асмиптотическое $\chi^2(h)$ распределение.

Эта тестовая статистика является обобщением теста на подгруппу регрессоров в модели линейной регрессии. В этом случае результаты доступны для малых выборок, если ошибки имеют нормальное распределение, тогда используется соответствующий $F$-тест.

\begin{center}
Тесты на статистическую значимость
\end{center}

Тест на значимость одного коэффициента --- это тест на то, отличается ли $\theta_j$ ($j$-ая компонента $\theta$) от нуля. Тогда $h(\theta) = \theta_j$, и $r(\theta) = \partial{h}/\partial{\theta}'$ --- это вектор, состоящий из нулей, кроме $j$-ой компоненты, которая равна 1, тогда можно упростить (7.8) до выражения
\begin{equation}
W_z = \frac{\hat{\theta}_j}{se[\hat{\theta}_j]},
\end{equation}
где $se[\hat{\theta}_j] = \sqrt{N^{-1}\hat{c}_{jj}}$ --- это стандартная ошибка $\hat{\theta}_j$, а $\hat{c}_{jj}$ --- это диагональный элемент матрицы $\hat{C}$.

Тестовую статистику $W_z$ (7.12) часто называют <<$t$-статистикой>> из-за результатов для линейной регрессионной модели при условии нормальности, но, строго говоря, она является асимптотической <<$z$-статистикой>>.

Для двустороннего теста нулевая гипотеза $H_0: \theta_{j0} = 0$ против альтернативной гипотезы $H_a: \theta_{j0} \not= 0$ отвергается на уровне значимости $\alpha$, если $|W_z| > z_{\alpha/2}$, в остальных случаях она не отвергается. Это даёт те же самые результаты, что и хи-квадрат статистика Вальда, так как $W_z^2 = W$, где $W$ определено в (7.6) и $z^2_{\alpha/2} = \chi^2(h)$.

Нередко бывает, что есть предварительная информация о знаке $\theta_j$. Тогда следует проверять одностороннюю гипотезу. Например, предположим, что, исходя из экономического обоснования или предыдущих исследований, $\theta_j > 0$. В данном случае имеет значение, соответствует ли $\theta_j > 0$ нулевой или альтернативной гипотезе. Для односторонних гипотез принято брать предыдущее утверждение в качестве альтернативной гипотезы, так как можно показать, что в этом нужны более веские доказательства, для того чтобы подтвердить утверждение. В этом случае на уровне значимости $\alpha$, если $W_z < z_{\alpha}$, нулевая гипотеза $H_0: \theta_{j0} \leq 0$ отвергается в пользу альтернативной $H_a: \theta_{j0} > 0$. Аналогично для утверждения $\theta_{j0} < 0$ на уровне значимости $\alpha$, если $W_z < - z_{\alpha}$, нулевая гипотеза $H_0: \theta_{j0} \geq 0$ отвергается в пользу альтернативной $H_a: \theta_{j0} < 0$.

Компьютер обычно приводит $p$-значение для двустороннего теста, но во многих случаях более целесообразно использовать односторонний тест. Если $\hat{\theta}_j$ имеет <<правильный>> знак, то $p$-значение для одностороннего теста в два раза меньше, чем для двустороннего теста.

\begin{center}
Тесты на нелинейное ограничение
\end{center}

Рассмотрим тест на одно нелинейное ограничение
\[
H_0: h(\theta) = \theta_1/\theta_2 - 1 = 0.
\]
Тогда $R(\theta)$ --- это вектор размера $1 \times q$, первый элемент которого равен $\partial{h}/\partial{\theta_1} = 1/\theta_2$, второй элемент равен $\partial{h}/\partial{\theta_2} = - \theta_1/\theta_2^2$, а все остальные равны нулю. Обозначая $\hat{c}_{jk}$ как $j$-ый элемент матрицы $\hat{C}$, (7.6) преобразовывается в
\[
W = N\left(\frac{\hat{\theta}_1}{\hat{\theta}_2} - 1\right)^2 \begin{pmatrix} \begin{bmatrix} \frac{1}{\hat{\theta}_2} & -\frac{\hat{\theta}_1}{\hat{\theta}_2^2} & 0 \end{bmatrix} & \begin{bmatrix} \hat{c}_{11} & \hat{c}_{12} & \dots \\ \hat{c}_{21} & \hat{c}_{22} & \dots \\ \vdots & \vdots & \ddots \end{bmatrix} & \begin{bmatrix} 1/\hat{\theta}_2 \\ - \hat{\theta}_1 / \hat{\theta}_2^2 \\ 0 \end{bmatrix} \end{pmatrix}^{-1},
\]
где $0$ --- это матрица из нулей размера $(q - 2) \times q$, которая даёт 
\begin{equation}
W = N[\hat{\theta}_2(\hat{\theta}_1 - \hat{\theta}_2)]^2(\hat{\theta}_2^2\hat{c}_{11} - 2\hat{\theta}_1\hat{\theta}_2\hat{c}_{12} + \hat{\theta}_1^2\hat{c}_{22})^{-1},
\end{equation}
распределённую асимптотически по $\chi^2(1)$ при нулевой гипотезе. Аналогично $\sqrt{W}$ имеет асимптотическое нормальное распределение.

\subsection{Тесты на неправильную спецификацию модели}

Большинство процедур проверки гипотез, в том числе приведённых в главах 7 и 8 этой книги, предполагают, что модель, которая получается при нулевой гипотезе, верно специфицирована, кроме случая небольшой неверной спецификации, которая не влияет на оценку, но требует, чтобы была поправка для стандартных ошибок.

На практике это является значительным упрощением. Например, при проверке теста на гетероскедастичность ошибок предполагается, что это единственный недостаток, который может иметь регрессия. Однако если условное математическое ожидание неверно специфицировано, то истинный размер теста будет отличаться от номинального размера, даже асимптотически. Кроме того, больше не будет асимптотической эквивалентности тестов, таких как тест Вальда, тест отношения правдоподобия и тест множителей Лагранжа. Однако чем лучше специфицирована модель, тем более полезны тесты.

Кроме того, стоит обратить внимание на то, что зачастую тесты имеют мощность не только против явно заявленной альтернативной гипотезы, но и против других. Например, предположим, что модель, которая получается при нулевой гипотезе, имеет вид $y = \beta_1 + \beta_2x + u$, где ошибки $u$ гомоскедастичны. Тест на то, включать ли $z$ в качестве регрессора или нет, также будет иметь мощность против альтернативы, что модель является нелинейной по $x$, например, $y = \beta_1 + \beta_2x + \beta_3x^2 + u$, если $x$ и $z$ коррелированы. Аналогично тест на гетероскедастичность ошибок также будет иметь некоторую мощность против нелинейности по $x$. Если нулевая гипотеза отвергается, это не означает, что модель, которая получается при альтернативной гипотезе, является единственной возможной моделью.

\subsection{Совместные тесты против отдельных тестов}

В прикладных работах исследователь часто хочет знать, какие коэффициенты из множества коэффициентов <<значимы>>. Когда проверяется несколько гипотез с помощью теста, можно провести совместный или одновременный тест для проверки всех интересующих гипотез или провести отдельные тесты для каждой из гипотез.

Яркий пример для линейной регрессии касается использования отдельных $t$-тестов для проверки нулевых гипотез $H_{10}: \beta_1 = 0$ и $H_{20}: \beta_2 = 0$ вместо использования $F$-теста для проверки совместной гипотезы $H_0: \beta_1 = \beta_2 = 0$, где альтернативой является то, что по крайней мере один из параметров не равен нулю. $F$-тест --- явный совместный тест, при котором $H_0$ отвергается, если оценённая точка $(\hat{\beta}_1, \hat{\beta}_2)$ выходит за пределы линии уровня уровня линии уровня функции плотности. В качестве альтернативы можно провести два отдельных $t$-теста. Эта процедура является неявным совместным тестом, который называют индуцированным тестом (Савин, 1984). Отдельные тесты отвергают $H_0$, если отвергается или $H_{10}$, или $H_{20}$. Это происходит, если точка $(\hat{\beta}_1, \hat{\beta}_2)$ выходит за прямоугольник, границами которого являются критические значения двух тестовых статистик. Даже если для проверки $H_0$ используется один и тот же уровень значимости такой, чтобы эллипс и прямоугольник имели одинаковую площадь, области, в которых гипотеза отвергается, для совместных и отдельных тестов отличаются, и существует возможность конфликта между ними. Например, точка $(\hat{\beta}_1, \hat{\beta}_2)$ может лежать внутри эллипса, но за пределами прямоугольника.

Пусть $e_1$ и $e_2$ обозначают существование ошибки первого рода (см. раздел 7.5.1) в двух отдельных тестах, и пусть $e_I = e_1 \cup e_2$ обозначает существование ошибки первого рода в индуцированном совместном тесте. Тогда $\Pr[e_I] = \Pr[e_1] + \Pr[e_2] - \Pr[e_1 \cap e_2]$, откуда следует, что
\begin{equation}
\alpha_I \leq \alpha_1 + \alpha_2,
\end{equation}
где $\alpha_I$, $\alpha_1$ и $\alpha_2$ обозначают размеры индуцированного совместного теста, первого отдельного теста и второго отдельного теста соответственно. В частном случае, когда отдельные тесты статистически независимы, $\Pr[e_1 \cap e_2] = \Pr[e_1]\Pr[e_2] = \alpha_1 \alpha_2$, и, следовательно $\alpha_I = \alpha_1 + \alpha_2 -\alpha_1 \alpha_2$. Для распространённых значений $\alpha_1$ и $\alpha_2$, например, 0.05 или 0.01, значение $\alpha_1 \alpha_2$ очень мало, и верхняя граница (7.14) является хорошим индикатором размера теста.

Большое число книг по индуцированным тестам рассматривает проблему выбора критических значений для отдельных тестов таких, чтобы индуцированный тест имел известный размер. Мы не рассматриваем этот вопрос подробно, но приводим $t$-тест Бонферрони в качестве примера. Критические значения этого теста представлены в таблице; см. Савин (1984).

Статистически независимые тесты возникают в линейной регрессии с ортогональными регрессорами и при тестировании с помощью метода максимального правдоподобия (см. раздел 7.3), если соответствующие части информационной матрицы диагональные. Тогда тестовая статистика индуцированного совместного теста основывается на двух статистически независимых отдельных тестовых статистиках, тогда как тестовая статистика явного совместного нулевого теста является суммой двух отдельных тестовых статистик. Гипотеза о совместном нуле может быть отвергнута, потому что одна или обе компоненты нулевой гипотезы отвергаются. Использование отдельных тестов покажет, какая из двух ситуаций имеет место.

В более общем случае коррелированных регрессоров или недиагональной информационной матрицы явный совместный тест имеет указанный недостаток. Тот факт, что нулевая гипотеза отвергается, не указывает причину, из-за которой она была отвергнута. Если используется индуцированный совместный тест, то выбор размера теста требует применения некоторого варианта теста Бонферони или приближения с использованием верхней границы из (7.14). Аналогичные проблемы также возникают, когда последовательно проводятся отдельные тесты, каждый следующий этап которых зависит от результатов предыдущего этапа. В разделе 18.7.1 представлен пример с обсуждением совместного теста двух гипотез, где две компоненты теста коррелированы.

\subsection{Дельта метод для доверительных интервалов}

Метод, используемый для вывода статистики Вальда, называется дельта-методом, так как апроксимация с помощью ряда Тейлора $h(\hat{\theta})$ влечёт за собой взятия производной от $h(\theta)$. Этот метод также может быть использован для получения распределения нелинейной комбинации параметров и, следовательно, для построения доверительных интервалов или областей.

Примером может послужить получения для соотношения $\theta_1/\theta_2$ оценки $\hat{\theta}_1/\hat{\theta}_2$. Вторым примером является прогнозирование условного математического ожидания $g(x'\beta)$, например, с помощью $g(x'\hat{\beta})$. Третьим примером является расчёт эластичности по изменению одной компоненты $x$.

\begin{center}
Доверительные интервалы
\end{center}

Рассмотрим вывод вектора параметров $\gamma = h(\theta)$, оценка которого выглядит так:
\begin{equation}
\hat{\gamma} = h(\hat{\theta}),
\end{equation}
где предельное распределение $\sqrt{N}(\hat{\theta} - \theta_0)$ --- то же самое распределение, которое было дано в (7.5). Тогда прямое применение (7.9) даёт $\sqrt{N}(\hat{\gamma} - \gamma_0) \stackrel{d}{\rightarrow} N[0, R_0C_0R_0']$, где $R(\theta)$ определено в (7.4). Аналогично мы говорим, что $\hat{\gamma}$ имеет асимптотическое нормальное распределение со следующей оценкой коварианционной матрицы
\begin{equation}
\hat{\V}[\hat{\gamma}] = \hat{R}N^{-1}\hat{C}\hat{R}'.
\end{equation}
Этот результат может быть использован для построения доверительных интервалов.

В частности, $100(1-\alpha)\%$ доверительный интервал для скалярного параметра $\gamma$ будет иметь вид
\begin{equation}
\gamma \in \hat{\gamma} \pm z_{\alpha/2}se[\hat{\gamma}],
\end{equation}
где 
\begin{equation}
se[\hat{\gamma}] = \sqrt{\hat{r}N^{-1}\hat{C}\hat{r}'},
\end{equation}
где $\hat{r} = h(\hat{\theta})$ и $r(\theta) = \partial{\gamma}/\partial{\theta}' = \partial{h(\theta)}/\partial{\theta}'$.

\begin{center}
Примеры доверительных интервалов
\end{center}

В качестве примера предположим, что $\E[y|x] = \exp(x'\beta)$, и мы хотим построить доверительный интервал для спрогнозированного условного математического ожидания, когда $x = x_p$. Тогда $h(\beta) = \exp(x_p'\beta)$, так, $\partial{h}/\partial{\beta}' = \exp(x_p'\beta)x_p$ и (7.18) дают
\[
se[\exp(x_p'\beta)] = \exp(x_p'\beta)\sqrt{x_p'N^{-1}\hat{C}x_p},
\]
где $\hat{C}$ --- это состоятельная оценка ковариационной матрицы при предельном распределении $\sqrt{N}(\hat{\beta} - \beta_0)$.

В качестве второго примера предположим, что мы хотим построить доверительный интервал для $e^{\beta}$, а не для $\beta$, скалярного коэффициента. Тогда $h(\beta) = e^{\beta}$, так, $\partial{h}/\partial{\beta} = e^{\beta}$ и (7.18) дают $se[e^{\hat{\beta}}] = e^{\hat{\beta}}se[\hat{\beta}]$. Это даёт $95\%$ доверительный интервал для $e^{\beta}$: $e^{\hat{\beta}} \pm 1.96e^{\hat{\beta}}se[\hat{\beta}]$.

Дельта метод не всегда является лучшим способом, чтобы построить доверительный интервал, потому что он ограничивает доверительный интервал так, чтобы он был симметричным относительно $\hat{\gamma}$. Более того, в предыдущем примере доверительный интервал мог включать в себя отрицательные значения, хотя $e^{\beta} > 0$. Альтернативный доверительный интервал получается экспоненцированием слагаемых в доверительном интервале для $\beta$. Тогда
\[
\Pr[\hat{\beta} - 1.96se[\hat{\beta}] < \beta < \hat{\beta} + 1.96se[\hat{\beta}]] = 0.95
\]
\[
\Rightarrow \Pr[\exp(\hat{\beta} - 1.96se[\hat{\beta}]) < e^{\beta} < \exp(\hat{\beta} + 1.96se[\hat{\beta}])] = 0.95.
\]

Этот доверительный интервал имеет то преимущество, что он асимметричный и включает в себя только положительные значения. Такое преобразование часто используется для доверительных интервалов для параметров наклона в моделях бинарного выбора и в моделях длительности. Подход может быть обобщён и на другие преобразования $\gamma = h(\theta)$ при условии монотонности $h(\cdot)$.

\subsection{Отсутствие инвариантности теста Вальда}

Тестовую статистику Вальда легко получить при условии, что оценки модели без ограничений могут быть получены. Она не менее мощная, чем другие возможные процедуры тестов, которые будут рассмотрены в следующих разделах. По этой причине тест Вальда является наиболее часто используемым тестом.

Однако у теста Вальда есть фундаментальная проблема: он не инвариантен к алгебраически эквивалентным параметризациям нулевой гипотезы. Например, рассмотрим на примере раздела 7.2.5. Тогда $H_0: \theta_1/\theta_2 - 1 = 0$ можно эквивалентным образом выразить как $H_0: \theta_1 - \theta_2 = 0$, что приводит к следующей хи-квадрат тестовой статистике Вальда:
\begin{equation}
W^* = N(\hat{\theta}_1 - \hat{\theta}_2)^2(\hat{c}_{11} - \hat{c}_{12} + \hat{c}_{22})^{-1},
\end{equation}
которая отличается от $W$ из (7.13). Статистики $W$ и $W^*$ могут существенно отличаться для конечных выборок, хотя асимптотически они эквивалентны. Для малых выборок разница может быть весьма существенной, как было показано в методе Монте-Карло Грегори и Виллом (1985), которые рассматривали очень похожий пример. Для тестов с номинальным размером 0.05, один вариант теста Вальда имел истинный размер между 0.04 и 0.06 для всех моделей. Так, асимптотическая теория дала хорошую апроксимацию для малых выборок, тогда как альтернативный асимптотически эквивалентный вариант теста Вальда имел истинный размер, который в некоторых моделях превышал 0.20.

Филлипс и Парк (1988) объяснили различия, показав, что, хотя различные представления ограничений нулевой гипотезы  имеют то же хи-квадрат распределение с использованием обычных асимптотических методов, они имеют разные асимптотические распределения при использовании более сложной асимптотической теории, основанной на разложениях Эджуорта (см. раздел 11.4.3). Кроме того, в особых условиях таких, как предыдущий пример, разложения Эджуорта могут быть использованы для указания параметризации нулевой гипотезы и областей пространства параметров, где стандартная асимптотическая теория, скорее всего, может обеспечить плохую апроксимацию для малых выборок.

Урок заключается в том, что необходимо проявлять осторожность при проверке гипотез о нелинейных ограничениях. В качестве проверки на устойчивость можно провести несколько тестов Вальда с использованием различных алгебраически эквивалентных представлений ограничений, налагаемых нулевой гипотезой. Если это приводит к существенно другим выводам, то может возникнуть проблема. Одним из решений является выполнение бутстреп версии теста Вальда. Это может дать лучший результат для малых выборок и устранить большую разницу между тестами Вальда, которые используют различные представления нулевой гипотезы, потому что, как следует из раздела 11.4.4, бутстреп по сути реализует разложение Эджурта. Второе решение заключается в использовании других методов тестирования, которые приведены в следующем разделе и которые не зависят от различных представлений нулевой гипотезы.

\section{Тесты, основанные на методе максимального правдоподобия}

В этом разделе мы рассмотрим проверку гипотез, когда функция правдоподобия известна, то есть распределение полностью специфицировано. Существуют три классические статистические методики для проверки гипотез --- тест Вальда, тест отношения правдоподобия и тест множителей Лагранжа. Четвёртый тест, $C(\alpha)$ тест, был предложен Нейманом (1959), менее широко используется и здесь не приводится; см. Дэвидсон и МакКиннон (1993). Все четыре теста асимптотически эквивалентны, поэтому выбор между ними основан на простоте расчёта и на том, какие результаты они дают на конечных выборках. Мы также не приводим гладкий критерий Неймана (1937), который, как утверждают Бера и Гош (2002), является оптимальным и столь же фундаментальным, как и другие тесты.

Эти результаты предполагают правильную спецификацию функции правдоподобия. Более подробное описание тестов, основанных на оценках метода квази-максимального правдоподобия, а также на $m$-оценках и эффективных оценках, полученных с помощью обобщённого МНК, приведены в разделе 7.5.

\subsection{Тест Вальда, тест отношения правдоподобия и тест множителей Лагранжа}

Пусть $L(\theta)$ обозначает функцию правдоподобия, совместную условную плотность $y$ при заданных $X$ и параметрах $\theta$. Мы хотим проверить нулевую гипотезу, которая дана в (7.3), то есть  $h(\theta_0) = 0$.

Тесты, кроме теста Вальда, требуют оценивание, которое подразумевает ограничения, накладываемые нулевой гипотезой. Определим оценки следующим образом:

\begin{equation}
\hat{\theta}_u,
\tilde{\theta}_r,
\end{equation}
где $\hat{\theta}_u$ --- оценка ММП для неограниченной модели, $\tilde{\theta}_r$ --- оценка ММП для ограниченной модели.

Оценка ММП для неограниченной модели $\hat{\theta}_u$ получается из максимизации $\ln L(\theta)$, ранее при рассмотрении теста Вальда она обозначалась просто $\hat{\theta}$. Оценка ММП для ограниченной модели $\tilde{\theta}_r$ получается из максимизации Лагранжиана $\ln L(\theta) - \lambda'h(\theta)$, где $\lambda$ --- это вектор множителей Лагранжа размера $h \times 1$. В простом случае исключающего ограничения $h(\theta) = \theta_2 = 0$, где $\theta = (\theta_1', \theta_2')'$, а при включении ограничения $\tilde{\theta}_r = (\tilde{\theta}_{1r}',0')$, где $\tilde{\theta}_{1r}'$ получается как максимум по $\theta_1$ функции максимального правдоподобия для ограниченной модели $\ln L(\theta_1, 0)$ и $0$, который является вектором из нулей размера $(q - h) \times 1$.

Здесь мы вводим и описываем три тестовые статистики, а вывод откладываем до раздела 7.3.3. Все три тестовые статистики сходятся по распределению к $\chi^2(h)$ при нулевой гипотезе. Таким образом, нулевая гипотезы отвергается на уровне значимости $\alpha$, если вычисленная тестовая статистика превышает $\chi_{\alpha}^2(h)$. Аналогично нулевая гипотеза отвергается на уровне значимости $\alpha$, если $p \leq \alpha$, где $p = \Pr[\chi^2(h) > t]$ --- это $p$-значение, а $t$ --- это вычисленное значение тестовой статистики.

\begin{center}
Тест отношения правдоподобия
\end{center}

Мотивацией для статистики теста отношения правдоподобия является то, что если нулевая гипотеза не отвергается, то безусловный и условный максимумы функции максимального правдоподобия должны совпадать. Это предполагает использование функции разницы между $\ln L(\hat{\theta}_u)$ и $\ln L(\tilde{\theta}_r)$.

Для реализации метода необходимо полученить предельное распределение этой разницы. Можно показать, что разница, домноженная на два, имеет асимптотическое хи-квадрат распределение при нулевой гипотезе. Это приводит к статистике теста отношения правдоподобия
\begin{equation}
LR = -2[\ln L(\tilde{\theta}_r) - \ln L(\hat{\theta}_u)].
\end{equation}

\begin{center}
Тест Вальда
\end{center}

Мотивацией для теста Вальда является то, что если нулевая гипотеза не отвергается, то оценка ММП для неограниченной модели $\hat{\theta}_u$ должна удовлетворять ограничениям, накладываемым нулевой гипотезой, поэтому значение $h(\hat{\theta}_u)$ должно быть близко к нулю.

Для реализации метода необходимо получить асимптотическое распределение $h(\hat{\theta}_u)$. В общем виде тест Вальда приведён в (7.6). Для метода максимального правдоподобия происходит специализация с помощью равенства информационных матриц $\V[\hat{\theta}_u] = -N^{-1}A_0^{-1}$, где
\begin{equation}
A_0 = \plim N^{-1} \frac{\partial^2 \ln L}{\partial{\theta}\partial{\theta}'}|_{\theta_0}.
\end{equation}

Это приводит к тестовой статистике Вальда
\begin{equation}
W = -N\hat{h}'[\hat{R}\hat{A}^{-1}\hat{R}']^{-1}\hat{h},
\end{equation}
где $\hat{h} = h(\hat{\theta}_u)$, $\hat{R} = R(\hat{\theta}_u)$, $R(\theta) = \partial{h(\theta)}/\partial{\theta'}$, и $\hat{A}$ --- это состоятельная оценка $A_0$. Знак минуса появляется, так как $A_0$ отрицательно определена.

\begin{center}
Тест множителей Лагранжа
\end{center}

Мотивацией для статистики теста множителей Лагранжа является то, что градиент $\partial{\ln L}/\partial{\theta}|_{\hat{\theta}_u} = 0$ в точке максимума функции максимального правдоподобия. Если нулевая гипотеза не отвергается, то этот максимум будет максимумом и для функции максимального правдоподобия в случае ограниченной модели (например, $\partial{\ln L}/\partial{\theta}|_{\tilde{\theta}_r} \simeq 0)$, потому что наложение ограничений будет иметь незначительное влияние на оценку $\theta$. Используя эту мотивацию, тест множителей Лагранжа называется  скор-тестом, потому что $\partial{\ln L}/\partial{\theta}$ является скор-вектором.

Альтернативные мотивации заключаются в измерении близости к нулю множителей Лагранжа из оптимизационной задачи в случае ограниченной модели. Максимизация по $\theta$ функции $\ln L(\theta) - \lambda'h(\theta)$ подразумевает, что
\begin{equation}
\frac{\partial{\ln L}}{\partial{\theta}}|_{\tilde{\theta}_r} = \frac{\partial{h(\theta)'}}{\partial{\theta}}|_{\tilde{\theta}_r} \times \tilde{\lambda}_r.
\end{equation}

Отсюда следует, что тесты, основанные на оценённых множителях Лагранжа $\tilde{\lambda}_r$, эквивалентны тестам, основанным на значении $\partial{\ln L}/\partial{\theta}|_{\tilde{\theta}_r}$, так как предполагается, что $\partial{h}/\partial{\theta}'$ имеет полный ранг.

Применение этого метода требует нахождения асимптотического распределения $\partial{\ln L}/\partial{\theta}|_{\tilde{\theta}_r}$. Это приводит к получению статистики теста множителей Лагранжа
\begin{equation}
LM = -N^{-1}\frac{\partial{\ln L}}{\partial{\theta}'}|_{\tilde{\theta}_r}\tilde{A}^{-1}\frac{\partial{\ln L}}{\partial{\theta}}|_{\tilde{\theta}_r}, 
\end{equation}
где $\tilde{A}$ --- это состоятельная оценка $A_0$ из (7.22), оценённая в точке $\tilde{\theta}_r$, а не $\hat{\theta}_u$.

Тест множителей Лагранжа, предложенный Аинчисоном и Сильви (1958) и Сильви (1959), эквивалентен скор-тесту, что показал Рао (1947). Статистика теста множителей Лагранжа обычно выводится путём получения аналитического выражения для скор-вектора, а не для множителей Лагранжа. Эконометристы обычно называют этот тест тестом множителей Лагранжа, хотя более правильно было бы называть его скор-тестом.

\begin{center}
Обсуждение
\end{center}

Хорошее объяснение обеспечивается разъяснительным графическим анализом трёх тестов, который предложил Бьюз (1982) и который рассматривает все три теста, измеряя изменение логарифма функции правдоподобия. Здесь мы приводим словесное описание.

Рассмотрим скалярный параметр и тест Вальда для проверки того, $\theta_0 - \theta^* = 0$ или нет. Тогда данное отклонение $\hat{\theta}_u$ от $\theta^*$ приведёт к тем большему изменению $\ln L$, чем более изогнутым является  логарифм функции правдоподобия. Обычной мерой кривизны функции является вторая производная $H(\theta) = \partial^2{\ln L}/\partial{\theta}^2$. Таким образом, $W = -(\hat{\theta}_u - \theta^*)^2H(\hat{\theta}_u)$. Статистику $W$ из (7.23) можно рассматривать как обобщение вектора $\theta$ и более общее ограничение $h(\theta_0)$, где $N\hat{A}$ используется для измерения кривизны.

Для скор-теста Бьюз показывает, что заданное значение $\partial{\ln L}/\partial{\theta}|_{\tilde{\theta}_r}$ приводит к тем большему изменению $\ln L$, чем менее изогнут логарифм функции правдоподобия. Это приводит к использованию $(N\tilde{A})^{-1}$ из (7.25). И статистика теста множителей Лагранжа напрямую сравнивает логарифмы функций правдоподобия.

\begin{center}
Пример
\end{center}

Чтобы проиллюстрировать три теста, рассмотрим пример, где $y_i$ независимы и одинаково распределены, $y_i \sim N[\mu_0, 1]$. Необходимо проверить гипотезу $H_0: \mu_0 = \mu^*$. Тогда $\hat{\mu}_0 = \bar{y}$ и $\tilde{\mu}_r = \mu^*$.

Для теста отношения правдоподобия $\ln L(\mu) = -\frac{N}{2}\ln 2\pi - \frac{1}{2}\sum_i (y_i - \mu)^2$. После некоторых алгебраических преобразований получается
\[
LR = 2[\ln L(\bar{y}) - \ln L(\mu^*)] = N(\bar{y} - \mu^*)^2.
\]

Тест Вальда основывается на том, $\bar{y} - \mu^* \simeq 0$ или нет. Не представляет сложности показать, что $\bar{y} - \mu^* \sim N[0, 1/N]$ при нулевой гипотезе, что приводит к квадратичной форме
\[
W = (\bar{y} - \mu^*)[1/N]^{-1}(\bar{y} - \mu^*).
\]
Это выражение можно упростить до $N(\bar{y} - \mu^*)^2$, и тогда получается, что $W = LR$.

Тест множителей Лагранжа основывается на близости к нулю $\partial{\ln L(\mu)}/\partial{\mu}|_{\mu^*} = \sum_i (y_i - \mu)|_{\mu^*} = N(\bar{y} - \mu^*)$, что является всего лишь масштабированием $(\bar{y} - \mu^*)$, поэтому $LM = W$. Более формально $\tilde{A}(\mu^*) = -1$, так как $\partial^2{\ln L(\mu)}/\partial{\mu^2} = -N$, и (7.25) даёт
\[
LM = N^{-1}(N(\bar{y} - \mu^*))[1]^{-1}(N(\bar{y} - \mu^*)).
\]
Это тоже можно упростить до $N(\bar{y} - \mu^*)^2$, что подтверждает, что $LM = W = LR$.

Несмотря на совершенно разные мотивации, три тестовые статистики эквивалентны в данном случае. Эта точная эквивалентность свойственна этому примеру с постоянной кривизной вследствие того, что логарифм функции правдоподобия является квадратичной функцией относительно $\mu$. В более общем случае три тестовые статистики отличаются для конечных выборок, но они асимптотически эквивалентны (см. раздел 7.3.4).

\subsection{Пример регрессии Пуассона}

Рассмотрим тесты на исключающие ограничения в регрессионной модели Пуассона, которая была определена в разделе 5.2. Этот пример в основном обучающий, так как на практике следует делать статистические выводы для  данных при более слабых предположениях о распределении, чем тех, которые есть в модели Пуассона (см. главу 20).

Если $y$ при заданном $x$ распределён по Пуассону с условным математическим ожиданием $\exp(x'\beta)$, то логарифм функции правдоподобия будет иметь следующий вид

\begin{equation}
\ln L(\beta) = \sum_{i=1}^N \{- \exp(x_i'\beta) + y_ix_i'\beta - \ln y_i!\}.
\end{equation}
Для $h$ исключающих ограничений нулевая гипотеза $H_0: h(\beta) = \beta_2 = 0$, где $\beta = (\beta_1',\beta_2')'$.

Оценка ММП для неограниченной модели $\hat{\beta}$ получается из максимизации (7.26) по $\beta$, а условие первого порядка вылядит так: $\sum_i (y_i - \exp(x_i'\beta))x_i = 0$. Предельной ковариационной матрицей является $-A^{-1}$, где
\[
A = - \plim N^{-1} \sum_i \exp(x_i'\beta)x_ix_i'.
\]  

Оценка ММП для ограниченной модели $\tilde{\beta} = (\tilde{\beta}_1', 0')'$, где $\tilde{\beta}$ получается при максимизации (7.26) по $\beta_1$, где $x_i'\beta$ заменено на $x_{1i}'\beta_1$, так как $\beta_2 = 0$. Таким образом, $\tilde{\beta}_1$ является решением условия первого порядка $\sum_i (y_i - \exp(x_{1i}'\beta_1))x_{1i} = 0$.

Статистику ММП (7.21) легко рассчитать с помощью подстановки оценок в логарифмы функций максимального правдоподобия для ограниченной и неограниченной моделей.

Тестовая статистика Вальда для исключающих ограничений из раздела 7.2.5 равна $W = -N\hat{\beta}_2'\hat{A}^{22}\hat{\beta}_2$, где $\hat{A}^{22}$ --- это элемент (2,2) из матрицы $\hat{A}^{-1}$, а $\hat{A} = -N^{-1}\sum_i \exp(x_i'\beta)x_ix_i'$.

Тест множителей Лагранжа основывается на $\partial{\ln L(\beta)}/\partial{\beta} = \sum_i x_i(y_i - \exp(x_i'\beta))$. В случае ММП для ограниченной модели это выражение можно переписать как $\sum_i x_i\tilde{u}_i$, где $\tilde{u}_i = y_i - \exp(x_{1i}'\tilde{\beta}_1)$ --- это остатки из ограниченной модели. Статистика теста множителей Лагранжа (7.25) выглядит так:
\begin{equation}
LM = \begin{bmatrix} \sum_{i=1}^n x_i\tilde{u}_i \end{bmatrix}'\begin{bmatrix} \sum_{i=1}^n \exp(x_{1i}'\tilde{\beta}_1)x_ix_i'\end{bmatrix}^{-1}\begin{bmatrix} \sum_{i=1}^n x_i\tilde{u}_i \end{bmatrix}.
\end{equation}

Предыдущее выражение можно упростить ещё больше, так как $\sum_{i=1}^n x_i\tilde{u}_i = 0$ из условия первого порядка в случае ММП для ограниченной модели, который был приведён выше. Здесь тест множителей Лагранжа основывается на корреляции между пропущенными регрессорами и остатками, этот результат распространяется и на другие примеры, которые приведены в разделе 7.3.5.

В общем случае может быть трудно получить алгебраическое выражение для теста множителей Лагранжа. Для стандартных применений теста это было сделано и включено в статистические пакеты. Также возможно применение вспомогательной регрессии для расчёта (см. раздел 3.5).

\subsection{Вывод тестов}

Распределение теста Вальда было формально выведено в разделе 7.2.4. Доказательства для теста отношения правдоподобия и теста множителей Лагранжа являются более сложными, и здесь мы всего лишь кратко опишем их.

\begin{center}
Тест отношения правдоподобия
\end{center}

Для простоты рассмотрим особый случай, где нулевая гипотеза заключается в том, $\theta = \bar{\theta}$ или нет, чтобы не было ошибки оценивания при $\tilde{\theta}_r = \bar{\theta}$. Разложение $\ln L(\bar{\theta})$ в ряд Тейлора до второго члена в окрестности точки $\ln L(\hat{\theta}_u)$ даёт
\[
\ln L(\bar{\theta}) = \ln L(\hat{\theta}_u) + \frac{\partial{\ln L}}{\partial{\theta}'}|_{\hat{\theta}_u}(\bar{\theta} - \hat{\theta}_u) + \frac{1}{2}(\bar{\theta} - \hat{\theta}_u)'\frac{\partial^2{\ln L}}{\partial{\theta}\partial{\theta}'}|_{\hat{\theta}_u}(\bar{\theta} - \hat{\theta}_u) + R,
\]
где $R$ --- это остаточный член. Так как $\partial{\ln L}/\partial{\theta}|_{\hat{\theta}_u} = 0$ из-за условия первого порядка, то после перегруппировки получается
\begin{equation}
-2[\ln L(\bar{\theta}) - \ln L(\hat{\theta}_u)] = - (\bar{\theta} - \hat{\theta}_u)'\frac{\partial^2{\ln L}}{\partial{\theta}\partial{\theta}'}|_{\hat{\theta}_u}(\bar{\theta} - \hat{\theta}_u) + R.
\end{equation}
Правая сторона (7.28) распределена по $\chi^2(h)$ при $H_0: \theta = \bar{\theta}$, так как с помощью стандратных результатов $\sqrt{N}(\hat{\theta}_u) \stackrel{d}{\rightarrow} N[0, -[\plim N^{-1}\partial^2{\ln L}/
\partial{\theta}\partial{\theta}']^{-1}]$. Для того чтобы ознакомиться с тем, как выводится предельное распределение для теста отношения правдоподобия в общем случае, смотрите, например, Амемия (1985, стр. 143).

Причина, из-за которой предпочитается тест отношения правдоподобия, заключается в том, что по лемме Неймана-Пирсона (1933) наиболее мощным тестом для проверки простой нулевой гипотезы против простой альтернативной гипотезы является функция отношения правдоподобия $L(\tilde{\theta}_r)/L(\hat{\theta}_u)$, хотя необязательно, чтобы эта функция совпадала с функцией $-2\ln(L(\tilde{\theta}_r)/L(\hat{\theta}_u))$, которая отражает тест отношения правдоподобия, приведённый в (7.21), и даёт тестовой статистике своё название.

\begin{center}
Тест множителей Лагранжа или скор-тест
\end{center}

С помощью разложения в ряд Тейлора до первого члена получим
\[
\frac{1}{\sqrt{N}} \frac{\partial{\ln L}}{\partial{\theta}}|_{\tilde{\theta}_r} = \frac{1}{\sqrt{N}} \frac{\partial{\ln L}}{\partial{\theta}}|_{\theta_0} + \frac{1}{N} \frac{\partial^2{\ln L}}{\partial{\theta}\partial{\theta}'}\sqrt{N}(\tilde{\theta}_r - \theta_0),
\]
и оба члена правой части выражения входят в предельное распределение. Тогда следует $\chi^2(h)$ распределение метода множителей Лагранжа, которое было определено в (7.25), так как можно показать, что
\begin{equation}
R_0A_0^{-1} \frac{1}{\sqrt{N}} \frac{\partial{\ln L}}{\partial{\theta}}|_{\tilde{\theta}_r} \stackrel{d}{\rightarrow} N[0, R_0A_0^{-1}B_0A_0^{-1}R_0'],
\end{equation}
для которого все детали рассматриваются, например, Вулдриджем (2002, стр. 365), а $A_0$ и $R_0$ заданы в (7.4) и (7.22) и
\begin{equation}
B_0 = \plim N^{-1}\frac{\partial{\ln L}}{\partial{\theta}}\frac{\partial{\ln L}}{\partial{\theta}'}|_{\theta_0}.
\end{equation}

Результат (7.29) приводит к хи-квадрат статистике, которая является гораздо более сложной, чем (7.25), но существует упрощение (7.25) с помощью равенства информационных матриц.

\subsection{Выбор теста}

Тест, как правило, выбирается на основании существования версий с поправками, результатов для конечных выборок и простоты вычислений.

\begin{center}
Асимптотическая эквивалентность
\end{center}

Все три тестовые статистики имеют асимптотическое $\chi^2(h)$ распределение при нулевой гипотезе. Более того, можно показать, что все три теста могут иметь нецентральное  $\chi_2(h,\lambda)$ распределение с одним и тем же параметром нецентральности при локальных альтернативах. Более подробная информация о тесте Вальда представлена в разделе 7.6.3. Таким образом, тесты имеют одинаковую асимптотическую мощность против локальных альтернатив.

Распределения трёх тестовых статистик отличаются для конечных выборок. В линейной регрессионной модели с нормальным распределением остатков вариант тестовой статистики Вальда для $h$ линейных ограничений на $\theta$ в точности равен статистике $F(h, N - K)$ (см. раздел 7.2.1), тогда как невозможно аналитически выразить статистику теста отношения правдоподобия и статистику теста множителей Лагранжа. В целом, в нелинейных моделях для малых выборок их невозможно выразить в явном виде.

В некоторых случаях можно упорядочить значения, применяемые тремя тестовыми статистиками. В частности, для тестов на линейные ограничения для линейной регрессионной модели с нормальным распределением остатков Берндт и Савин (1977) показали, что $W \geq LM \geq LR$. Этот результат имеет небольшие теоретические последствия, так как 
тест, при котором нулевая гипотеза будет отвергнута с наименьшей вероятностью, будет иметь наименьший истинный размер, но и в то же время у него будет наименьшая мощность. Однако это имеет подследствие для линейной модели, так как это означает, что при тестировании на фиксированном номинальном размере $\alpha$ тест Вальда всегда будет отвергать нулевую гипотезу чаще, чем тест отношения правдоподобия, который, в свою очередь, будет отвергать нулевую гипотезу чаще, чем тест множителей Лагранжа. Тест Вальда будет предпочтитаться исследователем, который хочет отвергнуть нулевую гипотезу. Тем не менее, этот результат является верным только для линейных моделей.

\begin{center}
Инвариантность к параметризации 
\end{center}

Тест Вальда не является инвариантным к алгебраически эквивалентным параметризациям нулевой гипотезы (см. раздел 7.2.9), тогда как тест отношения правдоподобия является инвариантным. Некоторые, но не все версии теста множителей Лагранжа, инвариантны. Тест множителей Лагранжа, как правило, является инвариантным, если для оценки $A_0$ используется математическое ожидание Гессиана (см. раздел 5.5.2), и является неинвариантным, если используется сам Гессиан. Тест множителей Лагранжа$^*$, который будет описан позже в (7.34), инвариантный. Отсутствие инвариантности теста Вальда является одним из его основных недостатков.

\begin{center}
Версии с поправками
\end{center}

В некоторых случаях с неверно специфицированной плотностью метод квази-максимального правдоподобия (см. раздел 5.7) остаётся состоятельным. Тогда легко сделать поправку для теста Вальда (см. раздел 7.2). Для теста множителей Лагранжа можно сделать поправку, но это будет более сложно, см. (7.38) в разделе 7.5.1 общий результат для $m$-оценок и в разделе 8.4 некоторые примеры теста множителей Лагранжа с поправкой. Тест отношения правдоподобия уже не будеть иметь хи-квадрат распределение, за исключением частного случая, который будет приведён в (7.39). Вместо этого, тест отношения правдоподобия представляет собой смесь хи-квадратов (см. раздел 8.5.3).

\begin{center}
Удобство
\end{center}

Удобство расчётов также стоит принимать во внимание. Тест отношения правдоподобия требует оценки модели дважды, с ограничениями нулевой гипотезы и без них. Если расчёт производится статистическим пакетом, это можно легко реализовать, так как пакет выдаст значения для логарифмов фунций правдоподобия, надо вычесть один из другого и умножить на два. Тест Вальда требует оценивания только при альтернативной гипотезе, и его лучше всего использовать, когда легко оценить неограниченную модель. Например, этому соответствует случай ограничений на параметры условного математического ожидания в нелинейных моделях, таких как НМНК, пробит, Тобит и логит. Статистика теста множителей Лагранжа требует оценивания только при нулевой гипотезе, и лучше всего её использовать, когда легче всего оценить ограниченную модель. Примерами могут послужить тесты на автокорреляцию и гетероскедастичность, где легче всего оценить модель, которая получается при нулевой гипотезе и которая не имеет этих усложнений.

Тест Вальда часто используется для тестов на значимость, в то время как тест множителей Лагранжа часто используется для теста на верную спецификацию модели.

\subsection{Интерпретация и расчёт теста множителей Лагранжа}

Тест множителей Лагранжа имеет дополнительные преимущества из-за простой интерпретации в ряде ведущих примеров и расчёта с помощью вспомогательной регрессии.

В этом разделе будет рассматриваться стандартный случай пространственных данных со скалярной независимой по $i$ переменной такой, что $\partial{\ln(\theta)}/\partial{\theta} = \sum_i s_i(\theta)$, где 
\begin{equation}
s_i(\theta) = \frac{\partial{\ln f(y_i|x_i,\theta)}}{\partial{\theta}}
\end{equation}
отражает вклад $i$-ого наблюдения в скор-вектор неограниченной модели. Из (7.25) тест множителей Лагранжа --- тест $\sum_i s_i(\tilde{\theta}_r)$ на близость к нулю.

\begin{center}
Простая интерпретация теста множителей Лагранжа
\end{center}

Предположим, что плотность такова, что $s(\theta)$ факторизуется как
\begin{equation}
s(\theta) = g(x, \theta)r(y, x, \theta)
\end{equation}
для некоторой векторной функции $g(\cdot)$ размера $q \times 1$ и скалярной функции $r(y, x, \theta)$, которую можно интерпретировать как обобщённый остаток, так как $y$ присутствует в $r(\cdot)$, но не в $g(\cdot)$. Например, для регрессии Пуассона $\partial{\ln f}/\partial{\theta} = x(y - \exp(x'\beta))$.

\begin{center}
Тесты на проверку гипотез
\end{center}

Учитывая (7.32) и независимость по $i$, $\partial{\ln L}/\partial{\theta}|_{\tilde{\theta}_r} = \sum_i \tilde{g}_i\tilde{r}_i$, где $\tilde{g}_i = g(x_i, \tilde{\theta}_r)$ и $\tilde{r}_i = r(y_i, x_i, \tilde{\theta}_r)$. Таким образом, тест множителей Лагранжа можно легко интерпретировать как скор-тест на корреляцию между $\tilde{g}_i$ и остатками $\tilde{r}_i$. Эта интерпретация была приведена в разделе 7.3.2 про тест множителей Лагранжа в случае регрессии Пуассона, где $\tilde{g}_i = x_i$ и $\tilde{r}_i = y_i - \exp(x_{1i}'\tilde{\beta}_1)$.

Выражение из (7.32) будет напоминать о себе всякий раз, когда $f(y)$ будет основан на однопараметрической плотности. В частности, многие распространённые модели правдоподобия основываются на плотностях из экспоненциалього семейства с единственным параметром $\mu$, который затем моделируется как функция от $x$ и $\beta$. В случае экспоненциального семейства  $r(y, x, \theta) = (y - \E[y|x]) $ (см. раздел 5.7.3), поэтому обобщённые остатки $r(\cdot)$ из (7.32) являются обычными остатками.

В более общем случае выражение, аналогичное (7.32), также возникает, когда $f(y)$ основан на двухпараметрической плотности, информационная матрица которой имеет блочно-диагональный вид для этих двух параметров, а эти два параметра зависят от регрессоров и векторов параметров $\beta$ и $\alpha$, которые отличаются друг от друга. Тогда тест множителей Лагранжа на $\beta$ --- тест на корреляцию между $\tilde{g}_{\beta_i}$ и $\tilde{r}_{\beta_i}$, где $s(\beta) = g_{\beta}(x, \theta)r_{\beta}(y, x, \theta)$ с той же самой интерпретацией теста множителей Лагранжа на уровне значимости $\alpha$.

Ярким примером является линейная регрессия с нормальным распределением остатков и с двумя параметрами $\mu$ и $\sigma^2$, которые представлены так: $\mu = x'\beta$ и $\sigma^2 = \alpha$ или $\sigma^2 = \sigma^2(z, \alpha)$. Для исключающих ограничений в линейной регрессии при условии распределённых по нормальному закону остатков $s_i(\beta) = x_i(y_i - x_i'\beta)$ и тест множителей Лагранжа --- тест на корреляцию между регрессорами $x_i$, а $\tilde{u}_i = y_i - x_{1i}'\tilde{\beta}_1$ --- остатки из ограниченной модели. Для тестов на гетероскедастичность с $\sigma^2_i = \exp(\alpha_1 + z_i'\alpha_2)$, $s_i(\alpha) = \frac{1}{2}z_i(((y_i - x_i'\beta)^2/\sigma^2_i) - 1)$. Тест множителей Лагранжа --- это тест на корреляцию между $z_i$, и квадраты остатков $\tilde{u}^2_i = (y_i - x_i'\tilde{\beta})^2$, так как $\sigma^2_i$ постоянна при нулевой гипотезе о том, что $\alpha_2 = 0$.

\begin{center}
Вариант теста множителей Лагранжа с внешним произведением градиента
\end{center}

Теперь вернёмся к общему случаю $s_i(\theta)$, который был определён в (7.31). Как будет показано далее, асимптотически эквивалентную версию статистики теста множителей Лагранжа (7.25) можно получить с помощью вспомогательной или искусственной регрессии
\begin{equation}
1 = \tilde{s}_i'\gamma + v_i,
\end{equation}
где $\tilde{s}_i = s_i(\tilde{\theta}_r)$. Теперь получается
\begin{equation}
LM^* = NR_u^2,
\end{equation}
где $R_u^2$ --- это нецентрированный $R^2$, который был определён в (7.36). $LM^*$ имеет асимптотическое $\chi^2(h)$ распределение при нулевой гипотезе. Это равносильно тому, $LM^*$ равна $ESS_u$, нецентрированная объясняемая сумма квадратов (сумма квадратов оценённых значений), или равна $N - RSS$, где $RSS$ --- сумма квадратов остатков из регрессии (7.33).

Этот результат можно распространить и на другие случаи, так как во многих приложениях может быть довольно легко аналитически получить $s_i(\theta)$, сгенерировать данные для $q$ компонент $\tilde{s}_{1i}, \dots,\tilde{s}_{qi}$ и регрессировать 1 на $\tilde{s}_{1i}, \dots,\tilde{s}_{qi}$. Заметьте, что здесь $f(y_i| x_i, \theta)$ из (7.31) --- это плотность неограниченной модели.

Для исключающих ограничений в модели Пуассона был приведён пример в разделе 7.3.2, $s_i(\beta) = (y_i - \exp(x_i'\beta))x_i$ и $x_i'\tilde{\beta}_r = x_{1i}'\tilde{\beta}_{1r}$. Отсюда следует, что можно посчитать $LM^*$ как $NR_u^2$, регрессируя 1 на $(y_i - \exp(x_{1i}'\tilde{\beta}_{1r}))x_i$, где $x_i$ содержит $x_{1i}$ и $x_{2i}$, а $\tilde{\beta}_{1r}$ получается из регрессии Пуассона, когда $y_i$ регрессируют только на $x_{1i}$.

Уравнения (7.33) и (7.34) требуют только независимость по $i$. Можно проводить другие вспомогательные регрессии только при введении предположений о дальнейшей структуре. В частности, можно рассмотреть случаи, когда $s(\theta)$ факторизуется, как в (7.32), и задать $r(y, x, \theta)$ так, чтобы $\V[r(y, x, \theta)] = 1$. Тогда альтернативной асимптотически эквивалентной версией теста множителей Лагранжа будет $NR_u^2$ из регрессии $\tilde{r}_i$ на $\tilde{g}_i$. Это включает в себя тесты множителей Лагранжа для линейной регрессии с нормальным распределением остатков, например, тест множителей Лагранжа Бройша-Пагана на гетероскедастичность.

Эти альтернативные версии теста множителей Лагранжа называются тестами множителей Лагранжа с внешним произведением градиента, так как в них $-A_0$ из (7.22) заменяют на оценки, полученные с помощью внешнего произведения градиента, или на BHHH оценки $B_0$. Хотя они легко вычисляются, варианты тестов множителей Лагранжа с внешним произведением градиента могут иметь плохие свойства для малых выборок с большим числом искажений. По этой причине многие отказываются от этого варианта теста множителей Лагранжа. Проблемы такого рода могут быть значительно уменьшены с помощью метода бутстреп (см. раздел 11.6.3). Дэвидсон и МакКиннон (1984) предлагают вспомогательные регрессии двойной длины, которые также показывают лучшие результаты на конечных выборках.

\subsection{Вывод варианта с внешним произведением градиента}

Чтобы вывести $LM^*$, сначала заметим, что в (7.25), $\partial{\ln L(\theta)/\partial{\theta}}|_{\tilde{\theta}_r} = \sum \tilde{s}_i$. Во-вторых, с помощью равенства информационных матриц $A_0 = - B_0$ можно получить состоятельную оценку $B_0$ из раздела 5.5.2 при нулевой гипотезе с помощью оценки с внешним произведением градиента или BHHH оценки $N^{-1}\sum \tilde{s}_i\tilde{s}_i'$. Объединение этих результатов даёт асимптотически эквивалентную версию статистики теста множителей Лагранжа (7.25):
\begin{equation}
LM^* = \begin{pmatrix} \sum_{i=1}^n \tilde{s}_i' \end{pmatrix} \begin{bmatrix} \sum_{i=1}^n \tilde{s}_i' \end{bmatrix}^{-1} \begin{pmatrix} \sum_{i=1}^n \tilde{s}_i \end{pmatrix}.
\end{equation}

Это тестовая статистика может быть рассчитана из вспомогательной регрессии 1 на $\tilde{s}_i$. Определим $S$ как матрицу размера $N \times q$ с $i$-ым рядом $\tilde{s}_i'$ и определим $I$ как вектор из единиц размера $N \times 1$. Тогда
\begin{equation}
LM^* = I'S[S'S]^{-1}S'I = ESS_u = NR_u^2
\end{equation}
В целом для регрессии $y$ на $X$ нецентрированная объяснённая сумма квадратов $(ESS_u)$ имеет вид: $y'X(X'X)^{-1}X'y$, что в точности имеет вид (7.36), в то время как нецентрированный $R^2$ является $R_u^2 = y'X(X'X)^{-1}X'y/y'y$, который здесь (7.36) делится на $I'I = N$. Термин <<нецентрированный>> используется, потому что в $R_u^2$ имеет место деление на сумму квадратов отклонений $y$ в окрестности нуля, а не вокруг выборочного среднего.

\section{Пример тестов, основанных на методе максимального правдоподобия}

Различные тестовые процедуры --- тест Вальда, тест отношения правдоподобия, тест множителей Лагранжа --- проиллюстрированы, используя сгенерированные данные. Использовался процесс порождающий данные $y|x$, распределённые по Пуассону с математическим ожиданием $\exp(\beta_1 + \beta_2 x_2 + \beta_3 x_3 + \beta_4 x_4)$, где $\beta_1 = 0$  и $\beta_2 = \beta_3 = \beta_4 = 0.1$ и три регрессора независимы и одинаково распределены по нормальному закону $N[0,1]$.

\begin{table}[h]
\begin{center}
\caption{\label{tab:pred}Тестовые статистики для примера регрессии Пуассона}
\begin{minipage}{16.5cm}
\begin{tabular}[t]{l*{7}{{c}}}
\hline
\hline
  & \multicolumn{4}{c}{\bf{Тестовая статистика}} &  &  \bf{Результат} \\
\bf{Нулевая гипотеза}\footnote{Процесс порождающий данные для $y$ --- распределение Пуассона с параметром $\exp(0.0 + 0.1x_2 + 0.1x_3 + 0.1x_4)$ и размером выборки $N = 200$. Тестовые статистики приведены с соответствующими $p$-значениями в скобках. Тесты на проверку второй гипотезы имеют распределение $\chi^2(2)$, а другие тесты распределены по $\chi^2(1)$. Логарифмы функций правдоподобия для ограниченной модели также приведены; логарифм функции правдоподобия для неограниченной модели равен $-238,772$.} & \bf{Wald} & \bf{LR} & \bf{LM} & \bf{LM*} & \bf{$\ln L$} & \bf{на 5\% (ур. зн.)} \\
\hline
$H_{10}: \beta_3 = 0$ & 5.904 & 5.754 & 5.916 & 6.218 & -241.648 & Отвергнуть \\
 & (0.015) & (0.016) & (0.016) & (0.013) &  &  \\
$H_{20}: \beta_3 = 0, \beta_4 = 0$ & 8.570 & 8.302 & 8.575 & 9.186 & -242.922 & Отвергнуть \\
 & (0.014) & (0.016) & (0.014) & (0.010) &  &  \\
$H_{30}: \beta_3 - \beta_4 = 0$ & 0.293 & 0.293 & 0.293 & 0.315 & -238.918 & Не отвергать \\
 & (0.588) & (0.589) & (0.588) & (0.575) &  &  \\
$H_{30}: \beta_3 / \beta_4 - 1 = 0$ & 0.158 & 0.293 & 0.293 & 0.315 & -238.918 & Не отвергать \\
 & (0.691) & (0.589) & (0.588) & (0.575) &  &  \\
\hline
\hline
\end{tabular}
\end{minipage}
\end{center}
\end{table}

Регрессия Пуассона, когда $y$ регрессируется на константу, $x_2, x_3, x_4$ для сгенерированной выборки размером в 200 наблюдений в случае метода максимального правдоподобия для неогранченной модели даёт
\[
\hat{\E}[y|x] = \exp(-\underset{(-2.14)}{0.165} - \underset{(-0.36)}{0.028}x_2 + \underset{(2.43)}{0.163}x_3 + \underset{(0.08)}{0.103}x_4),
\]
где в скобках внизу указаны значения $t$-статистик, а значение логаримфма функции правдоподобия для неограниченной модели равно $-238.772$.

Сравнение тестов четырёх различных гипотез описано в первой колонке таблицы 7.1. Оценка является нелинейной, тогда как гипотезы являются примерами одного исключающего ограничения, нескольких исключающих ограничений, линейных ограничений и нелинейных ограничений соответственно. В оставшейся части таблицы приведены четыре асимптотически эквивалентные тестовые статистики для этих гипотез и соответствующие им $p$-значения. Для данной выборки все тесты отвергают первые две гипотезы и не отвергают две оставшиеся на уровне значимости 0.05.

Статистика теста Вальда вычисляется с использованием (7.23). Для этого оценивается неограниченная модель, учитывая ранее, что необходимо получить оценку ковариационной матрицы для неограниченной модели с помощью метода максимального правдоподобия. Тесты Вальда на проверку различных гипотез затем требуют расчёта различных $h$ и $R$ и упрощения в некоторых случаях. Хи-квадрат тест Вальда на одно исключающее ограничение --- это просто квадрат обычного $t$-теста, с $2.43^2 \simeq 5.90$. Статистика теста Вальда на совместные исключающие ограничения подробно описана в разделе 7.2.5. Здесь $x_3$ является статистически значимым и $x_4$ является статистически незначимым, в то время как совместно $x_3$ и $x_4$ статистически значимы на уровне значимости 0.05. Тест Вальда для третьей гипотезы приведён в (7.19) и приводит к тому, что гипотеза не отвергается. Третья и четвёртая гипотезы эквивалентны, поскольку из $\beta_3/\beta_4 - 1 = 0$ следует, что $\beta_3 = \beta_4$, но тестовая статистика Вальда для четвёртой гипотезы, которая приведена в (7.13), отличается от (7.19). Тестовая статистика (7.13) была рассчитана с использованием матричных операций, так как большинство статистических пакетов в лучшем случае рассчитает тест Вальда для линейных гипотез.

Статистику теста отношения правдоподобия особенно легко вычислить, используя (7.21), учитывая оценивание ограниченной модели. Для трёх первых гипотез ограниченная модель оценена с помощью регрессии Пуассона, когда $y$ регрессируется на регрессоры $(1, x_2, x_4)$, $(1, x_2)$ и $(1, x_2, x_3 + x_4)$ соответственно, где в третьей регрессии используется $\beta_3 x_3 + \beta_4 x_4$, если $\beta_3 = \beta_4$. В качестве примера теста отношения правдоподобия для второй гипотезы $LR = - 2 [-238.772 - (-242.922)] = 8.30$. Четвёртая ограниченная модель в теории требует оценивания методом максимального правдоподобия при нелинейном ограничении на параметры. Довольно немного статистических пакетов могут это реализовать. Тем не менее, ограниченное оценивание методом максимального правдоподобия инвариантно к тому, как выражаются ограничения, так что здесь получаются те же самые оценки, что и для третьей ограниченной модели, которая приводит к той же самой статистике теста отношения правдоподобия.

Статистика теста множителей Лагранжа вычисляется с помощью (7.25), которая преобразуется для модели Пуассона в (7.27). Эта статистика вычисляется с использованием матричных операций с различными ограничениями, которые ведут к различным  оценкам $\tilde{\beta}$, полученным с помощью метода максимального правдоподобия для ограниченной модели. Что касается теста множителей Лагранжа, то он инвариантен к преобразованиям, поэтому этот тест для третьей и четвёртной гипотезы эквивалентен.

Асимптотически эквивалентной версией статистики теста множителей Лагранжа является модифицированная статистика теста множителей Лагранжа, которая приведена в (7.35). Она может быть вычислена как объясняемая сумма квадратов из вспомогательной регрессии (7.33). Для модели Пуассона $s_{ji} = \partial{\ln f(y_i)}/\partial{\beta}_j = (y_i - \exp(x_i'\beta))x_{ji}$ при оценивании с помощью метода максимального правдоподобия для ограниченной модели, которая зависит от рассматриваемых гипотез. Модифицированная статистика теста множителей Лагранжа вычисляется проще, чем стандартная статистика теста множителей Лагранжа, хотя они обе требуют оценок, полученных методом максимального правдоподобия для ограниченной модели.

В этом примере с сгенерированными данными значения различных тестовых статистик очень похожи. Это не всегда так. В частности, модифицированная статистика теста множителей Лагранжа может иметь более плохие результаты на конечной выборке, чем стандартный тест множителей Лагранжа, даже если процесс порождающий данные известен. Кроме того, в приложениях к реальными данными процесс порождающий данные вряд ли будет хорошо специфицирован, что приводит к расходимости различных тестовых статистик даже для бесконечно больших выборок.

\section{Тесты без использования метода максимального правдоподобия}

Тест Вальда является стандартным тестом, который не использует метод максимального правдоподобия. Из раздела 7.2 следует, что это стандартная тестовая процедура, которая всегда может быть реализована с использованием соответствующей сэндвич оценки ковариационной матрицы оценок параметров. Единственным ограничением является то, что в некоторых случаях оценки для неограниченной модели может быть гораздо сложнее получить, чем оценки для ограниченной модели.

Тест множителей Лагранжа или скор-тест, основанный на отклонении от нуля вектора-градиента из неограниченной модели, оценённой с помощью оценок ограниченной модели, также может быть обобщён на оценки, которые получены не методом максимального правдоподобия. Однако вид теста множителей Лагранжа, как правило, в этом случае значительно сложнее, чем в случае метода максимального правдоподобия. Кроме того, простейшие формы статистики теста множителей Лагранжа, основанные на вспомогательных регрессиях, как правило, не устойчивы к неверной спецификации распределения.

Тест отношения правдоподобия основан на разности между максимальными значениями целевой функции с и без ограничений. Это обычно не обобщается на все целевые функции, кроме функции правдоподобия, так как эта разность, как правило, не имеет хи-квадрат распределение.

Для полноты картины мы приводим расширение тестов множителей Лагранжа для $m$-оценок и для эффективных оценок, полученных методом моментов. Как уже отмечалось, в большинстве случаев достаточно использовать более простой тест Вальда.

\subsection{Тесты, основанные на $m$-оценках}

Тесты для $m$-оценок являются расширенными вариантами тестов для оценок, полученных методом максимального правдоподобия. Однако для них уже невозможно использовать равенство информационных матриц для упрощения тестовой статистики, а также тест отношения правдоподобия может быть обобщён только в особых случаях. Результирующая тестовая статистика имеет асимптотическое $\chi^2(h)$ распределение при $H_0: h(\theta) = 0$, и она имеет то же нецентральное хи-квадрат распределение при локальных альтернативах.

Рассмотрим $m$-оценки, которые получаются из максимизации $Q_N(\theta) = N^{-1}\sum_i q_i(\theta)$ из условия первого порядка $N^{-1}\sum_i s_i(\theta) = 0$. Пусть матрица $A(\theta) = N^{-1}\sum_i \partial{s_i(\theta)}/\partial{\theta}'$ и $B(\theta) = N^{-1}\sum_i s_i(\theta)s_i(\theta)'$ --- матрицы размера $q \times q$, а $R(\theta) = \partial{\ln h(\theta)}/\partial{\theta}'$ --- матрица размера $h \times q$. Пусть $\hat{\theta}_u$ и $\tilde{\theta}_r$ --- это оценки для ограниченной и неограниченной моделей соответственно, и заданы $\hat{A} = A(\hat{\theta}_u)$ и $\tilde{A}= A(\tilde{\theta}_r)$ для $B$ и $R$ соответственно. Также пусть $\hat{h} = h(\hat{\theta}_u)$ и $\tilde{s}_i = s_i(\tilde{\theta}_r)$.

Тестовая статистика Вальда основана на близости $\hat{h}$ к нулю. Здесь
\begin{equation}
W = \hat{h}'[\hat{R}N^{-1}\hat{A}^{-1}\hat{B}\hat{A}^{-1}\hat{R}']^{-1}\hat{h},
\end{equation}
так как из раздела 5.5.1 оценка ковариационной матрицы с поправкой $\hat{\theta}_u$ равна $N^{-1}\hat{A}^{-1}\hat{B}\hat{A}^{-1}$.

Статистические пакеты со встроенной опцией скорректированных стандартных ошибок используют более общий вид для расчёта тестов Вальда на статистическую значимость.

Пусть $g(\theta) = \partial{\ln Q_N(\theta)}/\partial{\theta}$ обозначает вектор-градиент и $\tilde{g} = g(\tilde{\theta}_r) = \sum_i \tilde{s}_i$. Статистика теста множителей Лагранжа основана на близости $\tilde{g}$ к нулю и имеет вид
\begin{equation}
LM = N\tilde{g}'\begin{bmatrix} \tilde{A}^{-1} \tilde{R}'\begin{pmatrix}\tilde{R} \tilde{A}^{-1} \hat{B}\tilde{A'}^{-1}\tilde{R}'\end{pmatrix}^{-1}\tilde{R}\tilde{A}^{-1}\end{bmatrix}^{-1}\tilde{g}.
\end{equation}

Этот результат получен с помощью хи-квадрат тестовой статистики, основанной на (7.29), где $N\tilde{g}$ заменяет $|\partial{\ln L}/\partial{\theta}|_{\tilde{\theta}_r}$. Этот тест не так просто реализовать в качестве теста Вальда с поправкой. Некоторые примеры вычисления тестов метода Лагранжа с поправкой приведены в разделе 8.4.
Стандартные тесты множителей Лагранжа в статистических пакетах часто не являются версиями теста множителей Лагранжа с поправкой.

Тест отношения правдоподобия нелегко обобщить. Его можно обобщать дл $m$-оценок, если $B_0 = -\alpha A_0$  для некоторого скалярного $\alpha$, это более слабая версия равенства информационных матриц. В таких особых случаях статистика теста отношения квази-правдоподобия равна
\begin{equation}
QLR = -2N[Q_N(\tilde{\theta}_r) - Q_N(\hat{\theta}_u) ]/\hat{\alpha}_u,
\end{equation}
где $\hat{\alpha}_u$ является состоятельной оценкой, полученной из оценивания неограниченной модели (см. Вулдридж, 2002, с. 370). Условие $B_0 = -\alpha A_0$ справедливо для обобщённых линейных моделей (см. раздел 5.7.4). Тогда статистика теста отношения квази-правдоподобия эквивалентна разнице вариаций для ограниченной и неограниченной моделей, обобщённому $F$-тесту, который основан на разности между суммами квадратов остатков ограниченной и неограниченной моделей для МНК и НМНК оценок с гетероскедастичными ошибками. Для общего случая оценивания с помощью метода максимального правдоподобия, где $B_0 \not= - \alpha A_0$, статистика теста отношения правдоподобия может быть распределена как взвешенная сумма хи-квадратов (см. раздел 8.5.3).

\subsection{Тесты, основанные на эффективных оценках обобщенного метода моментов}

Простейшим вариантом различных тестовых статистик общённого метода моментов является применение эффективных оценок, полученных обобщённым методом моментов, что означает оценивание с помощью оптимальных взвешенных матриц. Это не накладывает больших практических ограничений, так как оптимальная взвешенная матрица всегда может быть оценена, как показано в разделе 6.3.5.

Рассмотрим оценивание с помощью обобщённого метода моментов, основанного на условии, что $\E(m_i) = \theta$. (Обратите внимание на другое обозначение по сравнению с главой 6: $H(\theta)$ используется в текущей главе для
обозначения ограничений, накладываемых нулевой гипотезой).

Используя обозначения, введённые в разделе 6.3.5, эффективная оценка, полученная обобщённым методом моментов в случае неограниченной модели, $\hat{\theta}_u$ получается из минимизации $Q_N(\theta) = g_N(\theta)'S_N^{-1}g_N(\theta)$, где $g_N(\theta) = N^{-1}\sum_i m_i(\theta)$ и $S_N$ состоятельна для $S_0 = \V[g_N(\theta)]$. Предполагается, что оценка, полученная обобщённым методом моментов в случае ограниченной модели, $\tilde{\theta}_r$ является минимумом $Q_N(\theta)$ с той же взвешенной матрицей $S_N^{-1}$ при ограничении $h(\theta) = 0$.

Три следующие ниже тестовые статистики, описанные Ньюи и Вестом (1987а), имеют асимптотическое $\chi_2(h)$ распределение при $H_0: h(\theta) = 0$ и имеют то же нецентральное хи-квадрат распределение при локальных альтернативах.

Статистика теста Вальда, как и в стандартном случае, основана на близости $\hat{h}$ к нулю, что даёт
\begin{equation}
W = \hat{h}'\begin{bmatrix} \hat{R}N^{-1}\begin{pmatrix} \hat{G}'S^{-1}\hat{G} \end{pmatrix}^{-1} \hat{R}'\end{bmatrix}^{-1}\hat{h},
\end{equation}
так как вариация эффективной оценки, полученной с помощью обобщённого метода моментов, равна $N^{-1}(\hat{G}'S^{-1}\hat{G})^{-1}$ из раздела 6.3.5, где $G_N(\theta) = \partial{g_N(\theta)}/\partial{\theta}'$ и крышка означает оценивание в точке $\hat{\theta}_u$.

Условие первого порядка для этой оценки равно $\hat{G}'S^{-1}\hat{g} = 0$. Статистика тестов множителей Лагранжа, проверяющая близок ли вектор-градиент к нулю, оценивается в точке $\tilde{\theta}_r$, что даёт
\begin{equation}
LM = N\tilde{g}'S^{-1}\tilde{G}(\tilde{G}'S^{-1}\tilde{G})^{-1}\tilde{G}'S^{-1}\tilde{g},
\end{equation}
где тильда обозначает оценивание в точке $\tilde{\theta}_r$ и мы используем предположение из раздела 6.3.3 о том, что $\sqrt{N}g_N(\theta_0) \stackrel{d}{\rightarrow} N[0, S_0]$, откуда $\sqrt{N G'S^{-1}g} \stackrel{d}{\rightarrow} N[0, \plim N^{-1}G'S^{-1}G]$.

Для эффективной оценки, полученной с помощью обобщённого метода моментов, можно найти разность значений целевой функции в точках, соответствующих максимуму функции для ограниченной и неограниченной моделей, что даст формулу тестовой статистики
\begin{equation}
D = N[Q_N(\tilde{\theta}_r) - Q_N(\hat{\theta}_u)].
\end{equation}

Так же, как и статистика теста Вальда и статистика теста множителей Лагранжа, статистика $D$ тоже имеет асимптотическое $\chi^2(h)$ распределение при $H_0: h(\theta) = 0$.

Даже в случае применения метода максимального правдоподобия последняя статистика отличается от статистики отношения правдоподобия, так как она использует другую целевую функцию. В методе максимального правдоподобия минимизируется $Q_N(\theta) = - N^{-1}\sum_i \ln f(y_i|\theta)$. Из раздела 6.3.7 в случае асимптотически эквивалентной эффективной оценки, полученной с помощью обобщённого метода моментов, вместо этой функции минимизируется квадратичная форма  $Q_N(\theta) = N^{-1}(\sum_i s_i(\theta))'(\sum_i s_i(\theta))$, где $s_i(\theta) = \partial{\ln f(y_i|\theta)}/\partial{\theta}$. Статистику $D$ можно обобщить при условии, что оценка, полученная с помощью обобщённого метода моментов, является эффективной, тогда как тест отношения правдоподобия может быть только обобщён для некоторых частных случаев $m$-оценок, о которых рассказано после (7.39).

Для оценок, полученных с помощью метода моментов, в модели, которая была описана выше, выполняется равенство $D = LM = NQ_N(\tilde{\theta}_r)$, поэтому тест множителей Лагранжа и тесты разности эквивалентны. Для $D$ можно применить это упрощение, так как $g_N(\hat{\theta}_u) = 0$ и $Q_N(\hat{\theta}_u) = 0$. То, как можно упростить выражение для теста множителей Лагранжа, приведено в (7.41), так как матрица $\tilde{G}_N$ обратима.

\section{Мощность и размер тестов}

В остальных разделах этой главы исследуются два ограничения использования статистических пакетов для проверки гипотез.

Во-первых, тест может иметь низкую способность отличать нулевую гипотезу от альтернативной гипотезы. В этом случае тест имеет низкую мощность, то есть существует низкая вероятность отвергнуть нулевую гипотезу, когда она неверна. Стандартный результат, который выдаёт компьютер, не рассчитывает мощность теста, но её можно оценить с помощью асимптотических методов (см. данный раздел) или с помощью метода Монте-Карло для конечных выборок (см. раздел 7.7). Если главный вклад эмпирической работы заключается в том, отвергается ли конкретная гипотеза или нет, то нет никаких оснований для того, чтобы не привести дополнительно мощность теста против некоторых важных альтернативных гипотез.

Во-вторых, истинный размер теста может существенно отличаться от номинального размера теста, который получен из асимптотической теории. Правило большого пальца состоит в том, что размер выборки $N > 30$ является достаточным для того, чтобы асимптотическая теория обеспечила хорошую апроксимацию для вывода для одной переменной, но это правило не распространяется на модели с регрессорами. 

Плохая апроксимация, скорее всего, может быть в хвостах распределения, но хвосты используются для получения критических значений тестов на стандартных уровнях значимости таких, как 5\%. На практике критическое значение тестовой статистики, полученное с помощью апроксимации на большой выборке, часто меньше, чем истинное критическое значение, основанное на неизвестном истинном распределении. Уточнения для малых выборок --- это попытки приблизиться к истинному критическому значению. Для линейной регрессии с нормальным распределением остатков точные критические значения могут быть получены с использованием $t$ вместо $z$ и $F$ вместо $\chi^2$ распределени, но аналогичные результаты могут быть неточными для нелинейной регрессии. Вместо этого уточнения для малых выборок могут быть получены с помощью метода Монте-Карло (см. раздел 7.7) или с помощью метода бутстреп (см. раздел 7.8 и главу 11).

С современными компьютерами относительно легко исправить размер и исследовать мощность тестов, используемых в прикладных исследованиях. Мы представляем эту тему, которой обычно пренебрегают, более подробно.

\subsection{Размер теста и мощность}

Проверка гипотез приводит либо к тому, что нулевая гипотеза отвергается, либо нет. Правильное решение принимается, если нулевая гипотеза отвергается, когда она неверна, или если она не отвергается, когда она верна. 

Есть также два возможных неправильных решения: (1) если нулевая гипотеза отвергается, когда она верна, то это ошибка первого рода, и (2) если она не отвергается, когда она неверна, то это ошибка второго рода. В идеальном случае вероятности обоих ошибок будут низкими, но на практике уменьшение вероятности ошибки одного рода происходит за счёт увеличения вероятности ошибки другого рода. Классическое решение для тестирования гипотезы --- закрепить вероятность ошибки первого рода на определённом уровне, как правило, 0.05, оставив при этом вероятность ошибки второго рода неуказанной.

Размер теста или уровень значимости определяется так:
\begin{equation}
\alpha = \Pr[\text{ошибка I рода}] = \Pr[ \text{отвергнуть } H_0 | H_0 \text{ верна} ],
\end{equation}
со стандартными вариантами $\alpha$ 0.01, 0.05 или 0.10. Гипотеза отвергается, если значение тестовой статистики попадает в область альтернативной гипотезы, определённую так, чтобы уровень значимости теста равнялся указанному значению $\alpha$. Близкий к этому эквивалентный метод вычисляет $p$-значение теста, предельный уровень значимости, при котором нулевая гипотеза отвергается, и отвергает нулевую гипотезу, если $p$-значение меньше указанного значения $\alpha$. Оба способа требуют только знание распределения тестовой статистики при нулевой гипотезе, которое представлено в разделе 7.2 для статистики теста Вальда.

Также стоит рассмотреть вероятность ошибки второго рода. Мощность теста определяется как
\begin{multline}
\text{Мощность} = \Pr[\text{отвергнуть } H_0|H_a \text{ верна}] = \\
= 1 - \Pr[\text{принять } H_0|H_a \text{ верна}] = 1 - \Pr[\text{ошибка II рода}].
\end{multline}

В идеальном случае мощность теста близка к единице, поскольку тогда вероятность ошибки второго рода близка к нулю. Определение мощности требует знания распределения тестовой статистики при альтернативной гипотезе.

Анализ мощности теста, как правило, не проводится в эмпирических работах. Кроме того, тестовые процедуры, как правило, выбираются таким образом, чтобы заранее из теории было известно, что мощность, которой они обладают, при заданном уровне $\alpha$ является высокой по сравнению с другими альтернативными тестовыми статистиками. В идеальном случае используется равномерно наиболее мощный критерий. Это тест, который имеет наибольшую мощность при заданном уровне $\alpha$ для всех альтернативных гипотез. Равномерно наиболее мощные критерии существуют при проверке простой нулевой гипотезы против простой альтернативной гипотезы. Более того, лемма Неймана-Пирсона даёт результат, что равномерно наиболее мощный критерий является функцией теста отношения правдоподобия. Для более общих ситуаций проверки гипотез, связанных с тестированием сложных гипотез обычно не существует равномерно наиболее мощного критерия. Также накладываются дальнейшие ограничения такие, как равномерно наиболее мощные односторонние тесты. На практике право размышлять о мощности предоставляют эконометристам-теоретикам, которые используют теорию и моделирование к различным процедурам проверки гипотез, чтобы выяснить, какие тесты являются самыми мощными.

Тем не менее, можно определить мощность теста в любом заданном случае. В дальнейшем мы подробно рассмотрим, как вычислить асимптотическую мощность теста Вальда, которая равна мощности теста отношения правдоподобия и теста множителей Лагранжа в полностью параметрическом случае.

\subsection{Локальные альтернативные гипотезы}

Поскольку мощность --- это вероятность отвергнуть нулевую гипотеза, когда альтернативная гипотеза верна, вычисление мощности требует получения распределения тестовой статистики при альтернативной гипотезе. Для хи-квадрат теста Вальда на уровне значимости $\alpha$ мощность равна $\Pr[W > \chi_{\alpha}^2(h)|H_a]$. Расчёт этой вероятности требует уточнения конкретной альтернативной гипотезы, потому что вариант $H_a: h(\theta) \not= 0$ слишком широкий.

Очевидным выбором является фиксированная альтернатива $h(\theta) = \delta$, где $\delta$ --- конечный вектор, состоящий из  ненулевых констант и имеющий размер $q \times 1$. Величину $\delta$ иногда называют ошибкой гипотезы, и большие ошибки гипотезы приводят к большей мощности. Для фиксированной альтернативы статистика теста Вальда асимптотически имеет мощность, равную единице, так как она всегда отвергает нулевую гипотезу. Чтобы убедиться в этом, заметим, что если $h(\theta) = \delta$, то статистика Вальда становится стремится к бесконечности, так как 
\begin{equation}
W = \hat{h}(\hat{R}N^{-1}\hat{C}\hat{R}')^{-1}\hat{h} \stackrel{p}{\rightarrow} \delta'(R_0N^{-1}C_0R_0')^{-1}\delta,
\end{equation}
используя $\hat{\theta} \stackrel{p}{\rightarrow} \theta_0$, так, $\hat{h} = h(\hat{\theta}_u) \stackrel{p}{\rightarrow} h(\theta) = \delta$ и $\hat{C} \stackrel{p}{\rightarrow} C_0$. Отсюда следует, что $W \stackrel{p}{\rightarrow} \infty$, так как все члены, кроме $N$ конечные и отличные от нуля. Это бесконечное значение приводит к тому, что нулевая гипотеза всегда отвергается, как и должно быть. Следовательно, тест имеет абсолютную мощность, равную единице.

Статистика теста Вальда --- это состоятельная тестовая статистика, её мощность стремится к единице при $N \rightarrow \infty$. Как и многие оценки являются состоятельными, так и многие тестовые статистики могут быть состоятельными. Необходимы более строгие критерии для выбора между тестовыми статистиками, в то время как для выбора между оценками используется относительная эффективность.

Для оценок, которые являются $\sqrt{N}$ состоятельными, рассмотрим последовательность локальных альтернатив
\begin{equation}
H_a: h(\theta) = \delta/\sqrt{N},
\end{equation}
где $\delta$ --- вектор, состоящий из конечных констант с $\delta \not= 0$. Эта последовательность альтернативных гипотез, называемая дрейфом Питмана, становится тем ближе к значению нулевой гипотезы, равному нулю, чем больше размер выборки. Причём данное стремление происходит с той же самой скоростью $\sqrt{N}$, который применяется для нормирования оценки $\hat{\theta}$, необходимого для получения невырожденного распределения состоятельной оценки. Следовательно, значение $h(\theta)$ для альтернативной гипотезы стремится к нулю со скоростью, не допускающей  повышения эффективности с увеличением размера выборки. Более подробно о локальных альтернативах написано в книге МакМануса (1991).

\subsection{Асимптотическая мощность теста Вальда}

При последовательности локальных альтернатив (7.45) статистика теста Вальда имеет невырожденное распределение, нецентральное хи-квадрат распределение. Это позволяет определить мощность теста Вальда.

В частности, как показано в разделе 7.7.4, при $H_a$ статистика теста Вальда, приведённая в (7.6), имеет асимптотическое $\chi^2(h; \lambda)$ распределение, где $\chi^2(h; \lambda)$ --- это нецентральное хи-квадрат распределение с параметром нецентральности
\begin{equation}
\lambda = \frac{1}{2}\delta'(R_0C_0R_0')^{-1}\delta,
\end{equation}
где $R_0$ и $C_0$ были заданы в (7.4) и (7.5). Мощность теста Вальда, вероятность отвергнуть нулевую гипотезу, когда локальная альтернативная гипотеза верна, тогда имеет вид:
\begin{equation}
\text{Мощность} = \Pr[W > \chi_{\alpha}^2(h)| W \sim \chi_{\alpha}^2(h; \lambda)].
\end{equation}

График 7.1 отражает мощность против $\lambda$ тестов на проверку скалярных гипотез $(h = 1)$ на часто используемых размерах или уровнях значимости 10\%, 5\% и 1\%. Для $\lambda$, близких к нулю, мощность равна размеру, а для крупных $\lambda$ мощность стремится к одному.

Эти особенности имеют место и для $h > 1$. В частности, мощность монотонно возрастает по параметру нецентральности $\lambda$, который определён в (7.46). Отсюда следует несколько общих результатов.

Во-первых, мощность увеличивается с расстоянием между нулевой и альтернативной гипотезами, так как тогда $\delta$ и, следовательно, $\lambda$ увеличиваются.


\vspace{5cm}



График 7.1. Мощность хи-квадрат теста Вальда с одной степенью свободы для трёх различных размеров тестов с параметром нецентральности от 0 до 20.

Во-вторых, для заданной альтернативы $\delta$ мощность увеличивается вместе с эффективностью оценки $\hat{\theta}$, так как тогда $C_0$ меньше, и, следовательно, $\lambda$ больше.

В-третьих, вместе с увеличением размера теста увеличивается и мощность, а вероятность ошибки второго рода снижается.

В-четвертых, если несколько различных тестовых статистик все имеют $\chi^2(h)$ распределение при нулевой гипотезе и имеют нецентральное $\chi^2(h)$ распределение при альтернативной гипотезе, то предпочтительнее является та тестовая статистика, у которой наибольший параметр нецентральности $\lambda$, так как в этом случае мощность наиболее высокая. Кроме того, два теста, которые имеют тот же параметр нецентральности, асимптотически эквивалентны при локальных альтернативах.

Наконец, в реальных приложениях мощность можно рассчитать как функцию от $\delta$. В особенности, для заданной альтернативы $\delta$ оценку параметра нецентральности $\lambda$ можно вычислить с помощью (7.46), используя оценку параметра $\hat{\theta}$ с соответствующими значениями $\hat{R}$ и $\hat{C}$. Расчёт мощности представлен в разделе 7.6.5.

\subsection{Вывод асимптотической мощности}

Чтобы получить распределение $W$ при альтернативной гипотезе, надо начать с разложения в ряд Тейлора из (7.9). Его можно упростить до
\begin{equation}
\sqrt{N}h(\hat{\theta}) \stackrel{d}{\rightarrow} N[\delta, R_0C_0R_0'],
\end{equation}
при альтернативной гипотезе, так как тогда $\sqrt{N}h(\theta) = \delta$. Таким образом, квадратичная форма, центрированная по $\delta$, будет иметь хи-квадрат распределение при альтернативной гипотезе.

Статистика теста Вальда, определённая в (7.6), образует квадратичную форму, центрированную относительно нуля, и больше не имеет хи-квадрат распределение при альтернативной гипотезе. В общем случае, если $z \sim N[\mu, \Omega]$, где $\rank(\Omega) = h$. Тогда $z'\Omega^{-1}z \sim \chi^2(h; \lambda)$, где $\chi^2(h; \lambda)$ --- это нецентральное хи-квадрат распределение с параметром нецентральности $\lambda = \frac{1}{2}\mu'\Omega^{-1}\mu$. Применение этого результата к (7.48) даёт
\begin{equation}
Nh(\hat{\theta})'(R_0C_0R_0')^{-1}h(\hat{\theta}) \stackrel{d}{\rightarrow} \chi^2(h; \lambda)
\end{equation}
при альтернативной гипотезе, где $\lambda$ опеределено в (7.49).

\subsection{Расчёт асимптотической мощности}

Чтобы прояснить, как мощность меняется с изменением $\delta$, рассмотрим тест на значимость коэффициента в скалярном случае. Тогда параметр нецентральности, который был определён в (7.46), будет иметь вид:
\begin{equation}
\lambda = \frac{\delta^2}{2c} \simeq \frac{(\delta/\sqrt{N})^2}{2(se[\hat{\theta}])^2},
\end{equation}
где возникает приближение из-за оценивания $c$, предельной дисперсии $\sqrt{N}(\hat{\theta} - \theta)$ с помощью $N(se[\hat{\theta}])^2$, где $se[\hat{\theta}]$  --- это стандартная ошибка $\hat{\theta}$.

Рассмотрим хи-квадрат тест Вальда на проверку нулевой гипотезы $H_0: \theta = 0$ против альтернативной гипотезы
\[
H_a: \theta = a \times se[\hat{\theta}],
\]
где $se[\hat{\theta}]$ рассматривается как константа. Тогда $\delta/\sqrt{N}$ из (7.45) равняется $a \times se[\hat{\theta}]$, и (7.50) можно успростить до $\lambda = a^2/2$. Таким образом, тест Вальда имеет асимптотическое $\chi_{\alpha}^2(1; \lambda)$ распределение при альтернативной гипотезе, где $\lambda = a^2/2$.

Из графика 7.1 ясно, что в общем случае для тестов на значимость на уровне значимости 5\%,
если $a = 2$, мощность значительно ниже 0.5, если $a = 4$, мощность около 0.5, и если $a = 6$,
мощность ниже 0.9. Следовательно, пограничный тест на статистическую значимость может иметь низкую мощность против альтернатив, которые находятся на расстоянии нескольких стандартных ошибок от нуля. Интуитивно, если $\hat{\theta} = 2se[\hat{\theta}]$, тогда тест на проверку гипотезы $\theta = 0$ против альтернативной гипотезы $\theta = 4se[\hat{\theta}]$ имеет мощность около 0.5, так как $95\%$-ный доверительный интервал для $\theta$ примерно $(0, 4se[\hat{\theta}])$, если предположить, что значения $\theta = 0$ и $\theta = 4se[\hat{\theta}]$ равновероятны.

В качестве более конкретного примера предположим, что $\theta$ измеряет процентное увеличение заработной платы
в результате программы повышения квалификации и что исследование выявило, что $\hat{\theta} = 6$ с $se[\hat{\theta}] = 4$. Тогда тест Вальда на уровне значимости 5\% приводит к тому, что $H_0$ не будет отвергнута, так как $W = (6/4)^2 = 2.25 < \chi_{0.05}^2(1) = 3.96$. Исследование будет часто делать вывод, что программа повышения квалификации не является статистически значимой. Однако не надо воспринимать это как то, что существует высокая вероятность того, что программа не влияет, так как этот тест имеет низкую мощность. Например, предыдущий анализ показывает, что тест на проверку гипотезы $H_0: \theta = 0$ против альтернативной гипотезы $H_a: \theta = 16$, что говорит об относительно большом эффекте программы, имеет мощность, равную лишь 0.5, так как $4 \times se[\hat{\theta}] = 16$. Причины низкой мощности включают в себя небольшой размер выборки, большую дисперсию ошибок модели и малый разброс регрессоров.

В простых случаях можно решить обратную задачу оценивания минимального размера выборки, необходимого для достижения заданного желаемого уровня мощности. Это особенно популярно в медицинских исследованиях. 

Эндриус (1989) даёт более формальное изложение способов применения параметра нецентральности для определения значений параметров, при которых в практических ситуациях тесты могут иметь низкую мощность. Он предоставляет множество практических примеров, где можно легко определить, что тесты имеют низкую мощность против значимых альтернатив.

\section{Метод Монте-Карло}

Наше обсуждение статистических выводов до сих пор полагалось на асимптотические результаты. Для малых выборок аналитические результаты редко доступны, помимо тестов на линейные ограничения в линейной регрессионной модели при условии нормального распределения остатков. Однако результаты для малых выборок могут быть получены с помощью метода Монте-Карло.

\subsection{Обзор}

Приведём пример исследования свойств тестовой статистики для малых выборок с помощью метода Монте-Карло. Установим размер выборки $N = 40$ и, например, случайным образом сгенерируем 10 000 выборок размером 40 для модели, получаемой при нулевой гипотезе. Для каждой выборки выпишем тестовую статистику и проверим нулевую гипотезу, которая отвергается, если значение тестовой статистики попадает в область альтернативной гипотезы, которая, как правило, определяется с помощью асимптотических результатов.

Истинный или фактический размер тестовой статистики --- это доля выборок, для которых тестовая статистика попадает в область альтернативной гипотезы. В идеальном случае он близок к номинальному размеру, который является выбранным уровнем значимости теста. Например, при тестировании на уровне 5\% номинальный размер теста равен 0.05, и ожидается, что истинный размер близок к 0.05.

Определение мощности теста для небольших выборок требует дополнительного моделирования с выборками, сгенерированными при одной или нескольких конкретных спецификациях возможных моделей, которые заключены в композитной альтернативной гипотезе. Мощность вычисляется как доля выборок, на которых нулевая гипотеза отвергается, используя либо тот же самый метод, который применяется для определения истинного размера, либо версию теста с поправкой на размер выборки. Эта версия использует область альтернативной гипотезы, то есть ту, где номинальный размер равен истинному размеру.

Исследование с помощью метода Монте-Карло просто реализовать, но есть много тонкостей, используемых при моделировании хорошего исследования Монте-Карло. Отличный обзор представлен в книге Дэвидсона и МакКиннона (1993).


\subsection{Особенности метода Монте-Карло}

В качестве примера исследования с помощью метода Монте-Карло мы рассматриваем статистическое влияние на коэффициент наклона в пробит-модели. Приведённый ниже анализ не опирается на знание пробит-модели. Процесс порождающий данные --- это пробит-модель с бинарным регрессором $y$, который равен одному с вероятностью
\[
\Pr[y = 1|x] = \Phi(\beta_1 + \beta_2 x),
\]
где $\Phi(\cdot)$ --- стандартная нормальная функция распределения, $x \sim N[0,1]$ и $(\beta_1,\beta_2) = (0, 1)$.

Для этого процесса порождающего данные нетрудно сгенерировать данные $(y,x)$. Регрессор $x$ сначала получают случайным образом с помощью стандартного нормального распределения. Затем из раздела 14.4.2 зависимая переменная $y$ устанавливается равной 1, если $x + u > 0$, и устанавливается равной 0 в противном случае, где $u$ получено случайным образом с помощью стандартного нормального распределения. Для этого процесса порождающего данные $y = 1$ примерно в половине случаев
и $y = 0$ для другой половины.

В каждой модели есть $N$ новых наблюдений $x$ и $y$. С помощью метода максимального правдоподобия получаются оценки для пробит-регрессии $y$ на $x$. В качестве альтернативы можно использовать те же $N$ вариантов регрессора $x$ для каждого моделирования и только менять $y$. Первый способ соответствует простой случайной выборке, а второй соответствует анализу при заданном $x$, или <<фиксированному в повторяемых экспериментах>>, см. раздел 4.4.7.

В метода Монте-Карло часто рассматривают различные размеры выборок. Здесь мы устанавливаем $N = 40$. Можно также проверять на выборках с очень большим значением $N$, например, $N = 10 000$, так как тогда результаты, полученные с помощью метода Монте-Карло, дают результаты, близкие к асимптотическим.

Для определения истинного размера теста необходимо провести проверку на большом числе выборок, поскольку размер зависит от поведения в хвостах распределения, а не в центре. Если проведено $S$ экспериментов для поиска истинного размера теста $\alpha$, то доля случаев, когда нулевая гипотеза была отвергнута верно, является результатом $S$ биномиальных экспериментов с математическим ожиданием $\alpha$ и дисперсией $\alpha(1 - \alpha)/S$. Так, $95\%$ экспериментов Монте Карло дадут результат, что тест размера должен быть в интервале $\alpha \pm 1.96 \sqrt{\alpha(1 - \alpha)/S}$. Недостаточно провести 100 экспериментов, так как, например, этот интервал может иметь вид $(0.007, 0.093)$ при $\alpha = 0.05$. Для 10 000 экспериментов $95\%$ интервал будет гораздо более точным $(0.008, 0.012)$, $(0.046, 0.054)$, $(0.094, 0.106)$ и $(0.192, 0.208)$ при $\alpha$, равной $0.01$, $0.05$, $0.10$ и $0.20$ соответственно.

Проблема, которая может возникнуть при использовании метода Монте-Карло, заключается в том, что для некоторых выборок, возможно, нельзя будет оценить модель. Рассмотрим, например, линейную регрессию только на константу и переменную-индикатор. Если переменная-индикатор всегда имеет одно и то же значение, например 0,  то его коэффициент не может быть отделить от коэффициента для константы. Аналогичная проблема возникает в пробит и в других моделях бинарного выбора, если в выборке все $y$-ки равны 0 или все $y$-ки равны 1. Стандартная процедура, которая может быть подвергнута критике, --- отбросить такие выборки и написать компьютерный код, который позволяет повторяет эксперимент при возникновении такой проблемы. В этом примере проблема не возникла для $N = 40$, но она появилась для $N = 40$.

\subsection{Смещение для малых выборок}

Перед тем как перейти к проверке гипотез, мы смотрим на свойства оценки $\hat{\beta}_2$, полученной с помощью метода максимального правдоподобия, и оценки её стандартной ошибки $se[\hat{\beta}_2]$ для малых выборок.

На 10 000 выборках $\hat{\beta}_2$ имела математическое ожидание 1.201 и стандартное отклонение 0.452,
в то время как среднее значение $se[\hat{\beta}_2]$ было 0.359. По этой причине метод максимального правдоподобия даёт смещение в сторону завышения для малых выборок, так как среднее значение $se[\hat{\beta}_2]$ гораздо меньше, чем стандартное отклонение $\hat{\beta}_2$.

\subsection{Размер теста}

Мы рассмотрим двусторонний тест на проверку гипотезы $H_0: \beta_2 = 1$ против альтернативной гипотезы $H_a: \beta_2 \not= 1$, используя тест Вальда
\[
z = W_z = \frac{\hat{\beta}_2 - 1}{se[\hat{\beta}_2]}, 
\]
где $se[\hat{\beta}_2]$ представляет собой стандартную ошибку оценки, полученной методом максимального правдоподобия с использованием ковариационной матрицы, приведённой в разделе 14.3.2, которая равна минус математическое ожидание обратной матрицы Гессе. При данном процессе порождающем данные, $z$ имеет асимптотически стандартное нормальное распределение, и $z^2$ имеет хи-квадрат распределение. Цель состоит в том, чтобы определить, насколько хорошо это апроксимируется к распределению для малых выборок.

График 7.2 отражает плотность для $S = 10 000$ вычисленных значений $z$, где плотность изображается с использованием оценки плотности ядра из главы 9, а не с ипользованием гистограммы. Это накладывается на плотность стандартного нормального распределения. 

Очевидно, что асимптотический результат не является точным, особенно в верхней части, где разница достаточно большая, чтобы привести к искажению размера при тестировании, например, на уровне значимости 5\%. Также $z$ имеет среднее значение $0.114 \not= 0$ и стандартное отклонение $0.956 \not = 1$.

\begin{table}[h]
\begin{center}
\caption{\label{tab:pred} Размер теста Вальда и мощность примера пробит-регрессии}
\begin{minipage}{13cm}
\begin{tabular}[t]{*{4}{{c}}}
\hline
\hline
\bf{Номинальный} & \bf{Истинный} & \bf{Истинная} & \bf{Асимптотическая} \\
\bf{размер $(\alpha)$}\footnote{Процесс, порождающий данные, для $y$ --- пробит с $\Pr[y = 1] = \Phi( 0 + \beta_2 x)$ и размером выборки $N = 40$. Тест --- это двустронний тест Вальда на проверку того, равен ли коэффициент наклона 1 или нет. Истинный размер рассчитан с помощью $S = 10000$ экспериментов при $\beta_2 = 1$. Мощность рассчитана из 10 000 экспериментов при $\beta_2 = 2$} & \bf{размер} & \bf{мощность} & \bf{мощность} \\
\hline
0.01 & 0.005 & 0.007 & 0.272 \\
0.05 & 0.029 & 0.226 & 0.504 \\
0.10 & 0.081 & 0.608 & 0.628 \\
0.20 & 0.192 & 0.858 & 0.755 \\
\hline
\hline
\end{tabular}
\end{minipage}
\end{center}
\end{table}

Первые два столбца таблицы 7.2 отражают номинальный размер и истинный размер теста Вальда для номинальных размеров $\alpha = 0.01$, 0.05, 0.10 и 0.20. Истинный размер --- это доля 10 000 экспериментов, в которых $|z| > z_{\alpha/2}$, что эквивалентно $z^2 > \chi_{\alpha}^2(1)$. Очевидно, что истинный размер теста намного меньше, чем номинальный размер при $\alpha \leq 0.10$. Специальная поправка для малых выборок состоит в предположении, что $z$ имеет $t$-распределение с 38 степенями свободы, и гипотеза отвергается, если $|z| > t_{\alpha/2}(38)$. Однако это приводит к ещё меньшему истинному размеру, так как $t_{\alpha/2}(38) > z_{\alpha/2}$.

Метод Монте-Карло также можно использовать для получения скорректированных на размер критических значений. Таким образом, нижние и верхние 2.5 процентные квантили 10 000 моделируемых значений $z$ равны $- 1.905$ и $2.003$. Отсюда следует, что асиметричная область альтернативной гипотезы с истинным размером будет иметь вид: $z < - 1.905$ и $z > 2.003$. Она больше, чем область альтернативной гипотезы $|z^2| > 1.960$.



\vspace{5cm}




График 7.2 Плотность тестовой статистики Вальда, коэффициент наклона которой равен 1, посчитанный с помощью метода Монте-Карло. Для сравнения изображена плотность стандартного нормального распределения. Данные взяты из модели пробит.

\subsection{Мощность теста}

Мы рассмотрим мощность теста Вальда при альтернативной гипотезе $H_a: \beta_2 = 2$. Мы ожидаем, что мощность будет разумной, так как значение $\beta_2$ лежит в интервале от двух до трёх стандартных ошибок от значения $\beta_2 = 1$ из нулевой гипотезы при условии, что $se[\hat{\beta}_2]$ имеет среднее значение 0.359. Истинная и номинальная мощности теста Вальда приведены в двух последних столбцах таблицы 7.2.

Истинная мощность получается таким же образом, как и истинный размер, который является долей экспериментов из 10 000, в которых $|z| > z_{\alpha/2}$. Единственное отличие состоит в том, что при получении $y$ в моделировании $\beta_2 =2$, а не 1. Истинная мощность очень низкая для $\alpha = 0.01$ и 0.05, то есть для случев, когда истинный размер значительно меньше, чем номинальный размер.

Номинальная мощность теста Вальда определяется с использованием асимптотического нецентрального $\chi^2 (1; \lambda)$ распределения при альтернативной гипотезе, где из (7.50) $\lambda = \frac{1}{2}(\delta \sqrt{N})^2/ se[\hat{\beta}_2]^2 = \frac{1}{2} \times 1^2/0.359^2 \simeq 3.88$, так как локальная альтернатива состоит в том, что  $H_a: \beta_2 - 1 = \delta / \sqrt{N}$, поэтому $\delta / \sqrt{N} = 1$ и $\beta_2 = 2$. Асимптотический результат не является точным, но он даёт полезную оценку мощности для  $\alpha = 0.10$ и 0.20, то есть для случаев, когда истинный размер близок к номинальному размеру.

\subsection{Монте-Карло на практике}

Предыдущее обсуждение делало упор на использование метода Монте-Карло для расчёта мощности и размера теста. Он также может быть очень полезен для определения смещения оценки в малых выборках при установлении больших $N$ для определения того, что на самом деле оценка является состоятельной. Такую процедуру Монте-Карло легко реализовать с использованием современных статистических пакетов.

Метод Монте-Карло может быть применён на реальных данных, если условное распределение $y$ при заданном $x$ полностью параметризовано. Рассмотрим, например, пробит-модель, оценённую на реальных данных. 

В каждой модели регрессоры устанавливаются равными выборочным значениям, если выборка является одной из выборок с фиксированными регрессорами в повторяющихся выборках, и необходимо получить новый набор значений для бинарной зависимой переменной $y$. Это будет зависеть от того, какие значения параметра $\beta$ используются. Пусть $\hat{\beta}_1, \dots, \hat{\beta}_k$ обозначают оценки пробит модели для изначальной выборки и рассмотрим тест Вальда $H_0: \beta_j = 0$. Чтобы вычислить размер теста, проведём $S$ экспериментов при условии $\beta_k = \hat{\beta}_k$ для $j \not= k$ и $\beta_j = 0$, и потом посчитаем количество случаев, когда нулевая гипотеза отвергается. Чтобы посчитать мощность теста Вальда против специфической альтернативной гипотезы $H_a: \beta_j = 1$, сгенерируем $y$ при условии $\beta_k = \hat{\beta}_k$ для $j \not= k$ и $\beta_j = 0$ для генерируемого $y$ и посчтитаем долю случаев, когда нулевая гипотеза отвергается.

На практике большая часть микроэконометрического анализа основывается на оценках, которые не основаны на полностью параметрических моделях. В таком случае необходимы дополные предположения о распределении, для того чтобы проводить эксперименты Монте-Карло. 

Альтернативным способом можно найти мощность с помощью асимптотических методов, а не методов для конечных выборок. Более того, метод бутстреп, который будет представлен ниже, может быть применён для того, чтобы получить размер теста, используя более сложную асимптотическую теорию. 

\section{Пример метода бутстреп}

Бутстреп --- это вариант метода Монте-Карло, плюсом которого является то, что его можно применить с меньшим числом параметрических предположений и несложным дополнительным компьютерным кодом, необходимым для оценивания модели. Для того чтобы выполнялись наиболее важные предположения для бутстрепа, необходимо, чтобы оценки имели предельное распределение и чтобы выборки, получаемые для бутстрепа, были независимые и одинаково распределённые.

Бутстреп имеет два основных применения. Во-первых, он может быть альтернативным способом для расчёта тестовых статистик без асимптотических предположений. Это особенно полезно для вычисления стандартных ошибок, когда аналитические формулы имеют сложный вид. Во-вторых, он может быть использован для определения через него стандартной асимптотической теории, которая может позволить получить более хорошую апроксимацию к распределению тестовой статистики для конечных выборок.

Мы покажем, как бутстреп применим для теста Вальда далее в главе 11.
 
 
\subsection{Вывод при использовании стандартной асимптотической теории}

Рассмотрим опять пример пробит-регрессии с бинарным $y$, равным единице с вероятностью $p = \Phi (\gamma + \beta x)$, где $\Phi(\cdot)$ --- функция распределения стандартной нормальной случайной величины. Мы хотим проверить гипотезу $H_0: \beta = 1$ против альтернативной $H_a: \beta \not= 1$ на уровне значимости 0.05. Для проведения анализа знание пробит-модели не является необходимым.

Генерируем одну выборку размером $N = 30$. Оценивание пробит-модели с помощью метода максимального правдоподобия даёт $\hat{\beta} = 0.817$ и $s_{\hat{\beta}} = 0.294$, где стандартная ошибка основана на $- \hat{A}^{-1}$, поэтому тестовая статистика $z = (1 - 0.817)/0.294 = - 0.623$

Используя стандартную асимптотическую теорию, получаем критические значения для 5\% уровня значимости $- 1.96$ и 1.96, так как $z_{0.025} = 1.96$, поэтому нулевая гипотеза не отвергается.


\subsection{Бутстреп без асимптотической теории}

Отправной точкой метода бутстреп является генерация повторной выборки из апроксимации к генеральной совокупности, см. раздел 11.2.1. Парный бутстреп достигает этого путём генерации повторной выборки на базе имеющейся выборки.

Таким образом, можно создать $B$ псевдовыборок размера $N$, которые состоят из случайных комбинаций элементов имеющейся выборки $(y_i, x_i), i = 1, \dots, N$. Например, в первой псевдовыборке из 30 наблюдений может содержаться $(y_1, x_1)$ один раз, $(y_2, x_2)$ вообще может отсутствовать, а $(y_3, x_3)$ может встречаться два раза и так далее. Это даёт $B$ оценки параметров $\beta$ $\hat{\beta}_1^*, \dots, \hat{\beta}_B^*$, которые могут быть использованы для выявления особенностей распределения исходной оценки $\beta$. 

Например, допустим, что компьютерная программа, которая используется для оценивания пробит-модели, выдаёт $\hat{\beta}$, но не выдаёт стандартные ошибки $s_{\hat{\beta}}$. Бутстреп решает эту проблему, так как можно использовать оценки стандартных ошибок $s_{\hat{\beta}, boot}$ оценок $\hat{\beta}_1^*, \dots, \hat{\beta}_B^*$ из $B$ бутстреп псевдовыборок. При наличии оценок стандартных ошибок можно проверить гипотезу о $\beta$  с помощью теста Вальда.

Для примера теста Вальда для пробит-модели получаемая с помощью бутстрепа оценка стандартной ошибки $\hat{\beta}$ равна 0.376, поэтому $z = (1 - 0.817) / 0.376 = - 0.487$. Так как $- 0.487$ принадлежит интервалу от $- 1.96$ до 1.96, то на уровне значимости 5\% нулевая гипотеза не отвергается.

Это использование бутстрепа для проверки гипотез не приводит к улучшению размера теста для малых выборок. Тем не менее, это может привести к большой экономии времени во многих случаях, если трудно иным образом получить стандартные ошибки для оценки.

\subsection{Бутстреп с асимптотической теорией}

Иногда бутстреп может привести к лучшей асимптотической апроксимации к распределению $z$. Это может привести к получению критических значений для конечных выборок, которые лучше в том смысле, что истинный размер, скорее всего, будет ближе к номинальному размеру 0.05. Подробно об этом говорится в главе 11. Здесь мы приводим описание метода.

Снова создаём $B$ псевдовыборок размера $N$, которые состоят из случайных комбинаций элементов имеющейся выборки. Оцениваем пробит-модель для каждой псевдовыборки и для $b$-той псевдовыборки вычисляем $z_b^* = (\hat{\beta}_b^* - \hat{\beta}) / s_{\hat{\beta}_b^*}$, где $\hat{\beta}$ --- это первоначальная оценка. Распределение бутстрепа для тестовой статистики $z$ --- эмпирическое распределение $z_i^*, \dots, z_B^*$, а не стандартное нормальное распределение. Нижний и верхний 2.5 процентные квантили этого эмпирического распределения дают критические значения бутстрепа.

Для примера здесь при $B = 1 000$ нижний и верхний 2.5 процентные квантили эмпирического бутстреп распределения  $z$ равны $- 2.62$ и 1.83. Критические значения бутстрепа для тестирования на уровне значимости 5\% равны $- 2.62$ и 1.83, а не стандартным $\pm 1.96$. Так как изначальная тестовая статистика для исследуемой выборки $z = - 0.623$ лежит в промежутке от $- 2.62$ до 1.83, мы не отвергаем нулевую гипотезу $H_0: \beta = 1$. Для метода  
бутстреп также можно вычислить $p$-значение.

В отличие от метода бутстреп, описанного в предыдущем разделе, здесь есть асимптотическое улучшение, потому что стьюдентизированная тестовая статистика $z$ асимптотически значима (см. раздел 11.2.3), тогда как оценка $\hat{\beta}$ нет.

\section{Практические соображения}

Микроэконометрические исследовани делают акцент на статистических выводах, основанных на минимальных предположениях о распределении, и используют скорректированную оценку ковариационной матрицы оценки. Однако нет смысла в скоректированных выводах, если нарушение предположений о распределении приводит к более серьёзному осложнению несостоятельности оценки, что может произойти с некоторыми, хотя и не всеми, оценками, полученными методом максимального правдоподобия.

Многие пакеты имеют опцию скорректированных стандартных ошибок. В пакетах, связанных с микроэконометрикой, термин <<скорректированные>> часто означает устойчивость к гетероскедастичности и не рассматривает другие проблемы такие, как кластеризация, см. раздел 24.5, что также может привести к неверным статистическим выводам.

Скорректированный вывод обычно получают с помощью теста Вальда. Он имеет недостаток: он неинвариантный к репараметризации нелинейных гипотез. Однако эта проблема может быть решена с помощью применения метода бутстреп. Стандартные вспомогательные регрессии для теста множителей Лагранжа и реализация теста с помощью статистических пакетов, как правило, не имеет поправки. Хотя в некоторых случаях существует относительно простая поправка для теста множителей Лагранжа (см. раздел 8.4).

Мощность тестов может быть слабой. В идеальном случае мощность против некоторых значимых альтернатив может быть получена. В противном случае, как указывается в разделе 7.6, следует быть осторожным с выводами при проверке гипотез кроме случая, когда параметры очень точно оценены.

Размер тестов для конечных выборок, полученный с помощью асимптотической теории, также является проблемой. Метод бутстреп, который подробно описан в главе 11, может позволять проверять гипотезы и строить доверительные интервалы с гораздо более хорошими свойствами для конечных выборок.

Статистические выводы могут быть неустойчивыми, поэтому этот вопрос имеет важное значение для практиков. Рассмотрим двусторонний тест Вальда на статистическую значимость, когда $\hat{\theta} = 1.96$, и предположим, что тестовая статистика, действительно, имеет стандартное нормально распределение. Если $s_{\hat{\theta}} = 1.0$, то $t = 1.96$ и $p$-значение равно 0.050. Однако истинное $p$-значение намного выше 0.117, если стандартная ошибка была недооценена на 20\% (таким образом, правильное $t = 1.57$), и оно значительно ниже 0.014, если стандартная ошибка переоценена на 20\% (таким образом, $t = 2.35$).

\subsection{Библиографические заметки}

Книги по эконометрике Гурьеру и Монфора (1989), Дэвидсона и МакКиннона (1993) уделяют много внимания проверке гипотез. Описание, которое приведено в этой книге, рассматривает только ограничения типа равенств. Для тестов на ограничения типа неравенств можно посмотреть Гурьеру, Холли, и Монфора (1982) для линейных случаев и Волак (1991) для нелинейных случаев. Если параметры заданы на границе пространства параметров при нулевой гипотезе, не всегда можно провести тест на проверку гипотезы; см. Эндриус (2001).
\begin{itemize}
\item [$7.3$] Полезное графическое описание трёх классических тестовых процедур приведено Бьюзом (1982).
\item [$7.5$] Ньюи и Вест (1987a) описывают расширение классических тестов для оценивания обобщённым методом моментов.
\item [$7.6$] Дэвидсон и МакКиннон (1993) подробно рассматривают мощность и объясняют различие между явными и неявными нулевыми и альтернативными гипотезами.
\item [$7.7$] Про исследования методом Монте-Карло можно посмотреть книги Дэвидсона и МакКиннона (1993) и Хендри (1984). 
\item [$7.8$] Метод бутстреп, введённый Эфроном (1979), подробно рассмотрен в главе 11.
\end{itemize}

\section{Упражнения}
\begin{enumerate}

\item [$7-1$] Предположим, что для выборки получены оценки $\hat{\theta}_1 = 5$, $\hat{\theta}_2 = 3$ с асимптотическими оценками вариации $4$ и $2$, коэффициент корреляции между $\hat{\theta}_1$ и $\hat{\theta}_2$  равен $0.5$. Предположим, что оценки параметров имеют асимптотическое нормальное распределение.
\begin{enumerate}
\item Проверьте гипотезу $H_0: \theta_1 e^{\theta_2} = 100$ против $H_a: \theta_1 \not= 100$ на уровне значимости 0.05.
\item Постройте 95\% доверительный интервал для $\gamma = \theta_1 e^{\theta_2}$.
\end{enumerate}
\item [$7-2$] Рассмотрим НМНК регрессию для модели $y = \exp(\alpha + \beta x) + \epsilon$, где $\alpha, \beta$  и $x$ являются скалярными, а $\epsilon \sim N[0,1]$. Для лёгкости вычислений $\sigma_{\epsilon}^2 = 1$, и его оценку не нужно получать. Мы хотим проверить гипотезу $H_0: \beta = 0$ против $H_a: \beta \not= 0$.
\begin{enumerate}
\item Приведите условие первого порядка для $\alpha$ и $\beta$, оцениваемых методом максимального правдоподобия для неограниченной модели.
\item Приведите асимптотическую ковариационную матрицу для $\alpha$ и $\beta$, оцениваемых методом максимального правдоподобия для неограниченной модели.
\item Найдите оценки $\alpha$ и $\beta$ с помощью метода максимального правдоподобия для ограниченной модели.
\item Приведите вспомогательную регрессию для того, чтобы найти вариант теста множителей Лагранжа с внешним произведением градиента.
\item Приведите полное выражение для стандартного вида теста множителей Лагранжа. Заметьте, что для этого необходимо найти производные логарифма функции правдоподобия для неограниченной модели, оценённого в $\alpha$ и $\beta$, полученных методом максимального правдоподобия для ограниченной модели. [Это сложнее, чем пункты (a) --- (d)].
\end{enumerate}
\item [$7-3$] Предположим, мы хотим выбрать из двух вложенных параметрических моделей. Соотношение между плотностями этих двух моделей выглядит так: $g(y|x, \beta, \alpha = 0) = f(y|x, \beta)$, где для простоты $\beta$ и $\alpha$ --- скаляры. Если $g$ --- это верная плотность, то ММП оценка $\beta$, основанная на плотности $f$, несостоятельная. Тест на модель $f$ против модели $g$ --- это тест $H_0: \alpha = 0$ против $H_a: \alpha \not= 0$. Предположим, что оценивание методом маскимального правдоподобия даёт следующие результаты: (1) модель $f$: $\hat{\beta} = 5.0, se[\hat{\beta}] = 0.5$ и $\ln L = - 106$; (2) модель $g$: $\hat{\beta} = 3.0, se[\hat{\beta}] = 1.0, \hat{\alpha} = 2.5, se[\hat{\alpha}] = 1.0$ и $\ln L = - 103$. Не все тесты возможны при данных выше условиях. Если информации достаточно, проведите тесты и сделайте вывод. Если не хватает информации, то обозначьте это.
\begin{enumerate}
\item Проверьте нулевую гипотезу с помощью теста Вальда на уровне значимости 0.05. 
\item Проверьте нулевую гипотезу с помощью множителей Лагранжа на уровне значимости 0.05. 
\item Проверьте нулевую гипотезу с помощью теста отношения правдоподобия на уровне значимости 0.05. 
\item Проверьте нулевую гипотезу с помощью теста Хаусмана на уровне значимости 0.05. 
\end{enumerate}
\item [$7-4$] Проверьте гипотезу $H_0: \mu = 0$ против $H_a: \mu \not= 0$ на уровне значимости 0.05, если процесс порождающий данные --- это $y \sim N[\mu, 100]$, то есть стандартное отклонение равно 10, а размер выборки $N = 10$. Тестовая статистика --- это стандартная $t$-тестовая статистика $t = \hat{\mu}/\sqrt{s/10}$, где $s^2 = (1/9) \sum_i (y_i - \bar{y})^2$. Проведите 1000 симуляций, чтобы ответить на следующие вопросы.
\begin{enumerate}
\item Получите истинный размер $t$-теста, если верные критические значения для конечных выборок равны $\pm t_{0.025}(8) = \pm 2.306$. Есть ли искажения из-за размера?
\item Получите истинный размер $t$-теста, если асимптотически апроксимированные критические значения равны $\pm t_{0.025}(8) = \pm 2.306$. Есть ли искажения из-за размера?
\item Получите мощность $t$-теста против альтернативной гипотезы $H_a: \mu = 1$, когда используются критические значения $\pm t_{0.025}(8) = \pm 2.306$. Мощный ли тест против именно этой альтернативы?
\end{enumerate}
\item [$7-5$] Используйте данных о расходах на здравоохранение из раздела 16.6. Модель представляет собой пробит-регрессию DMED, переменной-индикатора положительных расходов на здравоохранение, на 17 регрессоров, перечисленных во втором абзаце в разделе 16.6. Вы должны получить оценки, приведённые в первой колонке таблицы 16.1. Рассмотрим совместный тест на статистическую значимость показателей здоровья HLTHG, HLTHF и HLTHP на уровне значимости 0.05.
\begin{enumerate}
\item Проведите тест Вальда.
\item Проведите тест отношения правдоподобия.
\item Проведите вспомогательную регрессию, чтобы провести тест множителей Лагранжа. [Это потребует написания дополнительного кода].
\end{enumerate}
\end{enumerate}

