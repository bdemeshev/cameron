
\chapter{Мультиномиальные модели}

\section{Введение}

В предыдущей главе рассматривались модели дискретного выбора, зависимая переменная в которых принимает только одно из двух возможных значений. В настоящей главе мы будем рассматривать случаи с несколькими возможными значениями, обычно взаимно исключающими. К примерам таких ситуаций можно отнести выбор способа совершения ежедневной поездки на работу (на автобусе, на машине или пешком), различные типы медицинского страхования (раздельная оплата услуг, управляемое медицинское обслуживание или отсутствие страхования), различные статусы экономически активного населения (занятый на полный рабочий день, на неполный рабочий день или безработный), выбор места отдыха, выбор профессии или выбор товара.

Статистическая модель в определенном смысле довольно проста --- данные имеют мультиномиальное распределение, также как бинарные данные должны иметь биномиальное или распределение Бернулли. Оценка параметров модели наиболее часто производится методом максимального правдоподобия, поскольку очевидно, что данные распределены мультиномиально. Однако, при возникновении некоторых осложнений, вместо него используется метод моментов.

Различные мультиномиальные модели возникают вследствие использования различных функциональных форм для определения вероятности наступления события, имеющего мультиномиальное распределение, аналогично разнице между пробит и логит-моделями в случае бинарных данных. Разграничение также проводится между моделями, для которых регрессоры варьируются в зависимости от альтернатив для конкретного индивида, и моделями, в которых регрессоры не зависят альтернатив. Например, при рассмотрении проблемы выбора способа транспортировки некоторые независимые переменные, такие как время в пути и затраты, будут зависеть от сделанного выбора, тогда как другие, например, возраст индивида, не зависят от выбранной альтернативы.

Простейшая мультиномиальная модель, условная или мультиномиальная логит-модель, достаточна проста в использовании, однако, имеет слишком много ограничений на практике, особенно, если данные о множественных исходах получены путем индивидуального выбора. Для неупорядоченных исходов могут быть использованы менее жесткие модели на базе модели случайной полезности. 
В этой модели выбор делается в пользу альтернативы, которая принесет большую полезность, а полезность каждой альтернативы оценивается как сумма детерминированной и случайной составляющей. Различные определения случайной составляющей приводят к  различным функциональным формам для вероятностей выбора, а, следовательно, к различным мультиномиальным моделям. Дополнительные модели возникают в приложениях, если какие-то предположения могут быть выдвинуты по поводу процесса принятия решения, такие как естественная упорядоченность альтернатив или последовательность принятия решений. На практике используется широкий круг мультиномиальных моделей.

В разделе 15.2 представлен пример мультиномиальных данных, на котором будут продемонстрированы обсуждаемые в настоящей главе идеи. Общие выводы для мультиномиальных моделей приведены в разделе 15.3. Условная и мультиномиальная логит-модель рассматриваются в разделе 15.4. Аддитивная модель случайной полезности представлена в разделе 15.5. Вложенная логит-модель, логит-модель со случайными параметрамии, мультиномиальная пробит-модель являются предметом рассмотрения в разделах 15.6-15.8. Модели с упорядоченными исходами и модели с последовательными решениями подробно рассматриваются в разделе 15.9. Многомерные модели с более чем одной зависимой переменной представлены в разделе 15.10. Полупараметрические методы оценки кратко рассматриваются в разделе 15.11.

\section{Пример: выбор способа рыбалки}

В настоящем разделе проиллюстрирована мультиномиальная логит-модель, простейшая мультиномиальная модель с неупорядоченными исходами. Ее варианты представлены в разделе 15.4., где рассматриваются регрессоры, изменяющиеся между альтернативами. Акцент делается на интерпретацию оцениваемой модели. Предельный эффект от изменения значения независимой переменной является гораздо более сложным, чем простое влияние на условное среднее. Вместо этого, для мультиномиальных данных, мы изучаем предельный эффект на вероятность каждого исхода. Отсюда сумма предельных эффектов равна нулю, поскольку сумма вероятностей равна единице.

Рассмотрим проблему выбора способа рыбалки. Зависимая переменная $y$ принимает значение 1, 2, 3 или 4, в зависимости от того, какая из взаимно исключающих альтернатив, способов рыбалки -- рыбалка с пляжа, с пристани, с собственной или взятой на прокат лодки, соответственно, будет выбрана. Неупорядоченная мультиномиальная модель, такая как мультиномиальная логит-модель, здесь применима, поскольку отсутствует четкое упорядочивание значений зависимой переменной. В качестве независимых переменных примем индивидуальный доход, который не зависит от выбранного способа рыбалки, а также цену и коэффициент вылова, которые зависят от выбранного способа рыбалки и индивида.

Пример выборки в 1182 человека взят из исследования, проведенного Томсоном и Круком (1991)  и проанализированного Херриджесом и Клингом (1999). Описание данных приведено в таблице 15.1, содержащей средние по подвыборкам людей, которые предпочли каждый из способов, а также средние значения для регрессоров по выборке в целом. 

\subsection{Условная логит-модель: регрессоры, значения которых зависят от альтернатив}

Сначала рассмотрим роль цены и коэффициента вылова, регрессоров, значения которых зависят от альтернатив. Исключением здесь является цены на рыбалку с пляжа и на рыбалку с пристани, которые совпадают.

Просмотрев таблицу 15.1, наблюдаем, что люди стремятся рыбачить там, где это дешевле всего делать. Например, для людей, выбравших рыбалку с пляжа, средняя цена составила \$36 в сравнении со средними ценами в \$36, \$98 и \$125 для других способов. В более общем смысле, для людей, выбиравших рыбалку с пляжа или с пристани, эти способы в среднем оказывались намного дешевле, чем рыбалка с лодки, а для людей, выбиравших рыбалку с лодки, эти способы оказывались намного дешевле, чем рыбалка с пляжа или пристани. Зависимость между выбором способа рыбалки и коэффициентом вылова менее ясна, тем не менее, очевидно, наибольший коэффициент вылова у рыбалки с лодки, взятой в аренду.

\textbf{Таблица 15.1. }Множественный выбор способа рыбалки: результаты

\begin{tabular}{|p{1.3in}|p{0.5in}|p{0.5in}|p{0.7in}|p{0.8in}|p{0.7in}|} \hline 
\textbf{Независимые переменные} & \multicolumn{4}{|p{2.5in}|}{\textbf{Средние по подвыборкам}} & \textbf{Средние по всей выборке по всем }${\mathbf y}$  \\ \hline 
 & ${\mathbf y}{\mathbf =}{\mathbf 1}$\textbf{\newline Рыбалка с пляжа} & ${\mathbf y}{\mathbf =}{\mathbf 2}$\textbf{\newline Рыбалка с пристани} & ${\mathbf y}{\mathbf =}{\mathbf 3}$\textbf{\newline Рыбалка с собственной лодки} & ${\mathbf y}{\mathbf =}{\mathbf 4}$\textbf{\newline Рыбалка с арендованной лодки} &   \\ \hline 
Доход (в \$1000 в месяц) & 4,052 & 3,387 & 4,654 & 3,881 & 4,099 \\ \hline 
Цена рыбалки с пляжа (\$) & 36 & 31 & 138 & 121 & 103 \\ \hline 
Цена рыбалки с пристани (\$) & 36 & 31 & 138 & 121 & 103 \\ \hline 
Цена рыбалки с собственной лодки (\$) & 98 & 82 & 42 & 45 & 55 \\ \hline 
Цена рыбалки с арендованной лодки (\$) & 125 & 110 & 71 & 75 & 84 \\ \hline 
Коэффициент вылова при рыбалке с пляжа & 0,28 & 0,26 & 0,21 & 0,25 & 0,24 \\ \hline 
Коэффициент вылова при рыбалке с пристани & 0,22 & 0,20 & 0,13 & 0,16 & 0,16 \\ \hline 
Коэффициент вылова при рыбалке с собственной лодки & 0,16 & 0,15 & 0,18 & 0,18 & 0,17 \\ \hline 
Коэффициент вылова при рыбалке с арендованной лодки & 0,52 & 0,50 & 0,65 & 0,69 & 0,63 \\ \hline 
Вероятность наступления события & 0,113 & 0,151 & 0,354 & 0,382 & 1.000 \\ \hline 
Количество наблюдений & 134 & 178 & 418 & 452 & 1182 \\ \hline 
\end{tabular}



Для регрессоров, значения которых зависят от альтернатив, таких как цена и коэффициент вылова, мультиномиальная логит-модель называется условной логит-моделью (см. параграф 15.4.1). Вероятность того, что $i$-ый индивид выберет $j$-ый способ рыбалки определяется по формуле

\[p_{ij}={\Pr  \left[y_i=j\right]\ }=
\frac{{\rm exp} ({\beta }_PP_{ij}+{\beta }_CC_{ij})}{\sum^4_{k=1}{{\rm exp} ({\beta }_PP_{ik}+{\beta }_CC_{ik})}},\ \ \ \ j=1,\dots ,4,\] 

где $P$ обозначает цену, $C$ -- коэффициент вылова, индекс $i$ обозначает $i$-го индивида, а коэффициенты $j$ или $k$ -- альтернативу. Эта модель является очевидным обобщением бинарной логит-модели и дает значения вероятностей, которые лежат между 0 и 1, а в сумме дают единицу. В других мультиномиальных моделях используются другие функциональные формы для определения $p_{ij}$.

Оценки коэффициентов приведены в колонке CL таблицы 15.2. Для условной логит-модели, тем не менее, в отличие от некоторых других мультиномиальных моделей, знаки коэффициентов непосредственно интерпретируются. Предвосхищая выводы из раздела 15.4.3., поскольку ${\beta }_P< 0$,  возрастание цены на одну альтернативу приводит к снижению вероятности выбора этой альтернативы и возрастанию вероятности выбора других альтернатив. Аналогично, поскольку ${\beta }_C>0$, возрастание коэффициента вылова одной альтернативы приводит к росту вероятности ее выбора и к снижению вероятности выбора других альтернатив.


%%% here 

Стандартным показателем влияния регрессора является $N^{-1}\sum^N_{i=1}{{\partial p_{ij}}/{\partial x_{ikr}}}$, среднее предельное изменение вероятности выбора альтернативы $j$, когда $r$-ый регрессор увеличивается на одну единицу для альтернативы $k$ и остается неизменным для остальных альтернатив. Для условной логит-модели этот показатель оценивается как $N^{-1}\sum^N_{i=1}{{\hat{p}}_{ij}\left({\delta }_{ijk}-{\hat{p}}_{ik}\right){\widehat{\beta }}_r}$ (см. (15.18)), где $\widehat{\beta }$ --- оценка параметра $\beta $, а ${\hat{p}}_{ij},\ j=1,\dots ,m,$ --- прогнозируемые вероятности исходов.

Средние изменение вероятности для четырех способов рыбалки для изменения двух регрессоров, цены и коэффициента вылова, приведены в таблице 15.3. В таблице приведены предельный эффект на вероятность выбора при изменении цены на 100 единиц (или на \$100) и предельный эффект при изменении  коэффициента вылова на одну единицу. Например, рост цены на рыбалку с пляжа на \$100 приводит к снижению вероятности выбора этого способа на 0,272 и увеличению вероятности выбора на 0,119, 0,080 и 0,068 соответственно рыбалки с пристани, с собственной лодки и с арендованной лодки. Обратите внимание, что, как и ожидалось, сумма изменений вероятностей равна нулю.

\textbf{Таблица 15.2. }Выбор способа рыбалки: оценка мультиномиальной логит-модели*

\begin{tabular}{|p{0.7in}|p{0.7in}|p{1.7in}|p{0.5in}|p{0.5in}|p{0.5in}|} \hline 
\textbf{Регрессор} & \textbf{Тип} & \textbf{Коэффициент} & \multicolumn{3}{|p{1.4in}|}{\textbf{Модель}} \\ \hline 
  &   &   & \textbf{CL} & \textbf{MNL} & \textbf{Mixed} \\ \hline 
Цена (P) & Зависимый & ${\beta }_P$ & -0,021 & - & -0,025 \\ \hline 
Коэффициент вылова (C) & Зависимый & ${\beta }_{CR}$ & 0,953 & - & 0,358 \\ \hline 
Константа  & Независимый & ${\alpha }_1$: рыбалка с пляжа & - & 0,0 & 0,0 \\ \hline 
 &  & ${\alpha }_2$: рыбалка с пристани & - & 0,814 & 0,778 \\ \hline 
 &  & ${\alpha }_3$: рыбалка с собственной лодки & - & 0,739 & 0,527 \\ \hline 
 &  & ${\alpha }_4$: рыбалка с арендованной лодки & - & 1,341 & 1,694 \\ \hline 
Доход (I) & Независимый & ${\beta }_{I1}:$рыбалка с пляжа & - & 0,0 & 0,0 \\ \hline 
 &  & ${\beta }_{I2}:$рыбалка с пристани & - & -0,143 & -0,128 \\ \hline 
 &  & ${\beta }_{I3}:$рыбалка с собственной лодки & - & 0,092 & 0,089 \\ \hline 
 &  & ${\beta }_{I4}:$рыбалка с арендованной лодки & - & -0,032 & -0,033 \\ \hline 
$-lnL$ &  &  & -1311 & -1477 & -1215 \\ \hline 
Псевдо-$R^2$ &  &  & 0,162 & 0,099 & 0,258 \\ \hline 
\end{tabular}

*Регрессор может быть двух типов: зависимый от исхода или независимый от исхода. Исходы: (1) рыбалка с пляжа, (2) с пристани, (3) с собственной лодки, (4) с арендованной лодки. Оценки параметров методом максимального правдоподобия приведены для условной логит-модели (столбец CL, conditional logit), для мультиномиальной логит-модели (столбец MNL, multinomial logit) и для смешанной логит-модели (столбец Mixed). Мультиномиальная и смешанная логит-модели нормализованы по базовой категории, в качестве которой выбрана рыбалка с пляжа. Все оценки, кроме ${\beta }_{I4}$, статистически значимы на уровне значимости 5\%.

Расчет этих предельных эффектов и вероятностей требует дополнительных вычислений после оценки модели. В  условной логит-модели используется простая формула ${\overline{p}}_j\left({\delta }_{jk}-{\overline{p}}_k\right){\widehat{\beta }}_r$, где ${\overline{p}}_j$ --- средняя по выборке вероятность. Для эффекта от изменения цены на рыбалку с пляжа на вероятность выбора этого способа получим $100\times 0,113\left(1-0,113\right)\times \left(-0,021\right)=-0,21$ по сравнению со средним по выборке значением -0,272 в таблице. Это приближение становится менее разумным при приближении значений вероятностей к 0 или 1.

Результаты в таблице 15.3 являются соответствуют идеи, что наибольшая взаимозаменяемость наблюдается между рыбалкой с пристани и с пляжа, а также между рыбалкой с собственной и с арендованной лодок. А именно рост цены или снижение коэффициента вылова для рыбалки с пристани приводит к росту предпочтительности рыбалки с пляжа, и наоборот. Аналогичные выводы сохраняются и для соотношения между рыбалкой с арендованной и с собственной лодки.

\textbf{Таблица 15.3. }Выбор способа рыбалки: предельные эффекты для условной логит-модели*

\begin{tabular}{|p{0.7in}|p{0.4in}|p{0.5in}|p{0.5in}|p{0.6in}|p{0.4in}|p{0.5in}|p{0.5in}|p{0.6in}|} \hline 
 & \multicolumn{4}{|p{2.0in}|}{\textbf{Изменение цены на \$100}} & \multicolumn{4}{|p{2.0in}|}{\textbf{Изменений коэффициента вылова на единицу}} \\ \hline 
 & \textbf{с пляжа} & \textbf{с пристани} & \textbf{с собст-венной лодки} & \textbf{с арендо-\newline ванной лодки} & \textbf{с пляжа} & \textbf{с пристани} & \textbf{с собст-венной лодки} & \textbf{с арендо-ванной лодки} \\ \hline 
Изменение Pr[с пляжа] & -0,272 & 0.119 & 0,085 & 0,068 & 0,126 & -0,055 & -0,040 & -0,032 \\ \hline 
Изменение Pr[с пристани] & 0.119 & -0,263 & 0,080 & 0,064 & -0,055 & 0,122 & -0,037 & -0,030 \\ \hline 
Изменение Pr[с собственной лодки] & 0,080 & 0,080 & -0,391 & 0,225 & -0,040 & -0,037 & 0,182 & -0,105 \\ \hline 
Изменение Pr[с арендованной лодки] & 0,068 & 0,064 & 0,225 & -0,357 & -0,032 & -0,030 & -0,105 & 0,166 \\ \hline 
\end{tabular}

* Средняя предельное изменение вероятности выбора каждой из альтернатив, когда значение регрессора изменяется для одной из альтернатив и остается неизменным для остальных.

Эти изменения в вероятности выбора рассчитаны для очень больших изменений значений регрессоров. В приведенном примере средняя цена по выборке составила \$86, а средний коэффициент вылова 0,30. В некоторых случаях вместо предельных эффектов рассчитываются эластичности. Однако эластичности для вероятностей выбора следует использовать очень аккуратно, поскольку вероятности ограничены значениями от 0 до 1. Изменение в прогнозируемой вероятности с 0,01 до 0,02 приведет к значению эластичности приблизительно в 50 раз больше, чем изменение прогнозируемой вероятности с 0,50 до 0,51. 

\subsection{Мультиномиальная логит-модель: независимые от альтернатив регрессоры}

Теперь рассмотрим влияние дохода, рассчитанного как месячный доход в тысячах долларов. Из таблицы 15.1 видно, что если доход растет, то выбор способа рыбалки постепенно смещается с рыбалки с пристани, для которой средний месячный доход человека составляет \$3387, к рыбалке с арендуемой лодки, затем к рыбалке с пляжа и, наконец, к рыбалке с собственной лодки, для которой среднемесячный доход равняется \$4654.

Поскольку доход не зависит от выбранной альтернативы, подходящей является мультиномиальная логит-модель (приведенная в параграфе 15.4.1). Эта модель позволяет коэффициентам при независимых переменных изменяться в зависимости от альтернативы, а вероятность определяется как

\[p_{ij}={\Pr  \left[y_i=j\right]\ }=
\frac{{\rm exp}({\alpha }_j+{\beta }_{Ij}I_i)}
{\sum^N_{k=1}{{\rm exp}({\alpha }_k+{\beta }_{Ik}I_i)}},
\ \ \ \ \ \ \ j=1,\dots ,4,\] 

где $I$ обозначает доход. Нормализация параметров является необходимой, поскольку сумма вероятностей равна единице. Обычно выбирают ${\alpha }_1=0$ и ${\beta }_{I1}=0.$

Оценки параметров приведены в столбце MNL таблицы 15.2. Интерпретация коэффициентов осложняется по сравнению с условной логит-моделью. В частности, для мультиномиальных логит-моделей положительное значение параметра регрессии вовсе не означает, что увеличение значения регрессора приведет к увеличению вероятности выбор некоторой альтернативы. Вместо этого, интерпретация мультиномиальной логит-модели возможна относительно базовой категориальной группы, в нашем примере это рыбалка с пляжа, поскольку коэффициенты для этого исхода были нормированы к нулю. В сравнении с рыбалкой с пляжа более высокий доход ведет к снижению относительной вероятности выбора рыбалки с пристани (поскольку ${\beta }_{I2}=-0,143<0)$ или с арендованной лодки (поскольку ${\beta }_{I4}=-0,032$) и увеличению относительной вероятности выбора рыбалки с собственной лодки (поскольку ${\beta }_{I3}=0,092$).

Величина реакции на изменение дохода может быть измерена с помощью показателя $N^{-1}\sum^N_{i=1}{{\partial p_{ij}}/{\partial I_i}}$, предельного эффекта, усредненного по индивидам. Для мультиномиальных логит-моделей этот показатель оценивается с помощью $N^{-1}\sum^N_{i=1}{{\hat{p}}_{ij}(\widehat{{\beta }_j}-{\widehat{\overline{\beta }}}_i)}$ (см. (15.19)), где $\widehat{{\beta }_j}$ -- оценка параметра ${\beta }_j$, ${\overline{\beta }}_i=\sum^m_{l=1}{p_{il}{\beta }_l}$ средняя, взвешенная с помощью вероятностей, ${\beta }_l$, а ${\hat{p}}_{ij},\ j=1,\dots ,m,$ - прогнозируемые вероятности. Для четырех исходов увеличение месячного дохода на \$1000 приведет к изменению на 0,000, -0,021, 0,033 и -0,012 в вероятностях выбора соответственно рыбалки с пляжа, с пристани, с собственной лодки и с арендованной лодки. Это показывает незначительные изменения вероятности рыбалки с пляжа, отказ от рыбалки с пристани или арендуемой лодки, и рост предпочтительности рыбаки с собственной лодки. Поскольку среднемесячный доход составляет \$4100, изменения вероятности существенны.

Тем не менее, доход сам по себе не лучший показатель выбора способа рыбалки. В последних строках таблицы 15.2 видно, что значение логарифмической функции правдоподобия и псевдо-$R^2$ для мультиномиальной логит-модели значительно меньше значений для условной логит-модели. Дополнильные расчеты показывают, что для всех индивидов из выборки вероятности, прогнозируемые с помощью мультиномиальной логит, изменяются от 0,095 до 0,115 для рыбалки с пляжа, от 0,036 до 0,234 для рыбалки с пристани, от 0,240 до 0,626 для рыбалки с собственной лодки и от 0,244 до 0,416 для рыбалки с арендованной лодки. Поскольку в модель включена константа, средние значения для этих прогнозируемых вероятностей для каждого исхода равны средним вероятностям по выборке. Этот вывод для мультиномиальной логит-модели --- следствие из \eqref{GrindEQ__15_16_}.

\subsection{Смешанная логит-модель}

Более богатой получается модель, которая комбинирует две ранее описанные модели. Это  достигается при использовании так называемой смешанной логит-модели (см. параграф 15.4.1), для которой

\[{\Pr  \left[y_i=j\right]\ }=
\frac{{\rm exp}({\beta }_PP_{ij}+{\beta }_CC_{ij}+{\alpha }_j+{\beta }_{Ij}I_i)}
{\sum^4_{k=1}{{\rm exp}({\beta }_PP_{ik}+{\beta }_CC_{ik}+{\alpha }_k+{\beta }_{Ij}I_k)}}.\] 

Эта модель, не спутайте с моделью из раздела 15.7, которую также называют смешанной моделью, может быть рассмотрена как условная логит-модель, для которой

\[{\Pr  \left[y_i=j\right]\ }=
\frac{{\rm exp}({\beta }_PP_{ij}+{\beta }_CC_{ij}+\sum^4_{l=1}{({\alpha }_ld_{ijl}+{\beta }_{Il}dI_{ijl})})}
{\sum^4_{k=1}{{\rm exp}({\beta }_PP_{ik}+{\beta }_CC_{ik}+\sum^4_{l=1}{({\alpha }_ld_{ijl}+{\beta }_{Il}dI_{ijl})})}},\] 

где $d_{ijl}$ --- фиктивная переменная равная единице, если $j=l$, и нулю в обратном случае, а $dI_{ijl}=d_{ijl}I_i$ равняется доходу, если $j=l$, и нулю в обратном случае. В этом случае, строим регрессию $y_i$ от восьми регрессоров: $P_{ij},\ C_{ij},\ d_{ij2},\ d_{ij3},d_{ij4},dI_{ij2},\ dI_{ij3}$ и $dI_{ij4}.$ Поскольку ${\alpha }_1=1\ $ и ${\beta }_{l1}=0$, независимыми переменными $d_{ij1}$ и $dI_{ij1}$ опущены. 
Обратите внимание, что если мы оценим эту условную логит-модель взяв регрессорами только лишь с $d_{ijl}$ и $dI_{ijl}$, оценки условной логит-модели совпадут с оценками мультиномиальной логит-модели, приведенными ранее. Мультиномиальная логит-модель всегда может быть оценена как условная логит-модель (см. параграф 15.3.4).

Хотя смешанная логит-модель дает более содержательную оценку, чем условная логит-модель, у условной логит-модели есть следующее преимущество. Если дополнительная альтернатива будет предложена к выбору, тогда можно предсказать вероятность ее выбора, поскольку параметры условной логит-модели не изменяются в зависимости от альтернатив.

Результаты для смешанной модели приведены в последней колонке таблицы 15.2. По сравнению с первыми двумя моделями коэффициенты модели изменились не значительно, за исключением существенного изменения оценки параметра для коэффициента вылова. Это изменение обусловлено включением зависимых от альтернатив фиктивных переменных, а не переменной дохода. Смешанная логит-модель гораздо предпочтительней других моделей, поскольку имеет гораздо более высокое значение логарифмической функции правдоподобия и лучшие результаты формальных статистических тестов.

\section{ Общие выводы}

Результаты, полученные в настоящем разделе, относятся ко всем мультиномиальным моделям. Внимание в настоящей главе обращено к различным спецификациям мультиномиальной модели, используемым на практике.

\subsection{Мультиномиальные модели}

Пусть есть $m$ альтернатив, а зависимая переменная $y$ определена так, что принимает значение $j$, если выбрана $j$-ая альтернатива, $j=1,\dots ,m.$ (Некоторые авторы вместо такой постановки полагают $m+1$ альтернатив, где $j=0,\ 1,\dots ,m.$) Определим вероятность того, что выбрана альтернатива $j$

\begin{equation} 
\label{GrindEQ__15_1_} 
p_j={\Pr  \left[y=j\right]\ },\ \ \ \ \ \ \ \ \ j=1,\dots ,m. 
\end{equation} 

Введем $m$ бинарных переменных для каждого наблюдения $y$,

\begin{equation} \label{GrindEQ__15_2_} 
y_j=\left\{ \begin{array}{c}
1,\text{ если } y=j, \\ 
0,\text{ если } y\ne j. 
\end{array}
\right. 
\end{equation} 

Таким образом, $y_j$ равняется единице, если альтернатива $j$ -- наблюдаемый исход, а остальные исходы $y_k$ равняются нулю, то есть для каждого наблюдения $y$ ровно один исход из $y_1,\ y_2,\ \dots ,\ y_m$ будет иметь ненулевое значение. Тогда \textbf{функция плотности мультиномиального распределения } может быть записана как

\begin{equation} \label{GrindEQ__15_3_} f\left(y\right)=p^{y_1}_1\times \dots \times p^{y_m}_m=\prod^m_{j=1}{p^{y_j}_j}. \end{equation} 

Для регрессионных моделей введем индекс $i$ для $i$-го индивида и независимую переменную $x_i$. Запишем модель вероятности того, что индивид $i$ выберет $j$-ую альтернативу,

\begin{equation} \label{GrindEQ__15_4_} p_{ij}={\Pr  \left[y_i=j\right]\ }=F_j\left(x_i,\beta \right),\ \ \ \ \ j=1,\dots ,m,\ \ \ \ \ i=1,\dots ,N. \end{equation} 

Функциональная форма $F_j$ должна быть такой, что вероятности попадают в промежуток от 0 до 1, а сумма по $j$ равняется единице. Различные функциональные формы $F_j$ соответствуют определённым моделям, в частности мультиномиальной логит-модели, вложенной логит-модели, мультиномиальной пробит-модели, модели с упорядоченными исходами, модели с последовательными решениями и модели многомерного выбора. Эти модели описываются в последующих разделах.

\subsection{Оценка методом максимального правдоподобия}

Плотность мультиномиального распределения для одного наблюдения приведена в \eqref{GrindEQ__15_3_}. Функция правдоподобия для выборки из $N$ независимых наблюдений тогда принимает вид $L_N=\prod^N_{i=1}{\prod^m_{j=1}{p^{y_{ij}}_{ij}}},$ где индекс $i$ обозначает $i$-го из $N$ индивидов, а индекс $j$ -- $j$-ую из $m$ альтернатив. \textbf{Логарифмическая функция правдоподобия} принимает вид

\begin{equation} \label{GrindEQ__15_5_} {\mathcal L}={\ln  L_N=\sum^N_{i=1}{\sum^m_{j=1}{y_{ij}{\ln  p_{ij}\ }}}\ }, 
\end{equation} 

где $p_{ij}=F_j(x_i,\beta )$ -- функция параметра $\beta $ и независимой переменной, определенная в выражении \eqref{GrindEQ__15_4_}. В более общем случае, количество альтернатив может варьироваться в зависимости от индивида, тогда вместо $m$ альтернатив появится $m_i$ альтернатив.

Оценка параметра $\widehat{\beta }$ будет решением  условий первого порядка максимизации функции правдоподобия

\begin{equation} 
\label{GrindEQ__15_6_} 
\frac{\partial {\mathcal L}}{\partial\beta }=\sum^N_{i=1}{\sum^m_{j=1}{\frac{y_{ij}}{p_{ij}}}}\frac{\partial p_{ij}}{\partial\beta }=0,\  
\end{equation} 

которое обычно нелинейно по $\beta $. Распределение переменной $y_i$ с необходимостью является мультиномиальным, поэтому правильная спецификация процесса порождающего данные означает правильную функциональную форму $F_j(x_i,\beta )$ для вероятностей $p_{ij}$. Это обеспечивает состоятельность оценки, поскольку тогда $E\left[y_{ij}\right]=p_{ij},$ и, взяв математическое ожидание из \eqref{GrindEQ__15_6_}, получаем выражение $E\left[{\partial {\mathcal L}}/{\partial \beta }\right]=\sum^N_{i=1}{\sum^m_{j=1}{{\partial p_{ij}}/{\partial \beta }}},$ которое равняется нулю, поскольку $\sum^m_{j=0}{p_{ij}}=1.$

Применяется стандартная асимптотическая теория, а ковариационная матрица равняется обращенной и взятой с минусом информационной матрице. Продифференцировав двойную сумму из выражения \eqref{GrindEQ__15_6_} по $\beta '$ и используя $E\left[y_{ij}\right]=p_{ij}$, получим следующее упрощенное выражение

\begin{equation} 
\label{GrindEQ__15_7_} 
\widehat{\beta }\overset{a}{\sim }{\mathcal N}
\left[{\beta }_0,
{\left({\left.\sum^N_{i=1}{\sum^m_{j=1}{\frac{1}{p_{ij}}\frac{\partial p_{ij}}{\partial \beta }
\frac{\partial p_{ij}}{\partial {\beta }'}-
\frac{{\partial }^2p_{ij}}{\partial \beta \partial{\beta }'}}}\right|}_{{\beta }_0}\right)}^{-1}
\right]. 
\end{equation} 

Если наблюдения независимы по $i$, тогда нет необходимости использовать более общую форму ковариационной матрицы, поскольку данные однозначно имеют мультиномиальное распределение и равенство информационной матрицы будет сохранено.

Как уже отмечалось, различным моделям соответствуют различные формы $F_j(x_i,\beta )$ для $p_{ij}$, а, следовательно, различные выражения для \eqref{GrindEQ__15_6_} и \eqref{GrindEQ__15_7_}.

Оценивание методом максимального правдоподобия для выборок, основанных на отборе, например, в которых увеличено количество редко наблюдаемых исходов, рассматривается в разделах 14.5. и 24.4.

\subsection{ Оценка методом моментов}

Для простых случаев пространственных данных стандартным методом оценки является метод максимального правдоподобия.

Однако когда возникают осложнения, такие как эндогенность или корреляция между наблюдениями  возрастает, будет более удобно использовать \textbf{метод моментов} для оценки модели. Предполагая, что вероятности определены верно, можем рассмотреть любой метод оценивания с оценивающим уравнением

\begin{equation} 
\label{GrindEQ__15_8_} 
\sum^N_{i=1}{\sum^m_{j=1}{\left(y_{ij}-p_{ij}\right)z_i=0,}} 
\end{equation} 

где $z_i$ --- вектор той же размерности, что и $\beta $, независимый от $y_{ij},$ например, $z_i={\partial p_{ij}}/{\partial \beta }.$ Эта оценка будет состоятельной, если функциональная форма для $p_{ij}$ задана правильно, поскольку тогда $E\left[y_{ij}\right]=p_{ij}$, а математической ожидание левой часть выражения \eqref{GrindEQ__15_8_}  равно нулю. Эффективность метода будет зависеть от выбора $z_i$, и в наиболее общем случае может быть использован обобщенный метод моментов. Выражение для оценки \eqref{GrindEQ__15_8_} также является основой для симуляционного метода моментов для мультиномиальной пробит-модели (см. параграф 15.8.2).

\subsection{Зависимые от выбора альтернативы регрессоры}

Мультиномиальные модели различаются не только по принципу выбора функции $F_j(\cdot )$ в выражении \eqref{GrindEQ__15_4_}, но также и по тому, как  независимые переменные и параметры изменяются в зависимости от выбранных альтернатив.

Одна крайность представляет собой случай, когда все регрессоры являются \textbf{зависимыми от альтернатив.} Это означает, что все независимые переменные принимают разные значения при выборе различных альтернатив. Пусть $x_{ij}$ обозначает значение регрессора для индивида $i$ и альтернативы $j$, а также пусть $x_i={\left[x'_{i1}x'_{i2}\ \dots \ \ x'_{im}\right]}'.$ Тогда \eqref{GrindEQ__15_4_} обычно принимает форму

\[F_j\left(x_i,\beta \right)=F_j\left(x'_{i1}\beta ,\dots ,x'_{im}\beta \right),\] 

где параметр $\beta $ постоянен для всех альтернатив. Примером может служить условная логит-модель, описанная далее в \eqref{GrindEQ__15_10_}.

Другая крайность представляет собой случай \textbf{независимости регрессоров от альтернатив}, т.е. $x_i$ принимает постоянные значения для всех альтернатив. Примером могут послужить социально-экономические характеристики индивида в модели выбора способа транспортировки. Тогда выражение \eqref{GrindEQ__15_4_} обычно принимает форму

\[F_j\left(x_i,\beta \right)=F_j\left(x'_i\beta ,\dots ,x'_i\beta \right),\] 

где параметр ${\beta }_j$ изменяется в зависимости от альтернативы, и $\beta ={\left[{\beta }'_1{\beta }'_2\dots {\beta }'_m\right]}'.$ Идентификация параметров требует нормализации, такой как ${\beta }_1=0.$ Примером может послужить мультиномиальная  логит-модель, описанная далее в \eqref{GrindEQ__15_11_}.

Разграничение регрессоров на зависимые и независимые от альтернатив имеет практическое значение, поскольку стандартные обозначения и компьютерные программы для мультиномиальных моделей работают исключительно либо с теми, либо с другими. На практике, конечно, какие-то регрессоры могут быть зависимыми от альтернатив, а какие-то независимыми. В таком случае лучшим решением будет использование программы, созданной для зависимых от альтернатив регрессоров, поскольку тогда возможно перейти от постоянных для альтернатив регрессоров к формату зависимых от альтернатив регрессоров. Допустим $x_i$ --- вектор размера $K\times 1$. Тогда определим $x_{ij}$ как вектор размера $Km\times 1$, все элементы которого нули, кроме $j$-го блока, принимающего значение $x_i$. Тогда 

\[x_{ij}={\left[0'\dots 0' \, x'_i \, 0'\dots 0'\right]}',\] 

а также определим $\beta ={\left[0'{\beta }'_2\dots {\beta }'_m\right]}'$, где ${\beta }_1=0$ для нормализации. Тогда $x'_i{\beta }_j=x'_{ij}\beta .$ Независимые переменные по существу включены как взаимодействия с зависимыми от альтернатив фиктивными переменными. Пример приведен в параграфе 15.2.3. Также возможно перейти от зависимых от альтернатив регрессоров к формату независимых от альтернатив регрессоров, но тогда необходимо ввести $(m-1)$ выражений-ограничений на параметры модели для каждого зависимого от альтернативы регрессора.

\subsection{Данные о выявленных и заявленных предпочтениях}

Мультиномиальные данные, используемые в микроэкономических исследованиях, обычно возникают при изучении проблемы индивидуального потребительского выбора. Данные о выборе потребителя могут быть \textbf{данными о выявленных предпочтениях, } основанными на действительных решениях и выборе, или \textbf{данными о заявленных предпочтениях, }которые являются результатом ответа на вопросы о гипотетических ситуациях. Примеров выявленных предпочтений будет действительный выбор некоторой профессии. Примером заявленных предпочтений будут результаты маркетингового исследования по поводу выбора топливосберегающего транспортного средства, в котором респондентам предложено выбрать между гипотетическими транспортными средствами, которые различаются по своим характеристикам, таким как потребление топлива, комплектация и цена.

Данные о выявленных предпочтениях часто содержат очень мало или не содержат вообще данных об альтернативах, которые не были выбраны. Например, мы можем знать цену выбранного отдельным потребителем продукта, но не будем знать цены на альтернативные продукты. Привлекательность данных о заявленных предпочтениях для мультиномиальных моделей заключается в том, что доступны данные по ключевым переменными, таким как цена, для всех возможных альтернатив. Это в частности является большим преимуществом, если необходимо спрогнозировать вероятность выбора или доли рынка новой альтернативы на основе ее характеристик, поскольку все параметры могут быть постоянными для альтернатив, а значения регрессоров изменяться в зависимости от альтернатив.

Существую споры по поводу использования данных о заявленных предпочтениях, поскольку результаты могут зависеть от формулировки вопросов. Более того, люди могут преувеличивать или преуменьшать свою готовность платить в поддержку конкретной политики. Например, некоторые могут преувеличивать свои запросы, чтобы поддержать политику бережного отношения к окружающей среде. 

\textbf{Данные о сканированных штрих кодах} в магазине являются особенно привлекательными, потому что они дают доступ к данным о выявленных предпочтениях, тогда как данные о ценах на все альтернативы также доступны.

\subsection{Оценивание и выбор модели}

Параметры регрессии в мультиномиальных моделях могут трудно поддаваться интерпретации. Несмотря на это, полезно рассмотреть предельный эффект (или эластичности) от изменения значения регрессора на вероятность исхода. Формулы для условной и мультиномиальной логит-моделей приведены в параграфе 15.4.3 и используются в разделе 15.2.

Некоторые методы оценивания качества модели приведены в работах Амэмии (1981) и Маддалы (1983). Меры похожие на $R^2$, т.е. основанные на аналоге квадратов остатков, работают в этом случае плохо. Сравнение прогнозируемых вероятностей с реальными исходами имеет ограниченное применение, поскольку в мультиномиальных моделях с константой обязательно средняя прогнозируемая вероятность равняется той же средней выборочной вероятности для каждой альтернативы. Было бы полезно взглянуть на диапазон вероятностей для каждой альтернативы внутри выборки. Чем шире диапазон, тем более содержательный характер имеет модель. Для более подробной информации обратитесь к обсуждению этого вопроса в параграфе 14.3.7 для случая бинарных данных.

Обычно оценка параметров мультиномиальных моделей происходит методом максимального правдоподобия. Тогда, при условии, что модели являются вложенными, может быть использован стандартный тест отношения правдоподобия. Если модели являются невложенными, тогда возможно использовать варианты информационного критерия Акаике, основанного на соответствующей логарифмической функции правдоподобия с корректировкой на число степеней свободы, равное количеству параметров в модели (см. параграф 8.5.1).

Полезный показатель псевдо-$R^2$, предложенный МакФадденом (1973), имеет вид

\begin{equation} \label{GrindEQ__15_9_} 
R^2=1-{{\ln  L_{fit}\ }}/{{\ln  L_0\ },} 
\end{equation} 

где ${\ln  L_{fit}\ }$ обозначает изучаемую модель, а $L_0$ обозначает модель только с константой, которая оценивает вероятность выбора каждой альтернативы  средним по выборке. Для любой мультиномиальной модели теоретическое максимальное значение логарифмической функции правдоподобия равно нулю. Такая ситуация возникает, если $p_{ij}=1$, когда $y_{ij}=1$ и $p_{ij}=0$, в других случаях для $i$ и $j$. Таким образом, можно также предложить показатель $R^2$ равный

\[R^2=\frac{{\ln  L_{fit}\ }-{\ln  L_0\ }}{{\ln  L_{max}\ }-{\ln  L_0\ }}.\] 

Этот показатель можно интерпретировать как долю от максимального потенциального прироста логарифмической функции правдоподобия, полученную при использовании соответствующей модели (см. параграф 8.7.1).

\section{Мультиномиальная логит-модель}

Простейшей мультиномиальной моделью является мультиномиальная логит-модель, предложенная Люсом (1959). Варианты этой модели, которые обычно используются, различаются по принципу зависимости или независимости значений регрессоров от альтернатив. Многие из вопросов, рассмотренных в настоящем разделе, относятся и к другим моделям, представленным в последующих разделах.

\subsection{Условная, мультиномиальная и смешанная логит-модели}

В случае зависимости значений регрессоров от выбираемых альтернатив (см. параграф 15.3.4) используется \textbf{условная логит-модель}. Согласно этой модели

\begin{equation} \label{GrindEQ__15_10_} p_{ij}=\frac{e^{x'_{ij}\beta }}{\sum^m_{l=1}{e^{x'_{il}\beta }}},\ \ \ \ \ \ \ \ j=1,\dots ,m. \end{equation} 

Поскольку ${\exp  \left(x'_{il}\beta \right)\ }>0$, вероятности попадают в промежуток от нуля до единицы, а их сумма по $j$ равна единице. Действительно, стоит один раз осмыслить формулу \eqref{GrindEQ__15_10_}, кажется, что она является наиболее простым определением, которое гарантирует требуемые вероятностные свойства. Поскольку $\sum^m_{i=1}{p_{ij}}=1$, эквивалентную модель можно получить, определив $x_{ij}$ как отклонение регрессора от значения регрессора для первой альтернативы, и скажем, установив $x_{i1}=0.$

Если, наоборот, регрессоры постоянны для всех альтернатив, то используется \textbf{мультиномиальная логит-модель}. Согласно этой модели

\begin{equation} \label{GrindEQ__15_11_} p_{ij}=\frac{e^{x'_i{\beta }_j}}{\sum^m_{l=1}{e^{x'_i{\beta }_l}}},\ \ \ \ \ \ \ \ j=1,\dots ,m. \end{equation} 

Поскольку $\sum^m_{i=1}{p_{ij}}=1,$ необходимо наложить ограничение,  чтобы обеспечить идентификацию модели, в качестве которого обычно выступает ${\beta }_1=0.$

Две обозначенные модели могут быть скомбинированы в модель, которую некоторые авторы называют \textbf{смешанной логит-моделью, }для которой

\begin{equation} \label{GrindEQ__15_12_} p_{ij}=\frac{e^{x'_{ij}\beta +w'_i{\gamma }_j}}{\sum^m_{l=1}{e^{x'_{il}\beta +w'_i{\gamma }_l}}},\ \ \ \ \ \ \ \ j=1,\dots ,m, \end{equation} 

где $x_{ij}$ изменяются в зависимости от альтернатив, а $w_i$ не изменяются в зависимости от альтернатив. Как рассматривалось в параграфах 15.2.3 и 15.3.4., смешанная и мультиномиальная логит-модели могут быть представлены как условная логит-модель. Обратите внимание, что термин смешанная логит-модель также иногда используется для совершенно другой модели, которая подробно рассмотрена в разделе 15.7.

Всем этим моделям можно дать общее название мультиномиальных логит-моделей, однако, мы будем следовать стандартной договоренности о различении мультиномиальной и условной логит-моделей.

Очевидным обобщением мультиномиальной логит-модели является

\begin{equation} \label{GrindEQ__15_13_} p_{ij}=\frac{V_{ij}}{\sum^m_{l=1}{V_{il}}},\ \ \ \ \ \ \ \ j=1,\dots ,m, \end{equation} 

где $V_{ij}>0$ может быть довольно произвольной функцией регрессора $x_i$ и параметра $\beta $. Такая модель называется \textbf{универсальной логит-моделью.} И хотя, из этой модели можно вывести обширный класс моделей, она редко используется в эконометрике, поскольку не возникает естественным образом из теории выбора.

\subsection{ММП для смешанной и множественной логит-моделей}

Здесь будут представлены ключевые формулы для условной и мультиномиальной логит-моделей. Полные доказательства приведены в разделе 15.12.

Для условной логит-модели, для которой $p_{ij}$ определяется по формуле \eqref{GrindEQ__15_10_}, ${\partial p_{ij}}/{\partial \beta }=p_{i??}\left(x_{ij}-{\overline{x}}_i\right),$  где ${\overline{x}}_i=\sum^m_{l=1}{p_{il}x_{il}}$ -- среднее значение регрессоров, взвешенное с помощью вероятностей (см. параграф 15.12.1). Условие первого порядка максимизации функции правдоподобия для условной логит-модели, представленное в выражении \eqref{GrindEQ__15_6_} для общего $p_{ij}$, упрощается непосредственно до

\begin{equation} \label{GrindEQ__15_14_} \sum^N_{i=1}{\sum^m_{j=1}{y_{ij}\left(x_{ij}-{\overline{x}}_i\right)=0.}} \end{equation} 

Продифференцировав это выражение по $\beta '$, используя $E\left[y_{ij}\right]=p_{ij}$ и произведя некоторые алгебраические преобразования, получаем

\begin{equation} \label{GrindEQ__15_15_} {\widehat{\beta }}_{CL}\overset{a}{\sim }
{\mathcal N}\left[\beta ,\ {\left(\sum^N_{i=1}{\sum^m_{j=1}{p_{ij}}}\left(x_{ij}-{\overline{x}}_i\right)\left(x_{ij}-{\overline{x}}_i\right)'\right)}^{-1}\right]. \end{equation} 

Для мультиномиальной модели $p_{ij}$ определяется по формуле \eqref{GrindEQ__15_11_}, а в параграфе 15.12.2 показано, что ${\partial p_{ij}}/{\partial {\beta }_k}=p_{ij}\left({\delta }_{ijk}-p_{ik}\right)x_i,$ где ${\delta }_{ijk}$ переменная-индикатор, равная единице, если $j=k$, и равная нулю, если $j\ne k.$ Тогда, после некоторых алгебраических преобразований, получаем условие первого порядка максимизации функции правдоподобия для мультиномиальной логит-модели

\begin{equation} \label{GrindEQ__15_16_} \frac{\partial {\mathcal L}}{\partial {\beta }_k}=\sum^N_{i=1}{\left(y_{ik}-p_{ik}\right)x_i=0,\ \ \ \ \ \ \ \ \ k=1,\dots ,m.} \end{equation} 

В обычном случае${\widehat{\beta }}_{CL}\overset{a}{\sim }
{\mathcal N}\left[\beta ,\ {\left(E\left[{{\partial }^2{\mathcal L}}/{\partial\beta \partial{\beta }'}\right]\right)}^{-1}\right],$ для которой после некоторых алгебраических преобразований получаем $j$-ый блок информационной матрицы

\begin{equation} \label{GrindEQ__15_17_} E\left[\frac{{\partial }^2{\mathcal L}}{\partial {\beta }_j\partial {\beta }'_k}\right]=\sum^N_{i=1}{p_{ij}\left({\delta }_{ijk}-p_{ik}\right)x_ix'_i},\ \ \ \ \ \ \ \ \ j=1,\dots ,m,\ \ k=1,\dots ,m. \end{equation} 

\subsection{Интерпретация параметров регрессии}

Необходимо проявлять осторожность при интерпретации параметров любой нелинейной модели. Это, в частности, относится и к мультиномиальным моделям, для которых, например, совершенно необязательно соответствие между знаком коэффициента и вероятностью. В настоящем параграфе будут представлены утверждения, используемые в примере из раздела 15.2.

\subsubsection*{Предельные эффекты и эластичности}

Сосредоточимся на рассмотрении \textbf{предельных эффектов} на вероятности выбора при изменении значения регрессора для заданного индивида. \textbf{Эластичности } могут быть рассчитаны путем умножения предельного эффекта на значение соответствующего регрессора и деления на вероятность. Обычно эти показатели далее усредняются по индивидам для получения среднего предельного эффекта или среднего значения эластичности.

Для условной логит-модели определим предельный эффект как изменение $j$-ой вероятности на единицу изменения значения регрессора для $k$-ой альтернативы. Например, какой эффект произведет на вероятность выбора различных способов транспортировки увеличение времени путешествия на автобусе на одну минуту, если время путешествия другими видами транспорта останется неизменным? Из параграфа 15.12.1

\begin{equation} \label{GrindEQ__15_18_} \frac{\partial p_{ij}}{\partial x_{ik}}=p_{ij}\left({\delta }_{ijk}-p_{ik}\right)\beta , \end{equation} 

где ${\delta }_{ijk}$ определено после \eqref{GrindEQ__15_15_}. Отсюда следует, что, если коэффициенты регрессии положительны, тогда увеличение соответствующего  регрессора для $k$-ой альтернативы увеличивает вероятность выбора $k$-ой альтернативы и снижает вероятность выбора других альтернатив.

Для мультиномиальной модели, наоборот, определим предельный эффект на $j$-ую вероятность от изменения на единицу значения регрессора, который принимает одинаковые значения для всех альтернатив. Например, какой эффект на вероятность принятия решения работать производит увеличение возраста на один год? Из параграфа 15.22.2

\begin{equation} \label{GrindEQ__15_19_} \frac{\partial p_{ij}}{\partial x_i}=p_{ij}\left({\beta }_j-{\overline{\beta }}_i\right), \end{equation} 

где ${\overline{\beta }}_i=\sum_l{p_{il}}{\beta }_l$ -- среднее значение ${\beta }_l$, взвешенное с помощью вероятностей. Отсюда следует, что знак эффекта необязательно будет совпадать со знаком ${\beta }_j$, за исключением случая, когда ${\beta }_j>{\beta }_k$ для всех $k\ne j,$. Необязательно есть какой-то смысл в проверке равенства нулю некоторого коэффициента. Как и для других нелинейных моделей мы можем рассчитать среднее значение эффекта по формуле $N^{-1}\sum_i{{\partial p_{ij}}/{\partial x_i}}=\sum_i{p_{ij}\left({\beta }_j-{\overline{\beta }}_i\right),}$ или мы можем применить неаналитические методы и сравнить изменения в среднем значении вероятности в зависимости от изменения независимой переменной.

Сравнение с базовой категорией

Коэффициенты условной и мультиномиальной логит-моделей могут быть более точно интерпретированы также как и коэффициенты логит-модели, в терминах относительного риска (см. параграф 14.3.4). Это  возможно, поскольку эти модели могут быть представлены как логит-модели бинарного выбора.

Для мультиномиальной логит-модели сравнение проводится с базовой категорией, которой является нормализованная альтернатива с коэффициентом равным нулю. Чтобы увидеть это, отметим, что вероятности в мультиномиальной логит-модели \eqref{GrindEQ__15_11_} приводят к тому, что условная вероятность наблюдения альтернативы $j$, если  наблюдается альтернатива $j$ или $k$, принимает вид

\[{\Pr  [y=j | y=j\text{ или } k]\ }=\frac{p_j}{p_j+p_k}\] 

\begin{equation} \label{GrindEQ__15_20_} =\frac{e^{x'{\beta }_j}}{e^{x'{\beta }_j}+e^{x'{\beta }_k}} \end{equation} 

\[=\frac{e^{x'({\beta }_j-{\beta }_k)}}{1+e^{x'({\beta }_j-{\beta }_k)}},\] 

то есть вид логит-модели с коэффициентами$({\beta }_j-{\beta }_k)$. Вторая строка уравнения получается после некоторых упрощений. Предположим, что нормализации подверглась альтернатива 1, тогда ${\beta }_1=0.$

Тогда

\[{\Pr  \left[y_i=j\mathrel{\left|\vphantom{y_i=j y_i=j\text{ или } k}\right.\kern-\nulldelimiterspace}y_i=j\text{ или } k\right]\ }=\frac{e^{x'_i{\beta }_j}}{1+e^{x'_i{\beta }_j}},\] 

а параметр ${\beta }_j$ может быть интерпретирован по аналогии с коэффициентами логит-модели бинарного выбора между альтернативами $j$ и 1. Аналогично бинарной логит-модели \textbf{относительные шансы} выбора альтернативы $j$, а не альтернативы 1, составит

\[\frac{{\rm Pr}[y_i=j]}{{\rm Pr}[y_i=1]}=e^{x'_i{\beta }_j},\] 

а, следовательно, $e^{{\beta }_{jr}}$ позволяет оценить пропорциональное изменение значения отношения шансов, когда $x_{ir}$ изменяется на единицу. Такая интерпретация будет зависеть от того, какая альтернатива была выбрана для нормализации и имеет коэффициент, равный нулю. Для такой интерпретации, чтобы она была действительно полезной, необходимо определить естественную \textbf{базовую категорию}. Например, если изучаются способы поездки на работу, альтернативные поездке на автомобиле, тогда следует нормализовать коэффициенты этой альтернативы и приравнять их нулю. 

Аналогичный подход может быть также применен и к условной логит-модели, для которой 

\begin{equation} \label{GrindEQ__15_21_} {\Pr  \left[y_i=j\mathrel{\left|\vphantom{y_i=j y_i=j\text{ или } k}\right.\kern-\nulldelimiterspace}y_i=j\text{ или } k\right]\ }=\frac{e^{(x_{ij}-x_{ik})'\beta }}{1+e^{(x_{ij}-x_{ik})'\beta }}, \end{equation} 

а нормализация осуществляется по отношению к значению регрессора базовой категории.

\subsection{Независимость от посторонних альтернатив}

Ограниченность условной и мультиномиальной логит-моделей состоит в том, что различие между $m$ альтернативами сводится к серии попарных сравнений, которые не зависят от характеристик прочих альтернатив, кроме пары, находящейся в рассмотрении. Это очевидно из \eqref{GrindEQ__15_20_} и \eqref{GrindEQ__15_21_}, которые показывают, что мультиномиальная логит-модель сводится к логит-модели бинарного выбора между любой из пар. Условная вероятность не зависит от других альтернатив. 

Примером может послужить ситуация, когда условная вероятность выбора поездки на работу на машине, а не  на красном автобусе, в мультиномиальной или условной логит-модели, будет независима от наличия возможности ездить на синем автобусе. Тем не менее, на практике мы будем ожидать, что включение возможности поездки на синем автобусе, которая во всех аспектах совпадает с поездкой на красном автобусе, за исключением цвета автобуса, не будет оказывать большого влияния на предпочтение поездки на машине и сократит вдвое использование красного автобуса, приводя тем самым к увеличению относительной условной вероятности использования машины, предполагая наличие возможности ездить на машине или на красном автобусе.

Эта слабость мультиномиальной логит-модели известна в литературе как парадокс красного и синего автобуса или, более формальным языком, как предпосылка \textbf{независимости от посторонних альтернатив}. Она может быть проверена при помощи теста Хаусмана (см. работу Хаусмана и МакФаддена, 1984). Например, мы можем сравнить оценки коэффициентов для вероятности выбора поездки на красном автобусе в модели выбора с тремя альтернативами -- поездкой на автомобиле, красном или синем автобусе, с поездкой на машине в качестве базовой категории, с оценками коэффициентов для вероятности выбора поездки на красном автобусе для модели бинарного выбора между поездкой на машине или красном автобусе, снова с поездкой на машине в качестве базовой категории.

Большинство литературы по эконометрике обращено к альтернативным моделям с неупорядоченными исходами, в которых данный недостаток отсутствует. Эти модели представлены в разделах 15.6-15.8.

\section{Аддитивные модели случайной полезности}

Мультиномиальные модели с неупорядоченными исходами, которые являются более общими, чем мультиномиальная и условная логит-модели, могут быть получены с использованием общей структуры аддитивных моделей случайной полезности, представленной в настоящем разделе. В последующих разделах будут описаны основные примеры таких моделей.

\subsection{Модель ARUM}

\textbf{Аддитивная модель случайной полезности} (ARUM, additive random utility model) была введена в параграфе 14.4.2 для случая проблемы бинарного выбора. В общей мультиномиальной модели с $m$ альтернатив полезность $j$-ой альтернативы будет задана как

\begin{equation} \label{GrindEQ__15_22_} U_j=V_j+{\varepsilon }_j,\ \ \ \ \ \ \ \ j=1,2,\dots ,m, \end{equation} 

где $V_j$ обозначает детерминированный компонент полезности, а ${\varepsilon }_j$ --- случайный компонент полезности. Обычно для $i$-го индивида $V_{ij}=x'_{ij}\beta $ или $V_{ij}=x'_i{\beta }_j,$ тем не менее, структурный анализ может указать на явную или неявную функцию полезности, используемую в теории потребительского спроса. Для простоты обозначения в дальнейшем мы избавимся от индивидуального индекса $i$.

Выбранной становится альтернатива с наибольшей полезностью, то есть

\begin{equation} \label{GrindEQ__15_23_} {\Pr  \left[y=j\right]\ }={\Pr  \left[U_j\ge U_k,\text{ для всех } k\ne j\right]\ } \end{equation} 

\[={\Pr  \left[U_k-U_j\le 0,\text{ для всех } k\ne j\right]\ }\] 

\[={\Pr  \left[{\varepsilon }_k-{\varepsilon }_j\le V_j-V_k,\text{ для всех } k\ne j\right]\ }\] 

\[={\Pr  \left[{\widetilde{\varepsilon }}_{kj}\le {-\tilde{V}}_{kj},\text{ для всех } k\ne j\right],\ }\] 

где тильда и второй индекс $j$ обозначают разницу по отношению к базовой альтернативе $j$.

% здесь :)
Различные мультиномиальные модели могут быть построены в зависимости от различных предположений о совместном распределении случайных ошибок. Эти модели являются корректными статистически, с суммой вероятностей по всем альтернативам, равной единице. Кроме того, они согласуются со стандартной экономической теорией принятия решений.

Например, рассмотрим выражение ${\rm Pr}[y=1]$ для модели выбора с тремя альтернативами. Используя последнее равенство из выражения \eqref{GrindEQ__15_23_} и определив ${\widetilde{\varepsilon }}_{31}={\varepsilon }_3-{\varepsilon }_1$ и ${\widetilde{\varepsilon }}_{21}={\varepsilon }_2-{\varepsilon }_1$, получим

\begin{equation} \label{GrindEQ__15_24_} {\Pr  \left[y=1\right]\ }={\Pr  \left[{\widetilde{\varepsilon }}_{21}\le -{\tilde{V}}_{21},\ \ {\widetilde{\varepsilon }}_{31}\le -{\tilde{V}}_{31}\right]\ } \end{equation} 

\[=\int^{-{\tilde{V}}_{31}}_{-\infty }{\int^{-{\tilde{V}}_{21}}_{-\infty }{f({\widetilde{\varepsilon }}_{21},{\widetilde{\varepsilon }}_{31})d{\widetilde{\varepsilon }}_{21}d{\widetilde{\varepsilon }}_{31}}},\] 

то есть двумерный интеграл, который обычно не имеет аналитического решения. Более общая модель выбора с $m$ альтернативами предполагает $(m-1)$-мерный интеграл, для которого может быть, а может и не быть получено аналитическое решение для ${\Pr  \left[y=j\right]\ }.$

В общем случае все ошибки ${\varepsilon }_1,{\varepsilon }_2,\ \dots ,{\varepsilon }_m$ могут коррелировать между собой. Необходимо наложить ряд \textbf{ковариационных ограничений}, поскольку модель \textbf{идентифицируется} только с точностью до $(m-1)$  разниц между ошибками (см. последнее равенство в выражении (15.23)), и дополнительно одна дисперсия должна быть специфицирована, поскольку $U_j$ определяется только с точностью до масштаба.

\subsection{Различные  мультиномиальные модели с неупорядоченными исходами}

Различные мультиномиальные модели с неупорядоченными исходами возникают в зависимости от предположений о совместном распределении ошибок ${\varepsilon }_1,{\varepsilon }_2,\ \dots ,{\varepsilon }_m$. Анализ получается наиболее простым, если предположения об ошибках приводят к получению аналитического решения для вероятностей выбора. Тем не менее, во многих приложениях подобные допущения принимают слишком ограничительный характер.

Вычислительно интенсивные методы, приведенные в главе 12 позволяют оценить модель, даже если отсутствует аналитическое решение для вероятностей выбора. В параграфах 15.7.2 и 15.8.2 приведены примеры использования этих методов в случае мультиномиальных данных.

Ошибки, имеющие распределение экстремальных значений первого типа

Сначала допустим, что ${\varepsilon }_j$ -- независимые одинаково распределенные случайные величины, имеющие распределение экстремальных значений первого типа с плотностью распределения

\begin{equation} \label{GrindEQ__15_25_} f\left({\varepsilon }_j\right)=e^{-{\varepsilon }_j}{\exp  \left(-e^{-{\varepsilon }_j}\right)\ },\ \ \ \ \ \ \ \ j=1,2,\dots ,m. \end{equation} 

Свойства этой функции плотности были описаны в параграфе 14.4.2, где было показано что из нее следует логит-модели для случая бинарных исходов.

Для случая множественных исходов, для моделирования которых используется ARUM со случайными ошибками, имеющими распределение экстремальных значений первого типа, может быть показано, что \eqref{GrindEQ__15_23_} дает

\begin{equation} \label{GrindEQ__15_26_} {\Pr  \left[y=j\right]\ }=\frac{e^{V_j}}{e^{V_1}+e^{V_2}+\dots +e^{V_m}}. \end{equation} 

Это условная логит-модель, когда $V_j=x'_j\beta $, или мультиномиальная логит-модель, когда $V_j=x'{\beta }_j.$ Результат может быть получен путем либо интегрирования и упрощения аналогично случаю бинарных данных (см. раздел 14.8), либо как частный случай результата вложенной логит-модели, полученный в разделе 15.6. Таким образом, условная и мультиномиальная логит-модели могут быть получены из модели ARUM.

Допущение о том, что ошибки ${\varepsilon }_j$ независимы по альтернативам $j$, является слишком ограничительным, поскольку вполне вероятно может быть нарушено, если две альтернативы похожи. Например, предположим, что альтернативы 1 и 2 похожи. Низкое значение ${\varepsilon }_1$ (т.е. большое по модулю и отрицательное) приведет к переоценке полезности альтернативы 1. Тогда, также можно ожидать переоценки полезности альтернативы 2, поэтому ${\varepsilon }_2$ также принимает низкое значение. Поскольку низкие значения для ${\varepsilon }_1$ и ${\varepsilon }_2$, как правило, случаются одновременно, что аналогично и для высоких значений, ошибки должны коррелировать. Это другой способ рассмотрения проблемы красного и синего автобуса, а также проявление невыполнения допущения логит-моделей о независимости от посторонних альтернатив.

Обобщенная модель на базе распределения экстремальных значений и вложенная логит-модель (см. раздел 15.6) смягчают допущение о том, что ошибки, имеющие распределение экстремальных значений независимы по альтернативам. Ошибки сгруппированы так, что наблюдается независимость между группами ошибок, но допускается наличие корреляции между ошибками внутри одной группы. Тогда становится доступным получение аналитического решения для вероятностей выбора. И хотя эти модели намного богаче, чем мультиномиальная логит-модель, являющейся частным случаем  отсутствия корреляции ошибок внутри группы, во многих приложениях группировка ошибок происходит в некотором смысле произвольно.

В логит-модели со случайными параметрами (см. раздел 15.7) в мультиномиальную логит-модель вводится дополнительная хаотичность, которая вызывает корреляцию между полезностями разных альтернатив. Такая модель является примером обобщенной модели случайной полезности (см. параграф 15.7.3).

Ошибки, имеющие нормальное распределение

Мультиномиальная пробит-модель (см. раздел 15.8) возникает, если полагается, что ошибки ${\varepsilon }_1,\dots ,{\varepsilon }_m$ имеют совместное нормальное распределение. Такое предположение является более естественным, чем предположение о распределении экстремальных значений первого типа для ошибок. Это позволяет допустить очень богатую структуру корреляции между ошибками за счет необходимости применения численных или симуляционных методов, с помощью которых находится значение $(m-1)$-мерного нормального интеграла.

\subsection{Согласованность с моделями случайной полезности}

Довольно легко предъявить аналитическое выражение для вероятности выбора, которая лежит между нулем и единицей, а их сумма по альтернативам равна единице. Более или менее общим примером является универсальная логит-модель в выражении \eqref{GrindEQ__15_13_}. В эконометрической литературе особое значение придается  мультиномиальным моделям, которые согласовываются с максимизацией функции случайной полезности. Этот случай аналогичен ограничению анализа функции спроса, которая согласуется с теорией потребительского выбора. 

Пусть $V=\left(V_1,\dots ,V_m\right).$ Из работы Борша-Супана (1987, стр. 19), набор вероятностей выбора $p_j\left(V\right),\ =1,\dots ,m,$ совместим с максимизацией в ARUM, если выполняется

\begin{enumerate}
\item  $p_j\left(V\right)\ge 0,\ \sum^m_{j=1}{p_j\left(V\right)=1}$, и $p_j(V)=p_j(V+\alpha )$для всех $\alpha \in R$;

\item  ${\partial p_j(V)}/{\partial V_k}={\partial p_k(V)}/{\partial V_j}$; и

\item  ${{\partial }^{\left(m-1\right)}p_j(V)}/{\partial V_1\dots \left[\partial V_i\right]\dots \partial V_m\ge 0,}$ где квадратные скобки обозначают пропускаемый элемент.
\end{enumerate}

Эти условия, сформулированные Уильямсом (1977), Дэйли и Закари (1979) и МакФадденом (1981), обеспечивают соответственно (1) хорошее поведение вероятностей и инвариантность к смещению; (2) интегрируемость $p_j$ аналогично условию Слуцкого; (3) функция распределения ошибок в соответствующей ARUM модели имеет собственную (неотрицательную) функцию плотности.

\subsection{Анализ благосостояния}

Основным преимуществом использования мультиномиальных моделей, к которым относится модель случайной полезности, является то, что они позволяют произвести анализ благосостояния. Тогда эффект от изменения одной или более детерминант выбора, таких как цена или время в пути в ситуации выбора способа транспортировки, может быть оценен в денежном эквиваленте.

В стандартном \textbf{анализе благосостояния} используется компенсирующая или эквивалентная вариация дохода. Детерминированная компонента полезности из выражения \eqref{GrindEQ__15_22_} задается как косвенная функция полезности

\begin{equation} \label{GrindEQ__15_27_} V_j=V\left(I-p_j,x_j\right), \end{equation} 

где $I$ обозначает доход, $p_j$ -- цена $j$-ой альтернативы, а $x_j$ --- характеристики $j$-ой альтернативы. Для простоты обозначения неизвестный параметр регрессии $\beta $ опущен. Тогда полезность альтернативы $j$ будет определяться по формуле

\begin{equation} \label{GrindEQ__15_28_} U_j=U\left(I-p_j,x_j,{\varepsilon }_j\right)=V\left(I-p_j,x_j\right)+{\varepsilon }_j. \end{equation} 

Предположим, что значение некоторой характеристики изменилось с $x'_j$ на $x''_j$. Тогда \textbf{компенсирующая вариация дохода } $CV$ --- это изменение в доходе, необходимое для поддержания полезности на начальном уровне. Таким образом, наивысший уровень полезности, достижимый при доходе $I$ и значении характеристики $x'_j$, должен быть равен наивысшему уровню полезности, достижимой при уровне дохода $(I-CV)$ и значении характеристики $x''_j$. Тогда компенсирующая вариация $CV$ неявным образом определяется как решение уравнения 

\begin{equation} \label{GrindEQ__15_29_} {\mathop{\max }_{j=1,\dots ,m} U\left(I-p_j,x_j,{\varepsilon }_j\right)=\ }{\mathop{\max }_{j=1,\dots ,m} U\left(I-CV-p_j,x''_j,{\varepsilon }_j\right).\ } \end{equation} 

В качестве примера рассмотрим модель выбора с двумя альтернативами, для которой $U_j=I+x_j+{\varepsilon }_j,\ j=1,2,$ а скалярная величина $x_j$ изменяет свое значение с $x'_j$ на $x''_j$. Тогда возможны четыре ситуации. Если альтернатива 1 выбирается как до, так и после изменения характеристики, тогда $CV=\left(x''_1-x'_1\right),$ поскольку $U''_1=I-CV+x''_1+{\varepsilon }_1=I+x'_1+{\varepsilon }_1=U'_1.$ Аналогично, если альтернатива 2 выбирается до и после изменения характеристики, тогда $CV=\left(x''_2-x'_2\right).$ Если происходит переключение с альтернативы 1 к альтернативе 2, тогда $U''_2=U'_1$ означает $I-CV+x''_2+{\varepsilon }_2=I+x'_1+{\varepsilon }_1,$ отсюда $CV=x''_2-x'_1+{\varepsilon }_2-{\varepsilon }_1.$ Аналогично, если происходит переключение с альтернативы 2 к альтернативе 1, тогда $CV=x''_1-x'_2+{\varepsilon }_1-{\varepsilon }_2.$ В более общем смысле, для $m$ альтернатив компенсирующая вариация определяется как $CV_{jk}=V''_k-V'_j+{\varepsilon }_k-{\varepsilon }_j$, если изменение значения $x$ приводит к переключению с альтернативы $j$ к альтернативе $k.$

Компенсирующая вариация дохода зависит от наблюдаемых переменных $(I,\ p_j,$ и $x_j)$,  параметров, который можно оценить, и от ненаблюдаемых ошибок ${\varepsilon }_j.$ Ненаблюдаемые ошибки устраняются путем расчета ожидаемого значения компенсирующей вариации $E\left[CV\right],$ которое включает интегрирование по ${\varepsilon }_j$. Из предыдущего примера должно быть очевидным, что такое интегрирование может быть достаточно сложным. В работе Дагсвика и Карлстрёма (2004) приведены достаточно общие результаты по этому поводу, которые будут обсуждаться далее в параграфе 15.6.5.

Для некоторых моделей не существует аналитического решения для $E\left[CV\right].$ Тогда необходимо найти интеграл функции $CV$, определенной по формуле \eqref{GrindEQ__15_19_}, по ${\varepsilon }_j$, используя численные методы. Как описано в параграфе 12.3.2 значение этого интеграла может быть найдено следующим образом:

\begin{enumerate}
\item  На итерации $s$ сгенерировать ${\varepsilon }^s$ из распределения $\varepsilon =\left({\varepsilon }_1,\dots ,{\varepsilon }_m\right).$

\item  Найти $CV^s$ из уравнения $\underset{j=1,\dots ,m}{\max } 
U\left(I-p_j,x_j,{\varepsilon }_j\right)=
\underset{j=1,\dots ,m}{\max } U\left(I-CV^s-p_j,x''_j,{\varepsilon }_j\right).\ $

\item  Повторить шаги $1$ и 2 $S$ раз.

\item  Оценить $E[CV]$ как $S^{-1}\sum^S_{t=1}{CV^t}.$
\end{enumerate}

Этот метод позволяет получить $E\left[CV\right]$ для каждого индивида в выборке. Усреднение, возможно со взвешиванием, дает оценку по генеральной совокупности. Приложение моделей с ошибками, имеющими распределение экстремальных значений первого типа обсуждаются в параграфе 15.6.5.

\section{Вложенная логит-модель}

Вложенная логит-модель является наиболее легко поддающимся аналитической трактове обобщением мультиномиальных моделей. Она является идеальной моделью, когда присутствует явная структура вложения, однако не все случаи множественного выбора имеют очевидную структуру вложения. 

\subsection{Модель с ошибками, имеющими обобщенное распределение экстремальных значений}

МакФадден (1978) предложил достаточно общий класс моделей, основанных на предположении, что совместным распределением ошибок является \textbf{обобщенное распределение экстремальных значений (ОРЭЗ) } с совместной функцией распределения 

\begin{equation} 
\label{GrindEQ__15_30_} 
F\left({\varepsilon }_1,{\varepsilon }_2,\dots ,{\varepsilon }_m\right)={\exp  \left[-G\left(e^{-{\varepsilon }_1},e^{-{\varepsilon }_2},\dots ,e^{-{\varepsilon }_m}\right)\right]\ }, 
\end{equation} 

где функция $G(Y_1,Y_2,\dots ,Y_m)$ выбрана так, что она удовлетворяет набору допущений, таких как неотрицательность, однородность первой степени, имеет смешанные частные производные, которые являются непрерывными и неположительными для четного и неотрицательными для нечетного порядка, а ${\mathop{\lim }_{Y_{j\to \infty }} G\left(Y_1,Y_2,\dots ,Y_m\right)=\infty .\ }$ Эти предположения обеспечивают то, что совместное распределение и финальные частные распределения будут корректно определены, а сумма вероятностей составит единицу. 

Если ошибки имеют ОРЭЗ, тогда явные значения для вероятностей в модели случайной полезности \eqref{GrindEQ__15_22_} могут быть получены из

\begin{equation} \label{GrindEQ__15_31_} p_j={\Pr  \left[y=j\right]\ }=e^{V_j}\frac{G_j(e^{-V_1},e^{-V_2},\dots ,e^{-V_m})}{G(e^{-V_1},e^{-V_2},\dots ,e^{-V_m})}, \end{equation} 

где $G_j\left(Y_1,Y_2,\dots ,Y_m\right)={\partial G(Y_1,Y_2,\dots ,Y_m)}/{\partial }Y_j$ (см. работу МакФаддена, 1978, стр. 81).

Широкий спектр моделей может быть получен при различных спецификациях формы $G\left(Y_1,Y_2,\dots ,Y_m\right).$ Мультиномиальная логит-модель возникает, если $G\left(Y_1,Y_2,\dots ,Y_m\right)=\sum^m_{k=1}{Y_k}$, следовательно она является моделью с ошибками, имеющими ОРЭЗ. Другой широко используемой моделью этого класса является вложенная логит-модель.

\subsection{Вложенная логит-модель}

Вложенная логит-модель разбивает возможные решения на несколько групп. Простым примером является задача выбора, когда сначала люди делают выбор между двухгодичным и четырехгодичным образованием, а затем внутри каждой из групп решают получать образование в государственном или частном учебном заведении. Эту ситуацию можно изобразить следующим образом:


Колледж

2 года               4 года

Частный Государственный Частный Государственный



Ошибки в модели случайной полезности могут быть коррелированы для индивидов, сделавших выбор внутри двухгодичной группы  и четырехгодичной группы, однако не может быть корреляции между ошибками этих двух групп.

Более общими словами, пусть на верхнем уровне существуют $J$ ветвей, между которыми необходимо сделать выбор. Пусть $j$-ая ветвь имеет $K_j$ ответвлений, пронумерованных как $j1,\dots ,jk,\dots ,jK_j.$ Тогда полезность для альтернативы $j$-ой из $J$ ветвей и $k$-ой из $K_j$ ответвлений будет

\begin{equation} \label{GrindEQ__15_32_} U_{jk}=V_{jk}+{\varepsilon }_{jk},\ \ k=1,2,\dots ,K_j,\ \ j=1,2,\dots ,J, \end{equation} 

где для модели с $m$ вариантами выбора $K_1+\dots +K_J=m.$ Эта модель может быть проиллюстрирована следующим образом:

Корень



Ветвь 1  \dots  Ветвь $j$ \dots  Ветвь$J$



Ответвление 1\dots Ответвление $K_1$   \dots      Ответвление $k$      \dots      Ответвление 1\dots Ответвление $K_J$

$V_{11}+{\varepsilon }_{11}$\dots $V_{1K_1}+{\varepsilon }_{1K_1}$\dots $V_{jk}+{\varepsilon }_{jk}$\dots $V_{J1}+{\varepsilon }_{J1}$\dots $V_{JK_J}+{\varepsilon }_{JK_J}$

Также в эту модель может быть добавлен и третий ряд ответвлений, и т.д. Для простоты обозначения мы будем рассматривать двухуровневую модель.

Для любой модели с вложенными вероятностями $p_{jk}$, совместная вероятность попасть на ветвь $j$ и на ответвление $k$ может быть разложена на произведение $p_j$, вероятность выбора ветви $j$, на $p_{j|k}$, вероятность выбора ответвления $k$ при условии выбора ветви $j$. Тогда

\[p_{jk}=p_j\times p_{j|k}.\] 

Вложенная логит-модель МакФаддена (1978) возникает, когда ошибка ${\varepsilon }_{jk}$ имеет совместную функцию распределения ОРЭЗ

\begin{equation} \label{GrindEQ__15_33_} F\left(\varepsilon \right)={\rm exp}{\rm [-}{\rm G}\left(e^{-{\varepsilon }_{11}},\dots ,e^{-{\varepsilon }_{1K_1}};;\dots ;;e^{-{\varepsilon }_{J1}},\dots ,e^{-{\varepsilon }_{JK_j}}\right)] \end{equation} 

для следующей конкретной формы функции $G\left(\cdot \right)$

\begin{equation} \label{GrindEQ__15_34_} G\left(Y\right)=G\left(Y_{11},\dots ,Y_{1K_1},\dots ,Y_{JK_j}\right)=\sum^J_{j=1}{{\left(\sum^{K_j}_{k=1}{Y^{{1}/{{\rho }_j}}_{jk}}\right)}^{{\rho }_j}.} \end{equation} 

Параметр ${\rho }_j$ является функцией коэффициента корреляции между ${\varepsilon }_{jk}$ и ${\varepsilon }_{jl}$, но не равен этому коэффициенту. По сути, можно показать, что ${\rho }_j$ равняется $\sqrt{1-Cor[{\varepsilon }_{jk},{\varepsilon }_{jl}]},$ т.е. параметр ${\rho }_j$ находится в обратной зависимости к коэффициенту корреляции и ественными являются значения $0\le {\rho }_j\le 1.$ Допущение о ${\rho }_j=1$ соответствует независимости между ${\varepsilon }_{jk}$ и ${\varepsilon }_{jl}$ и приводит к  мультиномиальной логит-модели. Назовем ${\rho }_j$\textbf{параметрами масштаба, } поскольку они масштабируют параметры в моделях, рассмотренных далее.

Обозначения варьируются у разных авторов. МакФадден (1978) и Маддала (1983), в отличие от нас, определяют эту функцию распределения в терминах ${\sigma }_j=1-{\rho }_j$, который называют \textbf{параметром расхождения. } Другие используют ${\mu }_j={1}/{{\rho }_j}$. Многие авторы нумеруют альтернативы $ij$ для $n$-го индивида, в то время как в настоящем пособии для альтернатив используются индексы $jk$ и коэффициент $i$ обозначает $i$-го индивида.

Переменная исхода $y_{jk}$ равна единице, если выбрана альтернатива $jk$, и нулю в противном случае. Тогда из выражения \eqref{GrindEQ__15_32_}, $p_{jk}={\Pr  \left[y_{jk}=1\right]\ }={\Pr  \left[U_{jk}\ge U_{lm},\text{ для всех } l,m\right]\ }.$ Аналитические решения для вероятностей $p_{jk}$, как функций $V_{jk}$ и ${\rho }_j$, получены в параграфе 15.12.3. Эти решения затем рассчитываются для детерминированной составляющей функции полезности 

\begin{equation} \label{GrindEQ__15_35_} V_{jk}=z'_j\alpha +x'_{jk}{\beta }_j,\ \ k=1,\dots ,K_j,\ \ j=1,\dots ,J, \end{equation} 

где $z_j$ изменяется только в зависимости от выбранной ветви, а $x_{jk}$ изменяется в зависимости как выбранной ветки, так и выбранного ответвления этой ветви. Параметры $\alpha $ и ${\beta }_j$ называются \textbf{параметрами регрессии.}

Модель, заданная уравнениями \eqref{GrindEQ__15_32_}-\eqref{GrindEQ__15_35_} дает \textbf{вложенную логит-модель}

\begin{equation} 
\label{GrindEQ__15_36_} 
p_{jk}=
p_j\times p_{j|k}=
\frac{{\rm exp}(z'_j\alpha +{\rho }_jI_j)}{\sum^J_{m=1}{{\rm exp}(z'_m\alpha +{\rho }_mI_m)}}
\times 
\frac{{\rm exp}(x'_{jk}{\beta }_j/{\rho }_j)}{\sum^{K_j}_{l=1}{{\rm exp}(x'_{jl}{\beta }_j/{\rho }_j)}}. 
\end{equation} 
% hi
(см.  15.12.3), где

\begin{equation} \label{GrindEQ__15_37_} I_j={\ln  \left(\sum^{K_j}_{l=1}{{\rm exp}(x'_{jl}{\beta }_j/{\rho }_j)}\right)\ } \end{equation} 

называется \textbf{включающей величиной }или \textbf{лог-суммой. } Одним из привлекательных свойств вложенной логит-модели является то, что вероятности $p_{ij}$ и $p_{j|i}$ естественным образом имеют вид как в условной логит-модели.

Описанные выше результаты получены для случая зависимости регрессоров от выбираемой альтернативы. Расчеты могут быть адаптированы для случая независимых от альтернатив регрессоров $V_{jk}=z'{\alpha }_j+x'{\beta }_{jk},$ с нормализацией одного из параметров ${\beta }_{jk}$. Алгебраически все, что необходимо, это разделение детерминированной составляющей $V_{jk}=A_j+B_{jk},$ где $A_j$ относится к некоторой ветви, а $B_{jk}$ относится как к конкретной ветви, так и к ее некоторому ответвлению.

\subsection{Оценка вложенной логит-модели}

Для $i$-го наблюдения мы видим $K_1+\dots +K_J$ исходов $y_{ijk}$, где $y_{ijk}=1$, если выбрана альтернатива $jk$, и $y_{ijk}=0$ в противном случае. Тогда $p_{ijk}=p_{ij|k}\times p_{ij}$, а плотность  для наблюдений $y_i=(y_{i11},\dots ,y_{iJK_j})$ может быть компактно записана как

\[f\left(y_i\right)=\prod^J_{j=1}{\prod^{K_j}_{k=1}{{\left[p_{ik|j}\times p_{ij}\right]}^{y_{ijk}}=\prod^J_{j=1}{\left(p^{y_{ij}}_{ij}\prod^{K_j}_{k = 1}{p^{y_{ijk}}_{ik|j}}\right)}},}\] 

где $y_{ij}=\sum^{K_j}_{l=1}{y_{ijl}}$ равно единице, если выбрана ветвь $j$, и нулю в противном случае.

Плотность распределения для выборки имеет вид $\prod^N_{i=1}{f\left(y_i\right).}$\textbf{Оценка методом максимального правдоподобия с полной информацией (ММППИ)} максимизирует функцию

\begin{equation} \label{GrindEQ__15_38_} {\ln  L\ }=\sum^N_{i=1}{\sum^J_{j=1}{y_{ij}{\ln  p_{ij}\ }}+\sum^N_{i=1}{\sum^J_{j=1}{\sum^{K_j}_{k=1}{y_{ijk}{\ln  p_{ik|j}\ }}}}}, \end{equation} 

относительно параметров $\alpha $, ${\beta }_j$ и ${\rho }_j.$

Альтернативой является менее эффективный \textbf{метод последовательного оценивания} или оценка методом максимального правдоподобия с ограниченной информацией (ММПОИ), который использует разделение $p_{jk}$ на произведение $p_{k|j}$ и $p_j$. Первый этап оценивания основывается на втором слагаемом из правой части выражения \eqref{GrindEQ__15_38_}, который согласно \eqref{GrindEQ__15_36_} является условной логит-моделью с оцениваемым параметром ${\beta }_j/{\rho }_j.$ Второй этап получения оценки основывается на первом слагаемом из правой части выражения \eqref{GrindEQ__15_38_}, которое согласно \eqref{GrindEQ__15_36_} является условной логит-моделью с добавленным регрессором ${\hat{I}}_{ij}$, оценкой включающей величины из \eqref{GrindEQ__15_37_}, которая может быть рассчитана с помощью оценки параметра, полученной на первом этапе. Параметры $\widehat{\alpha }$ и ${\widehat{\rho }}_j$ получены непосредственно на втором шаге, а ${\widehat{\beta }}_j$ равняется произведению ${\hat{p}}_j$ на оценку $\widehat{{\beta }_j/{\rho }_j}$, полученную на первом шаге.

Этот метод последовательного оценивания менее эффективен, чем ММППИ. На втором шаге обычные стандартные ошибки условной логит-модели занижают реальные стандартные ошибки метода последовательного оценивания, поскольку они не допускают наличия погрешности в оценке включающей величины. МакФадден (1981) приводит формулу для корректного расчета стандартных ошибок. Также может быть применен метод бутстрепа. Метод последовательного получения оценки был предложен очень давно, когда еще даже оценки условной логит-модели было трудно получить. Сейчас относительно просто запрограммировать функцию правдоподобия, поэтому лучшим вариантом является использование ММППИ. Метод последовательного оценивания полезен для получения начальных значений параметров, поскольку функция правдоподобия в ММППИ не является вогнутой на всей области определения.

Для примера применим вложенную логит-модель к данным из раздела 15.2. Вложенная структура содержит рыбалку с побережья или с лодки на верхнем уровне и рыбалку с пляжа или с пристани (для рыбалки с побережья) или с частной или арендованной лодки (для рыбалки с лодки) на нижнем уровне. Регрессорами $x_{jk}$ в выражении \eqref{GrindEQ__15_36_}, которые будут варьироваться на нижнем уровне, выступают цена $(P)$ и коэффициент вылова $\left(C\right).$ Регрессором $z_j$ на верхнем уровне, который принимает значение в зависимости от выбора рыбалки с побережья или с лодки, выступает переменный индикатор $d$ равный единице, если выбрана рыбалка с побережья, и $d\times I$, доход умноженный на индикатор выбора рыбалки с побережья. Оценка условной логит-модели (с ${\rho }_1={\rho }_2=1$) дает  ${\ln  L\ }=-1252$, значение, которое, как ожидалось, меньше значения логарифмической функции правдоподобия для аналогичной, но менее подверженной ограничениям модели, приведенной в последнем столбце таблицы 15.2. Оценка ММППИ соответствующей вложенной логит-модели, для которой ${\rho }_1$ и ${\rho }_2$ теперь могут варьироваться, дает более высокое значение логарифмической функции правдоподобия и приводит к отказу от ограниченной условной логит-модели, используя тест отношения правдоподобия $\chi^2(2)$.

\subsection{Обсуждение}

Основным ограничением вложенной логит-модели является то, что не каждая проблема выбора может  быть естественным образом представлена в виде вложенной структуры. При необходимости можно выбрать вложенную схему, используя тест отношения правдоподобия или информационный критерий Акаике. Однако итоговая схема не всегда соответствует априорным ожиданиям.

Другим практическим вопросом является то, что состоятельность вложенной логит-модели с  ARUM требует выполнения трех условий из параграфа 15.5.2. 
Третье из этих условий выполняется глобально, если $0\le {\rho }_j\le 1$, и, в случае структуры с более чем двумя уровнями вложенности, дополнительно требуется, чтобы $\rho $ на верхних уровнях вложенной структуры не превосходил значений $\rho $ на ее нижних уровнях. 
На практике возможно получение оценки параметра ${\rho }_j$, которая выходит за пределы единичного интервала. Вложенную модель и тогда можно использовать, поскольку она приводит к вероятностям выбора лежащим в диапазоне от 0 до 1, однако модель уже не вытекает из ARUM. Борш-Супан и другие исследователи рассматривали условие локальной идентификации, при выполнении которого вложенная логит-модель может быть согласованной с ARUM, даже если ${\rho }_j$ лежит за пределами интервала от нуля до единицы. Также полезным может быть проведение  поиска на сетке по ${\rho }_j$, чтобы ограничить ${\rho }_j$ единичным интервалом и посчитать вызванное тем самым уменьшение значения логарифмической функции правдоподобия, если таковое имеет место.

Вложенная логит-модель, описанная в \eqref{GrindEQ__15_36_} и \eqref{GrindEQ__15_37_}, была предложена МакФадденом (1978), который получил ее как модель с ошибками с ОРЭЗ. \textbf{Ранний вариант } вложенной логит-модели был аналогичен \eqref{GrindEQ__15_36_}-\eqref{GrindEQ__15_37_}, за исключением того, что ${\rm exp}(x'_{jl}{\beta }_j/{\rho }_j)$ было заменено на ${\rm exp}(x'_{jl}{\beta }_j)$. Это было альтернативным способом вывода модели, как естественного расширения условной логит-модели, поскольку она является специальным случаем \eqref{GrindEQ__15_36_}-\eqref{GrindEQ__15_37_}, когда ${\rho }_j=1.$ Для более подробной информации ознакомьтесь с работами МакФаддена (1978, стр. 79), Маддалы (1983, стр. 70) и Грина (2003, стр. 726).

Важно отметить, что два варианта вложенной логит-модели различаются, если значения ${\rho }_j$ различаются для разных альтернатив (см. работы Коппельмана (1998), Уэна (1998) и Трейна (2003, стр. 88)). В некоторых ранних исследованиях оценки, полученные методом последовательного оценивания, существенно отличались от оценок, полученных ММППИ, ставя под сомнение робастность вложенной логит-модели. Впрочем, в некоторых из этих исследований различные методы оценивания были применены к разным вариантам вложенной логит-модели. Более того, даже сегодня в различных статистических пакетах оцениваются разные варианты вложенной логит-модели.

Вложенная логит-модель может быть обобщена для случая альтернатив более высокого уровня (или вложенности). Например, в работе Голдберга (1995) рассматривается пятиуровневая структура: (1) купить автомобиль; (2) купить новый автомобиль, если выбрана альтернатива (1); (3) автомобиль какого из девяти классов был приобретен, если выбрана альтернатива (2); (4) иностранного или отечественного производства; (5) модель автомобиля. Дополнительной привлекательной стороной вложенной логит-модели в случае многоуровневой структуры вложенности является то, что для оценки параметров достаточно рассмотреть фиксированное или случайно выбранное подмножество альтернатив (см. работу МакФаддена, 1978).

\subsection{Анализ благосостояния}

Анализ благосостояния для моделей ARUM был представлен в параграфе 15.5.4. В общем случае не существует аналитического решения для $E\left[CV\right]$, ожидаемого значения компенсирующей вариации дохода.

Примечательно, что для моделей, основанных на ОРЭЗ стандартной ошибки, линейных по доходу, $V\left(I-p_j,\ x_j\right)=\alpha \left(I-P_j\right)+f(x_j)$, МакФадден (1995) и другие исследователи в более ранних работах показали, что существует явное решение для ожидаемого значения компенсирующей вариации

\[E\left[CV\right]=\frac{1}{\alpha }\left({\ln  G\left(e^{V''_1},\dots ,e^{V''_m}\right)\ }-{\ln  G\left(e^{V'_1},\dots ,e^{V'_m}\right)\ }\right),\] 

где функция $G(\cdot )$ для ОРЭЗ определена в выражении \eqref{GrindEQ__15_34_}, а $V'_j$ и $V''_j$ --- значения детерминированной компоненты полезности до и после изменения.

Для моделей, основанных на  ОРЭЗ стандартной ошибки, с нелинейной зависимостью компенсирующей вариации от дохода, тем не менее, не существует явного решения. Одним из подходов является симуляционный метод, описанный в параграфе 15.5.4. Для мультиномиальной логит-модели применить этот метод достаточно просто, поскольку просто получить ошибки, имеющие распределение экстремальных значений, используя метод преобразования, описанный в параграфе 12.8.2, --- сгенерируйте $u$, имеющее равномерное распределение на (0, 1), и  далее возьмите $\varepsilon =-{\ln  (-{\ln  (u)\ })\ }$. Для более общей логит-модели, однако, сложно сгенерировать ОРЭЗ ошибки, даже в простом случае двумерного распределения экстремальных значений. МакФадден (1995) предложил применять метод Монте-Карло по схеме марковской цепи совместно с алгоритмом Метрополиса-Гастингса (см. раздел 13.5). Герриджес и Клинг (1999) приводят блестящее описание этого метода с приложением к вложенной логит-модели для данных о выборе способа рыбалки из раздела 15.2, используя различные неявные функции полезности, включая и транслогарифмическую.

Не так давно Дагсвик и Карлстрём (2004) показали, что, хотя, нет явного решения для $E\left[CV\right]$для моделей с ОРЭЗ ошибкой, если присутствует нелинейная зависимость компенсирующей вариации от дохода, то возможно аналитическими методами свести $E\left[CV\right]$ к одномерному интегралу. Нахождение значения этого интеграла методом Гаусса -- более простая процедура, чем применение вышеупомянутого симуляционного метода.

\section{Лоubn vjlель со случайными параметрами}

Логит-модель со случайными параметрами позволяет легко обобщить мультиномиальную или условную логит-модель так, чтобы допустить корреляцию полезностей разных альтернатив между собой. Эта модель, возможно, является главным эконометрическим примером моделей со случайными параметрами для пространственных данных в микроэкономике.

\subsection{Логит-модель со случайными параметрами}

\textbf{Логит-модель со случайными параметрами }  определяет полезность $j$-ой альтернативы для $i$-го индивида как

\begin{equation} \label{GrindEQ__15_39_} U_{ij}=x'_{ij}{\beta }_i+{\varepsilon }_{ij},\ \ j=1,2,\dots ,m. \end{equation} 

где ${\varepsilon }_{ij}$ -- независимые случайные величины, имеющие распределение экстремальных значений, как и в условной логит-модели, однако, дополнительно допускается случайность параметра ${\beta }_i$. Наиболее распространённым предположением является то, что 

\begin{equation} \label{GrindEQ__15_40_} {\beta }_i\sim {\mathcal N}\left[\beta ,\ {\Sigma }_{\beta }\right]. \end{equation} 

Также возможно использовать логнормальное, а не нормальное распределение для этих параметров, если их знаки известны априори. Эта модель также называется \textbf{смешанной логит-моделью, }если заимствовать терминологию для панельных моделей со случайными параметрами. Представив мультиномиальную логит-модель как условную, получим результат, относящийся и к мультиномиальной логит-модели со случайными параметрами.

Модель можно перезаписать как

\[U_{ij}=x'_{ij}\beta +v_{ij,}\] 

\[v_{ij}=x'_{ij}\beta +{\varepsilon }_{ij},\] 

где $u_i\sim {\mathcal N}\left[0,\ {\Sigma }_{\beta }\right].$ Тогда $Cov\left[v_{ij},\ v_{ik}\right]=x'_{ij}{\Sigma }_{\beta }x_{ik}$, $j\ne k$, то есть введение случайных параметров привлекательно тем, что позволяет допустить корреляцию между альтернативами.

Во многих приложениях этой модели ковариационная матрица ${\Sigma }_{\beta }$ определяется как диагональная, а также дополнительно предполагается  равенство нулю некоторых диагональных элементов. Тогда количество элементов ковариационной матрицы, которые должны быть оценены, равно количеству компонент ${\beta }_i$, которые определены как случайные.

В качестве примера рассмотрим смешанную условную логит-модель со скалярным регрессором и параметрами $\beta $ и ${\sigma }^2_{\beta }.$ Допустим, что оценками параметров являются $\widehat{\beta }=2,0$ со стандартной ошибкой 0,5 и ${\widehat{\sigma }}^2_{\beta }=1,0$ со стандартной ошибкой 0,2. Тогда нулевая гипотеза о том, что параметр имеет постоянное значение, то есть ${\sigma }^2_{\beta }=0$, решительно отвергается, поскольку $t=1,0/0,2=5,0.$ Эффект, который оказывает на ${\rm Pr}[y_i=j]$ увеличение $x_{ij}$, различен между индивидами и имеет положительное значение для примерно 97,5\% выборки, поскольку по оценкам ${\beta }_i\sim {\mathcal N}[2,0;1,0]$. Чтобы ознакомиться с примерами, которые делают акцент на интерпретации оценок коэффициентов, обратитесь к работе Ревелта и Трейна (1998).

В литературе по теории отраслевых организаций рассматривается \textbf{агрегирование} по потребителям в моделях аналогичных логит-модели со случайными параметрами, чтобы оценить параметры спроса, используя \textbf{данные по рынку в целом.} См., например, Берри (1994), Нево (2001) и также Алленби и Росси (1991).

\subsection{Оценка логит-модели со случайными параметрами}

В модели линейной регрессии со случайными параметрами оценивание методом наименьших квадратов дает оценку среднего значения параметра $\beta $, которая является состоятельной, хотя и неэффективной. Однако, оценки в нелинейных моделях, при получении которых не был учтен случайный характер параметров, будут несостоятельными. Таким образом, стандартный ММП, примененный для условной логит-модели, даст несостоятельные оценки параметров, если процесс порождающий данные описывается \eqref{GrindEQ__15_39_} и \eqref{GrindEQ__15_40_}. Вместо этого, оценка ММП должна явно учитывать стохастичность ${\beta }_i$.

Если ${\beta }_i$ известно, тогда единственным источником случайности становится ${\varepsilon }_{ij}$, и получается условная логит-модель с вероятностью $p_{ij}={e^{x'_{ij}{\beta }_i}}/{\sum^m_{l=1}{e^{x'_{il}{\beta }_i}}}$. Поскольку фактически ${\beta }_i$ является случайной величиной, эту случайность необходимо учесть. Отсюда получаем

\begin{equation} \label{GrindEQ__15_41_} 
p_{ij}={\Pr  \left[y_i=j\right]\ }=
\int{\frac{e^{x'_{ij}{\beta }_i}}{\sum^m_{l=1}{e^{x'_{il}{\beta }_i}}}\phi({\beta }_i|\beta ,\ {\Sigma }_{\beta })\,d{\beta }_i}, 
\end{equation} 

где интеграл является многомерным, а $\phi({\beta }_i|\beta ,\ {\Sigma }_{\beta })$ обозначает плотность распределения многомерного нормального распределения для параметра ${\beta }_i$ со средним $\beta $ и дисперсией ${\Sigma }_{\beta }.$

Оценка ММП максимизирует функцию ${\ln  L_N=\sum^N_{i=1}{\sum^m_{j=1}{y_{ij}{\ln  p_{ij}\ }}}\ }$ по $\beta $ и ${\Sigma }_{\beta }.$ Сложность заключается в том, что интеграл, количество измерений которого определяется количеством случайных компонент ${\beta }_i$  с неравной нулю дисперсией, не имеет аналитического решения. Следовательно, его необходимо оценить с помощью симуляционных методов.

Одним из подходов является прямое симуляционное приближение $p_{ij}$  (см. параграф 12.4.1). Согласно этому подходу интеграл в выражении \eqref{GrindEQ__15_41_} замещается средним по $S$ оценкам подынтегральной функции, полученным для некоторых случайных ${\beta }_i$, имеющих распределение ${\mathcal N}[\beta , \Sigma_{\beta }]$. Тогда \textbf{оценка симуляционного  правдоподобия } максимизирует функцию

\begin{equation} \label{GrindEQ__15_42_} {\ln  {\hat{L}}_N(\beta ,\ {\Sigma }_{\beta })\ }=\sum^N_{i=1}{\sum^m_{j=1}{y_{ij}{\ln  \left[\frac{1}{S}\sum^S_{s=1}{\frac{e^{x'_{ij}{\beta }^{\left(s\right)}_i}}{\sum^m_{l=1}{e^{x'_{il}{\beta }^{\left(s\right)}_i}}}}\right]\ }}}, \end{equation} 

где ${\beta }^{\left(s\right)}_i,\ s=1,\dots ,S$ -- случайные величины, сгенерированные согласно  плотности $\phi\left({\beta }_i;\ \beta ,\ {\Sigma }_{\beta }\right).$ Поскольку $\beta $ и ${\Sigma }_{\beta }$ являются неизвестными, сумма из \eqref{GrindEQ__15_42_} предполагает итерационную процедуру получения оценок, в которой ${\beta }^{(r)}$ и ${\Sigma }^{(r)}_{\beta }$ оцениваются на $r$-ой итерации. Состоятельность оценок требует, чтобы  $S\to \infty $, также как и $N\to \infty $ и $\sqrt{N}/S\to \infty $ (см. параграф 12.4.3). Для ускорения расчетов  используют ряды Гальтона (см. параграф 12.7.4) и альтернативные симуляционные методы.

Альтернативные методы оценки используют Байесовские методы с относительно плоским априорным распределением. Трейн (2001, 2003) определяет иерархичное априорное распределение с $\beta \sim {\mathcal N}[{\beta }^*,\ {\Omega }^*]$, где ${\Omega }^*$предполагается очень большим, а ${\Sigma }_{\beta }$ имеет обратное распределение Уишарта со $K={\dim  \left[\beta \right]\ }$ степенями свободы и параметром масштаба $I_K$. Вместо того, чтоб использовать апостериорное распределениетолько для $\beta $ и ${\Sigma }_{\beta }$ вычислительно быстрее дополнительно включить параметр ${\beta }_i,\ i=1,\dots ,N.$ Тогда (1) условным апостериорным распределением для$\beta |{\Sigma }_{\beta },\ {\beta }_i$ будет нормальное, (2) условнымапостериорным распределением для ${\Sigma }_{\beta }|\beta ,\ {\beta }_i$ будет обратное распределение Уишарта, и (3) условным апостериорнымраспределениемдля${\beta }_i|{\Sigma }_{\beta }$будет $\beta $, который пропорционален подынтегральному выражению из \eqref{GrindEQ__15_41_}. Учитывая эти выводы, оценка условного апостериорного распределения может быть получена с использованием вариаций семплирования Гиббса (см. параграф 13.5.2) с осложнениями, которые приводят к необходимости использования одной итерации алгоритма Метрополиса-Гастингса для третьего апостериорного распределения (см. параграф 13.5.4), поскольку полный набор условных выражений не доступен. На практике на расчеты по этому методу затрачивается время, аналогичное ИММП, и, при условии относительно плоского априорного распределения, будут получены оценки параметров модели и стандартные ошибки, которые отклоняются в общем случае не более чем на 10\% от значений оценок ИММП.

\subsection{Обобщенная модель случайной полезности}

Желательно использовать более гибкие модели, чем мультиномиальная логит-модель. В связи с этим в настоящее время наблюдается большой интерес к логит-модели со случайными параметрами. МакФадден и Трейн (2004) показали, что любая модель случайной полезности может быть сколь угодно хорошо приближена смешанной логит-моделью, хотя такой результат требует аккуратного выбор регрессоров и  распределения смеси.

Нет причин ограничивать применение моделей со случайными параметрами только к мультиномиальной логит-модели. Например, она может быть расширена до вложенной логит-модели. Более того, в модель могут быть включены дополнительные источники случайности, в особенности скрытые классы и скрытые переменные.

Начнем описание таких расширений с модели ARUM \eqref{GrindEQ__15_22_}. В этой модели полезность, получаемая индивидом $i$ от $j$-ой альтернативы задается как $U_{ij}=V_{ij}\left(x_i,\ \beta \right)+{\varepsilon }_{ij}$, где $x_i$ обозначает наблюдаемые данные, $\beta $ обозначает неизвестный параметр, а ${\varepsilon }_{ij}$ обозначает ошибки, независимые по $i$, но возможно коррелирующие по $j$. Предположение о том, что ${\varepsilon }_{ij}$ имеет распределение \eqref{GrindEQ__15_23_} приводит к аналитическому решению для вероятностей выбора обозначаемых

\[p_{ij}=F_j\left(V_i\left(x_i,\beta \right),\ {\Theta }_{\varepsilon }\right),\] 

где $V_i\left(x_i,\beta \right)=[V_{i1}\left(x_i,\beta \right),\dots ,V_{im}\left(x_i,\beta \right)]$, а ${\Theta }_{\varepsilon }$ обозначает неизвестные параметры распределения ${\varepsilon }_i=\left({\varepsilon }_{i1},\dots ,{\varepsilon }_{im}\right).$  Такое аналитическое решение может быть получено, если ${\varepsilon }_i$ имеет ОРЭЗ, в частности можно получить мультиномиальную и вложенную логит-моделям.

Более общая модель включает дополнительную случайность в модель, описанную выше. Во-первых, ранее детерминированная часть полезности принимает вид $V_{ij}=V_{ij}\left(x_i,\ {\xi }_i,\ \beta \right)$. Тогда, допустив, что ${\varepsilon }_i$ такие, что условные по ${\xi }_i$ вероятности можно записать в явном виде, получаем для безусловных вероятностей

\begin{equation} \label{GrindEQ__15_43_} p_{ij}=\int{F_j\left(V_i\left(x_i,\ {\xi }_i,\ \beta \right),{\theta }_{\varepsilon }\right)f\left({\xi }_i\mathrel{\left|\vphantom{{\xi }_i {\theta }_{\xi }}\right.\kern-\nulldelimiterspace}{\theta }_{\xi }\right)d{\xi }_i}, \end{equation} 

где $f\left(\xi \mid \theta_{\xi}\right)$ обозначает плотность распределения $\xi $. Логит-модель со случайными параметрами является примером, для которого $V_{ij}=x'_{ij}\beta +x'_{ij}{\xi }_i$, где ${\xi }_i$ имеет распределение ${\mathcal N}[0,\ \Sigma ]$, и модель можно описать с помощью случайных параметров. 
Тем не менее, ${\xi }_i$ также может быть введена в модель как дополнительный элемент случайности или как скрытая переменная. Во-вторых, можно предположить, что индивиды принадлежат к одному из $C$ скрытых классов. См. модель дюрации в разделе 18.5 и  работу Свайта (2003) для примеров применения ОРЭЗ в случае скрытых классов или моделей смеси. Если $\beta $ и ${\theta }_{\varepsilon }$ изменяются в зависимости от класса, то \eqref{GrindEQ__15_43_}  принимает безусловный вид

\begin{equation} \label{GrindEQ__15_44_} p_{ij}=\sum^C_{c=1}{\left[\int{F_j\left(V_j\left(x_i,\ {\xi }_i,\ {\beta }^c\right),{\theta }^c_{\varepsilon }\right)f\left({\xi }_i\mathrel{\left|\vphantom{{\xi }_i {\theta }_{\xi }}\right.\kern-\nulldelimiterspace}{\theta }_{\xi }\right)d{\xi }_i}\right]}{\pi }_c, \end{equation} 

где ${\pi }_c$ обозначает вероятность принадлежности индивида к $c$-му классу, и обычно $C=2$ или $C=3$. Тогда оценка симуляционного ММП максимизирует функцию

\[{\ln  {\hat{L}}_N(\beta ,\ {\Sigma }_{\beta })=\sum^N_{i=1}{\sum^m_{i=1}{y_{ij}{\ln  \left[\frac{1}{S}\sum^S_{s=1}{\sum^C_{c=1}{F_j(V_i(}x_i,{\xi }^s_i,{\beta }^c),\ {\theta }^c_{\varepsilon }){\pi }_c}\right],\ }}}\ }\] 

где ${\xi }^s_i$ обозначает $s$-ое сгенерированное значение из $f\left({\xi }^s_i \mid {\theta }_{\xi }\right)$. Камакура и Уэдел (2004) оценивают мультиномиальную модель конечной смеси с помощью Байесовских методов.



Рисунок 15.1. Обобщенная модель случайной полезности

Explanatory variables --- Объясняющие переменные
Disturbances --- Случайные ошибки
Indicators --- Индикаторы
Latent classes --- Скрытые классы
Latent variables --- Скрытые переменные
Utilities --- Полезности
Revealed preference indicator --- Индикатор выявленного предпочтения
Observable variable --- Наблюдаемая переменная
Unobservable variable --- Ненаблюдаемая переменная
Structural relationship --- Структурные связи
Disturbances --- Случайные ошибки
Measurement relationship --- Измерение
Stated preference indicators --- Индикаторы заявленных предпочтений



Уолкер и Бен-Акива назвали такую модель \textbf{обобщенной моделью случайной полезности}. Они ссылаются на многие статьи с подобными расширениями, рассматривают использование \textbf{данных о задаявленных предпочтениях}, чтобы дополнить данные о выявленных предпочтениях, а также приводят много эмпирических примеров. На рисунке 15.1, взятом из работы Уолкера и Бен-Акивы, обобщены различные расширения модели случайной полезности.

Литература по мультиномиальному моделированию активно исследует сильно параметризованные модели, которые включают модели со случайными параметрами, скрытыми переменными и скрытые параметры, а также комбинируют данные из более чем одного источника. Эти методы применимы к любому типу пространственных данных, а не только к случаям дискретных исходов.

\section{Мультиномиальная пробит-модель}

Альтернативным очевидным способом включения корреляции между альтернативами в ненаблюдаемой компоненте является применение нормально распределенных ошибок. Однако оценка ММП затрудняется, поскольку в наиболее общем случае необходимо взять $(m-1)$-мерный интеграл.

\subsection{Мультиномиальная пробит-модель}

\textbf{Мультиномиальная пробит-модель } --- это мультиномиальная модель с $m$ альтернативами для выбора, где полезность $j$-ой альтернативы задается как

\begin{equation} \label{GrindEQ__15_45_} U_j=V_j+{\varepsilon }_j,\ \ j=1,2,\dots ,m, \end{equation} 

а ошибки имеют совместное нормальное распределение с параметрами

\begin{equation} \label{GrindEQ__15_46_} \varepsilon \sim {\mathcal N}\left[0,\ \Sigma \right], \end{equation} 

где $\varepsilon =[{\varepsilon }_1,\dots ,{\varepsilon }_m]'$ --- $m\times 1$ вектор. Как правило, $V_j=x'_j\beta $ или $V_j=x'{\beta }_j$.

Различные мультиномиальные пробит-модели возникают при использовании различных спецификаций ковариационной матрицы $\Sigma $. Для некоторых из внедиагональных элементов задаются ненулевые значения, чтобы разрешить корреляцию между ошибками, однако необходимо наложить некоторые ограничения на матрицу $\Sigma $. Обратите внимание, что, если между ошибками нет корреляции, то мультиномиальная пробит-модель по-прежнему не имеет аналитического решения для вероятностей, и тогда проще предположить, что ошибки имеют  распределение экстремальных значений и использовать условную или мультиномиальную логит-модель.

Ограничения на матрицу $\Sigma $ необходимы, чтобы обеспечить \textbf{идентифицируемость}. Из \eqref{GrindEQ__15_23_} очевидно, что для любой модели ARUM выбор определяется разницей в полезностях или ошибках. Тогда рассмотрим разницу $U_j-U_1$ между полезностью альтернативы $j$ и полезностью  альтернативы 1, которая выбрана в качестве базовой альтернативы. Банч (1991)  продемонстрировал, что все кроме одного параметры ковариационной матрицы ошибок ${\varepsilon }_j-{\varepsilon }_1$ идентифицируемы (см. обсуждение в конце параграфа 15.5.1). Одним из способов достижения идентификации является нормализация, скажем, ${\varepsilon }_1=0$, и фиксирование одного из элементов ковариационной матрицы. Например, если $m=2$, пусть ${\varepsilon }_1=0$, тогда ${\sigma }_{11}=0$ и ${\sigma }_{12}=0$, и дополнительно ограничим ${\sigma }_{22}=1$. Тогда ${\varepsilon }_2-{\varepsilon }_1={\varepsilon }_2\sim {\mathcal N}[0,1]$, что приводит к пробит-модели бинарного выбора.

Дополнительные ограничения на матрицу $\Sigma $ или параметр $\beta $ могут понадобиться для успешного приложения модели для конкретного практического случая. Кин (1992) продемонстрировал, что даже если были сделаны предположения о ковариации ошибок, чтобы обеспечить идентификацию матрицы, на практике параметры мультиномиальной пробит-модели могут быть очень неточно оценены в моделях с регрессорами, которые не зависят от альтернатив. В таком случае необходимо наложить дополнительные ограничения на мультиномиальную пробит-модель. Такая неточность оценки качественно аналогична сильной мультиколлинеарности независимых переменных в линейной регрессии. Кин обнаружил, что ограничение исключения на регрессоры (с одним исключением для каждого индекса полезности) работает хорошо.  В качестве альтернативы, которая используется гораздо чаще, дополнительные ограничения могут налагаться на параметры ковариации.

Популярной экономичной моделью для ошибок является \textbf{факторная модель}

\[{\varepsilon }_j=v_j+\sum^L_{l=1}{c_{jl}{\xi }_l,\ \ j=1,2,\dots ,m,}\] 

где $v_j$ и ${\xi }_1,\dots ,{\xi }_L$ -- это  одинаково распределенные случайные величины, имеющие стандартное нормальное распределение, а $c_{jl}$ -- это веса, которые называются \textbf{коэффициентами нагрузки}, и их необходимо оценить. Эта модель позволяет значительно снизить количество параметров ковариации с $m(m+1)/2$ до $L$ и работать уже с $(L+1)$-мерным интегралом. Численные методы, обычно численное интегрирование, могут быть использованы при малых значениях $L$, в то время как необходимо использовать симуляционные методы при больших значениях $L$. Для панельных данных модель случайных эффектов (см. параграф 21.2.1) может быть рассмотрена как факторная модель с ошибкой $u_{it}={\alpha }_i+\epsilon_{it}$. Факторная модель может быть особенно удобной в случае использования пробит-модели для панельных данных.

\subsection{Оценка мультиномиальной пробит-модели}

Предпочтительно оценивать параметры регрессии и дисперсии ошибок с помощью ММП с логарифмической функцией правдоподобия, приведенной в параграфе 15.3.2. Сложность заключается в том, что не существует аналитической формы выражения для вероятностей выбора.

Для пробит-модели с тремя альтернативами

\[p_1={\Pr  \left[y=1\right]\ }=\int^{-{\tilde{V}}_{31}}_{-\infty }{\int^{{\tilde{V}}_{32}}_{-\infty }{f\left({\widetilde{\varepsilon }}_{21},{\widetilde{\varepsilon }}_{31}\right)d{\widetilde{\varepsilon }}_{21}d{\widetilde{\varepsilon }}_{31}}}\] 

(см. выражение (15.24)), где $f\left({\widetilde{\varepsilon }}_{21,}{\widetilde{\varepsilon }}_{31}\right)$ имеет двумерное нормальное распределение с двумя свободными параметрами ковариации, а ${\tilde{V}}_{21}$ и ${\tilde{V}}_{31}$ зависят от регрессоров и параметра $\beta $. Значение этого двумерного интеграла может быть быстро найдено численными методами. В более общем случае, однако, для модели с $m$ альтернативами требуется вычислить $(m-1)$-мерный интеграл. Трехмерный интеграл является пределом возможностей численных методов, ограничивая применение численных методов интегрирования мультиномиальной пробит-моделью с четырьмя альтернативами.

Для моделей большей размерности альтернативой является использование симуляционных методов. Для простоты обратимся к мультиномиальной модели с тремя альтернативами. Одной из возможностей выступает использование частотных симуляций, когда $p_1$ апроксимируется долей пар $\left({\widetilde{\varepsilon }}_{21,}{\widetilde{\varepsilon }}_{31}\right)$, которые меньше $(-{\tilde{V}}_{21},-{\tilde{V}}_{31})$. Как описано в параграфе 12.7.1 этот метод не является гладким и может быть очень неэффективен (см. параграф 12.7.2). Более того, при текущей постановке задачи, при использовании этого метода возможно получение граничных значений для вероятности ${\hat{p}}_1=0\text{ или } 1$. В общем случае лучше использовать метод сэмплирования по важности, подробно описанный в параграфе 12.7.2. В случае интегрирования многомерного интеграла по методу Монте Карло очень популярной разновидностью метода сэмплирования по важности является GHK-симулятор, названный в честь Гевеке (1992), Хадживасилу и МакФаддена (1994) и Кина (1994). Благодаря этому методу многомерная функция плотности нормального распределения усекается. В сопоставлении с частотной симуляцией этот метод является гладким, требует гораздо меньше испытаний для альтернатив с низкой вероятностью выбора и вряд ли будет иметь проблемы с граничными значениями. В работе Трейна (2003) приведено подробное описание этого метода.

В предшествующем обсуждении рассматривалась оценка вероятностей выбора в мультиномиальной пробит-модели, при известных параметре $\beta $ и матрице $\Sigma $. Фактически же $\beta $ и $\Sigma $ требуется оценить. Оценка, полученная \textbf{методом симуляционного правдоподобия} максимизирует функцию

\[{\ln  {\hat{L}}_N(\beta ,\Sigma )=\sum^N_{i=1}{\sum^m_{j=1}{y_{ij}{\ln  {\hat{p}}_{ij}\ }}}\ },\] 

где ${\hat{p}}_{ij}$ получена с использованием GHK-симулятора. Для состоятельности оценки требуется, чтобы количество испытаний  $S\to \infty $, также как и $N\to \infty $. Этот метод очень требователен к ресурсам. На $r$-ом этапе итерационного процесса (см. главу 10) получаются оценки ${\widehat{\beta }}^{(r)}$ и ${\widehat{\Sigma }}^{(r)}$, и требуется произвести перерасчет ${\hat{p}}_{ij}$, что требует $S$ испытаний для каждого из $N$ индивидов.

Альтернативной процедурой получения оценок выступает \textbf{симуляционный метод моментов} (см. раздел 12.5). Из выражения \eqref{GrindEQ__15_8_} состоятельная оценка, полученная методом моментов, является решением $\sum^N_{i=1}{\sum^m_{j=1}{\left(y_{ij}-p_{ij}\right)z_i=0}}$, где, например, $z_i=x_i$. Соответствующие оценки $\beta $ и $\Sigma $, полученные симуляционным методом моментов, являются решением уравнений

\[\sum^N_{i=1}{\sum^m_{j=1}{\left(y_{ij}-{\hat{p}}_{ij}\right)z_i=0}},\] 

где ${\hat{p}}_{ij}$ получена с помощью несмещенной оценки. Тогда $\left(y_{ij}-{\hat{p}}_{ij}\right)z_i$ является несмещенным для $\left(y_{ij}-p_{ij}\right)z_i$. Таким образом, получение состоятельной оценки возможно даже, если $S=1$. Этот момент позволяет значительно сократить расчеты. Тем не менее, присутствует потеря эффективности для малых $S$, и даже для больших $S$ симуляционный метод моментов менее эффективен, чем симуляционный ММП, поскольку для этого примера метод моментов менее эффективен, чем метод максимального правдоподобия. Реже используемым методом, который сопоставим по эффективности с симуляционным ММП, является симуляционный метод скоринга (method of simulated scores) (см. работы Хадживасилу и МакФаддена, 1998).

В альтернативных методах оценки используется Байесовские алгоритмы. В отличие от логит-модели со случайными параметрами, для этих методов отсутствует аналитическое решение для вероятностей, которые необходимо получить из полезностей. Скрытые полезности $U_i=(U_{1i},\dots ,U_{ji})$ вводятся как вспомогательные переменные, а также используется подход пополнения данных (см. раздел 13.7). Обозначив $U=(U_1,\dots ,U_N)$ и $y=(y_1,\dots ,y_N)$, получаем цикл сэмплирования Гиббса с шагами (1) условное апостериорное распределение для $\beta |y,\ U,\ \Sigma $, (2) условное апостериорное распределение для $\Sigma |y,\beta ,U$, (3) апостериорное распределением для $U_i|y,\ \beta ,\ \Sigma $. Альберт и Чиб (1993) детально рассматривают как мультиномиальные модели с неупорядоченными исходами, так и с упорядоченными исходами. МакКаллох и Росси (1994) подробно описывают приложения мультиномиальной пробит-модели. Чиб (2001) обсуждает сложности наложения ограничений на матрицу $\Sigma $, необходимые для идентификации (см. параграф 15.8.1).

\subsection{Обсуждение}

Как для мультиномиальной пробит-модели, так и для логит-модели со случайными параметрами отсутствует аналитическое решение для $p_{ij}$. Тем не менее, для логит-модели со случайными параметрами по крайней мере существует аналитическое решение для вероятностей при фиксированных ${\beta }_i$, и единственной проблемой будет интегрирование по ${\beta }_i$. Для мультиномиальной пробит-модели, которая предшествует логит-модели со случайными параметрами, такие условные вероятности не могут быть получены, и получение приближенного значения $p_{ij}$ осложняется, особенно, если значение $p_{ij}$ близко к нулю или единице. По-видимому, будет проще воспользоваться вложенной логит-моделью, логит-моделью со случайными параметрами или моделями смеси, чем мультиномиальной пробит-моделью.

\section{Упорядоченные, последовательные и ранжированные исходы}

В настоящем разделе будут представлены модели более структурированные, чем модели с неупорядоченными исходами, такие как модели с естественным упорядочиванием альтернатив или последовательностью принятия решений. Анализ таких моделей прост, поскольку применяются хорошо исследованные модели, с различными спецификациями для вероятности $p_{ij}$, а оценка производится ММП, основанном на \eqref{GrindEQ__15_4_}.

\subsection{Мультиномиальные модели с упорядоченными исходами}

Допустим, что альтернативы упорядочены естественным образом. Например, состояние собственного здоровья может быть оценено как прекрасное, хорошее, плохое или ужасное. Для таких данных может быть использована одна из моделей неупорядоченных исходов, однако, более экономной и рациональной будет модель, в которой учитывается это упорядочивание.

Отправной точкой будет индексная модель с одной скрытой переменной 

\begin{equation} \label{GrindEQ__15_47_} y^*_i=x'_i\beta +u_i, \end{equation} 

где $x$ здесь не включает константу, в отличие от параграфа 14.4.1. По мере того как $y^*$ пересекает серию возрастающих неизвестных порогов, мы переходим от одной альтернативы к другой. Например, для очень маленьких значений $y^*$ состояние здоровья оценивается как ужасное, для $y^*>{\alpha }_1$ состояние здоровья повышается до плохого, при $y^*>{\alpha }_2$ оно повышается дальше до хорошего и т.д.

В общем случае для \textbf{модели с } ${\mathbf m}$ \textbf{ упорядоченными альтернативами}определим

\begin{equation} \label{GrindEQ__15_48_} y_i=j,\ \text{ если } {\alpha }_{j-1}<y^*_i\le {\alpha }_j, \end{equation} 

где ${\alpha }_0=-\infty $ и $a_m=\infty $. Тогда

\[{\Pr  \left[y_i=j\right]\ }={\Pr  \left[{\alpha }_{j-1}<y^*_i\le {\alpha }_j\right]\ }\] 

\[={\Pr  \left[{\alpha }_{j-1}<x'_i\beta +u_i\le {\alpha }_j\right]\ }\] 

\begin{equation} \label{GrindEQ__15_43_} ={\Pr  \left[{\alpha }_{j-1}-x'_i\beta <u_i\le {\alpha }_j-x'_i\beta \right]\ } \end{equation} 

\[=F\left({\alpha }_j-x'_i\beta \right)-F\left({\alpha }_{j-1}-x'_i\beta \right),\] 

где $F$ --- функция распределения $u_i$. Параметры регрессии $\beta $ и $(m-1)$ значений порогов ${\alpha }_1,\dots ,{\alpha }_{m-1}$ получаются путем максимизации логарифмической функции правдоподобия \eqref{GrindEQ__15_5_} с $p_{ij}$, определенными в выражении (15.49). Для \textbf{логит-модели с упорядоченными исходами} $u$ имеет логистическое распределение с функцией $F\left(z\right)={e^z}/{(1+e^z)}$. Для \textbf{пробит-модели с упорядоченными исходами} $u$ имеет стандартное нормальное распределение, а $F(\cdot )$ -- функция распределения стандартной нормальной величины. Пусть $K$ обозначает количество независимых переменных за исключением константы, тогда модель с $m$ упорядоченными альтернативами будет иметь $K+m-1$ параметр, в то время как мультиномиальная логит-модель $(m-1)(K+1)$ параметр.

Знак параметра регрессии $\beta $ может быть непосредственно интерпретирован как индикатор того, будет ли скрытая переменная $y^*$ возрастать вместе с независимой переменной. Предельные эффекты на вероятности имеют вид

\[\frac{\partial {\rm Pr}[y_i=j]}{\partial x_i}=\left\{F'\left({\alpha }_{j-1}-x'_i\beta \right)-F'\left({\alpha }_j-x'_i\beta \right)\right\}\beta ,\] 

где $F'$ обозначает производную функцию $F$. Знак выражения в скобках может быть положительным или отрицательным.

Эта модель также может применяться для анализа счетных данных, для которых характерно наличие всего нескольких значений. Кэмерон и Триведи (1992) применили пробит-модель с упорядоченными исходами для моделирования количества медицинских консультаций. Хаусман, Ло и Маккинли (1992) применяли пробит-модель с упорядоченными исходами к данным об изменении количества, которое может быть и отрицательным, и дополнительно учитывали гетероскедастичность ошибок $u_i$.

\subsection{Мультиномиальные модели с последовательным выбором}

В некоторых ситуациях решения принимаются  последовательно. Например, некто может принимать решение о том, продолжать ли образование после школы или нет. Если принято решение не продолжать образование, тогда $y=1$. Если $y\ne 1$, то принимается решение о том, получать ли среднее специальное $\left(y=2\right)$ или высшее образование $\left(y=3\right)$. Учитывая эту последовательность, вероятности выбора могут быть просто получены. Например, смоделируем первую ситуацию выбора с помощью пробит-модели, а затем вторую ситуацию, если она имеет место, с помощью пробит-модели. Тогда ${\Pr  \left[y=1\right]\ }=\Phi (x'_1{\beta }_1)$ и ${\Pr  \left[y=2\mathrel{\left|\vphantom{y=2 y\ne 1}\right.\kern-\nulldelimiterspace}y\ne 1\right]\ }=\Phi (x'_2{\beta }_2)$. Безусловная вероятность имеет вид

\[{\Pr  \left[y=2\right]\ }={\Pr  \left[y=2\mathrel{\left|\vphantom{y=2 y\ne 1}\right.\kern-\nulldelimiterspace}y\ne 1\right]\ }\times {\Pr  \left[y\ne 1\right]\ }=\Phi \left(x'_2{\beta }_2\right)\left(1-\Phi \left(x'_1{\beta }_1\right)\right).\] 

Параметры ${\beta }_1$ и ${\beta }_2$ могут быть найдены путем максимизации логарифмической функции правдоподобия \eqref{GrindEQ__15_5_}, где $p_{1i}=\Phi \left(x'_{1i}{\beta }_1\right),\ p_{2i}$ дано в предыдущем выражении, а $p_{31}=1-p_{1i}-p_{21}$.

Этот подход базируется на правильном определении последовательности принятия решений. Лучше  для описанной ситуации  может подходить вложенная логит-модель с тремя альтернативами, в которой ошибки в полезностях от среднего специального и высшего образования коррелируют между собой и являются независимыми по отношению к ошибке в значении полезности от решения отказаться от образования. Эти модели можно сравнить, используя методы, основанные на  функции правдоподобия и описанные в разделе 8.5. 

\subsection{Модели для ранжированных данных}

В рассмотренных моделях предполагалось, что альтернативы являются взаимно исключающими, и только одна из них может быть выбрана. В более общем смысле, альтернативы могут мыть ранжированы, особенно в случае данных о заявленных предпочтениях. Например, могут быть известна наилучшая и вторая лучшая альтернативы. 

\textbf{Логит-модель с ранжированными исходами} может быть очень просто оценена (см. работу Беггса, Карделла и Хаусмана, 1981). Рассмотрим условную логит-модель с четырьмя альтернативами, когда наилучшей является альтернатива 2, а во второй лучшей --- альтернатива 3. Альтернатива 2 выбрана из всех четырех альтернатив, а затем альтернатива 3 выбрана из оставшихся альтернатив 1, 3 и 4. Совместная вероятность выбора тогда имеет вид 

\[\frac{e^{x'_{i2}\beta }}{e^{x'_{i1}\beta }+e^{x'_{i2}\beta }+e^{x'_{i3}\beta }+e^{x'_{i4}\beta }}\times \frac{e^{x'_{i3}\beta }}{e^{x'_{i1}\beta }+e^{x'_{i3}\beta }+e^{x'_{i4}\beta }}.\] 

Оценка производится методом максимального правдоподобия, аналогичный вид имеют и  остальные 11 совместных вероятностей.

Для мультиномиальной пробит-модели не существует подобной спецификации. Хаджиивасилу и Рууд  (1994) в своей работе описали получение совместных вероятностей симуляционными методами. Они использовали \textbf{пробит-модель с ранжированными исходами}, чтобы проиллюстрировать разнообразие симуляционных методов оценивания.

\section{Ситуации многомерного дискретного выбора}

Описанные выше модели, кроме моделей с ранжированными исходами, являются моделями для одной дискретной зависимой переменной, которая принимает одно из $m$ взаимно исключающих значений. В настоящем разделе мы рассмотрим модели, в которых присутствуют более одного дискретного исхода. Логарифмическая функция правдоподобия аналогична \eqref{GrindEQ__15_5_} для мультиномиальных моделей, а разным моделям соответствуют разные функциональные формы для вероятностей выбора. Эти вероятности могут учитывать корреляцию между различными выборами и их одновременность.

\subsection{ Двумерная дискретная переменная}

Для простоты рассмотрим двумерные дискретные данные $(y_{1i},y_{2i})$. Например, в совместной модели предложения труда и фертильности зависимая переменная $(y_{1i},y_{2i})$ для индивида $i$ может принимать значения $y_{1i}=2$, если индивид работает и $y_{1i}=1$, если не работает, а также $y_{2i}=2$, если имеет детей, и $y_{2i}=1$, если не имеет детей.

В более общем смысле, $y_1$ может принимать значения $1,\dots ,m_1$, а $y_2$ может принимать значения $1,\dots ,m_2$. Для индивида $i$ определим

\begin{equation} \label{GrindEQ__15_50_} p_{ijk}={\Pr  \left[y_{1i}=j,\ y_{2i}=k\right]\ },\ \ j=1,\dots ,m_1,\ \ k=1,\dots ,m_2. \end{equation} 

Обратите внимание, что $p_{ijk}$ определяет вероятности взаимно исключающих событий, и $\sum_j{\sum_k{p_{ijk}=1}}$. Определим $m_1\times m_2$ соответствующих бинарных индикаторов равных $y_{jk}=1$, если $(y_1=j,\ y_2=k)$ и $y_{jk}=0$ в обратном случае. Тогда совместная функция плотности для $i$-го наблюдения будет иметь вид

\[f\left(y_{1i},\ y_{2i}\right)=\prod^{m_1}_{k=1}{\prod^{m_2}_{j=1}{p^{y_{ijk}}_{ijk}}}.\] 

Тогда логарифмическая функция правдоподобия имеет вид $\sum^N_{i=1}{\sum^{m_1}_{k=1}{\sum^{m_2}_{j=1}{y_{ijk}{\ln  p_{ijk}\ }}}}$, а оценка производится методом максимального правдоподобия, как в параграфе 15.4.2.

Основной разницей между многомерными и мультиномиальными моделями является разница в спецификации функциональной формы для вероятностей.

В простейшем случае две дискретные зависимые переменные независимы между собой, и $p_{ijk}={\Pr  \left[y_{1i}=j\right]\ }\times {\rm Pr}[y_{2i}=k]$. Тогда $y_1$ и $y_2$ могут быть смоделированы с помощью независимых мультиномиальных моделей.

Если, наоборот, две переменные рассматриваются как взаимосвязанные, простым решением будет применение мультиномиальной логит-модели для вероятностей $p_{ijk}$. Тогда двумерный исход $(y_1,y_2)$ естественным образом рассматривается как $m_1\times m_2$ одномерный исход. Например, в описанном примере с предложением труда и фертильностью одним из четырех исходов тогда будет наличие работы и детей.

В следующем параграфе рассмотрим модели для этих двух случаев.

\subsection{Двумерная пробит-модель}

Двумерная пробит-модель --- это совместная модель для двух бинарных исходов, которая обобщает индексную функциональную модель (см. параграф 14.4.1) с одной скрытой переменной на случай двух скрытых переменных, которые могут коррелировать между собой.

Зададим ненаблюдаемые скрытые переменные

\begin{equation} \label{GrindEQ__15_51_} y^*_1=x'_1{\beta }_1+{\varepsilon }_1, \end{equation} 

\[y^*_2=x'_2{\beta }_2+{\varepsilon }_2,\] 

где ${\varepsilon }_1$ и ${\varepsilon }_2$ имеют совместное нормальное распределение со средним равным нулю, дисперсией равной единице, и корреляцией равной $\rho $. Тогда \textbf{двумерная пробит-модель } определяет наблюдаемые исходы как

\[y_1=\left\{ \begin{array}{c}
2,\text{ если } y^*_1>0, \\ 
1,\text{ если } y^*_1\le 0, \end{array}
\right.\] 

\[y_2=\left\{ \begin{array}{c}
2,\text{ если } y^*_2>0, \\ 
1,\text{ если } y^*_2\le 0, \end{array}
\right.\] 

где используются обозначения (2, 1), вместо (1, 0), чтобы соответствовать обозначениям, принятым в настоящей главе. Эта модель распадается на две отдельные пробит-модели для $y_1$ и $y_2$, когда корреляция между ошибками $\rho =0$.

Если $\rho \ne 0$, то не существует аналитического решения для вероятностей выбора. Например,

\[{p}_{22}={\Pr  \left[y_1=2,\ y_2=2\right]\ }={\Pr  \left[y^*_1>0,\ y^*_2>0\right]\ }\] 

\[={\Pr  \left[-{\varepsilon }_1<x'_1{\beta }_1,\ -{\varepsilon }_2<x'_2{\beta }_2\right]\ }\] 

\[={\Pr  \left[{\varepsilon }_1<x'_1{\beta }_1,\ {\varepsilon }_2<x'_2{\beta }_2\right]\ }\] 

\[=\int^{x'_1{\beta }_1}_{-\infty }{\int^{x'_2{\beta }_2}_{-\infty }{ \phi \left(z_1,z_2,\rho \right)dz_1dz_2}}\] 

\[=\Phi \left(x'_1{\beta }_1,x'_2{\beta }_2,\rho \right),\] 

где $\phi \left(z_1,z_2,\rho \right)$ и $\Phi \left(z_1,z_2,\rho \right)$, соответственно, функция плотности и функция распределения стандартного нормального распределения $(z_1,z_2)$ со средним равным нулю, единичной дисперсией, корреляцией $\rho $. Здесь четвертое равенство имеет место для двумерного нормального распределения со средним, равным нулю.

Применение алгебраических преобразований для вероятностей других возможных исходов дает 

\[p_{jk}={\Pr  \left[y_1=j,\ y_2=k\right]\ }=\Phi \left(q_1x'_1\beta ,q_2x'_2\beta ,\ \rho \right),\] 

где $q_l=1$, если $y_l=2$, и $q_l=-1$, если $y_l=1$ для $l=1,2$. Это является основой для оценки ММП, подробно описанной у Грина (2003), который также рассматривает расчет предельных эффектов.

Оценивание модели требует расчета двумерного интеграла, которое возможно при применении численных методов. Обобщение до многомерной пробит-модели очевидно, хотя и приведет к сложностям в вычислениях из-за более высоких порядков интеграла. Если все исходы упорядочены, то эта модель может быть обобщена до \textbf{двумерной пробит-модели с упорядоченными исходами}.

Также можно рассмотреть систему одновременных уравнений пробит-модели, которая обобщает \eqref{GrindEQ__15_51_}, допуская эндогенность переменных в правой части уравнений. Например, первое уравнение для $y^*_1$ может включать $y^*_2$ и/или $y_2$ в качестве регрессора, и аналогично $y^*_2$, с введением некоторых ограничений, чтобы обеспечить идентифицируемость модели. Эта модель аналогична системе уравнений тобит-модели, описанной в параграфе 16.8.2.

\section{ Оценка полупараметрическими методами}

В некоторых исследованиях полупараметрические методы оценки распространяются на модели неупорядоченных мультиномиальных данных. Абэ (1999) оценивает условную логит-модель заменяя $x'_{ij}\beta $ в выражении \eqref{GrindEQ__15_10_} на аддитивную составляющую $\sum_p{{\beta }_pf_p(x_{ijp})}$, где $p$ обозначает $p$-ый компонент $x_{ij}$, а функция $f_p(\cdot )$ оценивается по данным. Л.-Ф. Ли (1995) распространил применение метода оценки Кляйна и Спэди (1993) с моделей бинарных исходов на модели мультиномиальных исходов. Полупараметрические методы для мульти-индексных моделей также могут применяться к мультиномиальным моделям с неупорядоченными исходами. Сложность заключается в обеспечении попадания значения прогнозируемых вероятностей в промежуток от нуля до единицы и равенства их суммы единице.

Модели с упорядоченными исходами хорошо поддаются полупараметрическому анализу, поскольку содержат индекс $x'\beta $, который пересекает некоторое количество пороговых значений. Например, в работе Кляйна и Шермана (2002) представлен метод оценки, который является $\sqrt{N}$-состоятельным и асимптотически нормальным как для регрессии, так и для пороговых значений по местонахождению и масштабу, при условии что ошибки независимы от регрессоров. 

\section{Вывод формул для мультиномиальной, условной и вложенной логит-моделей}

Рассмотрим условную и мультиномиальную логит-модели. Мы получим первую и вторую производную логарифмической функции правдоподобия и выражения для эффектов от изменения в значениях регрессоров на вероятности выбора. Затем вложенная логит-модель будет выведена из модели с ошибками ОРЭЗ.

\subsection{Условная логит-модель}

Вероятность в условной логит-модели имеет вид $p_{ij}={e^{x'_{ij}\beta }}/{\sum_l{e^{x'_{il}\beta }}}$. Взяв производную получим

\[\frac{\partial p_{ij}}{\partial \beta }=\frac{e^{x'_{ij}\beta }}{\sum_l{e^{x'_i{\beta }_l}}}x_{ij}-\frac{e^{x'_{ij}\beta }}{{\left(\sum_l{e^{x'_{il}\beta }}\right)}^2}\sum_l{e^{x'_{il}\beta }x_{il}}=p_{ij}x_{ij}-p_{ij}\sum_l{p_{il}x_{il}=}p_{ij}x_{ij}-p_{ij}{\overline{x}}_{i}=p_{ij}\left(x_{ij}-{\overline{x}}_i\right),\] 

где ${\overline{x}}_i=\sum_l{p_{il}x_{il}}$. Тогда 

\[\frac{\partial {\mathcal L}}{\partial \beta }=\sum_i{\sum_j{\frac{y_{ij}}{p_{ij}}}\frac{\partial p_{ij}}{\partial \beta }=\sum_i{\sum_j{\frac{y_{ij}}{p_{ij}}p_{ij}(x_{ij}-{\overline{x}}_i)=\sum_i{\sum_j{y_{ij}\left(x_{ij}-{\overline{x}}_i\right).}}}}}\] 

Отсюда следует, что 

\[\frac{{\partial }^2{\mathcal L}}{\partial \beta \partial \beta' }=-\sum_i{\sum_j{y_{ij}\frac{\partial {\overline{x}}_i}{\partial {\beta }'}}}\] 

\[=-\sum_i{\sum_j{y_{ij}\frac{\partial \sum_l{p_{il}x_{il}}}{\partial {\beta }'}}}\] 

\[=-\sum_i{\sum_j{y_{ij}\sum_l{p_{il}\left(x_{il}-{\overline{x}}_i\right)x'_{il}}}}\] 

\[=\sum_i{\sum_j{p_{ij}\left(x_{ij}-{\overline{x}}_i\right)x'_{ij}}}\] 

\[=\sum_i{\sum_j{p_{ij}\left(x_{ij}-{\overline{x}}_i\right)\left(x_{ij}-{\overline{x}}_i\right)'}},\] 

т.е. \eqref{GrindEQ__15_15_}. В предпоследнем равенстве используется тот факт, что $y_{ij}$ равняется единице ровно для одной альтернативы и нулю в других ситуациях так, что $\sum_j{y_{ij}\sum_l{a_{il}}}=\sum_j{\sum_l{y_{ij}a_{il}}}=\sum_j{a_{ij}}$, а в последнем равенстве используется равенство $\sum_j{p_{ij}\left(x_{ij}-{\overline{x}}_i\right){\overline{x}}'_i}=\sum_j{\left(p_{ij}x_{ij}-{p_{ij}\overline{x}}_i\right){\overline{x}}'_i}=\sum_j{({\overline{x}}_i-{p_{ij}\overline{x}}_i)}{\overline{x}}'_i = 0$, поскольку $\sum_j{p_{ij}=1}$.

Теперь рассмотрим эффект от изменения значения независимой переменной. Для условной логит-модели

\[\frac{\partial p_{ij}}{\partial x_{ij}}=\frac{e^{x'_{ij}\beta }}{\sum_l{e^{x'_{il}\beta }}}\beta -\frac{e^{x'_{ij}\beta }}{{\left(\sum_l{e^{x'_{il}\beta }}\right)}^2}e^{x'_{ij}\beta }\beta =p_{ij}\left(1-p_{ij}\right)\beta ,\] 

в то время как для $j\ne k$

\[\frac{\partial p_{ij}}{\partial x_{ik}}=-\frac{e^{x'_{ij}\beta }}{{\left(\sum_l{e^{x'_{il}\beta }}\right)}^2}e^{x'_{ik}\beta }\beta =-p_{ij}p_{ik}\beta .\] 

Скомбинировав эти результаты, получим \eqref{GrindEQ__15_18_}.

\subsection{Мультиномиальная логит-модель}

Вероятность в мультиномиальной логит-модели определяется как $p_{ij}={e^{x'_i{\beta }_j}}/{\sum_l{e^{x'_i{\beta }_l}}}$. Получим частные производные

\[\frac{\partial p_{ij}}{\partial {\beta }_j}=\frac{e^{x'_i{\beta }_j}}{\sum_l{e^{x'_i{\beta }_l}}}x_i-\frac{e^{x'_i{\beta }_j}}{{\left(\sum_l{e^{x'_i{\beta }_l}}\right)}^2}e^{x'_i{\beta }_j}x_i=p_{ij}x_i-p_{ij}p_{ij}x_i,\] 

а для $k\ne j$

\[\frac{\partial p_{ij}}{\partial {\beta }_k}=-\frac{e^{x'_i{\beta }_j}}{{\left(\sum_l{e^{x'_i{\beta }_l}}\right)}^2}e^{x'_i{\beta }_k}x_i=-p_{ij}p_{ik}x_i.\] 

Совмещая эти результаты, получим

\[\frac{\partial p_{ij}}{\partial {\beta }_k}={\delta }_{ijk}p_{ij}x_i-p_{ij}p_{ik}x_i=p_{ij}\left({\delta }_{ijk}-p_{ik}\right)x_i,\] 

где переменная-индикатор ${\delta }_{ijk}=1$, если $j=k$, и

\[\frac{\partial {\mathcal L}}{\partial {\beta }_k}=\sum_i{\sum_j{\frac{y_{ij}}{p_{ij}}\frac{\partial p_{ij}}{\partial {\beta }_k}}}\] 

\[=\sum_i{\sum_j{\frac{y_{ij}}{p_{ij}}\left({{\delta }_{ijk}p}_{ij}-p_{ij}p_{ik}x_i\right)}}\] 

\[=\sum_i{\left[\sum_j{y_{ij}{\delta }_{ijk}-y_{ij}p_{ik}}\right]x_i}\] 

\[=\sum_i{[y_{ik}-p_{ik}]}x_i,\] 

как утверждается в \eqref{GrindEQ__15_16_}, где в последней строке используется определение ${\delta }_{ijk}$ и равенство $\sum_j{y_{ij}=1}$. Выражение для второй производной имеет вид

\[\frac{{\partial }^2{\mathcal L}}{\partial {\beta }_j\partial {\beta }'_k}=-\sum_i{\sum_j{\frac{\partial p_{ij}}{\partial {\beta }'_k}x_i=-\sum_i{\sum_j{p_{ij}\left({\delta }_{ijk}-p_{ik}\right)x_ix'_i}}}},\] 

откуда получаем \eqref{GrindEQ__15_17_}.

Когда изменяется значение регрессора

\[\frac{\partial p_{ij}}{\partial x_i}=\frac{e^{x'_i{\beta }_j}}{\sum_l{e^{x'_i{\beta }_l}}}{\beta }_j-\frac{e^{x'_i{\beta }_j}}{{\left(\sum_l{e^{x'_{il}\beta }}\right)}^2}\sum_l{e^{x'_i{\beta }_l}}{\beta }_l=p_{ij}{\beta }_j-p_{ij}\sum_l{p_{il}{\beta }_l}=p_{ij}\left({\beta }_j-{\overline{\beta }}_i\right),\] 

где ${\overline{\beta }}_i=\sum_l{p_{il}{\beta }_l}$, как утверждается  в выражении \eqref{GrindEQ__15_19_}.

\subsection{Вложенная логит-модель}

Рассмотрим двухуровневую модель с ошибками ОРЭЗ, заданную в \eqref{GrindEQ__15_32_} и \eqref{GrindEQ__15_33_} с функцией

\[G\left(Y\right)=G\left(Y_{11},\dots ,Y_{1K_1},\dots ,Y_{J1},\dots ,Y_{JK_J}\right)=\sum^J_{j=1}{a_j{\left(\sum^{K_j}_{k=1}{Y^{{1}/{{\rho }_j}}_{jk}}\right)}^{{\rho }_j}\ ,}\] 

которая является обобщением \eqref{GrindEQ__15_34_} благодаря коэффициентам $a_j$. Общий результат модели с ОРЭЗ \eqref{GrindEQ__15_31_} принимает вид ${\Pr  \left[y_{jk}=1\right]\ }={Y_{jk}G_{jk}}/{G(Y)}$, где $G_{jk}$ является производной от $G(Y)$ по $Y_{jk}$, а $Y_{jk}=e^{V_{jk}}$.

Мы получаем 

\[G_{jk}=\frac{\partial G\left(Y\right)}{\partial Y_{jk}}={a_j\left(\sum^{K_l}_{l=1}{Y^{{1}/{{\rho }_j}}_{jl}}\right)}^{{\rho }_j-1}\times Y^{\left({1}/{{\rho }_j}\right)-1}_{jk},\] 

что дает

\[Y_{jk}G_{jk}=a_j{\left(\sum^{K_l}_{l=1}{Y^{{1}/{{\rho }_j}}_{jl}}\right)}^{{\rho }_j}Y^{{1}/{{\rho }_j}}_{jk}.\] 

Тогда 

\[p_{jk}\equiv \frac{Y_{jk}G_{jk}}{G\left(Y\right)}=\frac{a_j{\left(\sum^{K_l}_{l=1}{Y^{{1}/{{\rho }_j}}_{jl}}\right)}^{{\rho }_j-1}Y^{{1}/{{\rho }_j}}_{jk}}{{\sum^J_{m=1}{a_m\left(\sum^{K_l}_{l=1}{Y^{{1}/{{\rho }_m}}_{ml}}\right)}}^{p_m}}.\] 

Вероятность выбора ветви $j$ после упрощений принимает вид

\[p_j\equiv \sum^{K_j}_{k=1}{p_{jk}}=\frac{a_j{\left(\sum^{K_l}_{l=1}{Y^{{1}/{{\rho }_j}}_{jl}}\right)}^{{\rho }_j}}{{\sum^J_{m=1}{a_m\left(\sum^{K_l}_{l=1}{Y^{{1}/{{\rho }_m}}_{ml}}\right)}}^{p_m}}.\] 

Условная вероятность выбора ответвления $k$ при условии выбора ветви $j$ принимает вид

\[p_{k|j}\equiv \frac{p_{jk}}{p_j}=\frac{Y^{{1}/{{\rho }_j}}_{jk}}{\sum^{K_l}_{l=1}{Y^{{1}/{{\rho }_j}}_{jl}}}.\] 

Этот результат приведен в работе Маддалы (1983, стр. 72).

Необходимо подсчитать  это выражение в точке $Y_{jk}={\rm exp}(V_{jk})$. Предположим, 

\[V_{jk}=z'_j\alpha +x'_{jk}{\beta }_j.\] 

Тогда, произведя некоторые алгебраические преобразования, получим

\[{\left(e^{V_{jk}}\right)}^{{1}/{{\rho }_j}}={\rm exp}({z'_j\alpha }/{{\rho }_j}){\rm exp}(x'_{jk}{\beta }_j/p_j),\] 

\[\sum^{K_l}_{l=1}{{\left(e^{V_{jl}}\right)}^{{1}/{{\rho }_j}}}={\rm exp}({z'_j\alpha }/{{\rho }_j}){\rm exp}(I_j),\] 

\[{\left(\sum^{K_l}_{l=1}{{\left(e^{V_{jl}}\right)}^{{1}/{{\rho }_j}}}\right)}^{{\rho }_j}={\exp  \left(z'_j\alpha +p_jI_j\right)\ },\] 

где

\[I_j={\ln  \left(\sum^{K_l}_{l=1}{{\rm exp}(x'_{jk}{\beta }_j/p_j)}\right)\ }.\] 

Отсюда следует, что вероятность выбора ветви $j$ принимает вид

\[p_j=\frac{a_j{\left(\sum^{K_l}_{l=1}{{\left(e^{V_{jl}}\right)}^{{1}/{{\rho }_j}}}\right)}^{p_j}}{\sum^J_{m=1}{{\left(\sum^{K_l}_{l=1}{{\left(e^{V_{ml}}\right)}^{{1}/{{\rho }_m}}}\right)}^{p_m}}}\] 

\[=\frac{a_j{\rm exp}(z'_j\alpha +p_jI_j)}{\sum^J_{m=1}{a_m({\rm exp}(z'_m\alpha +p_mI_m))}},\] 

как и заявлено в \eqref{GrindEQ__15_36_} для первого случая. Обратите внимание, что скалярный параметр $a_j$ можно включить в $z_j$ как специфичную для конкретной ветви фиктивную переменную, поскольку $a_j{\exp  \left(z'_j\alpha +p_jI_j\right)\ }={\rm exp}({\ln  a_j+\ }z'_j\alpha +p_jI_j)$. Без ограничения общности, поэтому, выберем $a_j=1$.

Вероятность выбора ответвления $k$ ветви $j$ имеет вид

\[p_{k|j}=\frac{{\left(e^{V_{jk}}\right)}^{{1}/{{\rho }_j}}}{\sum^{K_l}_{l=1}{{\left(e^{V_{jl}}\right)}^{{1}/{{\rho }_j}}}}=\frac{{\rm exp}({z'_j\alpha }/{{\rho }_j}){\rm exp}(x'_{jk}{\beta }_j/p_j)}{\sum^{K_l}_{l=1}{{\rm exp}({z'_j\alpha }/{{\rho }_j}){\rm exp}(x'_{jl}{\beta }_j/p_j)}}=\frac{{\rm exp}(x'_{jk}{\beta }_j/p_j)}{\sum^{K_l}_{l=1}{{\rm exp}(x'_{jl}{\beta }_j/p_j)}},\] 

как утверждается для второго случая в выражении \eqref{GrindEQ__15_36_}.

\section{Практические соображения}

Мультиномиальная логит-модель адекватна для описания данных или оценки предельных эффектов на вероятности, однако считается плохой, если требуется более структурная интерпретация параметров из-за предположения о независимости от посторонних альтернатив. Оценить мультиномиальную логит-модель можно во многих пакетах.

Вложенная логит-модель может быть оценена в пакете STATA и с помощью дополнения NLOGIT для пакета LIMDEP, а также ее достаточно легко реализовать на языке программирования, таком как GAUSS. Очевидно, что следует использовать эту модель, если имеется очевидная вложенная структура, однако, обычно такой ясной структуры не наблюдается.

Логит-модель со случайными параметрами необходимо специально кодировать на таком языке программирования, как, например, GAUSS, а также требуется использование симуляционных методов оценивания, описанных в главе 12. Кен Трэйн приводит код для этой модели на своем веб-сайте \url{elsa.berkeley.edu/~train}.

Мультиномиальную пробит-модель еще сложнее оценить для случая более четырех альтернатив, и она на практике довольно редко используется успешно. Поэтому в настоящее время предпочитают использовать логит-модель со случайными параметрами.

\section{Библиографические заметки}

\textbf{15.3.} Хорошими основными источниками для освоения мультиномиальных моделей являются работы Амэмии (1981, 1985), Маддалы (1983) и Грина (2003). В работах Бен-Акивы и Лермана (1985), Трэйна (1986) и Борш-Супана (1987) приведен и множество примеров, и обзор теории. В работе Трейна (2003) можно найти великолепное изложение мультиномиальных моделей с неупорядоченными исходами, оценка которых производится симуляционными методами.

\textbf{15.5.} В основополагающей статье МакФаддена (1981) описывается применение моделей дискретного выбора на продвинутом уровне, основной акцент делается на подход, использующий модель случайной полезности. Для более подробной информации об анализе благосостояния ознакомьтесь с работами Смолла и Росена (1981), Трейна (2003, стр. 59-61) и Дагсвика и Карлстрёма (2004).

\textbf{15.6.} В работе Борша-Супана дается блестящее описание и применение вложенной логит-модели.

\textbf{15.7.} Логит-модель со случайными параметрами и другие недавние достижения в этой области описаны в работе Трейна (2003). Ревелт и Трейн (1998) --- это ранний пример использования этой модели.

\textbf{15.8.} Болдак (1999) оценивает с помощью симуляционного правдоподобия мультиномиальную пробит-модель с девятью альтернативами.

\textbf{Упражнения}

\textbf{15-1. } Рассмотрите модель со скрытой переменной, заданной как $y^*=x'\beta +\varepsilon $, с $\varepsilon \sim {\mathcal N}[0, 1]$. Допустим, что мы наблюдаем только $y=2$, если $y^*<\alpha $, $y=1$, если $\alpha \le y^*<U$, и $y=0$, если $y^*\ge U$, где верхняя граница $U$ --- известная для каждого индивида константа и может варьироваться между индивидами, однако $\alpha $ не известно.

\begin{enumerate}
\item  Найдите условные вероятности наступления $y=0$, $y=1$ и $y=2$.

\item  Приведите подробное описание способа получения состоятельных оценок $\beta $ и $\alpha $.
\end{enumerate}

\textbf{15-2. } Используя 50\% подвыборку данных из примера с выбором способа рыбалки из раздела 15.2:

\begin{enumerate}
\item  Оцените условную логит-модель из параграфа 15.2.1.

\item  Прокомментируйте статистическую значимость полученных оценок параметров.

\item  Каков эффект от роста цен на выбор различных способов рыбалки?
\end{enumerate}

\textbf{15-3. } Используя 50\% подвыборку данных из примера с выбором способа рыбалки из раздела 15.2:

\begin{enumerate}
\item  Оцените мультиномиальную логит-модель из параграфа 15.2.2.

\item  Прокомментируйте статистическую значимость полученных оценок параметров.

\item  Каков эффект от роста дохода на выбор различных способов рыбалки?
\end{enumerate}

\textbf{15-4. }Используйте 50\% подвыборку данных из примера с выбором способа рыбалки из раздела 15.2. Допустим, ситуация была сведена к модели с тремя альтернативами, которые были упорядочены так, что $y=0$, если выбрана рыбалка с пристани или пляжа, $y=1$, если выбрана рыбалка с собственной лодки, и $y=2$, если выбрана рыбалка с арендованной лодки.

\begin{enumerate}
\item  Оцените логит-модель с упорядоченными исходами, когда в качестве единственной независимой переменной выступает доход.

\item  Дайте интерпретацию полученным оценкам коэффициентов.

\item  Сравните качество подгонки этой модели с качеством подгонки мультиномиальной модели с тремя альтернативами с доходом в качестве регрессора.
\end{enumerate}



