
\chapter{Модели множественных рисков}

% Тонкости перевода:
%
% 1. competing risks vs hazard function
% В данной главе вводится понятие "конкурирующих рисков", что в оригинале звучит как "competing risks". По сути, здесь имеется в виду конкуренция "причин".
% Очевидно, "(функция) риска" переводит другое слово "hazard". Хотя и там, и там "риски" обозначают "риски завершения длительности" (то бишь, это синонимы), иногда полезно понимать, что когда мы произносим термин "конкурирующие риски", "риски наступления события/причины q", "независимые риски" и т.д., мы переводим слово "risks", а когда произносим термин "функция риска", "базовый" и "интегральный" "риски", "пропорциональные риски" и т.д., мы переводим слово "hazard".
% Моя гипотеза --- что эти термины пришли из независимых концепций о похожих вещах, отсюда и различные названия.
%
% 2. marginal distributions
% переводим как "маргинальные распределения"
% в журнале "прикладная эконометрика" (Фантаццини про копула-функции) используется другой термин "частные распределения"
%
% 3. spell
% хотя это и означает буквально "период", я перевожу его чаще всего как "событие" (иногда "состояние" --- в главе 17), поскольку Кэмерон иногда говорит то event, то spell. Здесь имеется в виду "период, месяц, время года, время и состояние жизни в который наблюдалась длительность", то есть, непосредственно факт события. Например, многократные события (multiple spells) означают, что одно и то же событие повторилось много раз. Грубо говоря, один и тот же период (например, период состояния безработицы или беременности) повторился много раз. А это есть не что иное как повторяющееся событие.
%

% 341, 351, 454 лишние пустые строки 

\section{Введение}\label{sec:19.1}

\noindent
В данной главе мы рассмотрим несколько различных моделей времени жизни, которые составляют класс многомерных моделей, включающих параллельные и повторяющиеся переходы. Любая модель перехода с двумя и более состояниями может быть классифицирована как многомерная модель, поскольку такой анализ подразумевает оценку совместного распределения нескольких длительностей. Несмотря на то, что изучаемые модели могут относиться к различным ситуациям и типам данных, мы представим их в рамках одной главы для организационного удобства.

В качестве пояснения рассмотрим несколько примеров. Уже знакомая из экономики труда модель предполагает, что безработный индивид может быть как нанят на работу, так и исключен из состава рабочей силы. Первый переход можно конкретизировать далее, указав, что индивид вернулся на старую работу или нашел новую. Такие переходы являются взаимоисключающими. Поиски работы могут быть завершены переходом в любое из этих состояний. Как вариант, индивид также может устроиться на полставки, полную ставку или же остаться безработным. В таком случае, существует три возможных состояния. Ранее в главах 17 и 18 мы рассматривали модели перехода для двух состояний, которые применимы и в данном случае, если предположить, что 1 означает полную занятость, а 0 --- любое другое состояние. Для этого, как мы знаем, требуется смоделировать единственный коэффициент риска. Однако данную ситуацию возможно представить в полном виде, то есть, для трех состояний, с двумя переходами и двумя функциями риска, по одной для каждого перехода. В общем же случае, допустимо множество типов отказов, где переход из текущего состояния может произойти по причине любого отказа из этого множества. В данной главе мы хотим представить методы для моделирования таких переходов, и усовершенствовать представленный ранее инструментарий таким образом, чтобы получить возможность анализа множественных рисков, или многомерной модели времени жизни.

В данном контексте представляется важным понять ответы на следующие вопросы:
\begin{enumerate}
\item Как следует моделировать отношение между регрессорами и отказами различных типов?
\item Как следует моделировать взаимосвязь между типами отказов в рамках конкретного исследования?
\item Как оценивать коэффициенты отказа для конкретных типов отказов при условии исключения одного или всех остальных типов?
\end{enumerate}

\textbf{Многомерная модель времени жизни} подразумевает одновременное моделирование всех переходов, то есть, совместную спецификацию и оценивание двух и более функций риска. Существует несколько различных концепций анализа многомерных данных по длительностям, наиболее популярной из которых является идея \textbf{конкурирующих рисков} (\textit{competing risks}). На основе данной модели МакКолл (1996) представляет эмпирическое приложение по анализу данных по безработице с акцентом на роль страхования. Используя аналогичный подход, Денг, Куигли и Ван Ордер (2000) исследуют предварительную выплату или полное погашение ипотечных кредитов.

Однако в чем заключается смысл совместного моделирования отказов? Если отказы, по сути, независимы, то мы получим, в принципе, тот же результат. Ответ на вопрос состоит в том, что различные отказы могут быть связаны друг с другом; например, если в функциях риска присутствует общий параметр ненаблюдаемой гетерогенности, то отказы будут коррелированы.


Вторая группа моделей представляет анализ совместного распределения длительностей в ситуации, когда возможны параллельные переходы. Например, набор $(T_1, T_2)$ может обозначать длительности поисков работы и периода отсутствия страхового полиса. В таком случае идея совместного оценивания рисков аналогична предыдущему примеру.

Третья группа предполагает совместное распределение \textbf{повторяющихся периодов}, или \textbf{длительностей},
того же состояния (например, безработицы или отсутствия страхового полиса). То есть, для данного индивида, мы хотим одновременно смоделировать риски завершения длительности. Если длительности независимы, то анализ может быть представлен в контексте единственного перехода, как было показано ранее. Если же нас интересует структура зависимости переходов, то подходит совместное моделирование длительностей в данном состоянии. Когда длительности зависимы, требуется применение новых методов и моделей. Этот пример сложнее, чем первые два, из-за возможной зависимости между событиями, разбросанными во времени. Например, на вероятность последующих событий и их длительности может влиять предыдущая длительность и тип события, или же вся предыстория. Коррелированная ненаблюдаемая гетерогенность образует связь между повторяющимися событиями так, что вероятность наступления даже того же самого события будет зависеть от предыдущих исходов. Хекман и Борхас (1980) описывают несколько структурных типов зависимости от состояния для индивида, используя такие понятия, как \textbf{зависимость от наступления события} и (марковскую) \textbf{лаговую зависимость от длительности.}

Множеству различных ситуаций и типов данных соответствует разнообразие типов моделей, которые на первый взгляд могут показаться не имеющими друг к другу никакого отношения. Однако, на самом деле, в каждой из них присутствуют общие черты. Мы начнем анализ с определения базовых концепций в разделе \ref{sec:19.2}, а затем представим известную модель конкурирующих рисков. В разделе \ref{sec:19.3} мы рассмотрим многомерную модель, основанную на маргинальных распределениях моментов выживания, и представим подход, использующий копулы для оценки таких распределений. Модели с множественными событиями будут представлены в разделе \ref{sec:19.4}.




\section{Конкурирующие риски}\label{sec:19.2}
% вообще говоря, термин ``конкурирующий'' можно назвать устоявшимся, хотя в некоторых ситуациях ``более по-русски'' звучит ``альтернативный'', например, ``альтернативные причины смерти''.

\noindent
В начале мы определим основные понятия, которые используются в \textbf{модели конкурирующих рисков} (CRM, \textit{competing risks model}) и других многомерных моделях. Часто эти понятия являются общим видом ранее представленных концепций.  Так, базовая формулировка модели CRM применима к моделированию длительности в одном состоянии, где переход происходит по ряду конкурирующих причин, таких как различные способы смерти. Модель CRM является привлекательной благодаря относительной простоте в применении, если базовая модель --- типа PH.


\subsection{Основные понятия}\label{sec:19.2.1}

\noindent
Мы будем рассматривать CRM с $m$ латентными длительностями, или моментами отказа, при соответствующих конкурирующих причинах.

        \begin{center}Латентные длительности\end{center}
        \noindent
Модель устроена следующим образом. Каждый объект характеризуется моментом отказа, который может быть цензурирован. Момент отказа может быть любого типа из множества $J = \{1, \ldots , m\}$, что можно представить как ситуацию, когда существует $m$ различных причин перехода из данного состояния (<<смертей>>). При этом, наступление одного отказа избавляет нас от рисков наступления отказа любого другого типа. В таком случае, при цензурировании оставшихся $(m-1)$ длительностей мы наблюдаем не более одного отказа.

В CRM с $m$ типами отказов существует $m + 1$ возможных состояний $\{0, 1, \ldots , m\}$, где 0 обозначает текущее состояние, а $\{1, \ldots , m\}$ --- возможные состояния в результате перехода. Для $i$-го объекта вектор данных выглядит как $(\x_i, t_i, d_{1i}, \ldots , d_{mi}, d_{ci})$, где $\x_i$ --- это вектор слабо экзогенных регрессоров, соответствующих характеристикам объекта $i$, $t_i = \min(t_{1i}, \ldots , t_{mi}, t_{ci})$, где $t_{ki}$ --- момент перехода в $k$-ое состояние, а $t_{ci}$ --- момент цензурирования, и $d_{ji} \equiv \textbf{1}(t_{ji} = t_i)$, $j = 1, \ldots , m, c$ обозначают дамми переменные, равные единице при $t_{ji} = t_i$. Поскольку мы наблюдаем только $t_{ji}$, остальные длительности подразумеваются латентными.

Цензурирование можно воспринимать как конкурирующий риск, так как оно применяется к объектам в соответствии с распределением вероятностей. В данной главе предполагается, что переменная цензурирования независима от $(t_1, \ldots , t_m)$.

Ненаблюдаемые характеристики объекта $i$ учитываются в виде ненаблюдаемой гетерогенности с параметром $\nu$. Если $\nu$ варьируется с причинами перехода, то параметр записывается как $\nu_j$, $j = 1, \ldots , m$.

        \begin{center}Конкурирующие причины\end{center}
        \noindent
Стандартным примером конкурирующих рисков является смерть, наступившая по одной из конкурирующих причин. Представим, что некоторый индивид перенес операцию по пересадке почки и ожидает либо выздоровления, либо отказа новой почки, либо осложнения, например, со стороны печени. Переход в одно из этих состояний означает невозможность перехода в другие. То есть, в рамках модели с $m$ возможными событиями, каждому событию соответствует одна завершенная длительность и $m - 1$ цензурированных. Таким образом, в модели присутствуют <<конкурирующие риски>>, где конкуренция заключается в том, какой из рисков окажется причиной перехода.

Несмотря на то, что для большинства эмпирических приложений задача формулируется в дискретном времени, мы будем моделировать совместный риск в непрерывном, в соответствии с работой Меалли и Пудни (1996). Также мы будем работать с одноразовыми (немногократными) событиями.

Модель предполагает совместное распределение \textbf{длительности события}, обозначенной как $\tau$, и \textbf{способа перехода} (\textit{exit route}) $r$, переменной, принимающей целые значения из множества $(1, 2, \ldots , m)$.

Для простоты мы не рассматриваем цензурированные наблюдения и предполагаем, что для каждого способа перехода, который может завершить событие, существует латентная переменная из набора $(t_1, \ldots , t_m)$, которая соответствует длительности события, при отсутствии прочих факторов риска, которые могут завершить событие раньше. Регрессоры для каждого способа перехода записываются как $\x_j$ $(j = 1, \ldots , m)$. Мы наблюдаем только наиболее короткую длительность $\tau$, равную
    \begin{align}
    \label{eq:19.1}
    \tau    &= \min(t_1, \ldots , t_m)\\
            &= \min_{j}(t_j), t_j > 0, \notag
    \end{align}
в то время как все остальные длительности цензурированы. Помимо типов перехода мы не рассматриваем никакие другие причины цензурирования. Тогда
    \begin{align}
    \label{eq:19.2}
    \Pr[\tau > t]   &= \Pr[t_1 > t, \ldots ,  t_m > t]\\
                    &= S_{\tau}(t), \notag
    \end{align}
что представляет собой функцию выживания. Если риски независимы, то
    \begin{align}
    \label{eq:19.3}
    \Pr [\tau > t]  &= \Pr [t_1 > t] \times \Pr [t_2 > t] \times \ldots  \times \Pr [t_m > t]
    \end{align}
Соответствующий способ перехода $r$ равен
    \begin{align}
    \label{eq:19.4}
    r = \arg \min_{j \in J}(t_j)
    \end{align}

Если $g_j(t)dt$ обозначает вероятность перехода по причине $j$ в промежутке $(t, t + dt)$, то общий коэффициент риска, соответствующий всем причинам равен
    $$\lambda_\tau(t) \equiv - d/dt \ln S_\tau(t) = \sum_{j=1}^m g_j(t).$$
В биостатистике данный показатель называется \textbf{общей интенсивностью смертности} (\textit{total force of mortality}) (Дэвид и Мошбергер, 1978). Если риски независимы, то коэффициент риска для определенной причины $j$ равен $\la_j(t) = g_j(t)$, что означает, что вероятность отказа по причине $j$ в промежутке $(t, t + dt)$ при условии дожития до момента $t$ одинакова, независимо от того, является ли $j$ одним из рисков или единственным риском.

Вероятность пережить риск % выживания при риске
$j$ в интервале $(T_1, T_2)$ при условии дожития до момента $T_1$ равна
    \begin{align}
    \label{eq:19.5}
    \int_{T_1}^{T_2} \lambda_j(t)dt     &= \int_{0}^{T_2} \lambda_j(t)dt - \int_{0}^{T_1} \lambda_j(t)dt \\
                                        &= \ln S(T_2) - \ln S(T_1) \notag \\
                                        &= - \ln \frac{\Pr [t_j > T_2]}{\Pr [t_j > T_1]}, \notag
    \end{align}
что эквивалентно
    \begin{align}
    \label{eq:19.6}
    \exp{\left( - \int_{T_1}^{T_2} \lambda_j(t)dt \right)} = \frac{\Pr [t_j > T_2]}{\Pr [t_j > T_1]}.
    \end{align}
Единица за вычетом левой части уравнения называется \textit{чистой вероятностью смерти по причине} $j$ (\textit{net probability of death from cause} $j$) в интервале $(T_1, T_2)$. Также с помощью выражения в (\ref{eq:19.6}) можно получить функцию правдоподобия.

        \begin{center}Независимые риски\end{center}
        \noindent
На данном этапе мы можем представить регрессоры, влияющие на коэффициент риска. Мы будем предполагать \textbf{независимость рисков} (в противопоставление их коррелированности) и рассмотрим распределение длительности $t_j$. Коэффициент риска отказа типа $j$ записывается как
    \begin{align}
    \lambda_j(t_j|\x_j) = \lim_{\Delta t_j \rightarrow 0} \frac{\Pr [t_j \le T \le t_j + \Delta t, | T \ge t_j, \x_j]}{\Delta t_j}, \notag
    \end{align}
а интегральный риск $\La_j(t_j|\x_j)$ отказа $j$-го типа определен как
    \begin{align}
    \Lambda_j(t_j|\x_j) = \int_{0}^{t_j} \lambda_j(s|\x_j)ds. \notag
    \end{align}
Тогда, используя отношение между функциями выживания и интегрального риска, получим плотность распределения длительности
    \begin{align}
    f_j(t_j|\x_j, \be_j)    &= \lambda_j(t_j|\x_j, \be_j) S_j(t_j|\x_j, \be_j), \notag \\
                            &= \lambda_j(t_j|\x_j, \be_j) \exp{[-\Lambda_j(t_j|\x_j, \be_j)]}. \notag
    \end{align}
Пусть $\x = [\x_1, \ldots , \x_m]'$ и $\be = [\be_1, \ldots , \be_m]'$, тогда совместная плотность $\tau$ и $r$ равна
    \begin{align}
    \label{eq:19.7}
    f_j(\tau,r|\x,\be)  &= f_r(\tau|\x_r,\be_r) \prod_{j \ne r} \exp{[- \Lambda_j(\tau |\x_j,\be_j)]} \\
                        &= \lambda_r(\tau|\x_r,\be_r) \exp{[-\Lambda_r(\tau|\x_r,\be_r)]} \notag \\
                        &  \times \prod_{j \ne r} \exp{[-\Lambda_j(\tau|\x_j,\be_j)]} \notag \\
                        &= \lambda_r(\tau|\x_r,\be_r) \prod_{j = 1}^{m} \exp{[-\Lambda_j(\tau|\x_j,\be_j)]}, \notag
    \end{align}
где результат в первой строке следует из произведения условной и маргинальной вероятностей, а второй элемент в правой части выражения равен произведению вероятностей выживания для всех способов перехода кроме $r$, при условии что риски независимы.

Из уравнения (\ref{eq:19.7}) следует, что
    \begin{align}
    \label{eq:19.8}
    & \lambda_j(\tau|\x_j,\be_j) \exp{\left[\sum_{j=1}^{m} - \Lambda_j(\tau|\x_j,\be_j) \right]} \\
    &= \lambda_j(\tau|\x_j,\be_j) \exp{[- \Lambda^a (\tau|\x,\be)]}, \notag
    \end{align}
где $\Lambda^a (\tau|\x,\be) = \sum_{j=1}^{m} \Lambda_j(\tau|\x_j,\be_j)$ представляет агрегированный, или общий, интегральный риск. Другими словами, общий риск перехода из начального состояния равен сумме рисков отказа всех типов. Общая функция выживания равна
    \begin{align}
    \label{eq:19.9}
    S(t) = \exp{(-\Lambda^a (t))}
    \end{align}

Функция правдоподобия при условии независимости рисков представляет собой произведение элементов типа (\ref{eq:19.7}) по всем наблюдениям. Зная спецификацию соответствующих функциональных форм, можно получить конкретное выражение для правдоподобия. Такие представленные ранее вопросы, как гибкость функциональной формы и ненаблюдаемая гетерогенность, остаются актуальными в контексте CRM. Мы не будем продолжать обсуждение в общем виде, а рассмотрим вместо этого определенные функциональные формы. Одной из популярных спецификаций в литературе является форма пропорциональных рисков, которая и будет представлена далее.


\subsection{CRM c пропорциональными рисками}\label{sec:19.2.2}

\noindent
Идея заключается в том, чтобы получить совместную плотность длительности события и причины перехода. Сделать это можно с помощью агрегирования интегрального риска по типам перехода.

Рассмотрим модели PH в форме
    $$\lambda_j(t;\x) = \lambda_{0j}(t) \exp{[\x'(t) \be_j]}, j = 1,\ldots ,m,$$
где базовый риск $\la_{0j}$ и $\be_j$ соответствуют риску типа $j$, а $t_{j1} < \ldots  < t_{jk_j}$ --- $k_j$ упорядоченным отказам типа $j$. Например, для $m = 2$ $k_1$ соответствует количеству объектов, зарегистрировавших отказ типа 1, а $k_2$ --- числу объектов с отказом типа 2.

Функция правдоподобия \textbf{CRM Кокса} в таком случае равна

    \begin{align}
    \label{eq:19.10}
    \mathrm{L}(\be_1,\ldots ,\be_m) &= \prod_{j=1}^{m} \prod_{i=1}^{k_j} \frac{\exp{[\x'_{ji}(t_{ji}) \be_j]}}{\sum_{l \in R(t_{ji})} \exp{[\x'_l(t_{ji})\be_j]}}, \\
    &= \prod_{j=1}^{m} \mathrm{L}_j(\be_j), \notag
    \end{align}
где
    \begin{align}
    \label{eq:19.11}
    \mathrm{L}_j(\be_j) = \prod_{i=1}^{k_j} \frac{\exp{[\x'_{ji}(t_{ji}) \be_j]}}{\sum_{l \in R(t_{ji})} \exp{[\x'_l(t_{ji})\be_j]}}.
    \end{align}
    
Обратим внимание на следующие четыре особенности данной функции правдоподобия:
(1) $\mathrm{L}_j(\be_j)$ представляет собой частное правдоподобие, полученное в разделе 17.8.2. % \ref{sec:17.8.2} # UNCOMMENT AFTER 17 CHAPTER
Функция базового риска отсутствует, и в отношении асимптотического распределения применяются результаты, также полученные ранее.
(2) Максимизация $\mathrm{L}(\be_1, \ldots , \be_m)$ возможна с помощью максимизации каждого элемента $\mathrm{L}_j(\be_j)$ в отдельности, при условии, что риски независимы. То есть, совместная максимизация и максимизация по отдельности дают эквивалентные результаты.
Оценивание и сравнение $\be_j$ осуществляется с помощью стандартных асимптотических методов, применимых к каждому элементу из $m$ элементов правдоподобия.
(3) Идеи, представленные в разделах
17.7 % \ref{sec:17.7} # UNCOMMENT AFTER 17 CHAPTER
и 17.8, % \ref{sec:17.8} # UNCOMMENT AFTER 17 CHAPTER
могут быть обобщены. Если формулировка в дискретном виде (в виде дамми переменных) применяется для каждого типа риска, то идентифицируемые компоненты функции риска можно оценить для каждого типа совместно с $\be_j$.
(4) Ненаблюдаемая гетерогенность может быть представлена согласно модели пропорциональных рисков с одноразовым событием и двумя состояниями в главе 18. % \ref{ch:18} # UNCOMMENT IN THE END OF THE BOOK

\subsection{Идентификация CRM}\label{sec:19.2.3}

\noindent
Кокс (1962a) и Тсиатсис (1975) показали, что при отсутствии регрессоров модель CRM неидентифицируема. Другими словами, это означает, что любая модель CRM с зависимыми рисками по внешнему виду % с точки зрения наблюдателя
эквивалентна CRM с независимыми рисками. Хекман и Оноре (1989) показали, что CRM со смешанной PH формой с регрессорами идентифицируема  при определенных предпосылках. Описание основополагающих предпосылок предлагает Ван ден Берг (2001, стр. 3438 --- 3441). В частности, помимо допущений, представленных в главе 17, % \ref{ch:17} # UNCOMMENT IN THE END OF THE BOOK
необходимы дополнительные, такие как <<достаточная изменчивость>> регрессоров или отсутствие между ними идеальной коллинеарности. Также мы вправе требовать, чтобы базовые риски для различных типов не были коррелированы идеально.


\subsection{Интерпретация коэффициентов регрессии}\label{sec:19.2.4}

\noindent
В модели CRM с пропорциональными рисками эффект регрессоров на коэффициент риска аналогичен модели PH в главе 17, % \ref{ch:17} # UNCOMMENT IN THE END OF THE BOOK
однако при непосредственной интерпретации коэффициентов регрессии мы сталкиваемся с той же проблемой, что и в разделе 15.4.3 % \ref{sec:15.4.3} # UNCOMMENT AFTER 15 CH
при интерпретации логит модели множественного выбора. % multinomial logit model (Магнус, стр. 332)

Кроме стандартных выводов нас также может интересовать, как изменение регрессоров повлияет на вероятность перехода способом $r$, что подразумевает более сложные расчеты. Чтобы показать это, запишем непосредственно вероятность перехода способом $r$
    \begin{align}\label{eq:19.12}
    \Pr [r|\tau,\x,\be] = \frac{\lambda_r(\tau|\x_r,\be_r)}{\sum^{m}_{j=1} \lambda_j(\tau|\x_j,\be_j)}.
    \end{align}
Поскольку регрессоры присутствуют и в числителе, и в знаменателе, где знаменатель равен сумме всех рисков, итоговый знак частной производной $\pa\Pr[r|\tau, \x, \be] / \pa x_{rk}$ будет зависеть от параметров модели. Следовательно, знак $\beta_{rk}$ будет отличаться от направления частной производной. (Ситуация полностью аналогична описанной в 15 % \ref{ch:15} # UNCOMMENT IN THE END OF THE BOOK
главе по моделям множественного выбора.) Тем не менее, если конкурирующие риски пропорционального типа, то справедлив следующий результат (Томас, 1996, стр. 31). Если $\beta_{rk} > \beta_{jk}$, $\forall j \ne r$, то $\pa \Pr[r | \tau, \x, \be] / \pa x_{rk} > 0$. Иначе говоря, увеличение $x_k$ приведет к увеличению условной вероятности перехода способом $r$, если оценка данного коэффициента в функции риска $\la_r(\cdot)$ выше, чем соответствующий коэффициент в любой другой функции риска.


\subsection{CRM при наличии ненаблюдаемой гетерогенности}\label{sec:19.2.5}

\noindent
Если конкурирующие риски пропорционального типа, то метод, представленный в предыдущей главе можно обобщить на случай ненаблюдаемой гетерогенности. Общая спецификация ненаблюдаемой гетерогенности допускает наличие случайной компоненты, соответствующей конкретному состоянию. Пусть $\bm{\nu} = (\nu_1, \ldots , \nu_m)$ обозначает вектор параметров ненаблюдаемой гетерогенности с функцией совместного распределения $\bm{G}(\bm{\nu})$, тогда
    \begin{align}
    f_j(\tau,r| \x, \be, \bnu) &= \lambda_j(\tau|\x_j,\be_j,\nu_j) \exp{\left[ \sum^{m}_{j=1} -\Lambda_j(\tau|\x_j,\be_j,\nu_j) \right]} \notag \\
    &= \lambda_j(\x_j,\be_j)\nu_j \exp{\left[ \sum^{m}_{j=1} -\Lambda_j(\tau|\x_j,\be_j)\nu_j \right]}, \notag
    \end{align}
где во второй строке используется предпосылка о мультипликативной гетерогенности.

Данный пример представляет собой модель конкурирующих рисков со случайными эффектами для состояний. Маргинальное по отношению к $\bm{\nu}$ распределение может быть получено за счет исключения $\bm{\nu}$ с помощью интегрирования
    $$f_j(\tau,r|\x,\be) = \int \ldots  \int \lambda_j(\tau|\x_j,\be_j)\nu_j \exp{\left[ \sum^{m}_{j=1} -\Lambda_j(\tau|\x_j,\be_j)\nu_j \right]} d\bm{G}(\bnu),$$
что подразумевает запись $m$-кратного интеграла.

Очевидно, не каждая такая модель может быть рассчитана. Один из случаев, когда вычисления реализуемы, основывается на том, что $m$ параметров $\bm{\nu}$ являются независимыми гамма распределенными случайными величинами. Тогда $m$-кратный интеграл можно представить в виде произведения $m$ интегралов. Примером является модель, предполагающая смесь Вейбулла-Гамма для каждой функции риска при соответствующей причине, поскольку в таком случае конкурирующие риски независимы.

Если допустить коррелированность параметров $\bm{\nu}$, мы получим более интересный случай с зависимыми конкурирующими рисками. На самом деле, такой <<прием>> специально применяется для моделирования зависимости между конкурирующими рисками. Например, если $\bm{\nu}$ имеет многомерное лог-нормальное распределение $\begin{bmatrix} \ln\nu_1 & \ldots  & \ln\nu_m \end{bmatrix}' \sim \mathcal{N}[\bm{0}, \bm{\Sigma}]$, то зависимость реализуется через параметр гетерогенности. При этом, оценка максимума правдоподобия связана с гораздо более сложными вычислениями, поскольку представленный $m$-кратный интеграл не имеет решения в аналитическом виде. В таком случае, применяется интегрирование по методу Монте Карло. Если $m$ равно двум или трем, как во многих прикладных задачах, то вычисления, в принципе, реализуемы, хотя и нетривиальны. Уменьшить размерность интеграла можно с помощью ограничения на структуру матрицы ковариаций. Например, мы можем определить факторную структуру для каждого параметра $\nu_j$, специфицировав ее как линейную функцию от двух независимо идентично распределенных ($iid$) случайных величин с неизвестными весами (факторной нагрузкой, \textit{factor loadings}).


\subsection{CRM с зависимыми конкурирующими рисками}\label{sec:19.2.6}

\noindent
Модель CRM с независимыми рисками имеет значительные вычислительные преимущества перед моделью, где зависимость выражена с помощью параметров гетерогенности, коррелированных между конкурирующими рисками. С другой стороны, такая модель содержит ценную дополнительную информацию о структуре гетерогенности, например, о параметрах связи (\textit{association parameter}). Тем не менее, остается вопрос практического характера --- насколько ограничительной должна быть спецификация коррелированной гетерогенности? В качестве ответа мы рассмотрим случай с двумя параметрами, используя постановку, аналогичную (17.20): % \ref{eq:17.20} # UNCOMMENT AFTER 17 CH
    $$\ln\left[ \int \lambda_1(u)du \right] = -\x'\beta_1 - \nu_1 + \e,$$
    $$\ln\left[ \int \lambda_2(u)du \right] = -\x'\beta_2 - \nu_2 + \e.$$
Предпосылка $\nu_1 = \nu_2 = \nu$ означает, что в обеих моделях риска присутствует одинаковый параметр гетерогенности. Идея заключается в том, что на оба события могут влиять одинаковые параметры, но их масштаб может различаться. Такая ситуация относится к идеально коррелированной гетерогенности между обоими рисками. При меньших ограничениях мы можем предположить коррелированность между $\nu_1$ и $\nu_2$ и оценить параметр связи. Оба предположения можно рассматривать как модели с одним и двумя факторами гетерогенности, соответственно. Обоснованность того или иного подхода зависит от конкретной задачи. Например, если оба риска относятся к одно и тому же объекту, $\nu_1$ и $\nu_2$ можно воспринимать как два индивидуальных фактора, и тогда двухфакторная модель привлекательнее. При этом, есть некоторые теоретические и экспериментальные доказательства, что применение однофакторной модели, когда верна двухфакторная, приводит к значительным искажениям результатов (Линдебум и Ван ден Берг, 1994).




\section{Совместные распределения длительностей}\label{sec:19.3}

\noindent
В данном разделе мы рассмотрим случай с параллельными зависимыми событиями. Предполагается, что моменты выживания непрерывны. Описание представлено в общем виде, где для простоты мы будем рассматривать только нецензурированные длительности, обладающие параметрическими распределениями.

Прикладной анализ логично начать анализ с определенной функциональной формы, описывающей совместные функции выживания или функции плотности. Доступны ли <<стандартные>> функциональные формы, и есть ли общий метод записи моделей, представленных в предыдущих главах, в многомерном виде? Ответы на эти вопросы и будут представлены далее.


\subsection{Обобщение концепции выживаемости на многомерный случай}\label{sec:19.3.1}

\noindent
Имеет смысл начать анализ с обобщения представленных ранее базовых понятий на многомерный случай.

Многомерная функция выживания $S(\bt)$ задается как
    \begin{align}\label{eq:19.13}
    S(\bt)    &= S(t_1,\ldots ,t_q) \\
            &= \Pr [T_1>t_1,\ldots ,T_q>t_q], \notag
    \end{align}
где $T_1, \ldots , T_q$ соответствуют $q$ моментам выживания для одномерных функций выживания $S_j(t_j)$. По определению,
    \begin{align}\label{eq:19.14}
    S_j(t_j)    &= \Pr [T_j>t_j] \\
                &= S(T_1 \ge 0,\ldots , T_j \ge t_j, \ldots , T_q \ge 0) \notag \\
                &= S(0,\ldots ,t_j, \ldots ,0). \notag
    \end{align}
В отличие от одномерного случая
    $$ S(t_1, \ldots , t_q) \ne 1-F(t_1, \ldots , t_q).$$
Например, $S(t_1,t_2) = 1-F(t_1)-F(t_2)+F(t_1,t_2)$.

Совместная плотность $(t_1, \ldots , t_q)$ обозначается как $f(t_1, \ldots , t_q)$. Если $F(t_1, \ldots , t_q)$ непрерывно, то
    \begin{align}\label{eq:19.15}
    f(t_1, \ldots , t_q) = (-1)^q \frac{\partial^q F(t_1,\ldots  , t_q)}{\partial t_1\ldots \partial t_q}.
    \end{align}
\textbf{Совместная функция риска} $\la(t_1, \ldots , t_q)$ записывается аналогично одномерному случаю:
    \begin{align}\label{eq:19.16}
    \lambda(t_1, \ldots , t_q) = \frac{f(t_1, \ldots , t_q)}{S(t_1, \ldots , t_q)}.
    \end{align}
Совместный интегральный риск $\La(t_1, \ldots , t_q)$ представляет собой $q$-кратный интеграл от $\la(t_1, \ldots , t_q)$. Однако такого же простого как и ранее соотношения между $S(t_1, \ldots , t_q)$ и $\La(t_1, \ldots , t_q)$ теперь нет.

Ключевой вопрос заключается в том, возможно ли вывести совместные функции выживания на основе данных определений. Клейтон и Куцик (1985) предложили двумерную модель, которая иллюстрирует представленные понятия. Согласно авторам, сначала следует определить функцию \textbf{отношения перекрестных рисков} (\textit{cross-hazard ratio}), заданную как функцию от двух условных функций риска для $t_1$ при $T_2 = t_2$ и $T_2 \ge t_2$. Так мы получим нелинейное уравнение в частных производных второго порядка, решение которого и даст нам совместную функцию выживания. Детали можно найти в самой статье; при этом следует заметить, что для размерности больше двух применение такого подхода может быть затруднено.


\subsection{Двумерные распределения, основанные на маргинальных}\label{sec:19.3.2}
% примечание: надеюсь, здесь не возникнет ассоциации с бомжами? Такая "калька", обозначающая маргинальные распределения, присутствует в том числе на википедии:
% \url{http://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BF%D1%83%D0%BB%D0%B0}
% нужно ли заменить?

\noindent
Данный раздел представляет краткое описание некоторых методов построения двумерных моделей времени жизни, которые основываются на предположениях о маргинальных функциях выживания. Такие методы будут полезны в том случае, если мы имеем представление о маргинальных распределениях и хотим использовать их как составные элементы для построения модели. Разумеется, выбор составных элементов накладывает определенные ограничения на форму итогового совместного распределения.

Один из подходов, согласно работе Маршалла и Олкина (1990), предполагает, что модель с мультипликативной ненаблюдаемой гетерогенностью, присутствующей в обоих маргинальных распределения, устроена следующим образом. Пусть $f_i(t_i|\x_i, \nu)$, $i = 1, 2$ обозначает маргинальные распределения $t_1$, $t_2$ при данных наборах регрессоров $\x_1$, $\x_2$, где $\nu$ является общим параметром ненаблюдаемой гетерогенности и образует связь между обоими рисками; это является единственной причиной корреляции $t_1$ и $t_2$. В анализе выживаемости такую модель иногда называют моделью <<распределенной уязвимости>> (<<shared frailty>>). Пусть $\nu$, $\nu > 0$ имеет распределение с функцией плотности $g(\nu)$. Тогда двумерное распределение $t_1$, $t_2$ формально записывается как
    \begin{align}\label{eq:19.17}
    f(t_1,t_2|\x_1,\x_2) = \int^{\infty}_{0} f_1(t_1|\x_1,\nu) f_2(t_2|\x_2,\nu) g(\nu) d\nu,
    \end{align}
где параметры распределения пропущены для удобства записи.

Двумерное распределение, полученное в виде \textbf{смеси}, может как иметь, так и не иметь решения в аналитическом виде. Поэтому без определенной параметрической спецификации трудно сказать, насколько оно применимо для расчетов. Более того, итоговое совместное распределение подразумевает положительную корреляцию между $t_1$ и $t_2$, что не всегда так.

Такой подход применим к любому типу данных и может быть адаптирован для анализа выживаемости посредством замены маргинальных распределений на \textbf{маргинальные функции выживания} и выводом \textbf{совместной функции выживания} с помощью интегрирования по $\nu$; то есть,
    \begin{align}\label{eq:19.18}
    S(t_1, t_2|x_1,x_2) = \int^{\infty}_{0} S_1(t_1|x_1,\nu) S_2(t_2|x_2,\nu) g(\nu) d\nu.
    \end{align}
Одним из примеров применения этой идеи является работа Клейтона и Куцика (1985), где авторы использовали данную формулировку, чтобы получить \textbf{двумерную функцию выживания} для маргинальных пропорциональных рисков с гамма гетерогенностью.

Как показано, применение данного подхода связано с определенными ограничениями, одним из которых является предпосылка об однофакторной ненаблюдаемой гетерогенности. Как правило, это ограничение легко обойти, заменив $\nu$ на вектор двух коррелированных элементов $\begin{pmatrix} \nu_1 & \nu_2 \end{pmatrix}$, $\nu_1 > 0$, $\nu_2 > 0$, каждый из которых соответствует функции выживания с совместной вероятностью распределения $g(\nu_1, \nu_2)$. Тогда
    \begin{align}\label{eq:19.19}
    S(t_1, t_2|\x_1, \x_2) = \int^{\infty}_{0} \int^{\infty}_{0} S_1(t_1|\x_1, \nu_1) S_2(t_2|\x_2, \nu_2) g(\nu_1, \nu_2) d\nu_1 d\nu_2.
    \end{align}
Для определенности предположим, что
    \begin{align}
    \nu_1           &= \omega_{11}\e_1 + \omega_{12}\e_2 \notag \\
    \nu_2           &= \omega_{21}\e_1 + \omega_{22}\e_2 \notag \\
    \varepsilon_j   &\sim \mathcal G[1,\sigma^{2}_{j}] , j=1,2, \notag
    \end{align}
где $\{\om_{ij}, i, j = 1, 2\}$ --- неизвестные параметры (веса), часто называемые \textbf{<<факторной нагрузкой>>} (\textit{<<factor loadings>>}). Такая запись означает, что компоненты гетерогенности $(\nu_1, \nu_2)$ являются коррелированными линейными комбинациями независимо идентично распределенных ($iid$) случайных компонент $\e_1$ и $\e_2$, если факторная нагрузка отличается от нуля. Прочие распространенные предпосылки, связанные с ограничениями, заключаются в том, что (i) $(\ln\e_1, \ln\e_2)$ подчиняются стандартному двумерному нормальному распределению или что (ii) $\nu_1$, $\nu_2$ имеют дискретное распределение (конечной смеси). Таким образом, модель (\ref{eq:19.19}) имеет двумерную форму смеси. Также необходимы дополнительные ограничения идентифицируемости (например, нормализация $\om_{11} = 1$). Коэффициент корреляции Пирсона между $\nu_1$ и $\nu_2$, равный $\Cov[\nu_1, \nu_2]/[\V[\nu_1]\V[\nu_2]]^{1/2}$, зависит от $\{\om_{ij}, \sis_j, i, j = 1, 2\}$. Легко убедиться, что его значение не находится в привычном интервале от $-1$ до $+1$. (Заметим также, что соответствующий параметр связи для моментов отказа отличается и равен $\Cov[t_1, t_2]/[\V[t_1]\V[t_2]]^{1/2}$.) Ван ден Берг (1997) вывел точные границы для $\Cor[t_1, t_2|\x]$. В частности, для смешанной модели пропорциональных рисков с постоянным базовым риском справедливо неравенство $-1/3 < \Cor[t_1, t_2|\x] < 1/2$. Также он показал, что эти границы не зависят ни от регрессоров $x$, ни от распределения гетерогенности. Однако если базовый риск меняется, границы корреляции зависят от его изменений.

Спецификация компонент в виде факторной нагрузки имеет вычислительные преимущества по сравнению с той, когда компоненты ненаблюдаемой гетерогенности представлены в произвольном виде. Несмотря на то, что однофакторная модель может быть чересчур ограничительной, модели без ограничений допускают наличие интеграла любой кратности. Как следствие, совместная функция выживания, являющаяся результатом интегрирования, может не иметь выражения в аналитическом виде, и в  таком случае применяется подход на основе симуляций. На момент написания этой книги для оценки подобной модели потребовалось бы выйти за рамки стандартных статистических пакетов.

Спецификация в виде факторной нагрузки накладывает определенные ограничения на модель (Ван ден Берг, 2001; Линдебум и Ван ден Берг, 1994). Например, если одно из маргинальных распределений не указывает на наличие ненаблюдаемой гетерогенности, то $\Cov[\nu_1, \nu_2]$ должна равняться нулю; если $\V[\nu_1] > 0$ и $\V[\nu_2] > 0$, то $\Cov[\nu_1, \nu_2] \ne 0$. Тогда, если $\Cov[\nu_1, \nu_2] = 0$, то одно из маргинальных распределений не содержит ненаблюдаемой гетерогенности.

С практической точки зрения многомерная функция выживания должна быть гибкой. Помимо представленного подхода, связанного с некоторыми ограничениями, существуют альтернативные методы. Один такой перспективный подход основан на анализе копула-функций. Хугаард (2000, стр. 435 --- 437) предлагает описание основ в контексте анализа выживаемости.


\subsection{Подход на основе копула-функций}\label{sec:19.3.3}

\noindent
Копулы, изначально представленные Скларом в 1959 г. на французском (см. также Склар, 1973), были предложены как эффективный метод получения совместных распределений на основе маргинальных, что в особенности удобно, если мы работаем с распределениями, отличными от нормального. Данная идея нашла широкое применение в анализе выживаемости, но может быть использована для работы с совместными распределениями любого набора дискретных, непрерывных или смешанных случайных величин.

Изученные подходы (например, \textbf{метод Маршалла--Олкина}) определяют зависимость между переменными с помощью ненаблюдаемой гетерогенности, что вполне разумно, поскольку трудно представить, что наблюдаемые регрессоры могут отражать все возможные аспекты экономических событий.


        \begin{center}Свойства копулы\end{center}
        \noindent
Для определения копулы рассмотрим набор зависимых равномерно распределенных случайных величин $U_1, \ldots , U_q$ в интервале $[0, 1]$. Взаимосвязь описывается с помощью функции совместного распределения
    \begin{align}\label{eq:19.20}
    C(u_1, \ldots  , u_q) = \Pr[U_1 \le u_1, \ldots  , U_q \le u_q],
    \end{align}
где функция $C(\cdot)$ обозначает \textbf{копулу}, а $u_j$ --- конкретную реализацию $U_j$, $j = 1, \ldots , q$.

Правая часть уравнения обозначает совместную функцию распределения, $F(\cdot)$, где $q$ аргументов копулы можно заменить на $q$ маргинальных функций распределения $F_1(\cdot), \ldots , F_q(\cdot)$. Тогда совместную функцию распределения можно определить как
    $$C(F_1(u_1), \ldots  , F_q(u_q)) = F(u_1, \ldots , u_q).$$
Чтобы получить совместное распределение на основе копула-функции, необходимо объединить набор маргинальных распределений. Поскольку копула представляет собой функциональную форму для объединения выбранных функций, то для различных вариантов $C(\cdot)$ получаются различные совместные распределения. Согласно \textbf{теореме Склара} (\textit{Sklar's theorem}), любое многомерное распределение может быть представлено в виде копулы (\ref{eq:19.20}); более того, если маргинальные распределения непрерывны, то копула определена единственным образом.

В отношении многомерной функции выживания теорема Склара утверждает, что многомерная функция выживания $S(t_1, \ldots , t_q)$ размерности $q$ может быть представлена в виде соответствующей копулы $C(S_1(t_1), \ldots , S_q(t_q))$.

В случае, если $q = 2$, уравнения выглядят следующим образом
    \begin{align}
    F(t_1, t_2)     &= \Pr[T_1 \le t_1, T_2 \le t_2] \notag \\
                    &= 1 - \Pr[T_1 > t_1] - \Pr[T_2 > t_2] + \Pr[T_1>t_1, T_2>t_2] \notag
    \end{align}
и
    \begin{align}
    S(t_1, t_2)     &= \Pr[T_1>t_1, T_2>t_2] \notag \\
                    &= 1-F(t_1) - F(t_2) + F(t_1,t_2) \notag \\
                    &= S_1(t_1) + S_2(t_2) - 1 + C(1-S_1(t_1), 1 - S_2(t_2)), \notag
    \end{align}
где $C(\cdot)$ называется \textbf{копулой выживания} (\textit{survival copula}). Заметим, что здесь $S(t_1, t_2)$ является функцией только от маргинальных распределений.

Копулы обладают свойством симметричности, которое позволяет работать как с копулами, так и с копулами выживания (Нелсен, 1999). Джо (1997) определяет двумерную копулу $C(u, v)$, соответствующую распределению $F(\cdot)$, как двумерную функцию распределения вероятности на единичном пространстве $[0, 1]^2$ с равномерными маргинальными распределениями, определенными на $[0, 1]$. Для всех $(u, v) \in [0, 1]$, $C(u, 0) = C(0, v)$, $C(u, 1) = u$ и $C(1,v) = v$. Заменив $u$ на маргинальную функцию выживания $S(t_1)$, а $v$ --- на $S(t_2)$, получим свойства копулы выживания. В данном случае теорема Склара показывает, что существует функция-копула $C$, такая что
    \begin{align}\label{eq:19.21}
    F(u,v) = C(F_u(u), F_v(v)),
    \end{align}
где $F(u, v) = \Pr[U < u, V < v]$ обозначает двумерную функцию распределения случайных величин $U$ и $V$, а $F_u(u)$ и $F_v(v)$ являются соответствующими маргинальными распределениями.

Если $F$ непрерывна и для одномерных маргинальных распределений существуют квантильные функции $F_{u}^{-1}$ и $F_{v}^{-1}$, то копула (\ref{eq:19.21}) может быть представлена как
    $$C(u_1,u_2) = F(F^{-1}_u(u), F^{-1}_v(v)).$$

Подход на основе копула-функций требует спецификации не только маргинальных распределений каждой случайной величины, но и соответствующей функции (копулы), которая их объединяет. Копула-функция может быть задана так, чтобы измерять зависимость между маргинальными распределениями. Если зависимость не найдена, предполагается, что оба распределения независимы, и оценивание можно производить по отдельности. Если же зависимость присутствует, то оценки можно улучшить с помощью построения совместного распределения на основе копула-функции. Так как копула позволяет выявлять структуру зависимости независимо от формы маргинальных распределений, данный подход может быть весьма полезен для моделирования взаимосвязанных переменных. Степень зависимости, представленную копула-функцией, можно оценить с помощью \textbf{границ Фреше}. Несмотря на очевидные отличия, данный подход имеет фундаментальное сходство с подходом из раздела \ref{sec:19.3.2}, основанного на распределениях смеси, поскольку оба используют маргинальные распределения для получения двумерной функции выживания (19.19).

Рассмотрим пример с $q$ условно независимыми длительностями $(T_1, \ldots , T_q)$ при общей неучтенной гетерогенности $\nu$; для простоты регрессоры исключены. Тогда условная совместная функция выживания равна
    \begin{align}
    \Pr[T_1>t_1, \ldots  , T_q>t_q|v]   &= \Pr[T_1>t_1|v] \times \ldots  \times \Pr[T_q>t_q|v] \notag \\
                                    &= S_1[(t_1)|v]\ldots S_q[(t_q)|v], \notag
    \end{align}
и многомерная функция выживания записывается как
    \begin{align}\label{eq:19.22}
    \Pr[T_1>t_1, \ldots  , T_q>t_q] = \E_v[S_1(t_1)|v, \ldots  , S_q(t_q)|v].
    \end{align}


        \begin{center}Оценка зависимости\end{center} % Измерение?
        \noindent
Функциональная форма копула-функций как таковая не зависит от формы одномерных маргинальных распределений, однако зачастую включает параметр взаимосвязи, являющийся скалярной величиной. Для простоты мы будем рассматривать только двумерные копулы.

Многомерному распределению дискретных случайных величин может соответствовать несколько копула-функций (Джо, 1997, стр. 14). Однако это не является основной проблемой, которая заключается в аппроксимации неизвестного совместного распределения. Поэтому ключевой аспект моделирования состоит в выборе достаточно гибкой параметрической формы для копулы.

\textbf{Параметр взаимосвязи} не обязательно находится в пределах от 0 до 1 и поэтому не поддается интерпретации, в связи с чем его обычно преобразуют в более привычные \textbf{$\bm{\tau}$-Кендалла} и \textbf{$\bm{\rho}$-Спирмена}; см. Джо (1997). Швайцер и Вольф (1981) показали, что корреляция Спирмена может быть выражена исключительно в терминах копула-функции
    $$\rho(t_1,t_2) = 12 \int\int{\{C(u,v) - uv\}}dudv.$$

Рассмотрим любую двумерную совместную функцию распределения $F(t_1, t_2)$ с одномерными маргинальными распределениями $F_1(t_1)$ и $F_2(t_2)$. По определению, $0 \le F_1(t_1)$, $F_2(t_2) \le 1$. Тогда совместная функция распределения ограничена нижней и верхней границами Фреше, $F^-$ и $F^+$, заданными как
    \begin{align}
    F(t_1,t_2) \ge F^{-}(t_1,t_2) &\equiv \max[F_1(t_1) + F_2(t_2) - 1, 0], \notag \\
    F(t_1,t_2) \le F^{+}(t_1,t_2) &\equiv \min[F_1(t_1), F_2(t_2)]. \notag
    \end{align}
Поскольку копулы представляют собой совместные функции распределения, для них также можно найти \textbf{границы Фреше}, которые, в свою очередь, влияют на выбор конкретной копулы. Для каждой копулы существует область допустимых значений \textbf{параметра взаимосвязи} $\ttt$. При этом, по мере того, как $\ttt$ приближается к нижней (верхней) границе допустимых значений, копула приближается к нижней (верхней) границе Фреше. Однако параметрическая форма копулы может быть задана таким образом, что область допустимых значений будет исключать границы Фреше. По этой причине для определенного набора данных одна копула может подходить лучше, чем другая.



        \begin{center}Примеры\end{center}
        \noindent

В таблице \ref{tab:19.1} приведены примеры некоторых двумерных копул, используемых в литературе. Джо (1997) предлагает описание их свойств.

    \begin{table}[!htbp]\caption{\textit{Некоторые стандартные функции Копула}}\label{tab:19.1}
    \begin{center}
\begin{minipage}{12cm}
\begin{tabular}{lll}
\hline \hline
\textbf{Тип}                   &   \textbf{Функция}                         &\textbf{Область}\\
\textbf{копулы}                & $C(u, v)$                                  &\textbf{определения} $\bttt$\\
\hline
Произведение    
&$uv$                                                       
&na\footnote{na, не определена.} \\
FGMS\footnote{Копула Фарли-Гамбла-Моргенштерна, Farlie --- Gumble --- Morgenstern.}        
&$uv(1 + \ttt(1 - u)(1 - v))$                                       
&$-1 < \ttt < +1$ \\
Нормальная\footnote{$\Phi$ обозначает функцию двумерного нормального распределения.}  
&$\Phi[\Phi^{-1}(u) \Phi^{-1}(v);\ttt]$                             
&$-1 < \ttt < +1$\\
Клейтона        
&$(u^{-\ttt} + v^{-\ttt} - 1)^{-1/\ttt}$                           
&$\ttt \in (0, \infty)$\\
Франка         
&$-\ttt^{-1}\ln(\eta - (1 - e^{-\ttt u})(1 - e^{-\ttt v}))/\eta,$   
&$\ttt \in (-\infty, \infty)$\\
&$\eta = 1 - e^{-\ttt}$\\
\hline \hline
\end{tabular}
\end{minipage}
    \end{center}
    \end{table}

Нормальная копула и копула Франка включают границы Фреше в диапазон допустимых значений. Копула Клейтона принадлежит \textbf{семейству Архимедовых копул} и имеет вид $C(u, v) = \phi (\phi^{-1}(1 - u) + \phi^{-1}(1 - v))$; см. Смит (2003).

Предположим, что мы хотим смоделировать набор длительностей $\begin{pmatrix} t_1 & t_2 \end{pmatrix}$, используя копулу Клейтона. Тогда двумерное распределение, записанное в терминах маргинальных функций выживания $S(t_1)$ и $S(t_2)$, будет выглядеть как
    $$(S(t_1)^{-\theta} + S(t_2)^{-\theta} - 1)^{-1/\theta},$$
где мы предполагаем, что маргинальные функции выживания определены с точностью до неизвестных параметров. Как и ранее, эти функции могут учитывать зависимость от регрессоров и ненаблюдаемой гетерогенности, например, в виде модели пропорциональных рисков. Для оценивания применяется метод максимального правдоподобия, основанный на полученных двумерных копулах.

Такой подход также не лишен недостатков, в частности, следует отметить два из них. Во-первых, модель непросто обобщить на случай, когда размерность больше двух. Во-вторых, при выборе функциональной формы следует помнить о возможных ограничениях, например, что конкретная функциональная форма копулы может разрешать только положительную корреляцию между переменными.


        \begin{center}Функции правдоподобия на основе копула-функций\end{center}
        \noindent
Модель на основе копула-функций (в терминах функций распределения) оценивается в два этапа. На первом требуется выбрать копулу, а затем на ее основе выразить функцию правдоподобия (в терминах функций плотности распределения). Рассмотрим частный случай, двумерную модель с нецензурированными моментами отказа $(t_1, t_2)$. Определив $f_j(t_j) = \pa F_j(t_j) / \pa t_j$ и $C_j(F_1, F_2) / \pa t_j$ для $j = 1, 2$, а также $C_{12}(F_1, F_2) = \pa C(F_1, F_2) / \pa t_1 \pa t_2$, получим плотность вероятности
    \begin{align}\label{eq:19.23}
    f(t_1,t_2) = f_1(t_1) f_2(t_2) C_{12} (F_1(t_1), F_2(t_2)),
    \end{align}
где формула $f(t_1, t_2) = \pa^2 F(t_1, t_2) / \pa t_1 \pa t_2$ применяется для вывода функции правдоподобия. Если наблюдения цензурированы, требуется соответствующая поправка (Фрис и Вальдес, 1998, стр. 15 --- 16; Джорджес и др., 2001). 

Различные копулы соответствуют невложенным моделям, % DEF: эконометрические модели, каждая из которых не может быть получена путем наложения ограничений на параметры другой модели
выбор среди которых может быть основан на \textbf{функции правдоподобия со штрафом} (\textit{penalized log-likelihood}). % ALT: выбор среди которых может быть осуществлен

\section{Многократные события}\label{sec:19.4}

\noindent
Различия между параллельными и повторяющимися состояниями были упомянуты в начале главы. Параллельные состояния подразумевают параллельные события, такие как пребывание в безработном состоянии или наличие страхового полиса; повторяющиеся состояния подразумевают последовательные события, такие как первые, вторые и последующие роды. Термин <<многократные длительности>> относится к \textbf{промежуткам времени между повторами} одного и того же события. Совместное моделирование таких данных имеет сходство с совместным моделированием параллельных состояний, так как в обоих случаях используется концепция многомерного распределения. Однако в отличие от параллельных событий, последовательные могут порождать временную (динамическую) зависимость в рисках.

Рассмотрим несколько примеров повторяющихся событий. На рынке труда индивиды могут испытывать последовательность переходов между периодами работы и ее отсутствия. Например, молодые специалисты могут оставаться без работы не один раз. Ньюман и МакКуллах (1984) рассматривают распределение родов во времени в рамках модели рисков. В этом случае, при моделировании коэффициента риска нужно учитывать корреляцию между продолжительностями перерывов между родами. Триведи и Александер (1989) анализируют многократные длительности безработицы среди молодежи в Австралии. В литературе по фертильности ключевой интерес представляет количество времени между последовательными родами (Хекман, Хотц и Уолкер, 1985). Меалли и Пудни (1996) исследуют положительную связь между стажем работы и пенсионным статусом на основе данных из обследования населения по выходу на пенсию в Великобритании. Энгл и Расселл (1998) анализируют временные ряды интервалов между последовательными операциями по определенным ценным бумагам на фондовом рынке. На основе анализа многократных длительностей Стивенс (1999) исследует устойчивость бедности в течение жизни индивидов.

Вышеперечисленные примеры имеют некоторые особенности. В частности, коэффициент риска наступления события может зависеть от предыдущего события, при условии, что предыдущее событие наступило. Во-вторых, важна сама форма зависимости. Длительность предыдущего события, или периода, может быть включена как переменная, объясняющая риск более позднего события; наступление предыдущего события может оказывать воздействие на базовый риск более позднего периода; и, наконец, ненаблюдаемая гетерогенность может демонстрировать автокорреляцию.
Каждая из этих особенностей затрагивает важные аспекты моделирования.

\textbf{Многократные события}, или \textbf{периоды}, порождают лонгитюдные, или панельные, данные, которые помогают разрешить проблему идентификации в отношении влияния динамической зависимости (\textit{the hand of past}) по сравнению с моделями с гетерогенностью в функции риска. При некоторых предпосылках такие данные упрощают учет гетерогенности и выводы в отношении временной зависимости.

Может показаться, что оценивать модели выживания с гетерогенностью и зависимостью довольно трудно. Однако данные по многократным событиям позволяют исследовать те аспекты, анализ которых возможен только при наличии панельных данных. Примерами являются зависимость от наступления события, лаговая зависимость от длительности и автокоррелированная гетерогенность. И лаговая зависимость от длительности, и зависимость от наступления события относятся к зависимости между вероятностью завершения текущего периода и количеством или длительностями предыдущих периодов. С учетом этого было бы неверно исследовать периоды по отдельности, игнорируя их взаимосвязь.

Один из возможных подходов к анализу многократных событий заключается в моделировании зависимости с помощью совместных функций выживания, представленных в предыдущих разделах. Другой подход основан на анализе панельных данных, где нижний индекс вместо времени обозначает номер повтора события. При этом, календарное время также может оказывать влияние. Зависимость событий затрагивает аспекты, которые будут рассмотрены в разделах 22.5 % \ref{sec:22.5} # UNCOMMENT AFTER 22 CH
и 23.6, % \ref{sec:23.6} # UNCOMMENT AFTER 23 CH
посвященных динамическим моделям панельных данных. Различие в обоих подходах возникает из-за возможного цензурирования, возникающего по причине истощения панели или того, что недавние периоды еще не завершены.




\subsection{Модель с двукратными событиями}\label{sec:19.4.1}

\noindent
Некоторые особенности моделей с многократными событиями можно проиллюстрировать на примере модели пропорциональных рисков с двумя периодами, или повторами события. Применительно к эконометрике такие модели представлены в работах Оноре (1993) и Хоровиц и Ли (2003).

Оноре (1993) рассматривает модель пропорциональных рисков вида
        \begin{align}\label{eq:19.24}
        \lambda_s(t|\x,v) = \lambda_{0,s}(t) \phi(\x,\beta)v, \hspace{0.5cm} s=1,2.
        \end{align}
где гетерогенность представлена мультипликативно, а базовый риск, в отличие от параметра гетерогенности, определен для каждого периода. Следовательно, $\nu$ представляет собой фиксированные, или постоянные, характеристики объектов, и такая модель называется моделью с \textbf{фиксированными эффектами}. При условиях, аналогичных требуемым для идентификации смешанной модели PH в главе 18, автор показывает, что модель идентифицируема. При этом, ни предпосылки о распределении $\nu$, ни наличие регрессоров не играют значительной роли.

Оноре также рассматривает другую модель, где предполагается, что гетерогенность определена для каждого периода в отдельности, $\nu_1$ и $\nu_2$, с совместной функцией плотности $g(\nu_1, \nu_2)$. Корреляция между $\nu_1$ и $\nu_2$ показывает автокорреляцию в гетерогенности. Такая модель является моделью со \textbf{случайными эффектами}. Совместная функция выживания $S(t_1, t_2|\x)$ выводится через формулу  (\ref{eq:19.19}) на основе смешиваемого распределения $g(\nu_1, \nu_2)$. Совместная функция выживания идентифицируема в том случае, если идентифицируема маргинальная функция выживания. По сути, условия идентифицирумеости точно такие же, как для модели PH.

Оноре анализирует случай \textbf{лаговой зависимости от длительности} во втором периоде, предполагая, что длительность первого периода $t_1$, воздействует на риск завершения второго периода мультипликативно. Он формулирует достаточные условия для идентифицируемости параметров в условной модели для второго периода при данном наборе регрессоров и $t_1$. При таких условиях, модель пропорциональных рисков с несколькими повторами имеет вид
        \begin{align}\label{eq:19.25}
        \lambda_1(t_1|\x_1,v_1) &= \lambda_{0,1}(t) \phi(\x_1,\beta_1)v_1, \\
        \lambda_1(t_2|\x_2,v_2) &= \lambda_{0,2}(t) \phi(\x_2,\beta_2)v_2, \notag
        \end{align}
где $\x^{a}_{2} = (\x_2, t_1)$ обозначает расширенный вектор регрессоров. Мы не будем обсуждать эти условия здесь. Заметим, что в модели присутствует проблема эндогенности, поскольку, если $\nu_1$ и $\nu_2$ коррелированы, то $t_1$ и $\nu_2$ не являются независимыми.

Наступление события в предыдущем периоде может не только сдвинуть функцию риска в следующем, но и изменить саму спецификацию за счет включения новых регрессоров. Например, безработный индивид может поступить на программу профессиональной подготовки, которая вполне вероятно повлияет на риск завершения следующего периода безработицы. Предположение о слабой экзогенности переменной, отвечающей за получение или повышение квалификации, ставит под вопрос идентификацию такой модели. Аргумент имеет место и для анализа модели с одним периодом (единственным переходом): Предпосылка о некоррелированности регрессоров и ненаблюдаемой гетерогенности вовсе не является безобидной.

В некоторых случаях требуется смоделировать не только многократные длительности для одного состояния, но и длительности для связанных (смежных) состояний. Например, при анализе двух состояний, безработицы и занятости, интерес заключается не только в том, насколько длительность предыдущего периода безработицы влияет на длительность текущего, но и в том, какой эффект оказывает период занятости на последующую вероятность найти работу (риск завершения безработицы). Кроме того, данные о смежных состояниях могут быть недоступны. Например, официальная статистика может предоставлять информацию об индивидах, получающих пособие, в то время как о тех, кто пособие не получает, неизвестно ничего.




\subsection{Общая модель с многократными событиями}\label{sec:19.4.2}

\noindent
Для иллюстрации возможных вычислительных трудностей, возникающих при оценивании моделей с многократными событиями, мы представим краткое описание модели Меалли и Пудни (1996).

Пусть $\bm{\tau} = (\tau_1, \ldots , \tau_k)$ обозначает вектор завершенных длительностей размерности $k$, $r_{k-1}$ --- индекс начального состояния, а $r_k$ --- индекс конечного состояния. Предположим, что длительности между периодами независимы после учета возможной лаговой зависимости от длительности. Пусть $\la_j(\x_j, \be_j)$ обозначает функцию риска для каждого состояния, $\x = [\x_1, \ldots , \x_k]$ и $\be = [\be_1, \ldots , \be_k]$.

Тогда совместная плотность периодов и способов перехода задается как
        \begin{align}\label{eq:19.26}
        &f(\tau_1, r_1, \tau_2, r_2,\ldots , \tau_k|\x_1,\ldots , \x_k,r_0,\beta) \\
        &= f(\tau_1, r_1|\x_1,r_0;\beta)\ldots f(\tau_{k-1},r_{k-1}|\x_{k-1}, r_0, r_1,\ldots , r_{k-2},\beta) \notag \\
        &\times S(\tau_k|\x_k,r_0,r_1,\ldots , r_{k-1}, \beta) \notag \\
        &= \prod^{k-1}_{j=1} \lambda_{r_j}(\tau_j|\x_j,\beta_{r_j}) \exp{\left(-\sum^{k}_{l=1} \Lambda_0(\tau_l|\x_l,\beta) \right)}, \notag
        \end{align}
где применяются определения (17.4) % \ref{eq:17.4} # UNCOMMENT AFTER 17 CH
и (17.6); % \ref{eq:17.6} # UNCOMMENT AFTER 17 CH
также предполагается, что текущая $k$-ая длительность цензурирована (поскольку еще не была завершена).
Допускается, что набор регрессоров может включать лаговые длительности и некоторые регрессоры, которые варьируются между периодами. Данная формулировка сопоставима с формулировкой модели CRM с единственным периодом (\ref{eq:19.7}).

Меалли и Пудни (1996) предлагают подробную модель, используя такую формулировку в качестве основы. Поскольку они допускают наличие ненаблюдаемой гетерогенности с более сложной структурой по сравнению с той, которая была рассмотрена в главе, их вычислительная процедура также требует более сложных методов оценивания. В частности, авторы используют метод имитационного максимального правдоподобия (см. раздел 12.4). % \ref{sec:12.4} # UNCOMMENT AFTER 12 Ch
% ТЕРМИН "имитационного максимального правдоподобия" должен совпадать!!!
% http://www.quantile.ru/08/08-AT.pdf




\section{Пример конкурирующих рисков: длительность безработицы}\label{sec:19.5}

\noindent
Ранее в главах 17 % \ref{ch:17} # UNCOMMENT AFTER 17 CH
и 18 % \ref{ch:18} # UNCOMMENT AFTER 18 CH
мы анализировали продолжительность периода безработицы, игнорируя все прочие состояния после перехода. В данной главе мы представим анализ конкурирующих рисков, используя данные из работы МакКолла (1996). Данные содержат три возможных состояния: полная занятость, частичная занятость и полная либо частичная занятость. Следовательно, мы можем убрать предпосылку о том, что функция риска не зависит от последующего состояния, и построить модель конкурирующих рисков, в которой независимые конкурирующие риски определяют длительность безработицы.

В базе данных МакКолла содержатся 1073, 339 и 574 перехода в каждое из вышеперечисленных состояний, соответственно. Поскольку нет четкой и понятной интерпретации третьего состояния, мы не будем обсуждать его детально. В таблицах \ref{tab:19.2} и \ref{tab:19.3} для каждого перехода представлены результаты оценивания четырех параметрических моделей времени жизни, экспоненциальной и Вейбулла, с обратной гауссовской гетерогенностью и без. Как и ранее, использовалось лишь ограниченное число переменных. Гамма гетерогенность не рассматривалась по причине нестабильности вычислений. Наконец, поскольку риски независимы, оценивание уравнений можно производить по отдельности.

    \begin{table}[!htbp]\caption{\textit{Длительность безработицы: }}\label{tab:19.2}
    \begin{center}
\begin{tabular}{lcccccc}
\hline \hline
&\multicolumn{3}{c}{\textbf{No heterogeneity}}&\multicolumn{3}{c}{\textbf{IF heterogeneity}}\\
\cmidrule(r){2-4}\cmidrule(r){5-7}
\textbf{Risk}                    &\textbf{Риск 1} &\textbf{Риск 2} &\textbf{Риск 3} &\textbf{Риск 1} &\textbf{Риск 2} &\textbf{Риск 3}\\
\textbf{Coefficient Transitions} &\textbf{1,073}  &\textbf{339}    &\textbf{574}    &\textbf{1,073}  &\textbf{339}    &\textbf{574}\\
\hline
RR                  &.472   &--.092 &--.600 &.504   &--.185 &--.562 \\
                    &(.601) &(.976) &(.725) &(.614) &(1.025)&(.744) \\
DR                  &--.575 &--.959 &1.122  &--.806 &--1.051&1.078 \\
                    &(.762) &(1.247)&(.901) &(.781) &(1.295)&(.921) \\
UI                  &--1.424&--1.047&--.966 &--1.544&--1.092&--.963 \\
                    &(.249) &(.524) &(.449) &(.258) &(.544) &(.456) \\
RRUI                &.966   &--.669 &--.432 &1.057  &--.742 &--.482 \\
                    &(.612) &(1.192)&(1.014)&(.627) &(1.23) &(1.033) \\
DRUI                &--.198 &1.987  &2.102  &--0.12 &2.18   &2.158 \\
                    &(1.019)&(1.727)&(1.303)&(1.041)&(1.788)&(1.323) \\
LNWAGE              &.351   &--.257 &.003   &.373   &--.321 &--.007 \\
                    &(.116) &(.179) &(.145) &(.118) &(.191) &(.147) \\
TENURE              &0      &.005   &--.047 &.0006  &.007   &-.047 \\
                    &(.006) &(.013) &(.012) &(.007) &(.014) &(.012) \\
$-\ln\textrm{L}$    &\multicolumn{3}{c}{5,693.63}&\multicolumn{3}{c}{5,687.64} \\
\hline \hline
\end{tabular}
    \end{center}
    \end{table}


\subsection{Оценки модели конкурирующих рисков}\label{sec:19.5.1}

\noindent
Попарное сравнение экспоненциальных моделей с гетерогенностью и без указывает на более высокое качество модели, учитывающей ненаблюдаемую гетерогенность, что аналогично результатам, представленным в разделе 18.8. % \ref{sec:18.8} # UNCOMMENT AFTER 18 CH
При этом, модель Вейбулла без учета гетерогенности лучше экспоненциальной, что соответствует росту логарифму правдоподобия с $-5,666$ до $-5,693$. Наилучшей является модель Вейбулла с обратной гауссовской гетерогенностью с логарифмом правдоподобия, равным $-5,543$. Однако это не означает, что эта модель позволяет осуществлять корректные выводы --- этот вопрос остается открытым. Перейдем к обсуждению результатов из таблицы \ref{tab:19.3}.

С учетом ненаблюдаемой гетерогенности в модели Вейбулла коэффициенты наклона во всех трех функциях риска существенно возрастают: с $1.29$ до $1.75$ для 1 риска и с $1.08$ до $1.65$ для 2 риска, что указывает на убывающую зависимость от длительности, или более крутой наклон коэффициента риска. Такие изменения вполне согласуются с теорией из раздела 18.5. % \ref{sec:18.5} # UNCOMMENT AFTER 18 CH
Ненаблюдаемая гетерогенность оказывает существенный эффект на величину страховки от безработицы (\textit{unemployment insurance}, UI) в модели Вейбулла, который еще более существенен в абсолютных величинах. Коэффициенты при RR, DR, RRUI и DRUI определены неоднозначно. Коэффициент при LNWAGE значителен и положителен в первой функции риска и отрицателен во второй. Это означает, что увеличение LNWAGE ускоряет переход из состояния безработицы для тех, кто ищет работу на полную ставку, но имеет отрицательный эффект для тех, кто находит работу на полставки. Таким образом, модель конкурирующих рисков позволяет оценить роль переменных в различных функциях риска.

\begin{sidewaystable}[!htbp]\caption{\textit{Длительность безработицы: }}\label{tab:19.3}
    \begin{center}
\begin{tabular}{lccccccccc}
\hline \hline
&\multicolumn{3}{c}{\textbf{No heterogeneity}}&\multicolumn{3}{c}{\textbf{IF heterogeneity}}&\multicolumn{3}{c}{\textbf{Модель Кокса}}\\
\cmidrule(r){2-4}\cmidrule(r){5-7}\cmidrule(r){8-10}
\textbf{Risk}                    &\textbf{Риск 1} &\textbf{Риск 2} &\textbf{Риск 3} &\textbf{Риск 1} &\textbf{Риск 2} &\textbf{Риск 3} &\textbf{Риск 1} &\textbf{Риск 2} &\textbf{Риск 3}\\
\textbf{Coefficient Transitions} &\textbf{1,073}  &\textbf{339}    &\textbf{574}    &\textbf{1,073}  &\textbf{339}    &\textbf{574} &\textbf{1,073}  &\textbf{339}    &\textbf{574}\\
\hline
RR                  &.448   &--.085 &--.694 &.736   &--.379 &--.432 &.522   &--.071 &--.469 \\
                    &(.638) &(.992) &(.763) &(.906) &(1.452)&(1.111)&(--.752)&(.951)&(.715) \\
DR                  &--.427 &--.938 &1.361  &--1.072&--1.689&1.167  &--.571 &--1.023&.875 \\
                    &(.809) &(1.279)&(.969) &(1.149)&(1.78) &(1.378)&(.721) &(1.193)&(.878) \\
UI                  &--1.496&--1.109&--1.097&--2.574&--2.063&--1.761&--1.317&--.906 &--.905 \\
                    &(.264) &(.527) &(.46)  &(.384) &(.747) &(.623) &(.237) &(.510) &(.444) \\
RRUI                &1.015  &--.616 &--.305 &1.734  &--.301 &--.515 &.882   &--.781 &--.539 \\
                    &(.646) &(1.204)&(1.047)&(.933) &(1.702)&(1.418)&(.582) &(1.166)&(1.002) \\
DRUI                &--.299 &1.973  &1.991  &--.06  &3.263  &3.669  &--.095 &2.031  &2.293 \\
                    &(1.065)&(1.757)&(1.37) &(1.538)&(2.47) &(1.935)&(.977) &(1.671)&(1.274) \\
LNWAGE              &.366   &--.243 &.043   &.576   &--.494 &--.006 &.335   &--.280 &--.0140 \\
                    &(.122) &(.183) &(.153) &(.177) &(.261) &(.216) &(.110) &(.173) &(.141) \\
TENURE              &--.001 &.005   &--.049 &--.0009&.017   &--.067 &.000   &.005   &--.046 \\
                    &(.007) &(.013) &(.013) &(.01)  &(.019) &(.017) &(.006) &(.012) &(.011) \\
$\al$               &1.29   &1.08   &1.17   &1.75   &1.65   &1.79   &--     &--     &-- \\
                    &(.022) &(.033) &(.028) &(.04)  &(.06)  &(.048) &--     &--     &-- \\
$-\ln\textrm{L}$    &\multicolumn{3}{c}{5,666.13}&\multicolumn{3}{c}{5,543.33} \\
\hline \hline
\end{tabular}
    \end{center}
\end{sidewaystable}

\begin{figure}[ht!]\caption{Длительность безработицы: оценки базовых функций выживания в модели Кокса с конкурирующими рисками. Данные США по 3343 наблюдениям в 1986--92 гг., некоторые наблюдения неполные.}\label{fig:19.1}
\centering
%\includegraphics[scale=0.7]{fig.png}
\end{figure}

Представим модель Кокса в виде модели с конкурирующими рисками из раздела \ref{sec:19.2}. В этой спецификации отсутствует ненаблюдаемая гетерогенность и параметрическая спецификация базового риска. Последний, однако, можно оценить, как было показано в разделе 17.8.3. % \ref{sec:17.8.3} # UNCOMMENT AFTER 17 CH
Точечные оценки, сопоставимые с экспоненциальной моделью в таблице \ref{tab:19.2}, указаны в последних трех столбцах таблицы \ref{tab:19.3}. Стандартные ошибки больше, поскольку спецификация Кокса менее ограничительна, чем экспоненциальная. Оценки коэффициентов при страховке от безработицы ближе к оценкам экспоненциальной модели, чем к оценкам модели Вейбулла--IG, которые превышают настоящие почти в два раза. Коэффициент при LNWAGE также выше в модели Вейбулла--IG. Однако, при том, что ненаблюдаемая гетерогенность неучтена, базовый риск неидентифицируем. На рисунках \ref{fig:19.1} и \ref{fig:19.2}, соответственно, изображены рассчитанные базовые функции выживания и функции кумулятивного риска для трех состояний, которые можно интерпретировать как отражение некоторой ненаблюдаемой гетерогенности и зависимости от длительности. По графикам видно, что базовая функция выживания находится ниже остальных для тех, кто переходит в состояние частичной занятости, в то время как для тех, кто устраивается на полную ставку, она более пологая и лежит выше других. Соответственно, наклон функции кумулятивного риска наиболее крутой для тех, кто устраивается на полставки.

\begin{figure}[ht!]\caption{Длительность безработицы: оценки базовых кумулятивных рисков в модели Кокса с конкурирующими рисками. Данные те же, что и на рисунке \ref{fig:19.1}.}\label{fig:19.2}
\centering
%\includegraphics[scale=0.7]{fig.png}
\end{figure}

Описанный в данном разделе анализ не может быть заключительным и представлен здесь лишь в качестве иллюстрации. На самом деле, существуют серьезные подозрения, что вейбулловская функция риска мисспецифицирована. В частности, анализ МакКолл (1996), проведенный на этих же данных при более гибкой полиномиальной функции риска, свидетельствует об U-образной форме функции риска, что означает, что риск убывает для коротких длительностей и растет для более длительных наблюдений. Монотонная функция риска Вейбулла такую возможность не учитывает. Другие авторы, занимавшиеся моделированием длительностей безработицы на основе данных США, указывают, что при более гибкой функции риска учет ненаблюдаемой гетерогенности не оказывает значительного эффекта на результаты (Мейер, 1990; Хан Хаусман, 1990). Так как мы не наблюдаем этого в нашем примере, возможно имеет смысл попробовать более гибкую спецификацию, например, из раздела 17.10. % \ref{sec:17.10} # UNCOMMENT AFTER 17 CH



\section{Практические соображения}\label{sec:19.6}

\noindent
При моделировании многомерных моделей выживания имеет смысл начать с маргинальных моделей, прежде чем перейти к одновременному оцениванию. Такой подход может быть полезен для того, чтобы определить статистическую адекватность исходной спецификации.

На момент написания этой книги применение многомерных моделей выживания и риска в большинстве случаев потребовало бы написания собственного программного модуля на основе того или иного языка программирования, хотя такое задание и можно было бы упростить за счет использования встроенных библиотек, позволяющих максимизировать или минимизировать функции.

Оценивание модели CRM с независимыми рисками сводится к оцениванию ряда моделей выживания, практическая информация по применению которых была приведена в разделе 17.12. % \ref{sec:17.12} # UNCOMMENT AFTER 17 CH
Среди коммерческого программного обеспечения непросто найти программы для оценивания общих многомерных моделей CRM. Часто доступны лишь некоторые многомерные модели с определенной структурой зависимости. Например, STATA предоставляет расчеты \textbf{распределенной модели уязвимости} (\textit{shared frailty model}). Распределенная модель уязвимости является моделью со случайными эффектами, где компоненты ненаблюдаемой гетерогенности являются общими для каждой группы объектов или периодов и между группами распределены случайно.

Если основной интерес находится в области моделировании структуры зависимости между длительностями, то наиболее привлекательным по отношению к имитационному методу максимального правдоподобия для двумерного случая является подход на основе копула-функций, поскольку он не предполагает численного интегрирования. Данный подход применим и в случае, когда размерность больше двух, например, для моделей с многократными событиями, однако существует относительно мало таких примеров в литературе. Оценивание и тестирование маргинальных моделей возможно на основе стандартных одномерных моделей выживания, где параметр взаимосвязи оценивается с помощью последовательной двухшаговой процедуры. Даже если параметры оцениваются одновременно, оценки маргинальных моделей предоставляют полезную информацию в отношении стартовых значений для итерационных вычислений. Однако нам неизвестно программное обеспечение, которое бы позволяло оценивать такие модели.




\section{Библиографические заметки}\label{sec:19.7}

\begin{itemize}

    \item[\textbf{19.2}]
Хан и Хаусман (1990) предлагают эмпирический пример модели CRM, обобщенной на случай ненаблюдаемой гетерогенности.
В рамках модели CRM со случайными эффектами для состояний МакКолл (1996) анализирует эффект проводимой политики на поведение застрахованных безработных индивидов в поисках работы на полставки, используя для этого модель CRM с коррелированными рисками. В работе Батлера, Андерсона и Буркхаузера (1989) риски смерти и принятия предложения о работе также моделируются на основе CRM с коррелированными рисками.

    \item[\textbf{19.3}]
Первая работа по копула-функциям была написана Скларом в 1959 году на французском языке, однако статья Склара (1973) является хорошим аналогом на английском. Радулович и Вегкамп (дата не указана) приводят доказательство Теоремы Склара. Полезный обзор литературы по копулам с аннотированной библиографией можно найти в работе Фриса и Вальдеса (1998).

    \item[\textbf{19.4}]
Анализ многократных событий представлен в работах Меалли и Пудни (1996) и Флинна и Хекмана (1982). Меалли и Пудни (1996) исследуют переходы среди работ, учитываемых и не учитываемых при расчете пенсии, а также других <<состояний>> на рынке труда, используя симуляционные методы оценивания.

\end{itemize}


\section*{Упражнения}
\begin{enumerate}

    \item[\textbf{19--1}]
(Sapra, 2000; 2001). Данное упражнение иллюстрирует неидентифицируемость модели с конкурирующими рисками, которую привели Кокс и Тсиатсис и упомянутую в разделе \ref{sec:19.2}. Рассмотрим следующую модель с \textit{зависимыми} конкурирующими рисками, для которой известны $T = \min(T_1, T_2)$ и $\de$, где $\de = 1$, если $T = T_1$, и $\de = 2$, если $T = T_2$. Здесь $T_1$ и $T_2$ являются латентными длительностями рисков 1 и 2, соответственно. Предположим, что дана двумерная функция выживания $S(t_1, t_2) = \exp[-(\la_1 t_1 + \la_2 t_2)^\al]$, $0 < \al \le 1$, $\la_1, \la_2 > 0$. Постройте модель с независимыми конкурирующими рисками, эквивалентную обозначенной модели.

    \item[\textbf{19--2}]
Для модели, обозначенной в предыдущем упражнении, выпишите функцию логарифма правдоподобия в терминах коэффициентов риска и коэффициентов интегрального риска, если известны $T$ и $\de$. Исследуйте информационную матрицу параметров и покажите, что все параметры локально идентифицируемы, поскольку матрица невырождена.

    \item[\textbf{19--3}]
Рассмотрим две параллельные длительности, например, длительности периода безработицы, $T_1$, и периода отсутствия частного страхового полиса, $T_2$. Предположим, что длительности независимы условно на ненаблюдаемую гетерогенность и экспоненциально распределены со средними значениями $\beta_0 + \beta_1\x$ и $\ga_0 + \ga_1\x$, соответственно. Обозначим параметры ненаблюдаемой гетерогенности для обеих длительностей как $\nu_1$ и $\nu_2$ с матожиданием $\E[\nu_1] = \E[\nu_2] = 1$.
        \begin{enumerate}
        \item
Запишите такой алгоритм получения коррелированных реализаций $(\nu_1, \nu_2)$ для произвольных значений параметров, чтобы с учетом $\x$, но без учета $(\nu_1, \nu_2)$, обе длительности были коррелированы. Также можно делать любые предположения о совместном распределении $(\nu_1, \nu_2)$, основываясь, например, на соображениях удобства математических вычислений. Объясните, как можно учесть степень корреляции между длительностями.
        \item
Используя для получения двумерного совместного распределения метод, представленный в разделе \ref{sec:19.3.2}, запишите совместное распределение длительностей.
        \item
Опишите, как можно расширить анализ из пункта (b) для наблюдений, цензурированных справа.
        \end{enumerate}


    \item[\textbf{19--4}]
Используя ту же выборку данных МакКолла, что и в главе 18, % \ref{ch:17} # UNCOMMENT AFTER 18 CH
оцените модель с двумя состояниями, безработицы и занятости (то есть, игнорируя различия между полным и неполным рабочим днем как два альтернативных состояния)
        \begin{enumerate}
        \item
Оцените модель одного уравнения Вейбулла и сравните результаты с моделью с независимыми конкурирующими рисками со спецификацией Вейбулла.
        \item
Определите, насколько повысилось качество подгонки модели со спецификацией CRM.
        \item
Оцените и сравните предсказанные значения <<риска найти работу>> при средних по выборке значениях объясняющих переменных в модели одного уравнения и модели CRM.
        \end{enumerate}

\end{enumerate}
