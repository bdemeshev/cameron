
\part{Методы симуляционного моделирования}

В первой части говорилось о том, что, как правило, микроэконометрические модели нелинейны и для оценки этих моделей используются объемные, гетерогенные данные, полученные в ходе трудоемких эмпирических исследований, для которых характерно смещение в выборке. При такой постановке проблемы для более реалистичного описания экономической ситуации часто используются модели с трудоемкой процедурой оценивания и следующих из нее статистических выводов. Достижения в области вычислительной техники и программирования позволяют справиться с трудностями вычислений. В третьей части представлены современные, требующие больших затрат вычислительных ресурсов, методы оценки, которые позволяют облегчить процесс расчетов. Для освоения материала этой главы необходимо знание материала предыдущих частей, в особенности методов наименьших квадратов и максимального правдоподобия.

В главе 11 рассмотрены методы бутстрэпа, применяемые для статистических исследований. Преимущество этих методов состоит в упрощении процедуры вычисления стандартных ошибок в то время как формула для расчета следующая из асимптотической теории очень сложная, к примеру, расчет может состоять из двухшаговой процедуры. Вместе с тем, применение бутстрэпа, позволяет уточнить асимптотическую теорию, что может привести к улучшению статистических выводов для выборок малого размера.

В главе 12 рассмотрены методы симуляционного моделирования. С помощью этих методов производится оценка параметров, когда стандартные методы не работают из-за наличия интеграла по вероятностному распределению, наличие которого не позволяет получить решение в аналитическом виде.

В главе 13 рассмотрены байесовские методы. Байесовские подходы к оценке параметров и статистическим выводам значительно отличаются от классических подходов. Несмотря на отличие байесовского подхода, для выборок большого размера результаты аналогичны выводам, полученным в результате использования классических методов. Кроме того, байесовские методы часто оказываются более эффективны с точки зрения вычислений.


\chapter{Бутстрэп методы}
\section{Введение}

Для большинства микроэконометрических методов и соответствующих им тестовых статистик невозможно получить точные результаты для конечной выборки. Статистические выводы, которые рассматривались ранее и основанные на асимптотической теории, как правило, приводили к нормальному или хи-квадрат распределению.

Альтернативным асимптотике способом приближенной оценки является бутстрэп, впервые предложенный Эфроном (Эфрон, 1979, 1982). Бутстрэп позволяет построить приближенное к истинному распределение статистики с помощью метода Монте-Карло. Искусственная случайная выборка строится на основе эмпирического распределения или оцененного распределения для полученных данных. Дополнительные расчеты легко сделать с помощью современной вычислительной техники. Тем не менее, как и в стандартных методах, в основе бутстрэпа лежит асимптотическая теория, за счёт которой получаются точные оценки для бесконечно больших выборок.

Методы бутстрэпа можно разделить на две группы. К первой группе относят наиболее простые подходы, которые позволяют сделать статистические выводы, например, рассчитать стандартные ошибки, когда традиционные методы не справляются. Ко второй группе относят более сложные подходы, дополнительное преимущество которых заключается в возможности асимптотических уточнений, приводящих к более точным выводам для малых выборок. Для прикладных исследований наибольший интерес представляют подходы первой группы. Теоретические исследования отдают предпочтение второй группе, особенно в случаях, когда стандартные асимптотические методы плохо работают на конечной выборке.

В литературе по эконометрике бутстрэп рассматривается применительно к тестированию гипотез, и основан на приближенной оценке вероятности в хвостах распределения статистик. Также бутстрэп можно применять для расчета доверительных интервалов, оценки стандартных ошибок и коррекции смещения оценок. Бутстрэп легко реализовать для гладких  $\sqrt{N}$-состоятельных оценок, полученных на основе независимо одинаково распределенных выборок. Не смотря на это,  методы бутстрэпа с асимптотическими уточнениями используются слишком редко. В других задачах необходима осторожность, в том числе для расчета негладких оценок, таких как медиана, непараметрических оценок и при работе с  данными, которые не являются независимыми и одинаково распределенными.

Вполне полное описание бутстрэпа сделано в разделе 11.2, пример использования бутстрэпа рассмотрен в разделе 11.3, и некоторые теоретические вопросы представлены в разделе 11.4. Прочие варианты бутстрэпа рассмотрены в разделе 11.5. В разделе 11.6 рассмотрено применение бутстрэпа для специфического типа данных и специфических методов, используемых в микроэконометрике.
 
\section{Бутстрэп. Краткий обзор}

В этом разделе представлены основные методы бутстрэпа для оценки параметра $\hat{\theta}$ на независимо и одинаково распределенных данных $\{w_1, \ldots, w_N \}$, где, как правило, $w_i=(y_i,x_i)$ и $\hat{\theta}$ --- гладкая асимптотически нормальная и $\sqrt{N}$-состоятельная оценка. Для простоты обозначений рассмотрим скалярную $\theta$. В большинстве случаев для вектора $\theta$, $\theta$ достаточно просто заменить на $j$-ый элемент вектора $\theta$, $\theta_j$.

Интересующие нас статистики включают стандартные регрессионные показатели: оценку $\hat{\theta}$; стандартные ошибки $s_{\hat{\theta}}$; $t$-статистику $t=(\hat{\theta}-\theta_0)/s_{\hat{\theta}}$, где $\theta_0$ предполагаемое в нулевой гипотезе значение; соответствующее критическое значение $t$-статистики, точное P-значение и доверительный интервал. Далее рассмотрено применение бутстрэпа для каждой из вышеперечисленных статистик, теоретические аспекты см. в разделе 11.4.

\subsection{Бутстрэп без уточнения}

Рассмотрим оценку дисперсии выборочного среднего $\hat{\mu}=\overline{y}=N^{-1}\sum^{N}_{i=1}y_i$, где скалярные случайные величины $y_i$ независимы и одинаково распределены с параметрами $[\mu, \sigma^2]$, и известно, что $\V[\hat{\mu}]=\sigma^2/N$.

Оценка дисперсии $\hat{\mu}$ может быть получена путем создания $S$ выборок из генеральной совокупности размерностью $N$, и, следовательно, будут получены $S$ средних значений и $S$ оценок $\hat{\mu}_s=\overline{y}_s$, $s = 1,\ldots, S$. Таким образом, возможно оценить $\V[\hat{\mu}]$ через $(S - 1)^{-1}\sum^{S}_{s=1}(\hat{\mu}_s - \overline{\hat{\mu}})^2$, где $\overline{\hat{\mu}} = S^{-1}\sum^{S}_{s=1}\hat{\mu}_s$.

Естественно, что данный подход невозможно применить, поскольку у нас есть только одна выборка. Для использования бутстрэпа представим, что данная выборка есть генеральная совокупность. В таком случае, конечная выборка может быть представлена реальными данными $y_1,\ldots, y_N$. Распределение $\hat{\mu}$ можно получить построив $B$ бутстрэповских выборок из генеральной совокупности размера $N$, где каждая выборка размера $N$ получена путем случайной выборки из $y_1,\ldots , y_N$ с повторениями. В результате получим $B$ выборочных средних и $B$ оценок $\hat{\mu}_b = \overline{y}_b$, $b = 1,\ldots, B$. Тогда оценка $\V[\hat{\mu}]$ может быть получена из выражения $(B-1)^{-1}\sum^B_{b=1}(\hat{\mu}_b-\overline{\hat{\mu}})^2$, где $\overline{\hat{\mu}}=B^{-1}\sum^B_{b=1}\hat{\mu}_b$. Выборка с повторениями может казаться нарушением стандартных правил формирования выборки, тем не менее в действительности  стандартная теория формирования выборки подразумевает возможность повторений (см. раздел 24.2.2).

При наличии дополнительной информации возможно  создать бутстрэповскую выборку другими способами. Например, если известно, что $y_i$ распределено нормально $y_i \sim \cN [\mu,\sigma^2]$, то возможно сформировать $B$ выборок размера $N$ из распределения $\cN [\hat{\mu},s^2]$. Такой бутстрэп является примером параметрического бутстрэпа, в то время как предыдущий вид бутстрэпа создается на основе эмпирического распределения.

Для оценки $\hat{\theta}$ могут быть использованы аналогичные виды бутстрэпа, например, для оценки $\V[\hat{\theta}]$ и, соответствующих им стандартных ошибок, в случаях, когда аналитические формулы расчета $\V[\hat{\theta}]$ сложны. Как правило, такие методы бутстрэпа применимы для наблюдений $w_i$, независимо и одинаково распределенных по $i$, и порождают оценки со свойствами, похожими на свойства оценок, получаемых обычными асимптотическими методами.


\subsection{Асимптотические уточнения}

При решении некоторого класса задач методом бутстрэпа возможно достичь более точного результата, и, соответственно, оценки будут эквивалентны полученным на основе уточненной асимптотической теории, и будут лучше описывать распределение  $\hat{\theta}$ в конечной выборке. Основу данной главы составляет рассмотрение асимптотических уточнений.
 
Как правило, асимптотическая теория использует результат: $\sqrt{N}(\hat{\theta}-\theta_0) \stackrel{d}{\rightarrow} \cN[0,\sigma^2]$. Таким образом, 

\begin{equation}
\Pr[\sqrt{N}(\hat{\theta}-\theta_0)/ \sigma \leq z] = \Phi(z)+R_1,
\end{equation}
где $\Phi(\cdot)$ функция стандартного нормального распределения и $R_1$ остаточный член, значение которого стремится к нулю при $N \rightarrow \infty$. 

Этот результат получен с использованием асимптотической теории, подробно рассмотренной в разделе 5.3, который также включает центральную предельную теорему (ЦПТ). В основе ЦПТ лежит урезанное разложение в степенной ряд. Разложение Эджворта детально рассмотрено в разделе 11.4.3. При добавлении еще одного члена получаем:

\begin{equation}
\Pr[\sqrt{N}(\hat{\theta}-\theta_0)/ \sigma \leq z] = \Phi(z)+\dfrac{g_1(z)\phi(z)}{\sqrt{N}}+R_2,
\end{equation}
где $\phi(\cdot)$ плотность стандартного нормального распределения, $g_1(\cdot)$ ограниченная функция согласно (11.13) в разделе 11.4.3 и $R_2$ остаточный член, который исчезает при $N \rightarrow \infty$.

Разложение Эджворта сложно применять с теоретической точки зрения, поскольку функция $g_1(\cdot)$ зависит от данных сложным образом. Бутстрэп с асимптотическим уточнением предлагает простой вычислительный метод для применения разложения Эджворта. Теоретическое рассмотрение вопроса дано в разделе 11.4.4.

Поскольку $R_1=O(N^{-1/2})$ и $R_2=O(N^{-1})$, асимптотически $R_2<R_1$, и мы получаем более удачное приближение при $N \rightarrow \infty$. Однако в конечных выборках возможно что $R_2>R_1$. Бутстрэп с асимптотическим уточнением дает улучшенное асимптотическое приближение, что должно способствовать получению более точного приближения в конечных выборках типичного размера. Тем не менее, нет гарантии что такое улучшение произойдет и симуляционное моделирование часто используется, чтобы проверить действительно ли выгоды имеют место.

\subsection{Статистика, асимптотически не зависящая от неизвестных параметров}

Чтобы получить асимптотическое улучшение, предельное распределение бутстрэпируемой статистики не должно зависеть от неизвестных параметров. Данный результат объясняется в разделе 11.4.4.

В качестве примера рассмотрим процесс формирования выборки из $y_i \sim [\mu, \sigma^2]$. Тогда оценка $\hat{\mu}=\overline{y} \stackrel{a}{\sim} \cN[\mu, \sigma^2/N]$ не является статистикой в узком смысле слова, даже при заданном значении нулевой гипотезы $\mu = \mu_0$, поскольку данное распределение зависит от неизвестного параметра $\sigma^2$. Статистика Стьюдента $t=(\hat{\mu} - \mu_0)/s_{\hat{\mu}} \stackrel{a}{\sim} \cN[0,1]$ асимптотически не зависит от неизвестных параметров. 

Оценки неизвестных параметров, как правило асимптотически не являются статистиками в узком смысле слова. Традиционные тестовые статистики, имеющие стандартное нормальное или хи-квадрат распределение, в том числе статистика Вальда, статистика множителей Лагранжа, а также тест отношения правдоподобия и соответствующие им доверительные интервалы асимптотически не зависят от неизвестных параметров.  

\subsection{Бутстрэп}

В этом разделе мы приводим общее описание бутстрэпа, а детали изложены в последующих разделах.


\subsubsection*{Алгоритм бутстрэпа}


Общий алгоритм бутстрэпа состоит из следующих шагов:

\begin{enumerate}
\item  На основе данных $w_1,\ldots, w_N$ и выбранного метода строится бутстрэповская выборка размером $N$, $w_1^*,\ldots ,w_N^*$.


\item На основе бутстрэповской выборки рассчитывается статистика, а именно: (a) оценки параметра $\theta$ --- это $\hat{\theta}^*$, (b) стандартные ошибки $s_{\hat{\theta}^*}$ оценки $\hat{\theta}^*$,(c) $t$-статистика, $t^*=(\hat{\theta}^*-\hat{\theta})/s_{\hat{\theta}^*}$, центрированная на исходную оценку $\hat{\theta}$. Таким образом, $\hat{\theta}^*$ и $s_{\hat{\theta}^*}$ рассчитываются обычным методом, но с использованием новой бутстрэповской выборки.


\item Шаги 1 и 2  повторяются $B$ раз, при этом $B$ достаточно велико, в результате мы получаем $B$ значений интересующей нас статистики, скажем, $\hat{\theta}_1^*,\ldots ,\hat{\theta}_B^*$ или  $t_1^*,\ldots ,t_B^*$.

 
\item Используя полученные $B$ значений статистики, мы получаем  бутстрэповский вариант статистики, согласно описанию данному в последующих подразделах.
\end{enumerate}

Данный алгоритм допускает много вариаций, которые отличаются способом получения бутстрэповской выборки, количеством бутстрэповских выборок, бутстрэпировуемой статистикой и тем, зависит ли асимптотически данная статистика  от неизвестных параметров.


\subsubsection*{Процесс формирования выборки бутстрэпом}


Бутстраповский процесс порождающий данные на шаге 1 используется в качестве аппроксимации истинного процесса порождающего данные.

Самый простой бутстрэп предполагает использование эмпирического распределения данных, т.е. исходная выборка выступает в роли генеральной совокупности. Таки образом $w_1^*,\ldots ,w_N^*$ формируются путем случайной выборки из  $w_1,\ldots ,w_N$ с повторениями. В каждой бутстрэповской выборке, полученной таким образом, некоторые элементы исходной выборки могут встречаться несколько раз, а другие могут не встречаться вообще. Такой бутстрэп называют бустрэпом эмпирического распределения (empirical distribution function bootstrap) или непараметрическим бутстрэпом. Вместе с тем, этот подход получил название парного бутстрэпа, поскольку в регрессионных моделях с одним уравнением $w_i=(y_i,x_i)$, и новые выборки создаются для обеих переменных $y_i$ и $x_i$. 

Предположим, что задано условное распределение данных, $y|x\sim F(x,\theta_0)$ и имеется оценка $\hat{\theta} \stackrel{p}{\rightarrow} \theta_0$. Тогда, на первом шаге можно сформировать бутстрэповскую выборку, используя исходные $x_i$ и формируя новые значения $y_i$ случайным образом, учитывая заданное распределение $F(x_i,\hat{\theta})$. Такая процедура соответствует регрессорам с фиксированными значениями в повторных выборках (см. раздел 4.4.5). В качестве варианта, возможно сначала сформировать $x_i^*$ случайной выборкой из исходных значений $x_1,\ldots, x_N$ и, затем, сгенерировать $y_i$ случайно, используя распределение $F(x_i^*,\hat{\theta})$, $i=1,\ldots, N$. Оба вышеприведенных способа относятся к параметрическому бутстрэпу, который может быть применен в полностью  параметрических моделях.


Для регрессионной модели с независимо и одинаково распределенной аддитивной ошибкой, например, $y_i=g(x_i,\beta)+u_i$ можно получить предсказанные значения остатков $\hat{u}_1,\ldots ,\hat{u}_N$, где $\hat{u}_i=y_i-g(x_i,\hat{\beta})$. Тогда, на первом шаге бутстрэпа сделаем из этих остатков новую случайную выборку $(\hat{u}_1^*,\ldots ,\hat{u}_N^*)$, итогом будет формирование бутстрэповской выборки $(y_1^*,x_1),\ldots,(y_N^*,x_n)$, где $y_i^*=g(x_i,\hat{\beta})+u_i^*$. Такой бутстрэп получил название бутстрэпа остатков. Этот подход занимает промежуточное положение между непарметрическим и параметрическим бутсрэпом. Бутстрэп остатков может применяться, если распределение остатков не зависит от неизвестных параметров.

Мы обращаем особое внимание на парный бутстрэп. Он прост, применим ко многим нелинейным моделям, опирается на довольно слабые предпосылки о распределении.  В то же время, другие виды бутстрэпа обычно дают лучшую аппроксимацию, чем парный бутстрэп (см. Хоровиц, 2001, стр.3185) и должны применяться при выполнении необходимых предпосылок.

\subsubsection*{Количество выборок бутстрэпа}

Асимптотические свойства бутстрэпа основаны на предпосылке $N \rightarrow \infty$, поэтому бутстрэповские статистики могут быть асимптотически корректными и для малых $B$. Тем не менее, что бутстрэп более точен при $B \rightarrow \infty$. Какое значение $B$ считать достаточно большим? Ответ на этот вопрос зависит от приемлемого уровня бустраповской ошибки, вызванной симуляциями, и от цели использования бутстрэпа.

Эндрюс и Бучински (2000) предложили практический численный метод для определения количества репликаций $B$ необходимых для достижения требуемой точности, или метод для определения степени точности, получаемой при заданном значении $B$. Допустим, что $\lambda$ это искомое значение, а именно, стандартная ошибка или критическое значение статистики, тогда $\hat{\lambda}_\infty$ обозначает идеальную бутстрэповскую оценку при $B=\infty$, а $\hat{\lambda}_B$ --- оценку с количеством бутстрэповских выборок равным $B$. Эндрюс и Бучински (2000) показали, что

\[
\sqrt{B}(\hat{\lambda}_B-\hat{\lambda}_{\infty})/\hat{\lambda}_{\infty} \stackrel{d}{\rightarrow} \cN[0,w],
\]
где $w$ меняется в зависимости от приложения и задано в таблице III Эндрюс и Бучински (2000). Следовательно, $\Pr[\delta \leq z_{\tau/2} \sqrt{w/B}]=1-\tau$, где $\delta=|\hat{\lambda}_B-\hat{\lambda}_{\infty}|/\hat{\lambda}_{\infty}$ обозначает относительное отклонение зависящее от количества репликаций, $B$. Таким образом, выполнение неравенства $B \geq wz_{\tau/2}^2 / \delta^2$ означает, что относительные отклонения меньше $\delta$ с вероятностью не ниже $1-\tau$. Иными словами, при заданном количестве репликаций $B$ относительные отклонения меньше $\delta=z_{\tau/2}\sqrt{w/B}$.

Для практического руководства мы предлагаем правило <<большого пальца>>
\[
B=384w.
\]

Данное правило обеспечивает относительное отклонение меньше $10\%$ с вероятностью не менее $95\%$, поскольку $z_{.025}^2/0.1^2=384$. Единственная трудность в применении такого подхода заключается в оценке $\omega$, значение которого может меняться в зависимости от приложения.

Для оценивания стандартной ошибки $\omega=(2+\gamma_4)/4$, где $\gamma_4$ коэффициент эксцесса бутстрэповской оценки $\hat{\theta}^*$. Интуитивно,  тяжелые хвосты распределения приводят к более вероятным выбросам, и затрудняют оценивание  стандартной ошибки. Следовательно, если $\gamma_4=0$, то достаточно, чтобы $B=384{\times}(1/2)=192$, в то время как при $\gamma_4=8$ количество $B$ должно быть равно 960. Таким образом, это значение превышают $B=200$, ранее предложенное Эфроном и Тибшарани (1993, стр.52) как вполне достаточное.

Для проведения симметричного двустороннего теста или построения двустороннего доверительного интервала на уровне значимости $\alpha$, $w$ должна быть равна $\alpha(1-\alpha)/[2z_{\alpha/2}\phi(z_{\alpha/2})]^2$. Следовательно, $B=348$ при $\alpha=0.05$ и $B=685$ при $\alpha=0.01$. Как и ожидалось, чем дальше мы залезаем в хвосты распределения, тем больше должно быть количество бутстрэповских выборок.

Для проведения одностороннего или несимметричного двустороннего теста или построения доверительного интервала на уровне значимости $\alpha$ используется $w=\alpha(1-\alpha)/[z_{\alpha}\phi(z_{\alpha})]^2$. Следовательно, $B=634$ при $\alpha=0.05$ и $B=989$ при $\alpha=0.01$. Для одностороннего теста $B$ должно быть больше. Для хи-квадрат тестов с $h$ степенями свободы $w=\alpha(1-\alpha)/[\chi_{\alpha}^2(h)f(\chi_{\alpha}^2(h))]^2$, где $f(\cdot)$ плотность распределения $\chi^2(h)$.

Для точных $p$-значение используется $w$, равное $(1-p)/p$. Например, если $p=0.05$ тогда $w=19$ и $B=7,296$. Для расчета $p$-значения необходимо гораздо большее количество $B$ по сравнению с отвержением гипотезы при превышении критического значения.

Для оценки параметра $\theta$, скорректированной на смещение, есть простое правило, при котором $\hat{w}=\hat{\sigma}^2/\hat{\theta}^2$, где стандартная ошибка $\hat{\theta}$ равна $\hat{\sigma}$. Например, если обычная $t$-статистика равна $t=\hat{\theta}/\hat{\sigma}=2$, то $\hat{w}=1/4$ и $B=96$. В работе Эндрюс и Бучински (2000) рассмотрено намного больше деталей и уточнений этих результатов.

Для тестирования гипотез, Дэвидсон и МакКиннон (2000) предложили альтернативный подход. Они исследовали понижение мощности теста, которое происходит из-за  конечного количества $B$ бутстрэповских выборок. Отметим, что мощность теста не снижается, если $B=\infty$. На основе проведенных симуляций Дэвидсон и МакКиннон рекомендуют как минимум $B=399$ для тестов с $\alpha=0.05$ и как минимум $B=1,499$ для $\alpha=0.01$. Они приводят аргументы, что для тестирования гипотез их поход лучше, чем подход Эндрюса и Бучински.

Ряд работ Дэвидсона и МакКиннона, результаты которых обобщил МакКиннон (2002), сосредоточены на практических аспектах применения бутстрэпа. Для тестирования гипотез на уровне значимости $\alpha$ следует выбирать $B$ таким образом, чтобы значение выражения $\alpha(B+1)$ было целым числом. Например, при $\alpha=0.05$ лучше взять $B=399$, а не 400. Если все же взять $B=400$, тогда будет непонятно какая по счёту $t$-статистика, 20-ая или 21-ая, является критическим значением. Для нелинейных моделей количество расчетов можно сократить проведя только несколько итераций Ньютона-Рафсона в каждой бутстрэповской выборке, где начальные значения равны исходным оценкам параметров.

\subsection{Оценка стандартных ошибок}

Для оценивания дисперсии оценки параметра в бутстрэпе используется обычная формула оценки дисперсии, применяемая для $B$ репликаций $\hat{\theta}_1^*,\ldots ,\hat{\theta}_B^*$.

\begin{equation}
s_{\hat{\theta},Boot}^2=\dfrac{1}{B-1}\sum_{b=1}^B(\hat{\theta}_b^*-\overline{\hat{\theta}}^*)^2,
\end{equation} 
где

\begin{equation}
\overline{\hat{\theta}^*}=B^{-1}\sum_{b=1}^B\hat{\theta}_b^*.
\end{equation}
Извлекая квадратный корень, получим бутстрэповскую оценку стандартной ошибки, $s_{\hat{\theta},Boot}$.

Этот бутстрэп не предполагает асимптотических уточнений. Тем не менее, этот метод может быть полезен, когда трудно получить оценку стандартной ошибки применяя стандартные методы. Существует большое количество примеров. Оценка параметра $\hat{\theta}$ может быть последовательной двухшаговой М-оценкой, стандартную ошибку которой трудно рассчитать используя результаты раздела 6.8. Также $\hat{\theta}$ может быть рассчитана методом двухшагового МНК, при использовании статистического пакета, предполагающего гомоскедастичность стандартных ошибок, в то время как они гетероскедастичны. Оценка $\hat{\theta}$ может быть функцией других оценок, например, $\hat{\theta}=\hat{\alpha}/\hat{\beta}$, в таком случае может быть использован бутстрэп вместо дельта метода. Для кластеризованных данных со  множеством маленьких кластеров, к примеру, для разбиения на короткие панели, могут быть получены робастные кластерные стандартные ошибки через ресэмплинг кластеров.

Поскольку оценка бутстрэпа $s_{\hat{\theta},Boot}$ состоятельна, она может быть использована вместо $s_{\hat{\theta}}$ в обычной асимптотической формуле для построения доверительных интервалов и при проведении различных асимптотических тестов. Таким образом, использование асимптотических статистических выводов возможно в случае, когда трудно получить стандартные ошибки другими методами. Тем не менее, улучшения оценки для конечных выборок не произойдет. Для получения асимптотического уточнения необходимо использовать методы из следующего раздела.

\subsection{Тестирование гипотез}

В данном разделе рассматриваются тесты для отдельного коэффициента $\theta$. Тест может быть как с правой односторонней альтернативой $H_0:\theta \leq \theta_0$, $H_{\alpha}:\theta > \theta_0$, так и с двусторонней альтернативой $H_0: \theta = \theta_0$, $H_a: \theta \not= \theta_0$. Другие тесты будут рассмотрены в разделе 11.6.3.

\subsubsection*{Тесты с асимптотическими уточнениями}

Как правило базовой для асимптотических уточнений является обычная тестовая статистика $T_N=(\hat{\theta}-\theta_0)/s_{\hat{\theta}}$, поскольку асимптотическое распределение $T_N$ не зависит от неизвестных параметров. Создадим $B$ бутстрэповских репликаций и получим $B$ тестовых статистик $t_1^*,\ldots ,t_B^*$, где 

\begin{equation}
t_b^*=({\hat{\theta}_b}^*-\hat{\theta})/s_{{\hat{\theta}}_b^*}.
\end{equation}
Оценки $t_b^*$ сосредоточены около первоначальной оценки $\hat{\theta}$ поскольку ресэмплинг делается на основе значений, сосредоточенных около $\hat{\theta}$. Эмпирическое распределение $t_1^*, \ldots, t_B^*$, упорядоченных от меньшего к большему, используется для определения распределение $T_N$.

Для правосторонней альтернативной гипотезы бутстрэповское критическое значение (при уровне значимости $\alpha$) равно выборочному верхнему квантилю уровня $\alpha$ среди $B$ упорядоченных статистик. Например, если $B=999$ и $\alpha=0.05$ тогда критическим значением будет 950-ое наибольшее значение статистики $t^*$, поскольку тогда $(B+1)(1-\alpha)=950$. Аналогично, для левосторонней альтернативной гипотезы  бутстрэповское критическое значение  будет равно 50-му наименьшему значению $t^*$.

Также, используя бутстрэп можно рассчитать точное $p$-значения. Например, если первоначальное исходная $t$-статистика лежит между 914-м и 915-м наибольшим значением среди 999 бутстрэповских репликаций, тогда P-значение для правосторонней альтернативной гипотезы будет равно $1-914/(B+1)=0.086$.

Для двустороннего теста необходимо учитывать различие между симметричным и несимметричным тестами. Для несимметричного теста или теста с равными хвостами бутстрэповские критические значения на уровне значимости $\alpha$ составляют нижний $\alpha/2$ и верхний $\alpha/2$ квантили упорядоченных тестовых статистик $t^*$. Нулевая гипотеза отвергается на уровне значимости $\alpha$, если первоначальная $t$-статистика лежит за пределами обозначенного интервала. Для симметричного теста упорядочиваются абсолютные значения статистик, $|t^*|$ и бутстрэповское критическое значение (на уровне значимости $\alpha$) будет равно верхнему $\alpha$ квантилю упорядоченных $|t^*|$. Нулевая гипотеза отвергается на уровне значимости $\alpha$, если $|t|$ превышает критическое значение.

Вышеприведенные тесты при использовании метода $t$-перцентилей позволяют использовать асимптотические уточнения. Для одностороннего $t$-теста и несимметричного двустороннего $t$-теста истинная вероятность ошибки первого рода равна $\alpha+O(N^{-1/2})$ при использовании стандартных асимптотических критических значений, а при использовании бутстрэповских критических значений  истинная вероятность ошибки первого рода равна  $\alpha+O(N^{-1})$. Для двустороннего симметричного $t$-теста и асимптотического хи-квадрат теста аппроксимация работает лучше, здесь истинная вероятность ошибки первого рода равна $\alpha+O(N^{-1})$, если используются стандартные асимптотические критические значения, и равна  $\alpha+O(N^{-2})$ если используются бутстрэповские критические значения. 


\subsubsection*{Тесты без асимптотических уточнений}

Существуют альтернативные методы бутстрэпирования, которые являются асимптотически корректными, но не приводят к асимптотическим уточнениям.

Один из подходов, мы упомянули его в конце раздела 11.2.5 заключается в том, чтобы рассчитать $t=(\hat{\theta}-\theta_0)/s_{\hat{\theta},boot}$, где бутстрэп оценка $s_{\hat{\theta},boot}$, вычисленная по формуле (11.3), заменяет обычную оценку $s_{\hat{\theta}}$ и затем данная статистика  сравнивается с критическими значениями стандартного нормального распределения.

Второй подход, излагаемый здесь применительно к  двустороннему тесту гипотезы $H_0:\theta=\theta_0$ c альтернативной $H_a:\theta \neq \theta_0$, сначала рассчитывает нижний $\alpha/2$ и верхний $\alpha/2$ квантили оценок бутстрэпа $\hat{\theta}_1^*,\ldots ,\hat{\theta}_B^*$. Гипотеза $H_0$ отвергается, если значение $\theta_0$ лежит за пределами границ этого интервала. Этот подход получил название процентильного метод. Асимптотическое уточнение  возникает из-за использования  статистики $t_b^*$ в формуле (11.5), при этом центрирование происходит вокруг  $\hat{\theta}$, а не вокруг $\theta_0$, и своей стандартной ошибки $s_{\hat{\theta}}^*$ в каждом бутстрэпе.

Привлекательность двух вышеприведённых методов состоит в отсутствии необходимости рассчитывать $s_{\hat{\theta}}$, т.е. оценки стандартной ошибки, основанной на асимптотической теории.

\subsection{Доверительные интервалы}

Как правило, в литературе по статистике рассматривается оценка доверительных интервалов, а не тестирование гипотез. В этом разделе основное внимание сосредоточено на тестировании гипотез, поэтому вопрос построения доверительных интервалов будет изложен в краткой форме. 

Уточнения асимптотики основаны на $t$-статистике, которая асимптотически не зависит от неизвестных параметров. Таким образом, следуя по шагам 1-3 из раздела 11.2.4, получим реплицированные бутстрэпом $t$-статистики $t_1^*,\ldots ,t_B^*$. Обозначим через $t_{[1-\alpha/2]}^*$ и $t_{[\alpha/2]}^*$ нижний и верхний квантиль степени свободы $\alpha/2$ этих $t$-статистик. Тогда, согласно $t$-перцентильному методу $100(1-\alpha)$ процентный доверительный интервал равен

\begin{equation}
(\hat{\theta}-t_{[1-\alpha/2]}^*{\times}s_{\hat{\theta}},\hat{\theta}+t_{[\alpha/2]}^*{\times}s_{\hat{\theta}}),
\end{equation}
где $\hat{\theta}$ и $s_{\hat{\theta}}$ оценка и стандартная ошибка, соответственно, из первоначальной выборки.

Альтернативным $t$-перцентильному методу  является ускоренный метод коррекции смещения (bias corrected and accelerated method, $BC_a$), он подробно рассмотрен в работе Эфрона (1987). Данный метод позволяет получить асимптотические уточнения в более широком классе задача, чем $t$-перцентильный метод.

Другие методы позволяют построить асимптотически верный доверительный интервал, но без асимптотических уточнений. Во-первых, для построения доверительного интервала возможно использовать оценку бутстрэпа стандартной ошибки в обычной формуле, так мы получим интервал вида $(\hat{\theta}-z_{[1-\alpha/2]} \times s_{\hat{\theta},boot},\hat{\theta}+z_{[\alpha/2]}{\times}s_{\hat{\theta},boot})$. Во-вторых, согласно перцентильному методу доверительный интервал определяется как промежуток между нижним $\alpha/2$ и верхним $\alpha/2$ квантилями $B$ оценок бутстрэпа $\hat{\theta}_1^*,\ldots, \hat{\theta}_B^*$ параметра $\theta$.

\subsection{Корректировка смещения}

Как правило, в конечных выборках нелинейные оценки смещены, однако данное смещение  асимптотически стремится к нулю, если оценка состоятельна. Например, если оценка $\mu^3$ получена как $\hat{\theta}=\overline{y}^3$, где $y_i$ независимо и одинаково распределены с параметрами $[\mu,\sigma^2]$, тогда $\E[\hat{\theta}-\mu^3]=3\mu\sigma^2/N+\E[(y-\mu)^3]/N^2$.

В более общем виде, для $\sqrt{N}$-состоятельных оценок

\begin{equation}
\E[\hat{\theta}-\theta_0]=\dfrac{a_N}{N}+\dfrac{b_N}{N^2}+\dfrac{c_N}{N^3}+\ldots ,
\end{equation}
где $a_N,b_N$ и $c_N$ --- это ограниченные константы, значения которых зависят от данных и метода оценивания (см. Холл, 1992, стр. 53). Альтернативная оценка $\tilde{\theta}$ является асимптотическим уточнением, если 

\begin{equation}
\E[\tilde{\theta}-\theta_0]=\dfrac{B_N}{N^2}+\dfrac{C_N}{N^3}+\ldots,
\end{equation}
где $B_N$ и $C_N$ ограниченные константы. Для обеих оценок смещение исчезает при $N \rightarrow \infty$. Оценка $\tilde{\theta}$ более привлекательна, поскольку смещение быстрее устремляется в ноль и, таким образом, получаем  асимптотическое уточнение, однако в конечных выборках возможна обратная ситуация, т.е. $(B_N/N^2)>(a_N/N+b_N/N^2)$.

Мы хотим оценить смещение $\E[\hat{\theta}]-\theta$. Значение данного выражения равно расстоянию между ожидаемым средним значением оценки параметра и значением параметра, в процессе, порождающем данные. Бутстрэп заменяет генеральную совокупность на выборку, поэтому бутстрэповские выборки создаются с использованием параметра $\hat{\theta}$, среднее значение которого по выборкам равно $\overline{\hat{\theta}}^*$ . 

Тогда оценка смещения бутстрэпом равна
\begin{equation}
Bias_{\hat{\theta}}=(\overline{\hat{\theta}}^*-\hat{\theta}),
\end{equation}
где $\overline{\hat{\theta}}$ определена в (11.4).

Например, предположим, что $\hat{\theta}=4$ и $\overline{\hat{\theta}}^*=5$, тогда оценка смещения равна $(5-4)=1$. Следовательно имеем смещение в сторону увеличения на 1, это в свою очередь означает, что $\hat{\theta}$ переоценена на 1. Для корректировки смещения необходимо вычесть единицу из $\hat{\theta}$, что даст скорректированную на смещение оценку равную 3. В более общем виде, скорректированная на смещение оценка параметра $\theta$ может быть записана как

\begin{equation}
\hat{\theta}_{Boot}=\hat{\theta}-(\overline{\hat{\theta}}^*-\hat{\theta})
\end{equation}
\[
=2\hat{\theta}-\overline{\hat{\theta}}^*
\]

Следует обратить внимание, что оценка $\overline{\hat{\theta}}^*$ не скорректирована на смещение сама по себе. Для более подробного изучения вопроса корректировки, см. Эфрон и Тибшарани (1993, стр. 138). Для типовых $\sqrt{N}$-состоятельных оценок асимптотическое смещение параметра $\hat{\theta}$ равно $O(N^{-1})$ в то время, как асимптотическое смещение бутстрэповской оценки $\hat{\theta}_{Boot}$ равно $O(N^{-2})$.

На практике корректировка смещения редко применяется для $\sqrt{N}$-состоятельных оценок, поскольку бутстрэпэвская оценка может быть более изменчивой, чем первоначальная оценка $\hat{\theta}$ и, как правило, смещение меньше чем стандартная ошибка оценки. Бустраповская корректировка смещения  применяется, если скорость сходимости оценки ниже, чем $\sqrt{N}$, в особенности для непараметрических оценок регрессии и  плотности.

\section{Пример бутстрэпа}

В качестве примера бутстрэпа рассмотрим модель экспоненциальной регрессии, введенной в разделе 5.9. Для  примера,  сгенерируем экспоненциальное распределение с экспоненциальным средним и двумя регрессорами:

\[
y_i|x_i\sim exponential(\lambda_i), i=1,\ldots ,50,
\]
\[
\lambda_i= \exp(\beta_1+\beta_{2}x_{2i}+\beta_{3}x_{3i}),
\]
\[
(x_{2i},x_{3i})\sim \cN[0.1,0.1;0.1^2,0.1^2,0.005],
\]
\[
(\beta_1,\beta_2,\beta_3)=(-2,2,2).
\]

По выборке, состоящей из 50-ти наблюдений, методом максимального правдоподобия получаем следующие результаты: $\hat{\beta}_1=-2.192$; $\hat{\beta}_2=0.267,s_2=1.417$, и $t_2=0.188$; и $\hat{\beta}_3=4.664, s_3=1.741$, и $t_3=2.679$. Для данного примера ММП в основе расчетов стандартных ошибок лежит минус обратная оценённая матрица Гессе, $-A^{-1}$.

Основное внимание обратим на статистические выводы для $\beta_3$ и покажем применение бутстрэпа для расчета стандартных ошибок, проведения теста статистической значимости, формирования доверительных интервалов и корректировки смещения. В данном примере разница между бутстрэпом и обычными асимптотическими оценками мала, тем не менее эта разница может быть больше в других примерах.

Результаты получены методом парного бутстрэпа (см. раздел 11.2.4) с совместным ресэмплингом $(y_i,x_{2i},x_{3i})$, проведенным $B=999$ раз. Как следует из Таблицы 11.1, среднее значение и стандартное отклонение 999 реплицированных оценок бутстрэпа $\hat{\beta}_{3,b}^*$, $b=1,\ldots ,999$, равны 4.716 и 1.939, соответственно. Также в Таблице 11.1 приведены значения основных перцентилей для $\hat{\beta}_3^*$ и $t_3^*$.

Парный бутстрэп может быть заменен на параметрический бутстрэп. При параметрическом бутстрэпе выборка для $y_i$ будет формироваться из экспоненциального распределения с параметром $\exp(\hat{\beta}_1+\hat{\beta}_{2}x_{2i}+\hat{\beta}_{3}x_{3i})$. При тестировании гипотезы $H_0:\beta_3=0$ параметр экспоненциального распределения может быть равен $\exp(\tilde{\beta}_1+\tilde{\beta}_2x_{2i})$, где $\tilde{\beta}_1$ и $\tilde{\beta}_2$ ограниченные оценки ММП по первоначальной выборки.

Стандартные ошибки: по формуле (11.3) бутстрэповская оценка стандартной ошибки  рассчитывается по обычной формуле для  стандартного отклонения выборки, получаемой в результате 999-ти репликаций $\beta_3$. Оценка стандартной ошибки равна 1.939, что превышает обычную асимптотическую оценку стандартной ошибки --- 1.741. Заметим, что при параметрическом бутстрэпе отсутствует возможность асимптотических уточнений. Поэтому он используется в качестве способа проверки или в случае, если нахождение стандартных ошибок другими способами  затруднено.

\begin{table}[h]
\begin{center}
\caption{\label{tab:pred} Вывод коэффициента наклона с помощью бутсрэпа: пример}
\begin{minipage}{9cm}
\begin{tabular}{ccccc}
\hline
\hline
& $\hat{\beta}^*_3$ & $t^*_3$ & $z = t(\infty)$ & $t(47)$ \\ 
\hline 
Среднее \footnote{Описательные статистики и перцентили, основанные на 999 парных бутстрэпированных выборках для $(1)$ оценки $\hat{\beta}^*_3$; $(2)$ статистики $t^*_3 = (\hat{\beta}^*_3 - \hat{\beta})/s_{\hat{\beta}^*_3}$;
 $(3)$ $t$-распределения Стьюдента с 47-ю степенями свободы; $(4)$ стандартного нормального распределения. Процесс, порождающий данные, --- выборка из экспоненциального распределения, которое приведено в тексте. Размер выборки равен 50.} & 4.716 & 0.026 & 1.021 & 1.000 \\ 
Ст.от.\footnote{Стандартное отклонение} & 1.939 & 1.047 & 1.000 & 1.021 \\
1\% & -0.336 & -2.664 & -2.326 & -2.408 \\
2.5\% & 0.501 & -2.183 & -1.960 & -2.012 \\
5\% & 1.545 & -1.728 & -1.645 & -1.678 \\
25\% & 3.570 & -0.621 & -0.675 & -0.680 \\
50\% & 4.772 & 0.062 & 0.000 & 0.000 \\
75\% & 5.971 & 0.703 & 0.675 & 0.680 \\
95\% & 7.811 & 1.706 & 1.645 & 1.678 \\
97.5\% & 8.484 & 2.066 & 1.960 & 2.012 \\
99.0\% & 9.427 & 2.529 & 2.326 & 2.408 \\
\hline
\hline
\end{tabular}
\end{minipage}
\end{center}
\end{table} 

Проведение теста с асимптотическими уточнениями: рассмотрим тестирование гипотезы $H_0:\beta_{3}=0$ с альтернативной гипотезой $H_a: \beta_3 \neq 0$ на уровне значимости $0.05$. Тест с асимптотическим уточнениями основан на $t$-статистике, которая асимптотически не зависит от неизвестных параметров. Из раздела $11.2.6$ для каждой бутстрэповской выборки мы рассчитали $t_3^*=({\hat{\beta}_3}^*-4.664)/s_{\hat{\beta}_3^*}$, значения которой центрированы около оценки $\hat{\beta}_3=4.664$, рассчитанной на основе первоначальной выборки. Для несимметричного теста критические значения бутстрэпа равны нижнему и верхнему $2.5\%$-ому перцентилю для 999-ти значений $t_3^*$, т.е. 25-ому наименьшему и 25-ому наибольшему значению. Из Таблицы 11.1 следует, что эти значения равны -2.183 и 2.066, соответственно. Поскольку значение $t$-статистики рассчитанное на основе первоначальной выборки равно $t_3=(4.664-0)/1.741=2.679 > 2.066$, нулевая гипотеза отвергается. При проведении симметричного теста, в котором используется верхний $5\%$ перцентиль абсолютного значения статистики $|t_3^*|$, критическое значение бутстрэпа равно 2.078, что вновь приводит к отвержению нулевой гипотезы на уровне значимости 0.05.

В этом примере критические значения бутстрэпа превышают критические значения, вычисленные с помощью асимптотической аппроксимации стандартным нормальным распределением или с помощью $t(47)$ распределения, ad-hoc корректировки для конечной выборки, верной в линейной регрессии с нормальными ошибками. Как правило, обычные асимптотические результаты в этом примере приводят к отверганию нулевой гипотезы слишком часто и фактический размер теста превышает номинальный. Например, на $5\%$-ом уровне область, где $H_0$ не отвергается с использованием стандартного нормального распределения, $(-1.960, 1.960)$, уже бутстрэповской области $(-2.183, 2.066)$. На рисунке 11.1 изображен график ядерной оценки функции плотности обычного $t$-теста, основанный на $t_3^*$. Для сравнения на графике изображена плотность стандартного нормального распределения. Плотности похожи, но левый хвост распределения заметно тяжелее для бутстрэповских оценок. В Таблице 11.1 подчеркнуты отличия в хвостах.

Тестирование гипотез без асимптотических уточнений: Существуют иные бутстрэповкие способы тестирования, но эти методы не предполагают асимптотических уточнений. Во-первых, можно воспользоваться бутстрэповской оценкой стандартной ошибки, равной 1.939, вместо обычной асимптотической оценки, равной 1.7741. При этом  будет получено значение $t_3$ равное $t_3=(4.664-0)/1.939=2.405$. Это приводит к отвержению нулевой гипотезы на уровне значимости 0.05, где критическое значение может быть как стандартным нормальным, так и t(47). Во-вторых, из Таблицы 11.1 $95\%$ бутстрэповских оценок $\hat{\beta}_3^*$ лежат в промежутке (0.501, 8.484),следовательно нулевая гипотеза $H_0:\beta_3=0$ отвергается.

\vspace{3cm}

График 11.1 Плотность $t$-статистики бутстрэпа для угла наклона, равного нулю, которая получена с помощью 999 бутстрэповских оценок. Для сравнения изображена плотность стандартного нормального распределения. Данные сгенерированы с помощью экспоненциальной регрессионной модели.


Доверительные интервалы: Асимптотическое уточнение получается с использованием $t$-перцентильного $95\%$-ного
доверительного интервала. Используя (11.6) получим  $(4.664-2.183 \times 1.741,4.664+2.066 \times 1.741)$ или $(0.864,8.260)$. Для  сравнения приведем традиционный $95\%$-ти доверительный интервал $4.664 \pm 1.960 \times 1.741$ или $(1.25, 8.08)$.

Также могут быть построены иные доверительные интервалы, но уже без асимптотических уточнений. Используя оценку стандартной ошибки, рассчитанную бутстрэпом, получим $95\%$ доверительный интервал $4.664 \pm 1.960 \times 1.939=(0.864,8.464)$. Метод перцентилей использует нижний и верхний 2.5 перцентиль 999-ти оценок коэффициента, рассчитанных методом бутстрэпа, в результате чего границы доверительного интервала становятся $(0.501,8.484)$.
 
Корректировка смещения: Среднее значение 999-ти бутстрэповских оценок $\beta_3$ равно $4.716$ в сравнении с первоначальной оценкой 4.664. Оцененное смещение (4.716-4.664)=0.052 достаточно мало, особенно в сопоставлении со стандартной ошибкой $s_3=1.741$. Таким образом, оценка смещена вверх и согласно (11.10) скорректированная на смещение оценка равна 4.664-0.052=4.612.

В основе бутстрэпа лежит асимптотическая теория и, для конечных выборок, результаты применения бутстрэпа могут быть хуже результатов традиционных методов. Для того, чтобы определить действительно ли бутстрэп ведет к улучшению результатов необходимо провести анализ Монте-Карло, скажем создать 1,000 выборок размером 50 согласно экспоненциальному процессу, порождающему данные и для каждой из созданных выборок сделать ресэмплинг, скажем, 999 раз.


\section{Теория бутстрэпа}

Изложенный материал в этом разделе следует изложению Хоровица (2001). Основные результаты: оценки бутстрэпа состоятельны, и, если бутстрэпируется статистика не зависящая от неизвестных параметров, то возможно сделать асимптотическое уточнение.

\subsection{Бутстрэп}

Мы используем общее обозначение $X_1,\ldots ,X_N$, где для простоты обозначений не используем выделение жирным шрифтом для $X_i$, хотя он обычно является вектором, как например пара $(y_i,x_i)$. Предположим, что данные независимы и порождены распределением $F_0(x)=\Pr[X \leq x]$. В простых приложениях $F_0$ зависит от конечного количества параметров, $F_0=F_0(x,\theta_0)$.

Обозначим интересующую нас статистику через $T_N=T_N(X_1,\ldots ,X_N)$. Точное распределение $T_N$ на конечной выборке есть функция $G_N=G_N(t,F_0)=\Pr[T_N \leq t]$. Проблема состоит в том, чтобы найти хорошую аппроксимацию для $G_N$.

Обычная асимптотическая теория использует асимптотическое распределение $T_N$, обозначенное $G_{\infty}=G_{\infty}(t,F_0)$. Теоретически данное распределение может зависеть от неизвестной функции $F_0$, в таком случае будет использована состоятельная оценка $F_0$. Например, можно использовать $\hat{F}_0=F_0(\cdot,\hat{\theta})$, где $\hat{\theta}$ состоятельная оценка $\theta_0$.

В эмпирическом бутстрэпе используется иной подход к аппроксимации $G_N(\cdot,F_0)$. Вместо замены $G_N$ на $G_{\infty}$ производится замена функции распределения генеральной совокупности $F_0$ на состоятельную оценку $F_0$ --- функцию $F_N$, например, на  эмпирическую функцию  распределения.

Функция $G_N(\cdot,F_N)$ не может быть выписана явно, но возможно рассчитать приближение к ней бутстрэпированием. В результате применения бутстрэпа один раз получим статистику $T_N^*=T_N(X_1^*,\ldots ,X_N^*)$. Повторяя этот шаг $B$ независимых раз получим $T_{N,1}^*,\ldots ,T_{N,B}^*$. Эмпирическая функция распределения $T_{N,1}^*,\ldots ,T_{N,B}^*$ является бутстрэповской оценкой распределения статистики $T$ и

\begin{equation}
\hat{G}_N(t,F_N)=\dfrac{1}{B}\sum_{b=1}^{B}1(T_{N,b}^* \leq t),
\end{equation}
где $1(A)$ равно 1, если событие $A$ происходит и, в противном случае, равно нулю. По сути эта функция равна доле бутстрэповских выборок, для которых выполняется неравенство $T_N^* \leq t$.

Все обозначения собраны в Таблице $11.2$.


\subsection{Состоятельность бутстрэпа}

Очевидно, что оценка бутстрэпа $\hat{G}_N(t,F_N)$ сходится к $G_N(t,F_N)$ при $B \rightarrow \infty$. Для того, чтобы оценка $\hat{G}_N(t,F_N)$ функции $G_N(t,F_0)$ была состоятельно необходимо выполнение условия:

\[
G_N(t,F_N) \stackrel{p}{\rightarrow} G_N(t,F_0),
\]
равномерно по $t$ и для всех $F_0$ в пространстве возможных функций  распределения.

\begin{table}[h]
\begin{center}
\caption{\label{tab:pred} Обозначения для теоремы о бутсрэпе}
\begin{minipage}{\textwidth}
\begin{tabular}{ll}
\hline
\hline
Показатель & Обозначение \\ 
\hline 
Выборка\footnote{Выборка состоит из независимых и одинаково распределенных $X_i$} & $X_1, \ldots, X_N$, где $X_i$ --- это обычно вектор \\ 
Теоретическая функция распределения $X$ & $F_0 = F_0(x, \theta_0) = \Pr[X \leq x]$ \\
Статистика & $T_N = T_N(X_1, \ldots, X_N)$ \\
Функция распределения $T_N$ для конечных выборок & $G_N = G_N(t, F_0) = \Pr[T_N \leq t]$ \\
Предельная функция распределения $T_N$ & $G_{\infty} = G_{\infty}(t, F_0)$ \\
Асимптотическая функция распределения $T_N$ & $\hat{G}_{\infty} = G_{\infty}(t, \hat{F}_0)$, где $\hat{F}_0 = F_0(x, \hat{\theta})$ \\
Бутстрэпированная функция распределения $T_N$ & $\hat{G}_N(t, F_N) = B^{-1} \sum_{b=1}^B 1(T^*_{N,b} \leq t)$ \\
\hline
\hline
\end{tabular}
\end{minipage}
\end{center}
\end{table} 

Конечно, $F_N$ должна быть состоятельна для $F_0$. Кроме того, необходима гладкость процесса, порождающего данные, с распредлением $F_0(x)$, чтобы функции $F_N(x)$ и $F_0(x)$ были  близки равномерно по наблюдениям $x$ при больших $N$. Более того, необходима гладкость $G_N(\cdot,F)$, как фукционала от $F$, чтобы  $G_N(\cdot,F_N)$ и $G_N(\cdot,F_0)$ были близки при больших $N$. 

Хоровиц (2001, стр. 3166-3168) сформулировал две теоремы, одну общую и вторую --- для одинаково и независимых распределенных данных. Хоровиц приводит примеры, когда бутстрэп может не работать, например, при оценке медианы, а также наличии ограничений на  значения параметров.

При условии, что оценка $F_N$ состоятельна для $F_0$ и выполняются условия гладкости функций $F_0$ и $G_N$, бутстрэп дает состоятельные оценки и асимптотически верные выводы. В целом, бутстрэп дает состоятельные оценки для широкого круга задач.

\subsection{Разложение Эджворта}

Дополнительным преимуществом бутстрэпа является возможность асимптотических уточнений. Сингх (1981) предложил доказательство с использованием разложения Эджворта.

Рассмотрим предельное поведение $Z_N=\sum_{i}X_i/\sqrt{N}$, где для простоты обозначим за $X_i$ независимые и одинаково распределенные с параметрами $[0, 1]$ случайные величины. Следовательно, применение центральной предельной теоремы (ЦПТ) приводит к  стандартному нормальному распределению предела $Z_N$. Более точно,  функция распределения $Z_N$ имеет вид

\begin{equation}
G_N(z)=\Pr[Z_N \leq z] = \Phi(z) + O(N^{-1/2}),
\end{equation} 
где $\Phi(\cdot)$ функция стандартного нормального распределения. Отбрасывая остаточный член, обычная асимптотическая теория говорит, что $G_N(z)$ приблизительно равна $G_{\infty}(z)=\Phi(z)$.

ЦПТ, приводящая к формуле  (11.2), формально доказывается путем простой аппроксимации характеристической функции $Z_N$, $\E[e^{isZ_N}]$, где $i=-\sqrt{1}$. Более точная аппроксимация разлагает эту характеристическую функцию по степеням $N^{-1/2}$. В результате разложения Эджворта добавляется два дополнительных члена

\begin{equation}
G_N(z)=\Pr[Z_N \leq z]=\Phi(z)+\dfrac{g_1(z)}{\sqrt{N}}+\dfrac{g_2(z)}{N}+O(N^{-3/2}),
\end{equation}
где $g_1(z) = -(z^2-1)\phi(z) \kappa_3/6$, $\phi(\cdot)$ --- плотность стандартного нормального распределения, $\kappa_3$ --- третья кумулянта $Z_N$ и полное выражение для $g_2(\cdot)$ дано у Розенберга (1984, стр. 895) и Амэмия (1985, стр. 93). В общем случае, $r$-ая кумулянта $\kappa_r$ --- это $r$-ый коэффициент разложения ряда $\ln(\E[e^{isZ_N}])=\sum_{r=0}^{\infty} \kappa_r(is)^r/r!$ логарифмической характеристической  функции или, иначе, производящей функция кумулянт.

Опуская остаточный член в (11.13), разложение Эджворта даст приближенное значение функции $G_N(z,F_0)$, т.е. $G_{\infty}(z,F_0)=\Phi(z)+N^{-1/2}g_1(z)+N^{-1}g_2(z)$. Если принять $Z_N$ --- это тестовая статистика, то значение $Z_N$ можно использовать для расчета P-значений и критических значений. Иначе, (11.3) можно записать, как

\begin{equation}
\Pr \left[ Z_N+\dfrac{h_1(z)}{\sqrt{N}}+\dfrac{h_2(z)}{N} \leq z \right] \simeq \Phi(z),
\end{equation}
где выражения для функций $h_1(z)$ и $h_2(z)$ даны у Розенберга (1984, стр. 895). В левой части находится модифицированная статистика, лучше приближаемая стандартным нормальным распределением, нежели чем  первоначальная статистика $Z_N$.

Трудность использования такого подхода заключается в необходимости вычисления кумулянтов $Z_N$ для расчета значений функций $g_1(z)$ и $g_2(z)$ или $h_1(z)$ и $h_2(z)$. Составление выражения для расчета кумулянт в аналитическом виде может вызвать затруднения (см. например, Сурган, 1980 и Филлипс, 1983). Бутстрэп позволяет использовать разложение Эджворта без расчета кумулянт.

\subsection{Асимптотические уточнения с помощью бутстрэпа}

Вернемся к рассмотрению  вопроса в более общем виде, как в разделе 11.4.1., и сделаем дополнительное предположение о том, что $T_N$  имеет в пределе стандартное нормальное распределение и скорость сходимости $\sqrt{N}$.

Традиционные методы асимптотики используют предельную  функцию распределения $G_{\infty}(t,F_0)$ как приближение истинной функции распределения $G_N(t,F_0)$. Для $\sqrt{N}$-состоятельных асимтотически нормальных оценок такая аппроксимация дает ошибку в пределе кратную $N^{-1/2}$. Мы можем записать вышесказанное как

\begin{equation}
G_N(t,F_0)=G_{\infty}(t,F_0)+O(N^{-1/2}),
\end{equation}
где в нашем пример $G_{\infty}(t,F_0)=\Phi(t)$.

Более точная аппроксимация возможна с использованием разложения Эджворта. Тогда

\begin{equation}
G_N(t,F_0)=G_{\infty}(t,F_0)+\dfrac{g_1(t,F_0)}{\sqrt{N}}+\dfrac{g_2(t,F_0)}{N}+O(N^{-3/2}).
\end{equation}
К сожалению, как это было отмечено ранее, могут возникнуть трудности при построении функций $g_1(\cdot)$ и $g_2(\cdot)$, находящихся в правой части выражения.

Далее рассмотрим оценку $G_N(t,F_N)$ полученную бутстрэпом. Согласно разложению Эджворта получим 

\begin{equation}
G_N(t,F_N)=G_{\infty}(t,F_N)+\dfrac{g_1(t,F_N)}{\sqrt{N}}+\dfrac{g_2(t,F_N)}{N}+O(N^{-3/2});
\end{equation}
для более детального изложения см. Холл (1992). Оценка бутстрэпа $G_N(t,F_N)$ используется для аппроксимации функции распределения для конечной выборки $G_N(t,F_0)$. Вычитая (11.16) из (11.17), получим

\begin{equation}
G_N(t,F_N)-G_N(t,F_0)=[G_{\infty}(t,F_N)-G_{\infty}(t,F_0)]+\dfrac{[g_1(t,F_N)-g_1(t,F_0)]}{\sqrt{N}}+O(N^{-1}).
\end{equation}
Предположим, что $F_N$ является $\sqrt{N}$-состоятельной для истинной функции распределения $F_0$, т.е. $F_N-F_0=O(N^{-1/2})$. Для непрерывной функции $G_{\infty}$ первый член в правой части выражения (11.18), $[G_{\infty}(t,F_N)-G_{\infty}(t,F_0)]$, равен $O(N^{-1/2})$, таким образом $G_N(t,F_N)-G_N(t,F_0)=O(N^{-1/2})$.

Следовательно, в общем случае значение $G_N(t,F_N)$ не является асимптотически более близким к значению $G_N(t,F_0)$, чем $G_{\infty}(t,F_0)$; см. (11.15).

Теперь предположим, что статистика $T_N$ и, следовательно, её функция распределения $G_{\infty}$ асимптотически не зависят от неизвестных параметров. Это, например, возможно, если $T_N$ стандартизирована таким образом, что предельное распределение статистики является стандартным нормальным. В таком случае, $G_{\infty}(t,F_N)=G_{\infty}(t,F_0)$ и выражение (11.18) упрощается до 

\begin{equation}
G_N(t,F_N)-G_N(t,F_0)=N^{-1/2}[g_1(t,F_N)-g_1(t,F_0)]+O(N^{-1}).
\end{equation}
Поскольку $F_N-F_0=O(N^{-1/2})$, получим, что $[g_1(t,F_N)-g_1(t,F_0)]=O(N^{-1/2})$ для $g_1$ непрерывно зависящей от $F$. После упрощения имеем $G_N(t,F_N)=G_N(t,F_0)+O(N^{-1})$. Приближение, полученное при помощи бутстрэпа, $G_N(t,F_N)$ является более точным асимптотическим приближением для $G_N(t,F_0)$, поскольку теперь ошибка приближения равна $O(N^{-1})$.

Подводя итог, отметим, что в результате применения бутстрэпа для статистики, асимптотически независящей от неизвестных параметров, мы получаем выражение

\begin{equation}
G_N(t,F_0)=G_N(t,F_N)+O(N^{-1}),
\end{equation} 
которое свидетельствует об улучшении традиционной аппроксимации $G_N(t,F_0)=G_{\infty}(t,F_0)+O(N^{-1/2})$.

Таким образом, применение бутстрэпа для статистики асимптотически  не зависящей от неизвестных параметров повышает точность работы с малой выборкой в следующем смысле. Допустим, что $\alpha$ это номинальный размер теста. При использовании обычных асимптотических результатов,  фактический размер $t$-тестов равен $\alpha+O(N^{-1/2})$, в то время как при применении бутстрэпа размер $t$-тестов составляет $\alpha+O(N^{-1})$.

Можно показать, что для симметричного теста двусторонней гипотезы и построения доверительного интервала, в результате применения бутстрэпа для статистики в узком смысле слова ошибка приближения будет равна $O(N^{-3/2})$. В то время как  при использовании обычной теории асимптотики ошибка равна $O(N^{-1})$. 

Предыдущие результаты ограничены статистикой с асимптотически нормальным распределением. Для тестовой статистики, имеющей распределение хи-квадрат выигрыш от асимптотики аналогичен выигрышу для симметричного двустороннего теста гипотезы. Доказательство для коррекции смещения с помощью бутстрэпа можно найти у  Хоровица (2001, стр. 3172).

Теоретический анализ приводит к следующим выводам. При  бутстрэпа должно использоваться  распределение $F_N$, состоятельное для $F_0$. Одним из требований применения бутстрэпа является гладкость и непрерывность функций $F_0$ и $G_N$. Если, например, существует разрыв из-за ограничений на параметры, к примеру, $\theta \geq 0$, то необходима модификация обычного бутстрэпа. Бутстрэп предполагает наличие моментов низшего порядка, поскольку кумулянты низшего порядка присутствуют в разложении Эджворта функции $g_1$. Для того, чтобы сделать асимптотические уточнения необходимо использовать статистику асимптотически не зависящую от неизвестных параметров. В рассмотренных выше уточнениях предполагалось, что данные независимо и одинаково распределены, так что модификация необходима даже если ошибки гетероскедастичны. Более подробное обсуждение см. у Хоровица (2001). 


 \subsection{Мощность тестов бутстрэпа}

Анализ бутстрэпа сосредоточен на получении тестов правильного размера на малых выборках. Изменение размера бутстрэп теста приведет к изменению мощности теста, как и при любом другом изменении размера. 

Интуитивно, если реальный размер теста, полученного с использованием асимптотики первого порядка, превышает его номинальный размер, то бутстрэпирование с асимптотическим уточнениям не только  сократит размер теста до номинального, но и приведет к сокращению мощности теста, поскольку отвергание гипотезы будет  происходить реже. Наоборот, в случае, если реальный размер меньше номинального, тогда бутстрэпирование приведет к увеличению мощности. Это видно в численном эксперименте Хоровица (1994, стр. 409). Стоит отметить, что проведя эксперименты Хоровиц сделал вывод, что при  бутстрэпировании асимптотически эквивалентных тестов, получаются тесты примерно равных фактических размеров  (близких к номинальному размеру), но возможны значительные различия в мощности полученных тестов. 


\section{Обобщения бутстрэпа}

Рассмотренные ранее методы бутстрэпа применялись к гладкой $\sqrt{N}$-состоятельной асимптотически нормальной оценке на независимо и одинаково распределенных данных. Приводимые обобщения позволяют получить для широкого класса задач асимптотически состоятельные бутстрэповские оценки (Разделы 11.5.1 и 11.5.2) или состоятельного с асимптотическим уточнением (Разделы 11.5.3-11.5.5). Данные методы мы излагаем кратко. Некоторые из расширенных методов применяются в Разделе 11.6.

\subsection{Метод подвыборок}

В методе подвыборок используется выборка размера $m$, которая значительно меньше, чем размер выборки $N$. Подвыборка может быть как с повторениями (Бикель, Готце и ван Цвет, 1997) или без повторений (Политис и Романо, 1994).

В результате подвыборки с повторениями получаются случайные выборки из  генеральной совокупности, а не случайные выборки оценок как  при парном бутстрэпе. Подвыборка с повторениями может дать состоятельный результат в тех случаях, когда условия гладкости раздела 11.4.2 не выполняются и  бутстрэп по всей выборке несостоятелен. Однако, соответствующая асимптотическая ошибка при тестировании или построении  доверительных интервалов выше, чем $O(N^{-1/2})$, получаемая при использовании бутстрэпа без уточнений, когда он возможен.

Бутстрэп по подвыборке следует использовать, когда оценки бутстрэпа с использованием полной выборки ошибочны, или для проверки последнего. Результаты отличаются в зависимости от размера подвыборки. Кроме того, значительный рост ошибок может быть вызван сокращением размера выборки. В действительность нужны условия $(m/N) \rightarrow 0$ и $N{\rightarrow}\infty$. Для более подробного рассмотрения вопроса см. Политис, Романо, а также Вульф (1999) и Хоровиц (2001).

\subsection{Блочный бутстрэп}

Блочный бутстрэп используются для зависимых данных. Согласно данному методу выборка разбивается на $r$ неперекрывающих друг друга блоков длинной $l$, где $rl \simeq N$. Сначала  строится выборка с повторениями из этих блоков, полученные новые $r$ блоков будут расположены в порядке, который отличается от их изначального порядка. Далее производится оценка параметров с использованием  этой выборки. 

В блочном бутстрэпе  предполагается независимость случайно выбранных блоков, однако внутри блока данные могут быть зависимы. Аналогичное разбиение на блоки  было применено Андерсоном (1971) для докательства ЦПТ для слабозависимых случайных процессов. Для блочного бутстрэпа нужны условия $r \rightarrow \infty$ при $N \rightarrow \infty$, чтобы вероятность получения соседних некоррелированных блоков была высока. Также необходимо, чтобы длина блока $l \rightarrow \infty$ при $N \rightarrow \infty$. К примеру, см. Готце и Кунш (1996).

\subsection{Вложенный бутстрэп}

Вложенный бутстрэп был предложен Холлом (1986), Бераном (1987) и Ло (1987) и  представляет собой бутстрэп в бутстрэпе. Данный метод особенно полезен, если бутстрэп построен для статистики асимптотически зависящей от неизвестных параметров.   В частности, при трудностях в расчете стандартных ошибок оценок возможно бутстрэпировать уже имеющуюся выборку бутстрэпа для того, чтобы получить стандартные ошибки $s_{\hat{\theta}^*,Boot}$ и сформировать статистику $t^*=(\hat{\theta}^*-\hat{\theta})/s_{\hat{\theta}^*,Boot}$, и затем применить  $t$-перцентильный метод для бутстрэповских репликаций  $t_1^*,\ldots ,t_B^*$. Такой подход позволяет получить асимптотические уточнения в тех случаях, где при однократном бутстрэпе таких уточнений сделать нельзя.

В более общем смысле, итерационное бутстрэпирование это способ улучшить бутстрэп через оценку и исправление ошибок (смещения), которые возникают, если бутстрэп применяется один раз. В общем случае, при каждой последующей итерации бутстрэпа происходит корректировка смещения на $N^{-1}$, если используется статистика асимптотически не зависящая от неизвестных параметров, и на $N^{-1/2}$ иначе. Этот вопрос подробно рассмотрен в работе Холл и Мартин (1988). Если количество бутстрэпов равно $B$ для одной итерации, тогда при количестве итераций равном $k$ необходимо провести $B^k$ бутстрэпов. Из-за этого, как правило, проводят не более двух итераций и такой бутстрэп получил название двойного или калиброванного бутстрэпа.

Дэвидсон, Хинкли и Шехтман (1986) предложили  сбалансированный бутстрэп. Данный подход позволяет использовать выборочные данные одинаковое количество по всем $B$ бутстрэпам, что в итоге должно привести к улучшению оценок, полученных с помощью бутстрэпа. Практическое применение см. в работе Глиcон (1988), чьи алгоритмы не сильно увеличивают время расчетов по сравнению с обычным несбалансированным бутстрэпом.

\subsection{Центрирование и изменение масштаба}

Для  асимптотических уточнений в основе бутстрэпа должна быть оценка $\hat{F}$ функции $F_0$, которая накладывает все необходимые предпосылки на рассматриваемую модель. Основным примером здесь служит бутстрэп остатков.

В нелинейных моделях, а также в линейных моделях без свободного члена сумма МНК остатков не равна нулю. Для бутстрэпа остатков (см. Раздел 11.2.4), в котором используются МНК остатки, не выполняется условие $\E[u_i]=0$. Поэтому при бутстрэпе остатков нужно использовать центрированные остатки $\hat{u}_i-\overline{u}$, где $\overline{u}=N^{-1}\sum_{i=1}^N\hat{u_i}$. Аналогичное центрирование должно быть проведено для парного бутстрэпа, когда с помощью ОММ оценивается сверх-идентифицированная модель (см. Раздел 11.6.4).

Кроме того иногда полезно изменить масштаб остатков. Например, в линейной регрессионной модели с независимо и одинаково распределенными ошибками можно делать ресэмплинг масштабированных остатков $(N/(N-K))^{1/2}\hat{u}_i$, поскольку они имеют дисперсию равную $s^2$. Возможны и другие корректировки, например, использование стандартизованных остатков $\hat{u}_i/\sqrt{(1-h_{ii})s^2}$, где $h_ii$ стоит на i-том месте главной диагонали в проекционной матрице $X(X'X)^{-1}X'$.

\subsection{Джекнайф}

Для корректировки смещения может быть использован бутстрэп (см. Раздел 11.2.8). Альтернативным методом ресэмплинга является джекнайф (jackknife), предшественник бутстрэпа. В методе джекнайф используются $N$ детерминистических подвыборок размера $N-1$, каждая из которых генерируется путем отбрасывания по очереди одного из $N$ наблюдений и затем производится пересчет оценки.

Для того, чтобы увидеть как работает джекнайф, обозначим за $\hat{\theta}_N$ оценку параметра $\theta$, полученную на основе выборки размера $N$ и за $\hat{\theta}_{N-1}$ оценку параметра $\theta$, полученную на основе выборки по первым $N-1$ наблюдению. Если 11.7 выполняется, тогда $\E[\hat{\theta}_N]=\theta+a_N/N+b_N/N^2+O(N^{-3})$ и $\E[\hat{\theta}_{N-1}]=\theta+a_N/(N-1)+b_N/(N-1)^2+O(N^{-3})$, следовательно, $\E[N\hat{\theta}_N-(N-1)\hat{\theta}_{N-1}]=\theta+O(N^{-2})$. Таким образом, смещение оценки $N\hat{\theta}_N-(N-1)\hat{\theta}_{N-1}$ меньше смещения $\hat{\theta}_N$.

Однако данная оценка может иметь большую дисперсию, поскольку для расчета $N\hat{\theta}_N-(N-1)\hat{\theta}_{N-1}$ используется меньше данных. В граничном случае, когда $\hat{\theta}=\overline{y}$, оценка будет равна $y_N$, т.е. $N$-тому наблюдению. Дисперсия может быть уменьшена путем последовательного отбрасывания отдельных наблюдений и усредняя.

Рассмотрим процедуру расчета $\hat{\theta}$, оценки вектора параметров $\theta$, полученную на основе выборки размера $N$ с использованием независимо и одинаково распределенных данных. Из всего массива $i=1,\ldots ,N$ исключается $i$-ое наблюдение, затем рассчитывается $N$ репликаций джекнайф  оценки $\hat{\theta}_{(-i)}$, используя $N$ джекнайф выборок размера $(N-1)$. Джекнайф оценка смещения $\hat{\theta}$ равна $(N-1)(\overline{\hat{\theta}}-\hat{\theta})$, где $\hat{\theta}=N^{-1}\sum_{i}\hat{\theta}_{(-i)}$ среднее значение $N$ репликаций джекнайф  $\hat{\theta}_{(-i)}$. Смещение кажется большим из-за домножения на $(N-1)$, вместе с тем разница $(\hat{\theta}_{(-i)}-\hat{\theta})$ намного меньше, чем в случае применения бутстрэпа, поскольку джекнайф выборка отличается от первоначальной выборки только на одно наблюдение. 

Мы получаем джекнайф оценку параметра $\theta$ с коррекцией смещения:

\begin{equation}
\hat{\theta}_{Jack}=\hat{\theta}-(N-1)(\overline{\hat{\theta}}-\hat{\theta})
\end{equation}

\[
=N\hat{\theta}-(N-1)\overline{\hat{\theta}}.
\]
Корректировка позволяет сократить смещение от $O(N^{-1})$ до $O(N^{-2})$, что равно порядку сокращения смещения для бутстрэпа. Также предполагается, что как и в случае бутстрэпа, оценка является  гладкой и $\sqrt{N}$-состоятельной. Джекнайф оценка может иметь большую вариацию, чем $\hat{\theta}$, примеры, где джекнайф не работает даны в Миллер (1974).

Рассмотрим простой пример оценки дисперсии $\sigma^2$ независимо и одинаково распределенных величин выборки $y_i \sim [\mu,\sigma^2]$. ММП оценка дисперсии для нормального распределения, $\hat{\sigma}^2=N^{-1} \sum_{i}(y_i-\overline{y})^2$, имеет математическое ожидание равное $\E[\hat{\sigma^2}]=\sigma^2(N-1)/N$, при этом смещение порядка  $O(N^{-1})$  равно $\hat{\sigma}^2/N$. В данном примере джекнайф оценка упрощается до $\hat{\sigma}^{2}_{Jack}=(N-1)^{-1}\sum_{i}(y_i-\overline{y})^2$, так что не возникает необходимости рассчитывать $N$ оценок дисперсии $\hat{\sigma}^{2}_{(-i)}$ по-отдельности. Джекнайф оценка дисперсии $\sigma^2$ является несмещенной, таким образом, смещение равно нулю, а не $O(N^{-2})$ как в общем случае.

Джекнайф впервые описан Кенуй (1956). Тьюки (1958) рассматривал применение данного метода к различным  статистикам. В частности, джекнайф оценка стандартной ошибки оценки параметра, $\hat{\theta}$, равна 

\begin{equation}
\hat{se}_{Jack}[\hat{\theta}]=\left[\dfrac{N-1}{N}\sum^{N}_{i=1}(\hat{\theta}_{(-i)}-\overline{\hat{\theta}})^2\right]^{1/2}.
\end{equation}
Тьюки предложил термин джекнайф (складной нож) по следующей аналогии: с помощью складного ножа можно  решить различные проблемы, каждая из которых может быть решена более рационально, если применить специально разработанный способ. Джекнайф является приближенным методом для снижения смещения во многих случаях, вместе с тем, данный метод не является идеальным. Джекнайф может быть рассмотрен как линейная аппроксимация бутстрэпа (Эфрон и Тибшарани, 1993, p.146). При использовании выборок малого размера джекнайф требует меньше расчетов, чем  бутстрэп, поскольку тогда вероятно, что $N<B$, однако джекнайф уступает бутстрэпу  при $B \rightarrow \infty$.

Рассмотрим линейную регрессионную модель $y=X\beta+u$, где $\hat{\beta}=(X'X)X'y$. В качестве примера для получения смещенной оценки, возьмем модель временного ряда с лаговой зависимой переменной в качестве регрессора и оценим ее с помощью МНК. Оценка коэффициентов рассчитанная на основе $i$-ой джекнайф выборки  $(X_{(-i)},y_{(-i)})$ равна:

\[
\hat{\beta}_{(-i)}=[X'_{(-i)}X_{(-i)}]^{-1}X'_{(-i)}y_{(-i)}
\]


\[
=[X'X-x_{i}x'_i]^{-1}(X'y-x_{i}y_i)
\]


\[
=\hat{\beta}-[X'X]^{-1}x_i(y_i-x'_{i}\hat{\beta}_{(-i)}).
\]
В третьем равенстве отсутствует необходимость обращать матрицу $X'_{(-i)}X_{(-i)}$, для того, чтобы получить его, заметим, что

\[
[X'X]^{-1}=[X'_{(-i)}X_{(-i)}]^{-1}
-\dfrac{[X'_{(-i)}X_{(-i)}]^{-1} x_i x'_i[X'_{(-i)} X_{(-i)}]^{-1}}{1+x'_{i}[X'_{(-i)}X_{(-i)}]^{-1}x_{i}}.
\]
В данном случае псевдо-значения равны $N\hat{\beta}-(N-1)\hat{\beta}_{(-i)}$ и джекнайф оценка $\hat{\beta}$ равна 

\begin{equation}
\hat{\beta}_{Jack}=N\hat{\beta}-(N-1)\dfrac{1}{N}\sum^{N}_{i=1}\hat{\beta}_{(-i)}.
\end{equation}

Интересным применением джекнайф оценки для снижения смещения является джекнайф оценка для инструментальных переменных (см. раздел 6.4.4).


\section{Практическое применение бутстрэпа}

В данном разделе будет рассмотрено практическое применение бутстрэпа с учетом типичных микроэконометрических усложнений таких, как гетероскедастичность и кластеризация, а также более сложные случаи, которые могут привести к невозможности применить обычный бутстрэп.

\subsection{Гетероскедастичные ошибки}

При применении метода наименьших квадратов для оценки моделей с гетероскедастичными аддитивными ошибками, стандартная процедура предполагает использование ковариационной гетероскедастично-состоятельной матрицы Уайта для оценок (HCCME). Для малых выборок данная матрица плохо работает. При верном применении бутстрэп может способствовать улучшению оценок.

Парный бутстрэп приводит к верным результатам, поскольку предположение о независимости и одинаковом распределении $(y_i,x_i)$ позволяет значениям $\V[u_i|x_i]$ зависеть от $x_i$ (см. Раздел 4.4.7). Однако, парный бутстрэп не позволяет сделать асимптотические уточнения поскольку этот метод не накладывает условия, что $\E[u_i|x_i]=0$.

Бутстрэп остатков приводит к ошибочным результатам, поскольку в этом методе делается предположение о  независимости и одинаковом распределения условных ошибок $u_i|x_i$, а значит ошибочно налагается условие гомоскедастичности ошибок. В обозначениях Раздела 11.4, оценка функции $\hat{F}$ будет несостоятельна для $F$. Возможно специфицировать конкретную модель гетероскедастичности остатков, например, $u_i=\exp(z'_i\alpha)\e_i$, где $\e_i$ независимы и одинаково распределены, затем рассчитать оценку $\exp(z'_i \hat{\alpha})$ и  бутстрэпировать соответствующие значения остатков $\hat{\e}_i$. Состоятельность и асимптотические уточнения для такого бутстрэпа требуют верной спецификации функциональной формы для гетероскедастичности.

Дикий бутстрэп впервые был предложен Ву (1986) и Лю (1988) и дальнейшее развитие получил в работах Маммена (1993), в которых были рассмотрены асимтотические уточнения  без определения структуры гетероскедастичности. В диком бутстрэпе происходит замена МНК остатков, $\hat{u}_i$ на нижеследующие:

\[
\hat{u}^{*}=
\begin{cases} \dfrac{1-\sqrt{5}}{2}\hat{u}_i \simeq -0.6180\hat{u}_i \hspace{1.1cm} \text{с вероятностью} \hspace{0.5cm} \dfrac{1+\sqrt{5}}{2\sqrt{5}} \simeq 0.7236, \\
[1-\dfrac{1-\sqrt{5}}{2}]\hat{u}_i \simeq 1.6180\hat{u}_i \hspace{0.5cm} \text{с вероятностью} \hspace{0.5cm} 1-\dfrac{1+\sqrt{5}}{2\sqrt{5}} \simeq 0.2764.
\end{cases}
\]

Взяв математическое ожидание по отношению к этому распределению, принимающему всего два значения, и после преобразований, получим $\E[\hat{u}^{*}_i]=0$, $\E[\hat{u}^{*2}_i]=\hat{u}^{2}_i$ и $\E[\hat{u}^{*3}_i]=\hat{u}^{3}_i$. Таким образом,  остатки $\hat{u}^{*}_i$,  как и планировалось, имеют нулевое условное среднее, поскольку из условия $\E[\hat{u}^{*}_i|\hat{u}_i,x_i]=0$ следует, что $\E[\hat{u}^*_i|x_i]=0$, в то время как значения второго и третьего моментов не меняются.

При ресэмплинге в диком бутстрэпе  $i$-ое наблюдение равно $(y^{*}_i,x_i)$, где $y^{*}_i=x'\hat{\beta}+\hat{u}^{*}_i$. Значения $y^{*}$ в повторной выборке меняются поскольку меняются значения $\hat{u}^{*}_i$. В симуляциях Хоровиц (1997, 2001)  показал, что дикий бутстрэп работает гораздо лучше, чем парный бутстрэп, когда остатки гетероскедастичны, и хорошо работает на фоне других видов бутстрэпа, даже при отсутствии гетероскедастичности остатков.

Кажется удивительным, что бутстрэп работает, потому что для $i$-того наблюдения он выбирает всего из двух возможных значений для остатков, $-0.6180\hat{u}_i$ или $0.6180\hat{u}_i$. Однако берется одна и та же выборка, которая выбирается из всех $N$ наблюдений и всех $B$ бутстрэп интераций. Вспомним оценку Уайта, в которой $\E[u_i^2]$ заменяется на $\hat{u}_i^2$. Эта оценка, хотя и неверна для одного наблюдения, достоверна при усреднении выборки. Дикий бутстрэп вместо этого выбирает из значений случайной величины, которая принимает всего два значения, с математическим ожиданием 0 и дисперсией $\hat{u}_i^2$.  

\subsection{Панельные и кластеризованные данные}

Рассмотрим регрессионную модель панельных данных

\[
\tilde{y}_{it}=\tilde{w}'_{it}\theta+\tilde{u}_{it},
\]
где $i$ означает индивида и $t$ обозначает время. Следуя обозначениям Раздела 21.2.3 тильда добавлены, т.к. исходные данные $y_{it}$ и $x_{it}$ могли быть преобразованы для исключения фиксированных эффектов. Предположим, что ошибки $\tilde{u}_{it}$ независимы по $i$, при этом ошибки могут быть зависимы и коррелированы по $t$ для заданного $i$. 

Если панель короткая, $T$ конечно и асимптотическая теория опирается на $N \rightarrow \infty$, то состоятельные стандартные ошибки оценки $\hat{\theta}$ могут быть получены при помощи парного бутстрэпа или бутстрэпа эмпирического распределения, в которых создание повторной выборки происходит относительно $i$, а не относительно $t$. Тогда, $w_i$ равно $[y_{i1},x_{i1},\ldots ,y_{iT},x_{iT}]$, и ресэмплинг по $i$ даёт $T$ наблюдений для каждого выбранного $i$.

Такой панельный бутстрэп также называется блочным бутстрэпом, и может быть использован для нелинейных панельных моделей Главы 23. Основным предположением является то, что панель должна быть короткой и данные должны быть независимы по $i$. В общем случае, блочный бутстрэп может быть применен на любых кластеризованных данных (см. Раздел 24.5), при условии, что размер кластера конечен и количество кластеров стремится к бесконечности.

Панельный бутстрэп дает стандартные ошибки асимптотически эквивалентные панельным робастным сэндвич стандартным ошибкам (см. Раздел 21.2.3). Для блочного бутстрэпа асимптотическое уточнение не возникает. При этом данный бутстрэп легко реализовать и он очень полезен, поскольку многие статистические пакеты не рассчитывают панельные робастные стандартных ошибок даже для базовых способов оценки панельных данных, например, для оценки модели с фиксированным эффектом. В зависимости от ситуации, иные виды бутстрэпа, такие как параметрический бутстрэп или  бутстрэп остатков, иногда возможно применить, при этом ресэмплинг снова проводится по $i$.

В случае если ошибки независимо и одинаково распределены асимптотические уточнения получить легко. Однако, более правильно считать, что $\tilde{u}_{it}$ гетероскедастичны и коррелированы по $t$, а не по $i$. Дикий бутстрэп (см. Раздел 11.6.1) дает асимптотические уточнения  для линейных моделей на коротких панелях. При ресэмплинге дикого бутстрэпа $(i,t)$-ое наблюдение выглядит как $(\tilde{y}^{*}_{it},\tilde{w}_{it})$, где $\tilde{y}^{*}_{it}=\tilde{w}'_{it}\theta+\hat{\tilde{u}}_{it}^*$, $\hat{\tilde{u}}_{it}=\tilde{y}_{it}-\tilde{w}'_{it}\hat{\theta}$ и остатки $\hat{\tilde{u}}_{it}^*$ сгенерированы с помощью распределения с двумя значениями, описанного в Разделе 11.6.1.

\subsection{Тестирование гипотез и спецификация тестов}

В Разделе 11.2.6 основное внимание уделено тестированию гипотезы $\theta=\theta_0$. В данном разделе рассматриваются более общие тесты. Также как и в Разделе 11.2.6, для тестирования гипотез может использоваться бутстрэп как с асимтотическим уточнением, так и без. 


\subsubsection*{Тесты без асимптотических уточнений}

Основной пример пользы бутстрэпа --- это  тест Хаусмана (см. Раздел 8.3). Стандартное применение теста Хаусмана требует оценки $\V[\hat{\theta}-\tilde{\theta}]$, где $\hat{\theta}$ и $\tilde{\theta}$ две сравниваемых оценки. Получить  оценку дисперсии достаточно трудно если не предположить, что одна из оценок полностью эффективна при верной  $H_0$. Вместо этого может быть использован парный бутстрэп, который дает состоятельную оценку

\[
\hat{V}_{Boot}[\hat{\theta}-\tilde{\theta}]=\dfrac{1}{B-1}\sum^{B}_{b=1}[(\hat{\theta}^{*}_b-\tilde{\theta}^{*}_{b})-(\overline{\hat{\theta}}^*-\overline{\tilde{\theta}})][(\hat{\theta}^{*}_b-\tilde{\theta}^{*}_b)-(\overline{\hat{\theta}}^*-\overline{\tilde{\theta}}^*)]',
\]
где $\overline{\hat{\theta}}^*=B^{-1}\sum_{b}\hat{\theta}^{*}_b$ и $\overline{\tilde{\theta}}^*=B^{-1}\sum_{b}\tilde{\theta}^{*}_b$. Далее рассчитаем 

\begin{equation}
H=(\hat{\theta}-\tilde{\theta})'(\hat{V}_{Boot}[\hat{\theta}-\tilde{\theta}])^{-1}(\hat{\theta}-\tilde{\theta})
\end{equation}
и полученное значение сравниваем с критическим значением хи-вадрат. Как упоминалось ранее в Главе 8, может потребоваться обобщённая обратная матрица, а также необходима аккуратность при определения критических значений хи-квадрат распределения, т.к. нужно  верно определить степени свободы.


В общем случае, такой подход может быть применен для любого теста со стандартным нормальным или хи-квадрат распределением, реализация которого затруднена необходимостью оценки ковариационной матрицы. Примером может служить двухшаговый способ оценивания и М-тесты, рассмотренные в Главе 8. 

\subsubsection*{Тесты с асимптотическими уточнениями}

Многие тесты, особенно те, которые используются для полностью параметрических моделей, такие как тест множителей Лагранжа и критерий информационной матрицы могут быть легко реализованы с помощью  вспомогательной регрессии (см. Раздел 7.3.5 и 8.2.2). Однако, получаемая тестовая статистика плохо работает на конечных выборках, как это отмечено во многих исследованиях с помощью Монте-Карло. Такие тестовые статистики легко рассчитываются и асимптотически не зависят от неизвестных параметров, т.к. имеют хи-квадрат распределение. Таким образом, эти статистики являются главными кандидатами на асимптотические уточнения с помощью бутстрэпа.

Рассмотрим М-тест гипотезы $H_0:\E[m_i(y_i|x_i,\theta)]=0$ при альтернативной $H_a:\E[m_i(y_i|x_i,\theta)] \neq 0$ (см. Раздел 8.2). Сначала рассчитывается ММП  оценка параметра $\hat{\theta}$  и вычисляется тестовая статистика $M$. Используя параметрический бутстрэп, сгенерируем $y^*_i$ из условного распределения $f(y_i|x_i,\hat{\theta})$ для фиксированных регрессоров в повторных выборках, или используя $f(y_i|x_i^*,\hat{\theta})$. Далее вычисляется $M^*_b, b=1,\ldots, B$ в повторных выборках, созданных при помощи бутстрэпа. Гипотеза $H_0$ отвергается на уровне значимости $\alpha$, если изначально рассчитанная статистика $M$ превышает квантиль уровня $\alpha$ для $M^{*}_b, b=1,\ldots, B$.

Хоровиц (1994) предложил использовать вышеописанный бутстрэп для критерия информационной матрицы и продемонстрировал на примере симуляций, что данный бутстрэпа существенно повышает точность в малых выборках. Друккер (2002) подробно исследует тесты на спецификацию тобит-моделей и приходит к выводу, что тесты на спецификацию с использованием условных моментных ограничений легко реализовать в полностью параметрических моделях,  поскольку любое искажение размера теста во вспомогательной регрессии может быть скорректировано при помощи бутстрэпа.

Отметим, что тесты бутстрэпа без асимптотических уточнений, к примеру, рассмотренный тест Хаусмана, могут быть улучшены при помощи вложенного бутстрэпа, рассмотренного в Разделе 11.5.3.

\subsection{ОММ, метод минимального расстояния и эмпирическое правдоподобие в сверх-идентифицированных моделях}


Обобщенный метод моментов (ОММ) основан на моментных условиях для генеральной совокупности: $\E[h(w_i,\theta)]=0$, (см. Раздел 6.3.1). В точно идентифицированной модели состоятельная оценка является решением уравнения $N^{-1}\sum_{i}h(w_i,\hat{\theta}) = 0$. В сверх-идентифицированной модели такое решение не существует. Вместо  этого используется ОММ оценка (см. Раздел 6.3.2).

Рассмотрим использование парного бутстрэпа или  бутстрэп эмпирического распределения. Для ОММ в сверх-идентифицированных моделях $N^{-1}\sum_{i}h(w_i,\hat{\theta}) \neq 0$, поэтому на бутстрэповские выборки  не накладывается ограничение  $\E[h(w_i,\theta)]=0$. В результате чего, даже при использовании  $t$-статистики асимптотически не зависящей от неизвестных параметров не происходит асимптотического уточнения.  При этом бутстрэп оценки $\hat{\theta}$ и соответствующие доверительные интервалы и $t$-статистики остаются состоятельными. Более фундаментально, можно доказать, что применение бутстрэпа к тестам на сверх-идентифицирующие ограничений (OIR-тест) (см. раздел 6.3.8) приводит к несостоятельным результатам. В данном разделе основное внимание уделяется пространственным данным, но аналогичная проблема может возникнуть и при использовании  ОММ для панельных данных (см. Главу 22) в сверх-идентифицированных моделях.

Холл и Хоровиц (1996) предложили бороться со сверх-идентифицированностью при помощи повторного центрирования. Согласно их подходу в основе бутстрэпа лежит $h^{*}(w_i,\hat{\theta})=h(w_i,\hat{\theta})-N^{-1} \sum_{i} h(w_i,\hat{\theta})$, асимптотические уточнения  можно сделать для статистик, рассчитанных на основе $\hat{\theta}$, включая OIR тест на сверх-идентифицированность ограничений. 

Хоровиц (1998) провел аналогичное повторное центрирование для метода минимального расстояния (см. Раздел 6.7). Далее автор применил бутстрэп к ковариационной структуре, рассмотренной Альтонжи и Сигал (1996), см. Раздел 6.3.5.

Альтернативная корректировка была предложена в работе Браун и Ньюи (2002), идея заключается в том, чтобы вместо повторного центрирования делать ресэмплинг наблюдений $w_i$ с вероятностями не всегда равными $1/N$, а отличающихся для разных наблюдений. К примеру, допустим, что $\Pr[w^{*}=w_i]=\hat{\pi}_i$, где $\hat{\pi}_i=(1+\hat{\lambda}'\hat{h}_i)$, $\hat{h}_i=h(w_i,\hat{\theta})$, и $\hat{\lambda}$ максимизирует выражение $\sum_{i}\ln(1+\hat{\lambda}'\hat{h}_i)$. Обоснование такого расчета состоит в том, что вероятности $\hat{\pi}_i$ также являются решением задачи эмпирического правдоподобия (см. Раздел 6.8.2), когда максимизируется $\sum_{i}\ln{\pi}$ по $\pi_1,\ldots ,\pi_N$, при ограничениях $\sum_{i}\pi_{i}\hat{h}_i=0$ и $\sum_{i}\pi_{i}=1$. Таким образом, бутстрэп эмпирического правдоподобия оценок ОММ накладывает ограничение вида $\sum_{i}\hat{\pi}_{i}\hat{h}_{i}=0$.

Также возможно изначально использовать оценку эмпирического правдоподобия $\hat{\theta}$, а не ОММ оценку. Преимущество подхода Брауна и Ньюи (2002) состоит в отсутствии трудных вычислений, возникающих при эмпирическом правдоподобии. Вместо этого  необходимо только рассчитать оценку ОММ и решить задачу  минимизации  вогнутой функции $\sum_{i}\ln(1+\hat{\lambda}'\hat{h}_i)$. 

\subsection{Непараметрическая регрессия}

Непараметрические оценки функции плотности  регрессии сходятся со скоростью меньше, чем $\sqrt{N}$ и асимптотически смещены. Это усложняет статистические выводы, например, построение доверительных интервалов (см. Раздел 9.3.7 и 9.5.4).

Рассмотрим ядерную оценку регрессии $\hat{m}(x_0)$ функции $m(x_0)=\E[y|x=x_0]$ для независимо и одинаково распределенных данных $(y,x)$ , при этом допускается условная гетероскедастичность остатков. Как было отмечено у Хоровиц (2001, p.3204),  статистикой асимптотически независящая от неизвестных параметров будет:

\[
t=\dfrac{\hat{m}(x_0)-m(x_0)}{s_{\hat{m}(x_0)}},
\] 
где $\hat{m}(x_0)$ недосглаженая ядерная оценка  регрессии с шириной окна $h=o(N^{-1/3})$ отличной от оптимальной $h^{*}=O(N^{-1/5})$ и 

\[
s^{2}_{\hat{m}(x_0)}=\dfrac{1}{Nh{[\hat{f}(x_0)]}^2}\sum^{N}_{i=1}{(y_i-\hat{m}(x_i))}^{2}K{\left(\dfrac{x_i-x_0}{h}\right)}^2,
\]
где $\hat{f}(x_0)$ --- ядерная оценка функции распределения $f(x)$ в точке $x=x_0$. Применение парного бутстрэпа дает ресэмплинг пар $(y^{*},x^{*})$ и статистики $t^{*}_{b}=[\hat{m}^{*}_{b}(x_0)-m(x_0)]/s^{*}_{\hat{m}(x_0),b}$, где $s^{*}_{\hat{m}(x_0),b}$ рассчитана с использованием  бутстрэповской выборки  ядерных оценок $\hat{m}^{*}_b (x_i)$ и $\hat{f}^{*}_{b}(x_0)$. Метод $t$-перцентильного доверительного интервала, рассмотренный в Разделе 11.2.7, дает асимптотическое уточнение. Для симметричного доверительного интервала или симметричного теста уровня значимости $\alpha$ ошибка равна $o((Nh^{-1}))$ вместо $O((Nh^{-1}))$, которая получается при использовании асимптотического приближения первого порядка.

Возможно несколько вариантов представленного бутстрэпа. Вместо недосглаживания для исключения смещения возможно непосредственно оценивать смещение, указанное в Разделе 9.5.2. Также, вместо $s^{2}_{\hat{m}(x_0)}$ можно использовать явную оценку дисперсии из Раздела 9.5.2.

В работе Ячью (2003) представлено много деталей применения бутстрэпа для параметрических и полупараметрических регрессий.


\subsection{Негладкие оценки}

В Разделе 11.4.2 одним из предположений при использовании бутстрэпа была гладкость оценок и статистик. Если данная предпосылка не выполняется, то в результате бутстрэп может не привести к асимптотическим уточнениям, и даже может быть полностью неверным.

В качестве примера рассмотрим метод наименьших абсолютных отклонений и бинарные данные. В методе наименьших абсолютных отклонений (см. Раздел 4.6.2) целевая функция имеет вид $\sum_{i}|y_i-x'_{i}\beta|$, первая производная этой функции разрывна. В таком случае применение бутстрэпа может дать верное асимптотическое приближение, но не асимптотическое уточнение. Для бинарных результатов метод наименьших абсолютных значений сводится к методу максимального скоринга Мански (1975) (см. Раздел 14.7.2). Для бинарных данных бутстрэп несостоятелен.

В приведенных примерах бутстрэп с асимптотическими уточнениями может быть получен при использовании сглаженного варианта целевой функции. К примеру, сглаженный метод максимального скоринга Хоровица (1992) рассмотрен в Разделе 14.7.2.


\subsection{Временные ряды}

Методология бутстрэпа построена на создании повторной выборки из независимо и одинаково распределенных величин. Использование временных рядов вызывает очевидные трудности поскольку для этого типа данных характерна зависимость наблюдений.

Применение бутстрэпа не вызывает затруднений в линейных моделях с ARMA ошибками, в которых делают ресэмплинг ошибки, являющейся белым шумом. Например, предположим, что $y_t=\beta{x}_t+u_t$, где $u_t=\rho{u}_{t-1} + \e_t$ и $\e_t$ --- белый шум. Тогда, используя полученные оценки $\hat{\beta}$ и $\rho$ мы можем рекурсивно посчитать остатки $\hat{\e}_t=\hat{u}_t-\hat{\rho} \hat{u}_{t-1}=y_t-x_{t}\hat{\beta}-\hat{\rho}(y_{t-1}-x_{t-1}\hat{\beta})$. Бутстрэпируя эти остатки, можем получить новые значения $\hat{\e}^{*}_{t},t=1,\ldots ,T$ и рекурсивно рассчитать $\hat{u}^{*}_{t}=\rho\hat{u}^{*}_{t-1}+\hat{\e}^{*}_{t}$, тогда новые значения зависимой переменной будут равны $y^{*}_{t}=\hat{\beta}x_{t}+\hat{u}^{*}_{t}$. Далее строим регрессию $y^*_t$ на $x_t$ с AR(1) ошибками. Ранее аналогичный пример был приведен в работе Фридмана (1984), который использовал бутстрэп для динамической модели системы линейных уравнений, оцененной с помощью двухшагового МНК. С учетом линейности, одновременность добавляет мало проблем. Динамическая структура модели приводит к рекурсивному построению  $y^{*}_t=f(y^{*}_{t-1},x,u^{*}_t)$, где $u^{*}_t$ получены путем ресэмплинга остатков структурных уравнений, оцененных двухшаговым МНК и $y^{*}_0=y_0$. Далее применяем двухшаговый МНК на каждой выборки бутстрэпа.

В рассмотренном методе предполагается, что ошибки  независимо и одинаково распределены. Для общего случая, без ARMA спецификации, например для  нестационарных данных, может быть применен блочный бутстрэп (см. Раздел 11.5.2).

При проведении теста на наличие единичного корня или коинтеграции необходимо особая осторожность, поскольку при наличии единичного корня тестовая статистика разрывна, см. Ли и Маддала (1997). Не смотря на то, что при наличии единичного корня возможно применить бутстрэп, в настоящее время имеющиеся виды бутстрэпа не дают асимптотические уточнения.

\section{Практические соображения}

Бутстрэп без асимптотических уточнений может быть очень полезен для исследователя в тех ситуациях, когда задачу трудно решить другими способами. 
Эта необходимость зависит от доступного программного обеспечения и методов. 
В настоящее время самое распространенное применение бутстрэпа --- это вычисления оценок стандартных ошибок для теста Вальда. 
Приложения включают в себя тесты устойчивые к гетероскедастичности, робастные тесты для панельных данных, тесты для двухшаговых оценок и тесты для функций от оцениваемых параметров.
Также возможно применение бутстрэпа для М-тестов, например, для теста Хаусмана.

Кроме этого бутстрэп даёт возможность получить асимптотические уточнения.
Большое количество исследований Монте-Карло говорит о том, что популярные методы могут плохо работать на малых выборках.
Похоже здесь открывается широкая перспектива для асимптотических уточнений с помощью бутстрэпа, пока еще мало освоенная.
В некоторых случаях можно добавить точности существующим методам, например, это касается дикого бутстрэпа в моделях с аддитивными гетероскедастичными ошибками.
В других случаях можно использовать методы, которые пока еще не так часто используются.
Например, можно реализовать тесты на спецификацию моделей с хорошими свойствами в малых выборках с помощью бутстрэпа на этапе вспомогательной регрессии.

Существует два препятствия для использования бутстрэпа.
Во-первых, бутстрэп не всегда реализован в статистических пакетах по умолчанию.
Со временем эта ситуация изменится, и сейчас написание кода для бутстрэпа не является слишком сложным, если программа позволяет писать циклы и сохранять результаты оценивания регрессий.
Во-вторых, есть определенные тонкости.
Асимптотические уточнения возможны только для статистик не зависящих асимптотически от неизвестных параметров.
Простые виды бутстрэпа предполагают независимые и одинаково распределенные данные гладкость оценок и статистик. 
Этого достаточно для большинства, но не для всех приложений.


\section{Библиографические примечания}

Впервые бутстрэп был предложен Эфроном (1979) для независимо и одинаково распределенных данных. Ранняя теория бутстрэпа была представлена в работах Сингха (1981) и Бикеля и Фридман (1981). Хорошие статистическое введение можно найти в работе Эфрона и Тибшарани (1993), более углубленное --- в работе Холла (1992). Случай регрессии также был рассмотрен довольно рано, например,  у Фридмана (1984). Большинство  работ эконометристов появилось в последние 10 лет. Обширный обзор был составлен Хоровицом (2001), его хорошо дополняют работа Браунстоуна и Казими (1998), рассматривающая много эконометрических приложений, а также статья МакКиннона (2002).


\subsection{Упражнения}

\begin{enumerate}
\item [$11 - 1$] Рассмотрим регрессионную модель $y=\alpha+\beta x+\e$, где $\alpha, \beta$, и $x$ скаляры и $\e$ распределено нормально, $\e \sim \cN[0,\sigma^2]$. Сгенерируйте выборку размером $N=20$ c $\alpha=2, \beta=1$, и $\sigma^2=1$, и $x \sim \cN[2,2]$. Мы хотим протестировать $H_0:\beta=1$ против $H_a:\beta \neq 1$ на уровне значимости 0.05, используя $t$-статистику, $t=(\hat{\beta}-1)/se[\hat{\beta}]$. Сделайте столько заданий, сколько позволяет ваше программное обеспечение. Количество репликаций бутстрэпа $B=499$.
\begin{enumerate}
\item Оцените модель методом МНК и рассчитайте $\hat{\beta}$.
\item Рассчитайте стандартную ошибку методом парного бутстрэпа и сравните полученное значение с первоначальным. Протестируйте гипотезу $H_0$ с использованием вычисленной стандартной ошибки.\item  Протестируйте гипотезу $H_0$, используя парный бутстрэп с асимптотическими уточнениями.
\item Рассчитайте стандартную ошибку методом бутстрэпа остатков и сравните полученное значение с первоначальным. Протестируйте гипотезу $H_0$ с использованием вычисленной стандартной ошибки.
\item Протестируйте гипотезу $H_0$, используя  бутстрэп остатков с асимптотическими уточнениями.
\end{enumerate}

\item [$11 - 2$] Сгенерируйте выборку размера 20 в соответствии со следующим процессом порождающим данные. Имеются два регрессора $x_1\sim \chi^2(4)-4$ и $x_2 \sim 3.5+\mathcal{U}[1,2]$; ошибки рассчитываются из смешения двух нормальных распределений $u\sim \cN[0,25]$ с вероятностью 0.3 и $u \sim \cN[0,5]$ с вероятностью 0.7; и зависимая переменная $y$ задана уравнением $y=1.3x_1+0.7x_2+0.5u$.
\begin{enumerate}
\item Оцените модель $y=\beta_0+\beta_1{x_1}+\beta_2{x_2}+u$ с помощью МНК.
\item Предположим, что на основе данных нам необходимо оценить $\gamma=\beta_1+\beta^2$. Для оценки параметра используйте метод наименьших квадратов. Используйте дельта-метод для того, чтобы получить приближенную оценку стандартной ошибки данной функции.
\item Оцените стандартную ошибку $\hat{\gamma}$ с помощью парного бутстрэпа. Сравните полученное значение с $se[\hat{\gamma}]$, полученной в пункте (b) и объясните разницу. Для бутстрэпа используйте $B=25$ и $B=200$. 
\item Протестируйте гипотезу $H_0: \gamma=1.0$ на уровне значимости 0.05 используя парный бутстрэп с $B=200$. Проведите тесты бутстрэпа с асимптотическими уточнениями и без.
\end{enumerate}

\item [$11 - 3$] Используя 200 наблюдений из Раздела 4.6.4 по данным логарифма уровня затрат на здоровье $(y)$ и натурального логарифма общих затрат $(x)$, оцените модель $y=\alpha+\beta x +u$ с помощью МНК. Используйте парный бутстрэп, $B=999$.
\begin{enumerate}
\item Получите оценку стандартной ошибки параметра $\hat{\beta}$ методом бутстрэпа.
\item Используя оценку стандартной ошибки, протестируйте гипотезу $H_0:\beta=1$ при альтернативой гипотезе $H_a:\beta \neq 1$.
\item Проведите  бутстрэп тест гипотезы $H_0:\beta=1$ с уточнениями  против альтернативной $H_a:\beta \neq 1$, предполагая что остатки $u$ гомоскедастичны.
\item Какие результаты будут получены, если в пункте (c) предположить, что остатки $u$ гетероскедастичны? Является ли тест асимптотически верным? Если да, то возможно ли получить асимптотические уточнения?
\item Примените бутстрэп для получения оценки параметра $\beta$, скорректированной на смещение.
\end{enumerate}
\end{enumerate}

